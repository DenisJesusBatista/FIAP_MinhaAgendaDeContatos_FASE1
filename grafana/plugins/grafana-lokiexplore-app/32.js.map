{"version":3,"file":"32.js","mappings":"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","sources":["webpack://grafana-lokiexplore-app/./Components/FilterButton.tsx","webpack://grafana-lokiexplore-app/./Components/GrotError.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/PatternTag.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/PatternControls.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/GiveFeedbackButton.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/InterceptBanner.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/CustomVariableValueSelectors.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/LayoutScene.tsx","webpack://grafana-lokiexplore-app/./services/TagValuesProviders.ts","webpack://grafana-lokiexplore-app/./services/TagKeysProviders.ts","webpack://grafana-lokiexplore-app/./Components/IndexScene/IndexScene.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/ShowLogsButtonScene.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/ToolbarScene.tsx","webpack://grafana-lokiexplore-app/./Components/Pages.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/AddToExplorationButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/AddToFiltersButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldSelector.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/GoToExploreButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SearchInput.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LineFilterIcon.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LineFilterScene.tsx","webpack://grafana-lokiexplore-app/./services/logsFrame.ts","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableColumnsContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableCellContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableHeaderContext.tsx","webpack://grafana-lokiexplore-app/./services/search.ts","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsColumnSearch.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableEmptyFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableNavField.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableActiveFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableAvailableFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableMultiSelect.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/ColumnSelectionDrawerWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/DefaultCellWrapComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/QueryContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/CellContextMenu.tsx","webpack://grafana-lokiexplore-app/./Components/Table/constants.ts","webpack://grafana-lokiexplore-app/./Components/Table/DefaultPill.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LineActionIcons.tsx","webpack://grafana-lokiexplore-app/./Components/Table/DefaultCellComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogLinePill.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Scroller.tsx","webpack://grafana-lokiexplore-app/./Components/Table/RawLogLineText.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogLineCellComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsTableHeader.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsTableHeaderWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Table.tsx","webpack://grafana-lokiexplore-app/./Components/Table/TableWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/TableProvider.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsHeaderActions.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsTableScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogOptionsScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/CopyLinkButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsPanelScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsListScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SortByScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LayoutSwitcher.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/NumericFilterPopoverScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SelectLabelActionScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/TimeSeriesLimitSeriesTitleItem.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldsAggregatedBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldValuesBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/StatusWrapper.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/EmptyLayoutScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldsBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./services/labels.ts","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelValuesBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/BreakdownSearchScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/ByFrameRepeater.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelsAggregatedBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/FilterByPatternsButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternFieldLabelStatsRow.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternFieldLabelStats.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternNameLabel.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsLogsSampleScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsTableExpandedRow.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsViewTableScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsFrameScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsViewTextSearch.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsNotDetected.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./services/expressions.ts","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsVolumePanel.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/BreakdownViews.ts","webpack://grafana-lokiexplore-app/./Components/ServiceScene/ActionBarScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/ServiceScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/FavoriteServiceHeaderActionScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/SelectServiceButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ConfigureVolumeError.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/NoServiceSearchResults.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/TabPopoverScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ServiceSelectionTabsScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/NoServiceVolume.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/AddLabelToFiltersHeaderActionScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ServiceSelectionScene.tsx","webpack://grafana-lokiexplore-app/./services/CustomConstantVariable.ts","webpack://grafana-lokiexplore-app/./services/analytics.ts","webpack://grafana-lokiexplore-app/./services/comparison.ts","webpack://grafana-lokiexplore-app/./services/logql.ts","webpack://grafana-lokiexplore-app/./services/combineResponses.ts","webpack://grafana-lokiexplore-app/./services/shardQuerySplitting.ts","webpack://grafana-lokiexplore-app/./services/datasource.ts","webpack://grafana-lokiexplore-app/./services/favorites.ts","webpack://grafana-lokiexplore-app/./services/fields.ts","webpack://grafana-lokiexplore-app/./services/filters.ts","webpack://grafana-lokiexplore-app/./services/levels.ts","webpack://grafana-lokiexplore-app/./services/logger.ts","webpack://grafana-lokiexplore-app/./services/metadata.ts","webpack://grafana-lokiexplore-app/./services/navigate.ts","webpack://grafana-lokiexplore-app/./services/LogsSceneQueryRunner.ts","webpack://grafana-lokiexplore-app/./services/panel.ts","webpack://grafana-lokiexplore-app/./services/plugin.ts","webpack://grafana-lokiexplore-app/./services/query.ts","webpack://grafana-lokiexplore-app/./services/routing.ts","webpack://grafana-lokiexplore-app/./services/scenes.ts","webpack://grafana-lokiexplore-app/./services/sorting.ts","webpack://grafana-lokiexplore-app/./services/store.ts","webpack://grafana-lokiexplore-app/./services/testIds.ts","webpack://grafana-lokiexplore-app/./services/text.ts","webpack://grafana-lokiexplore-app/./services/variableGetters.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { testIds } from 'services/testIds';\n\ntype Props = {\n  onInclude: () => void;\n  onClear: () => void;\n  isIncluded: boolean;\n  onExclude: () => void;\n  isExcluded: boolean;\n  buttonFill: 'solid' | 'outline' | 'text';\n  titles?: {\n    include: string;\n    exclude: string;\n  };\n};\n\nexport const FilterButton = (props: Props) => {\n  const { isExcluded, isIncluded, onInclude, onExclude, onClear, titles, buttonFill } = props;\n  const styles = useStyles2(getStyles, isIncluded, isExcluded);\n  return (\n    <div className={styles.container}>\n      <Button\n        variant={isIncluded ? 'primary' : 'secondary'}\n        fill={buttonFill}\n        size=\"sm\"\n        aria-selected={isIncluded}\n        className={styles.includeButton}\n        onClick={isIncluded ? onClear : onInclude}\n        data-testid={testIds.exploreServiceDetails.buttonFilterInclude}\n        title={titles?.include}\n      >\n        Include\n      </Button>\n      <Button\n        variant={isExcluded ? 'primary' : 'secondary'}\n        fill={buttonFill}\n        size=\"sm\"\n        aria-selected={isExcluded}\n        className={styles.excludeButton}\n        onClick={isExcluded ? onClear : onExclude}\n        title={titles?.exclude}\n        data-testid={testIds.exploreServiceDetails.buttonFilterExclude}\n      >\n        Exclude\n      </Button>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2, isIncluded: boolean, isExcluded: boolean) => {\n  return {\n    container: css({\n      display: 'flex',\n      justifyContent: 'center',\n    }),\n    includeButton: css({\n      borderRadius: 0,\n      borderRight: isIncluded ? undefined : 'none',\n    }),\n    excludeButton: css({\n      borderRadius: `0 ${theme.shape.radius.default} ${theme.shape.radius.default} 0`,\n      borderLeft: isExcluded ? undefined : 'none',\n    }),\n  };\n};\n","import React from 'react';\n\nimport { css } from '@emotion/css';\nimport SVG from 'react-inlinesvg';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, useTheme2, Text } from '@grafana/ui';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    graphicContainer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      margin: '0 auto',\n    }),\n    graphic: css({ width: '200px', height: '120px', padding: theme.spacing(1) }),\n    text: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n    }),\n    wrap: css({\n      margin: '0 auto',\n    }),\n  };\n};\n\ntype Props = {\n  children?: React.ReactNode;\n};\n\nexport const GrotError = ({ children }: React.PropsWithChildren<Props>) => {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n  return (\n    <div className={styles.wrap}>\n      <div className={styles.graphicContainer}>\n        <SVG\n          className={styles.graphic}\n          src={\n            theme.isDark\n              ? `/public/plugins/grafana-lokiexplore-app/img/grot_err.svg`\n              : `/public/plugins/grafana-lokiexplore-app/img/grot_err_light.svg`\n          }\n        />\n      </div>\n      <div className={styles.text}>\n        <Text textAlignment=\"center\" color=\"primary\" element=\"span\">\n          {children ? children : 'An error occurred'}\n        </Text>\n      </div>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { Button, Icon, Tag, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport React, { useState } from 'react';\nimport { testIds } from 'services/testIds';\n\ninterface Props {\n  onRemove(): void;\n  pattern: string;\n  size?: PatternSize;\n}\n\ntype PatternSize = 'sm' | 'lg';\n\nexport const PatternTag = ({ onRemove, pattern, size = 'lg' }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [expanded, setExpanded] = useState(false);\n  return (\n    <div className={styles.pattern} onClick={() => setExpanded(!expanded)} onMouseLeave={() => setExpanded(false)}>\n      <Tag\n        title={pattern}\n        key={pattern}\n        name={expanded ? pattern : getPatternPreview(pattern, size)}\n        className={styles.tag}\n      />\n      <Button\n        aria-label=\"Remove pattern\"\n        data-testid={testIds.exploreServiceDetails.buttonRemovePattern}\n        variant=\"secondary\"\n        size=\"sm\"\n        className={styles.removeButton}\n        onClick={onRemove}\n      >\n        <Icon name=\"times\" />\n      </Button>\n    </div>\n  );\n};\n\nconst PREVIEW_WIDTH: Record<PatternSize, number> = {\n  sm: 50,\n  lg: Math.round(window.innerWidth / 8),\n};\n\nfunction getPatternPreview(pattern: string, size: PatternSize) {\n  const length = pattern.length;\n  if (length < PREVIEW_WIDTH[size]) {\n    return pattern;\n  }\n\n  const substringLength = Math.round(PREVIEW_WIDTH[size] * 0.4);\n\n  return `${pattern.substring(0, substringLength)} … ${pattern.substring(length - substringLength)}`;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    pattern: css({\n      display: 'flex',\n      fontFamily: 'monospace',\n      gap: theme.spacing(0.25),\n      cursor: 'pointer',\n      overflow: 'hidden',\n    }),\n    tag: css({\n      borderTopRightRadius: 0,\n      borderBottomRightRadius: 0,\n      backgroundColor: theme.colors.secondary.main,\n      border: `solid 1px ${theme.colors.secondary.border}`,\n      color: theme.colors.secondary.text,\n      boxSizing: 'border-box',\n      padding: theme.spacing(0.25, 0.75),\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n    }),\n    removeButton: css({\n      paddingLeft: 2.5,\n      paddingRight: 2.5,\n    }),\n  };\n};\n","import React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { AppliedPattern } from './IndexScene';\nimport { PatternTag } from './PatternTag';\nimport { css } from '@emotion/css';\nimport { useStyles2, Text } from '@grafana/ui';\nimport { USER_EVENTS_ACTIONS, USER_EVENTS_PAGES, reportAppInteraction } from 'services/analytics';\nimport { testIds } from 'services/testIds';\n\ntype Props = {\n  patterns: AppliedPattern[] | undefined;\n  onRemove: (patterns: AppliedPattern[]) => void;\n};\nexport const PatternControls = ({ patterns, onRemove }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  if (!patterns || patterns.length === 0) {\n    return null;\n  }\n\n  const includePatterns = patterns.filter((pattern) => pattern.type === 'include');\n  const excludePatterns = patterns.filter((pattern) => pattern.type !== 'include');\n\n  const onRemovePattern = (pattern: AppliedPattern) => {\n    onRemove(patterns.filter((pat) => pat !== pattern));\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_removed, {\n      includePatternsLength: includePatterns.length - (pattern?.type === 'include' ? 1 : 0),\n      excludePatternsLength: excludePatterns.length - (pattern?.type !== 'include' ? 1 : 0),\n      type: pattern.type,\n    });\n  };\n\n  return (\n    <div>\n      {includePatterns.length > 0 && (\n        <div className={styles.patternsContainer}>\n          <Text variant=\"bodySmall\" weight=\"bold\" data-testid={testIds.patterns.buttonIncludedPattern}>\n            Included pattern{patterns.length > 1 ? 's' : ''}\n          </Text>\n          <div className={styles.patterns}>\n            {includePatterns.map((p) => (\n              <PatternTag key={p.pattern} pattern={p.pattern} size=\"lg\" onRemove={() => onRemovePattern(p)} />\n            ))}\n          </div>\n        </div>\n      )}\n      {excludePatterns.length > 0 && (\n        <div className={styles.patternsContainer}>\n          <Text variant=\"bodySmall\" weight=\"bold\" data-testid={testIds.patterns.buttonExcludedPattern}>\n            Excluded pattern{excludePatterns.length > 1 ? 's' : ''}:\n          </Text>\n          <div className={styles.patterns}>\n            {excludePatterns.map((p) => (\n              <PatternTag\n                key={p.pattern}\n                pattern={p.pattern}\n                size={excludePatterns.length > 1 ? 'sm' : 'lg'}\n                onRemove={() => onRemovePattern(p)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    patternsContainer: css({\n      paddingBottom: theme.spacing(1),\n      overflow: 'hidden',\n    }),\n    patterns: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      alignItems: 'center',\n      flexWrap: 'wrap',\n    }),\n  };\n}\n","import React from 'react';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport const GiveFeedbackButton = () => {\n  const styles = useStyles2(getStyles);\n  return (\n    <div className={styles.wrapper}>\n      <a\n        href=\"https://forms.gle/1sYWCTPvD72T1dPH9\"\n        className={styles.feedback}\n        title=\"Share your thoughts about Logs in Grafana.\"\n        target=\"_blank\"\n        rel=\"noreferrer noopener\"\n      >\n        <Icon name=\"comment-alt-message\" /> Give feedback\n      </a>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      display: 'flex',\n      marginLeft: 'auto',\n      gap: theme.spacing(1),\n      position: 'relative',\n      top: theme.spacing(-1),\n    }),\n    feedback: css({\n      alignSelf: 'center',\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n  };\n};\n","import { Alert, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport function InterceptBanner(props: { onRemove: () => void }) {\n  const styles = useStyles2(getStyles);\n  return (\n    <>\n      <Alert className={styles.alert} severity={'info'} title={'Welcome to Explore Logs!'} onRemove={props.onRemove}>\n        <div>\n          Check out our{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://grafana.com/docs/grafana-cloud/visualizations/simplified-exploration/logs/\"\n            rel=\"noreferrer\"\n          >\n            Get started doc\n          </a>\n          , or see{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://github.com/grafana/explore-logs/releases\"\n            rel=\"noreferrer\"\n          >\n            recent changes\n          </a>\n          .<br />\n          Help us shape the future of the app.{' '}\n          <a className=\"external-link\" target=\"_blank\" href=\"https://forms.gle/1sYWCTPvD72T1dPH9\" rel=\"noreferrer\">\n            Send us feedback\n          </a>{' '}\n          or engage with us on{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://github.com/grafana/explore-logs/?tab=readme-ov-file#explore-logs\"\n            rel=\"noreferrer\"\n          >\n            GitHub\n          </a>\n          .\n        </div>\n      </Alert>\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    alert: css({\n      flex: 'none',\n    }),\n  };\n}\n","import {\n  ControlsLayout,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VariableValueSelectWrapper,\n} from '@grafana/scenes';\nimport React from 'react';\n\nexport interface VariableValueSelectorsState extends SceneObjectState {\n  layout?: ControlsLayout;\n  include?: string[];\n  exclude?: string[];\n}\n\nexport class CustomVariableValueSelectors extends SceneObjectBase<VariableValueSelectorsState> {\n  public static Component = CustomVariableValueSelectorsRenderer;\n}\n\nfunction CustomVariableValueSelectorsRenderer({ model }: SceneComponentProps<CustomVariableValueSelectors>) {\n  const variablesSetState = sceneGraph.getVariables(model).useState();\n  let variables = variablesSetState.variables;\n\n  if (model.state.include?.length) {\n    variables = variablesSetState.variables.filter((variable) =>\n      model.state.include?.includes(variable.state.name ?? '')\n    );\n  }\n  if (model.state.exclude?.length) {\n    variables = variablesSetState.variables.filter(\n      (variable) => !model.state.exclude?.includes(variable.state.name ?? '')\n    );\n  }\n\n  return (\n    <>\n      {variables.map((variable) => (\n        <VariableValueSelectWrapper key={variable.state.key} variable={variable} layout={model.state.layout} />\n      ))}\n    </>\n  );\n}\n","import { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, SceneFlexLayout, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { PatternControls } from './PatternControls';\nimport { AppliedPattern, IndexSceneState } from './IndexScene';\nimport { css, cx } from '@emotion/css';\nimport { GiveFeedbackButton } from './GiveFeedbackButton';\nimport { InterceptBanner } from './InterceptBanner';\n\nimport { PLUGIN_ID } from '../../services/plugin';\nimport { CustomVariableValueSelectors } from './CustomVariableValueSelectors';\n\ninterface LayoutSceneState extends SceneObjectState {\n  interceptDismissed: boolean;\n}\n\nconst interceptBannerStorageKey = `${PLUGIN_ID}.interceptBannerStorageKey`;\n\nexport class LayoutScene extends SceneObjectBase<LayoutSceneState> {\n  constructor(state: Partial<LayoutSceneState>) {\n    super({\n      ...state,\n      interceptDismissed: !!localStorage.getItem(interceptBannerStorageKey),\n    });\n  }\n\n  public dismiss() {\n    this.setState({\n      interceptDismissed: true,\n    });\n    localStorage.setItem(interceptBannerStorageKey, 'true');\n  }\n\n  static Component = ({ model }: SceneComponentProps<LayoutScene>) => {\n    if (!model.parent) {\n      return null;\n    }\n\n    const { controls, contentScene, patterns } = model.parent.useState() as IndexSceneState;\n    const { interceptDismissed } = model.useState();\n    if (!contentScene) {\n      return null;\n    }\n\n    const styles = useStyles2(getStyles);\n    return (\n      <div className={styles.bodyContainer}>\n        <div className={styles.container}>\n          {!interceptDismissed && (\n            <InterceptBanner\n              onRemove={() => {\n                model.dismiss();\n              }}\n            />\n          )}\n          {controls && (\n            <div className={styles.controlsContainer}>\n              <div className={styles.controlsFirstRowContainer}>\n                <div className={styles.filtersWrap}>\n                  <div className={cx(styles.filters, styles.firstRowWrapper)}>\n                    {controls.map((control) => {\n                      return control instanceof SceneFlexLayout ? (\n                        <control.Component key={control.state.key} model={control} />\n                      ) : null;\n                    })}\n                  </div>\n                </div>\n                <div className={styles.controlsWrapper}>\n                  <GiveFeedbackButton />\n                  <div className={styles.controls}>\n                    {controls.map((control) => {\n                      return !(control instanceof CustomVariableValueSelectors) &&\n                        !(control instanceof SceneFlexLayout) ? (\n                        <control.Component key={control.state.key} model={control} />\n                      ) : null;\n                    })}\n                  </div>\n                </div>\n              </div>\n              <div className={styles.controlsSecondRowContainer}>\n                <div className={styles.filtersWrap}>\n                  <div className={styles.filters}>\n                    {controls.map((control) => {\n                      return control instanceof CustomVariableValueSelectors ? (\n                        <control.Component key={control.state.key} model={control} />\n                      ) : null;\n                    })}\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n          <PatternControls\n            patterns={patterns}\n            onRemove={(patterns: AppliedPattern[]) => model.parent?.setState({ patterns } as IndexSceneState)}\n          />\n          <div className={styles.body}>{contentScene && <contentScene.Component model={contentScene} />}</div>\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    firstRowWrapper: css({\n      '& > div > div': {\n        gap: '16px',\n        label: 'first-row-wrapper',\n\n        [theme.breakpoints.down('lg')]: {\n          flexDirection: 'column',\n        },\n\n        // The datasource variable width should be auto, not fill the section\n        '& > div:first-child': {\n          flex: '1 0 auto',\n          display: 'inline-block',\n        },\n      },\n    }),\n    bodyContainer: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      gap: theme.spacing(1),\n      minHeight: '100%',\n      flexDirection: 'column',\n      padding: theme.spacing(2),\n      maxWidth: '100vw',\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n    }),\n    controlsFirstRowContainer: css({\n      display: 'flex',\n      gap: theme.spacing(2),\n      justifyContent: 'space-between',\n      alignItems: 'flex-start',\n      marginBottom: theme.spacing(2),\n    }),\n    controlsSecondRowContainer: css({\n      display: 'flex',\n      gap: theme.spacing(2),\n      justifyContent: 'space-between',\n      alignItems: 'flex-start',\n    }),\n    controlsContainer: css({\n      label: 'controlsContainer',\n    }),\n    filters: css({\n      label: 'filters',\n    }),\n    filtersWrap: css({\n      label: 'filtersWrap',\n      display: 'flex',\n      gap: theme.spacing(2),\n      width: 'calc(100% - 450)',\n      flexWrap: 'wrap',\n      alignItems: 'flex-end',\n      '& + div[data-testid=\"data-testid Dashboard template variables submenu Label Filters\"]:empty': {\n        visibility: 'hidden',\n      },\n\n      //@todo not like this\n      // The filter variables container: i.e. services, filters\n      '& > div &:first-child': {\n        // The wrapper of each filter\n        '& > div': {\n          // The actual inputs container\n          '& > div': {\n            flexWrap: 'wrap',\n            // wrapper around all inputs\n            '& > div': {\n              maxWidth: '380px',\n\n              // Wrapper around each input: i.e. label name, binary operator, value\n              '& > div': {\n                // These inputs need to flex, otherwise the value takes all of available space and they look broken\n                flex: '1 0 auto',\n\n                // The value input needs to shrink when the parent component is at max width\n                '&:nth-child(3)': {\n                  flex: '0 1 auto',\n                },\n              },\n            },\n          },\n        },\n      },\n      // the `service_name` filter is a special case where we want to hide the operator\n      '[data-testid=\"AdHocFilter-service_name\"]': {\n        'div[class*=\"input-wrapper\"]:first-child': {\n          display: 'none',\n        },\n        'div[class*=\"input-wrapper\"]:nth-child(2)': {\n          marginLeft: 0,\n        },\n      },\n\n      ['div >[title=\"Add filter\"]']: {\n        border: 0,\n        display: 'none',\n        width: 0,\n        padding: 0,\n        margin: 0,\n      },\n    }),\n    controlsWrapper: css({\n      label: 'controlsWrapper',\n      display: 'flex',\n      flexDirection: 'column',\n      marginTop: theme.spacing(0.375),\n    }),\n    controls: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n    }),\n    feedback: css({\n      textAlign: 'end',\n    }),\n    rotateIcon: css({\n      svg: { transform: 'rotate(180deg)' },\n    }),\n  };\n}\n","import { AdHocFiltersVariable, SceneObject } from '@grafana/scenes';\nimport { DataSourceGetTagValuesOptions, GetTagResponse, MetricFindValue, ScopedVars, TimeRange } from '@grafana/data';\nimport { BackendSrvRequest, DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { AdHocFilterWithLabels, getDataSource } from './scenes';\nimport { logger } from './logger';\nimport { LokiQuery } from './lokiQuery';\nimport { getDataSourceVariable, getValueFromFieldsFilter } from './variableGetters';\nimport { VAR_FIELDS, VAR_LEVELS, VAR_METADATA } from './variables';\nimport { isArray } from 'lodash';\nimport { joinTagFilters } from './query';\nimport { FilterOp } from './filterTypes';\nimport { getFavoriteLabelValuesFromStorage } from './store';\n\ntype FetchDetectedLabelValuesOptions = {\n  expr?: string;\n  timeRange?: TimeRange;\n  limit?: number;\n  scopedVars?: ScopedVars;\n  throwError: boolean;\n};\n\ninterface LokiLanguageProviderWithDetectedLabelValues {\n  fetchDetectedLabelValues: (\n    labelName: string,\n    queryOptions?: FetchDetectedLabelValuesOptions,\n    requestOptions?: Partial<BackendSrvRequest>\n  ) => Promise<string[] | Error>;\n}\n\nexport const getDetectedFieldValuesTagValuesProvider = async (\n  filter: AdHocFilterWithLabels,\n  expr: string,\n  sceneRef: SceneObject,\n  timeRange: TimeRange,\n  variable: typeof VAR_FIELDS | typeof VAR_METADATA | typeof VAR_LEVELS\n): Promise<{\n  replace?: boolean;\n  values: MetricFindValue[];\n}> => {\n  const datasourceUnknownType = await getDataSourceSrv().get(getDataSource(sceneRef));\n  // Narrow the DataSourceApi type to DataSourceWithBackend\n  if (!(datasourceUnknownType instanceof DataSourceWithBackend)) {\n    logger.error(new Error('getTagValuesProvider: Invalid datasource!'));\n    throw new Error('Invalid datasource!');\n  }\n\n  // Assert datasource is Loki\n  const lokiDatasource = datasourceUnknownType as DataSourceWithBackend<LokiQuery>;\n  // Assert language provider is LokiLanguageProvider\n  const languageProvider = lokiDatasource.languageProvider as LokiLanguageProviderWithDetectedLabelValues;\n\n  let values: MetricFindValue[] = [];\n\n  if (languageProvider && languageProvider.fetchDetectedLabelValues) {\n    const options: FetchDetectedLabelValuesOptions = {\n      expr,\n      limit: 1000,\n      timeRange,\n      throwError: true,\n    };\n\n    const requestOptions: Partial<BackendSrvRequest> = {\n      showErrorAlert: false,\n    };\n\n    try {\n      let results = await languageProvider.fetchDetectedLabelValues(filter.key, options, requestOptions);\n      // If the variable has a parser in the value, make sure we extract it and carry it over, this assumes the parser for the currently selected value is the same as any value in the response.\n      // @todo is the parser always the same for the currently selected values and the results from detected_field/.../values?\n      if (results && isArray(results)) {\n        if (variable === VAR_FIELDS) {\n          const valueDecoded = getValueFromFieldsFilter(filter, variable);\n          return {\n            replace: true,\n            values: results.map((v) => ({\n              text: v,\n              value: JSON.stringify({\n                value: v,\n                parser: valueDecoded.parser,\n              }),\n            })),\n          };\n        } else {\n          values = results.map((r) => ({ text: r }));\n        }\n      } else {\n        values = [];\n      }\n    } catch (e) {\n      logger.error(e);\n      logger.warn(\n        'getDetectedFieldValuesTagValuesProvider: loki missing detected_field/.../values endpoint. Upgrade to Loki 3.3.0 or higher.'\n      );\n      values = [];\n    }\n  } else {\n    logger.warn(\n      'getDetectedFieldValuesTagValuesProvider: fetchDetectedLabelValues is not defined in Loki datasource. Upgrade to Grafana 11.4 or higher.'\n    );\n    values = [];\n  }\n\n  return { replace: true, values };\n};\n\nexport async function getLabelsTagValuesProvider(\n  variable: AdHocFiltersVariable,\n  filter: AdHocFilterWithLabels\n): Promise<{\n  replace?: boolean;\n  values: GetTagResponse | MetricFindValue[];\n}> {\n  const datasource_ = await getDataSourceSrv().get(getDataSource(variable));\n  if (!(datasource_ instanceof DataSourceWithBackend)) {\n    logger.error(new Error('getTagValuesProvider: Invalid datasource!'));\n    throw new Error('Invalid datasource!');\n  }\n  const datasource = datasource_ as DataSourceWithBackend<LokiQuery>;\n\n  if (datasource && datasource.getTagValues) {\n    // Filter out other values for this key so users can include other values for this label\n    const filters = joinTagFilters(variable).filter((f) => !(filter.operator === '=' && f.key === filter.key));\n\n    const options: DataSourceGetTagValuesOptions<LokiQuery> = {\n      key: filter.key,\n      filters,\n    };\n    let results = await datasource.getTagValues(options);\n\n    if (isArray(results)) {\n      results = results.filter((result) => {\n        // Filter out values that we already have added as filters\n        return !variable.state.filters\n          .filter((f) => f.key === filter.key)\n          .some((f) => {\n            // If true, the results should be filtered out\n            return f.operator === FilterOp.Equal && f.value === result.text;\n          });\n      });\n      const favoriteValuesArray = getFavoriteLabelValuesFromStorage(\n        getDataSourceVariable(variable).getValue()?.toString(),\n        filter.key\n      );\n      const favoriteValuesSet = new Set(favoriteValuesArray);\n      if (favoriteValuesArray.length) {\n        results.sort((a, b) => {\n          return (favoriteValuesSet.has(b.text) ? 1 : -1) - (favoriteValuesSet.has(a.text) ? 1 : -1);\n        });\n      }\n    }\n\n    return { replace: true, values: results };\n  } else {\n    logger.error(new Error('getTagValuesProvider: missing or invalid datasource!'));\n    return { replace: true, values: [] };\n  }\n}\n","import { logger } from './logger';\nimport { LokiQuery } from './lokiQuery';\nimport { DataSourceGetTagKeysOptions, GetTagResponse, MetricFindValue } from '@grafana/data';\nimport { AdHocFiltersVariable } from '@grafana/scenes';\nimport { DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { getDataSource } from './scenes';\nimport { LABELS_TO_REMOVE } from './filters';\nimport { joinTagFilters } from './query';\n\nexport async function getLabelsTagKeysProvider(variable: AdHocFiltersVariable): Promise<{\n  replace?: boolean;\n  values: GetTagResponse | MetricFindValue[];\n}> {\n  const datasource_ = await getDataSourceSrv().get(getDataSource(variable));\n  if (!(datasource_ instanceof DataSourceWithBackend)) {\n    logger.error(new Error('getTagKeysProvider: Invalid datasource!'));\n    throw new Error('Invalid datasource!');\n  }\n  const datasource = datasource_ as DataSourceWithBackend<LokiQuery>;\n\n  if (datasource && datasource.getTagKeys) {\n    const filters = joinTagFilters(variable);\n\n    const options: DataSourceGetTagKeysOptions<LokiQuery> = {\n      filters,\n    };\n\n    const tagKeys = await datasource.getTagKeys(options);\n    const result: MetricFindValue[] = Array.isArray(tagKeys) ? tagKeys : [];\n    const filteredResult = result.filter((key) => !LABELS_TO_REMOVE.includes(key.text));\n\n    return { replace: true, values: filteredResult };\n  } else {\n    logger.error(new Error('getTagKeysProvider: missing or invalid datasource!'));\n    return { replace: true, values: [] };\n  }\n}\n","import React from 'react';\n\nimport { AdHocVariableFilter, AppEvents, AppPluginMeta, rangeUtil, SelectableValue } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  CustomVariable,\n  DataSourceVariable,\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneTimeRangeLike,\n  SceneTimeRangeState,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport {\n  DETECTED_FIELD_VALUES_EXPR,\n  DETECTED_LEVELS_VALUES_EXPR,\n  DETECTED_METADATA_VALUES_EXPR,\n  EXPLORATION_DS,\n  MIXED_FORMAT_EXPR,\n  PENDING_FIELDS_EXPR,\n  VAR_DATASOURCE,\n  VAR_FIELDS,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_LINE_FILTER,\n  VAR_LOGS_FORMAT,\n  VAR_METADATA,\n  VAR_PATTERNS,\n} from 'services/variables';\n\nimport { addLastUsedDataSourceToStorage, getLastUsedDataSourceFromStorage } from 'services/store';\nimport { ServiceScene } from '../ServiceScene/ServiceScene';\nimport { LayoutScene } from './LayoutScene';\nimport { getDrilldownSlug, PageSlugs } from '../../services/routing';\nimport { ServiceSelectionScene } from '../ServiceSelectionScene/ServiceSelectionScene';\nimport { LoadingPlaceholder } from '@grafana/ui';\nimport { config, getAppEvents, locationService } from '@grafana/runtime';\nimport {\n  renderLogQLFieldFilters,\n  renderLogQLLabelFilters,\n  renderLogQLMetadataFilters,\n  renderPatternFilters,\n} from 'services/query';\nimport { VariableHide } from '@grafana/schema';\nimport { CustomConstantVariable } from '../../services/CustomConstantVariable';\nimport {\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getMetadataVariable,\n  getPatternsVariable,\n  getUrlParamNameForVariable,\n  getValueFromFieldsFilter,\n} from '../../services/variableGetters';\nimport { ToolbarScene } from './ToolbarScene';\nimport { DEFAULT_TIME_RANGE, OptionalRouteMatch } from '../Pages';\nimport { plugin } from '../../module';\nimport { JsonData } from '../AppConfig/AppConfig';\nimport { reportAppInteraction } from '../../services/analytics';\nimport { getDetectedFieldValuesTagValuesProvider, getLabelsTagValuesProvider } from '../../services/TagValuesProviders';\nimport { lokiRegularEscape } from '../../services/fields';\nimport { logger } from '../../services/logger';\nimport { getLabelsTagKeysProvider } from '../../services/TagKeysProviders';\nimport { AdHocFilterWithLabels } from '../../services/scenes';\nimport { FilterOp } from '../../services/filterTypes';\nimport { ShowLogsButtonScene } from './ShowLogsButtonScene';\nimport { CustomVariableValueSelectors } from './CustomVariableValueSelectors';\n\nexport const showLogsButtonSceneKey = 'showLogsButtonScene';\nexport interface AppliedPattern {\n  pattern: string;\n  type: 'include' | 'exclude';\n}\n\nexport interface IndexSceneState extends SceneObjectState {\n  // contentScene is the scene that is displayed in the main body of the index scene - it can be either the service selection or service scene\n  contentScene?: SceneObject;\n  controls: SceneObject[];\n  body?: LayoutScene;\n  initialFilters?: AdHocVariableFilter[];\n  patterns?: AppliedPattern[];\n  routeMatch?: OptionalRouteMatch;\n}\n\nexport class IndexScene extends SceneObjectBase<IndexSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['patterns'] });\n\n  public constructor(state: Partial<IndexSceneState>) {\n    const { variablesScene, unsub } = getVariableSet(\n      getLastUsedDataSourceFromStorage() ?? 'grafanacloud-logs',\n      state.initialFilters\n    );\n\n    const controls: SceneObject[] = [\n      new SceneFlexLayout({\n        direction: 'row',\n        children: [\n          new SceneFlexItem({\n            body: new CustomVariableValueSelectors({ layout: 'vertical', include: [VAR_LABELS, VAR_DATASOURCE] }),\n          }),\n          new ShowLogsButtonScene({\n            key: showLogsButtonSceneKey,\n            disabled: true,\n          }),\n        ],\n      }),\n      new CustomVariableValueSelectors({ layout: 'vertical', exclude: [VAR_LABELS, VAR_DATASOURCE] }),\n      new SceneTimePicker({}),\n      new SceneRefreshPicker({}),\n    ];\n\n    if (getDrilldownSlug() === 'explore' && config.featureToggles.exploreLogsAggregatedMetrics) {\n      controls.push(\n        new ToolbarScene({\n          isOpen: false,\n        })\n      );\n    }\n\n    super({\n      $timeRange: state.$timeRange ?? new SceneTimeRange({}),\n      $variables: state.$variables ?? variablesScene,\n      controls: state.controls ?? controls,\n      // Need to clear patterns state when the class in constructed\n      patterns: [],\n      ...state,\n      body: new LayoutScene({}),\n    });\n\n    this._subs.add(unsub);\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  static Component = ({ model }: SceneComponentProps<IndexScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n\n  public onActivate() {\n    const stateUpdate: Partial<IndexSceneState> = {};\n    this.setVariableTagValuesProviders();\n\n    // Show \"show logs\" button\n    const showLogsButton = sceneGraph.findByKeyAndType(this, showLogsButtonSceneKey, ShowLogsButtonScene);\n    showLogsButton.setState({ hidden: false });\n\n    if (!this.state.contentScene) {\n      stateUpdate.contentScene = getContentScene(this.state.routeMatch?.params.breakdownLabel);\n    }\n    this.setTagProviders();\n    this.setVariableOperators();\n\n    this.setState(stateUpdate);\n\n    this.updatePatterns(this.state, getPatternsVariable(this));\n    this.resetVariablesIfNotInUrl(getFieldsVariable(this), getUrlParamNameForVariable(VAR_FIELDS));\n    this.resetVariablesIfNotInUrl(getLevelsVariable(this), getUrlParamNameForVariable(VAR_LEVELS));\n\n    this._subs.add(\n      this.subscribeToState((newState) => {\n        this.updatePatterns(newState, getPatternsVariable(this));\n      })\n    );\n\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    this._subs.add(timeRange.subscribeToState(this.limitMaxInterval(timeRange)));\n  }\n\n  private setVariableOperators() {\n    const fieldsVar = getFieldsVariable(this);\n    // No wip set when this is called, so once the operations must be consistent for all filters\n    // @todo we'll need to split out the duration, bytes, and float filters out of the VAR_FIELDS variable and into a new variable if we want to keep comparison operations out of string, int, etc filters\n    fieldsVar._getOperators = function () {\n      if (fieldsVar.state.filters.some((filter) => numericOperatorArray.includes(filter.operator as FilterOp))) {\n        return [...operators, ...numericOperators];\n      }\n      return operators;\n    };\n  }\n\n  private setTagProviders() {\n    const labelsVar = getLabelsVariable(this);\n\n    labelsVar._getOperators = function () {\n      const wip = labelsVar.state._wip;\n      if (\n        wip &&\n        labelsVar.state.filters.some((filter) => filter.key === wip.key && filter.operator === FilterOp.Equal)\n      ) {\n        return includeOperators;\n      }\n\n      return operators;\n    };\n\n    labelsVar.setState({\n      getTagKeysProvider: getLabelsTagKeysProvider,\n      getTagValuesProvider: getLabelsTagValuesProvider,\n    });\n  }\n\n  /**\n   * If user selects a time range longer then the max configured interval, show toast and set the previous time range.\n   * @param timeRange\n   * @private\n   */\n  private limitMaxInterval(timeRange: SceneTimeRangeLike) {\n    return (newState: SceneTimeRangeState, prevState: SceneTimeRangeState) => {\n      const { jsonData } = plugin.meta as AppPluginMeta<JsonData>;\n      if (jsonData?.interval) {\n        try {\n          const maxInterval = rangeUtil.intervalToSeconds(jsonData?.interval ?? '');\n          if (!maxInterval) {\n            return;\n          }\n          const timeRangeInterval = newState.value.to.diff(newState.value.from, 'seconds');\n          if (timeRangeInterval > maxInterval) {\n            const prevInterval = prevState.value.to.diff(prevState.value.from, 'seconds');\n            if (timeRangeInterval <= prevInterval) {\n              timeRange.setState({\n                value: prevState.value,\n                from: prevState.from,\n                to: prevState.to,\n              });\n            } else {\n              const defaultRange = new SceneTimeRange(DEFAULT_TIME_RANGE);\n              timeRange.setState({\n                value: defaultRange.state.value,\n                from: defaultRange.state.from,\n                to: defaultRange.state.to,\n              });\n            }\n\n            const appEvents = getAppEvents();\n            appEvents.publish({\n              type: AppEvents.alertWarning.name,\n              payload: [`Time range interval exceeds maximum interval configured by the administrator.`],\n            });\n\n            reportAppInteraction('all', 'interval_too_long', {\n              attempted_duration_seconds: timeRangeInterval,\n              configured_max_interval: maxInterval,\n            });\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    };\n  }\n\n  private setVariableTagValuesProviders() {\n    const fieldsVariable = getFieldsVariable(this);\n    const levelsVariable = getLevelsVariable(this);\n    const metadataVariable = getMetadataVariable(this);\n\n    fieldsVariable.setState({\n      getTagValuesProvider: this.getFieldsTagValuesProvider(VAR_FIELDS),\n    });\n\n    levelsVariable.setState({\n      getTagValuesProvider: this.getFieldsTagValuesProvider(VAR_LEVELS),\n    });\n\n    metadataVariable.setState({\n      getTagValuesProvider: this.getFieldsTagValuesProvider(VAR_METADATA),\n    });\n  }\n\n  private getFieldsTagValuesProvider(variableType: typeof VAR_FIELDS | typeof VAR_METADATA | typeof VAR_LEVELS) {\n    return (variable: AdHocFiltersVariable, filter: AdHocFilterWithLabels) => {\n      const filters = variable.state.filters.filter((f) => f.key !== filter.key);\n      const values = filters.map((f) => {\n        const parsed = variableType === VAR_FIELDS ? getValueFromFieldsFilter(f, variableType) : { value: f.value };\n        return `${f.key}${f.operator}\\`${lokiRegularEscape(parsed.value)}\\``;\n      });\n      const otherFiltersString = values.length ? '| ' + values.join(' |') : '';\n      const uninterpolatedExpression = this.getFieldsTagValuesExpression(variableType);\n      const expr = uninterpolatedExpression.replace(PENDING_FIELDS_EXPR, otherFiltersString);\n      const interpolated = sceneGraph.interpolate(this, expr);\n      return getDetectedFieldValuesTagValuesProvider(\n        filter,\n        interpolated,\n        this,\n        sceneGraph.getTimeRange(this).state.value,\n        variableType\n      );\n    };\n  }\n\n  private getFieldsTagValuesExpression(variableType: typeof VAR_FIELDS | typeof VAR_METADATA | typeof VAR_LEVELS) {\n    switch (variableType) {\n      case VAR_FIELDS:\n        return DETECTED_FIELD_VALUES_EXPR;\n      case VAR_METADATA:\n        return DETECTED_METADATA_VALUES_EXPR;\n      case VAR_LEVELS:\n        return DETECTED_LEVELS_VALUES_EXPR;\n      default:\n        const error = new Error(`Unknown variable type: ${variableType}`);\n        logger.error(error, {\n          variableType,\n        });\n        throw error;\n    }\n  }\n\n  /**\n   * @todo why do we need to manually sync fields and levels, but not other ad hoc variables?\n   * @param variable\n   * @param urlParamName\n   * @private\n   */\n  private resetVariablesIfNotInUrl(variable: AdHocFiltersVariable, urlParamName: string) {\n    const location = locationService.getLocation();\n    const search = new URLSearchParams(location.search);\n    const filtersFromUrl = search.get(urlParamName);\n\n    // If the filters aren't in the URL, then they're coming from the cache, set the state to sync with url\n    if (filtersFromUrl === null) {\n      variable.setState({ filters: [] });\n    }\n  }\n\n  private updatePatterns(newState: IndexSceneState, patternsVariable: CustomVariable) {\n    const patternsLine = renderPatternFilters(newState.patterns ?? []);\n    patternsVariable.changeValueTo(patternsLine);\n  }\n\n  getUrlState() {\n    return {\n      patterns: JSON.stringify(this.state.patterns),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<IndexSceneState> = {};\n\n    if (values.patterns && typeof values.patterns === 'string') {\n      stateUpdate.patterns = JSON.parse(values.patterns) as AppliedPattern[];\n    }\n\n    this.setState(stateUpdate);\n  }\n}\n\nfunction getContentScene(drillDownLabel?: string) {\n  const slug = getDrilldownSlug();\n  if (slug === PageSlugs.explore) {\n    return new ServiceSelectionScene({});\n  }\n\n  return new ServiceScene({\n    drillDownLabel,\n  });\n}\nconst operators = [FilterOp.Equal, FilterOp.NotEqual].map<SelectableValue<string>>((value) => ({\n  label: value,\n  value,\n}));\n\nconst includeOperators = [FilterOp.Equal].map<SelectableValue<string>>((value) => ({\n  label: value,\n  value,\n}));\n\nexport const numericOperatorArray = [FilterOp.gt, FilterOp.gte, FilterOp.lt, FilterOp.lte];\n\nconst numericOperators = numericOperatorArray.map<SelectableValue<string>>((value) => ({\n  label: value,\n  value,\n}));\n\nfunction getVariableSet(initialDatasourceUid: string, initialFilters?: AdHocVariableFilter[]) {\n  const labelVariable = new AdHocFiltersVariable({\n    name: VAR_LABELS,\n    datasource: EXPLORATION_DS,\n    layout: 'combobox',\n    label: 'Labels',\n    filters: initialFilters ?? [],\n    expressionBuilder: renderLogQLLabelFilters,\n    hide: VariableHide.dontHide,\n    key: 'adhoc_service_filter',\n  });\n\n  labelVariable._getOperators = function () {\n    return operators;\n  };\n\n  const fieldsVariable = new AdHocFiltersVariable({\n    name: VAR_FIELDS,\n    label: 'Fields',\n    applyMode: 'manual',\n    layout: 'vertical',\n    getTagKeysProvider: () => Promise.resolve({ replace: true, values: [] }),\n    getTagValuesProvider: () => Promise.resolve({ replace: true, values: [] }),\n    expressionBuilder: renderLogQLFieldFilters,\n    hide: VariableHide.hideLabel,\n  });\n\n  fieldsVariable._getOperators = () => {\n    return operators;\n  };\n\n  const metadataVariable = new AdHocFiltersVariable({\n    name: VAR_METADATA,\n    label: 'Metadata',\n    applyMode: 'manual',\n    layout: 'vertical',\n    getTagKeysProvider: () => Promise.resolve({ replace: true, values: [] }),\n    getTagValuesProvider: () => Promise.resolve({ replace: true, values: [] }),\n    expressionBuilder: renderLogQLMetadataFilters,\n    hide: VariableHide.hideLabel,\n  });\n\n  metadataVariable._getOperators = () => {\n    return operators;\n  };\n\n  const levelsVariable = new AdHocFiltersVariable({\n    name: VAR_LEVELS,\n    label: 'Filters',\n    applyMode: 'manual',\n    layout: 'vertical',\n    getTagKeysProvider: () => Promise.resolve({ replace: true, values: [] }),\n    getTagValuesProvider: () => Promise.resolve({ replace: true, values: [] }),\n    expressionBuilder: renderLogQLMetadataFilters,\n    hide: VariableHide.hideLabel,\n  });\n\n  levelsVariable._getOperators = () => {\n    return operators;\n  };\n\n  const dsVariable = new DataSourceVariable({\n    name: VAR_DATASOURCE,\n    label: 'Data source',\n    value: initialDatasourceUid,\n    pluginId: 'loki',\n  });\n\n  const unsub = dsVariable.subscribeToState((newState) => {\n    const dsValue = `${newState.value}`;\n    newState.value && addLastUsedDataSourceToStorage(dsValue);\n  });\n\n  return {\n    variablesScene: new SceneVariableSet({\n      variables: [\n        dsVariable,\n        labelVariable,\n        fieldsVariable,\n        levelsVariable,\n        metadataVariable,\n        new CustomVariable({\n          name: VAR_PATTERNS,\n          value: '',\n          hide: VariableHide.hideVariable,\n        }),\n        new CustomVariable({ name: VAR_LINE_FILTER, value: '', hide: VariableHide.hideVariable }),\n\n        // This variable is a hack to get logs context working, this variable should never be used or updated\n        new CustomConstantVariable({\n          name: VAR_LOGS_FORMAT,\n          value: MIXED_FORMAT_EXPR,\n          skipUrlSync: true,\n          hide: VariableHide.hideVariable,\n          options: [{ value: MIXED_FORMAT_EXPR, label: MIXED_FORMAT_EXPR }],\n        }),\n      ],\n    }),\n    unsub,\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { navigateToInitialPageAfterServiceSelection } from '../../services/navigate';\nimport { getLabelsVariable } from '../../services/variableGetters';\nimport { FilterOp } from '../../services/filterTypes';\nimport { testIds } from '../../services/testIds';\n\nexport interface ShowLogsButtonSceneState extends SceneObjectState {\n  disabled?: boolean;\n  hidden?: boolean;\n}\nexport class ShowLogsButtonScene extends SceneObjectBase<ShowLogsButtonSceneState> {\n  constructor(state: Partial<ShowLogsButtonSceneState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const labelsVar = getLabelsVariable(this);\n    const hasPositiveFilter = labelsVar.state.filters.some((f) => f.operator === FilterOp.Equal);\n    this.setState({\n      disabled: !hasPositiveFilter,\n    });\n\n    labelsVar.subscribeToState((newState) => {\n      const hasPositiveFilter = newState.filters.some((f) => f.operator === FilterOp.Equal);\n      this.setState({\n        disabled: !hasPositiveFilter,\n      });\n    });\n  }\n\n  onClick = () => {\n    const labelsVar = getLabelsVariable(this);\n    const positiveFilter = labelsVar.state.filters.find((f) => f.operator === FilterOp.Equal);\n\n    if (positiveFilter) {\n      navigateToInitialPageAfterServiceSelection(positiveFilter.key, positiveFilter.value);\n    }\n  };\n\n  static Component = ({ model }: SceneComponentProps<ShowLogsButtonScene>) => {\n    const { disabled, hidden } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    if (hidden === true) {\n      return null;\n    }\n\n    return (\n      <Button\n        data-testid={testIds.index.header.showLogsButton}\n        disabled={disabled}\n        fill={'outline'}\n        className={styles.button}\n        onClick={model.onClick}\n      >\n        Show logs\n      </Button>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    button: css({\n      [theme.breakpoints.down('lg')]: {\n        alignSelf: 'flex-end',\n      },\n      [theme.breakpoints.down('md')]: {\n        marginTop: theme.spacing(1),\n        alignSelf: 'flex-start',\n      },\n\n      alignSelf: 'flex-start',\n      marginTop: '22px',\n    }),\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Dropdown, Switch, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { config } from '@grafana/runtime';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { AGGREGATED_METRIC_START_DATE } from '../ServiceSelectionScene/ServiceSelectionScene';\nimport pluginJson from '../../plugin.json';\nimport { testIds } from '../../services/testIds';\nconst AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY = `${pluginJson.id}.serviceSelection.aggregatedMetrics`;\n\nexport interface ToolbarSceneState extends SceneObjectState {\n  isOpen: boolean;\n  options: {\n    aggregatedMetrics: {\n      active: boolean;\n      userOverride: boolean;\n      disabled: boolean;\n    };\n  };\n}\nexport class ToolbarScene extends SceneObjectBase<ToolbarSceneState> {\n  constructor(state: Partial<ToolbarSceneState>) {\n    const userOverride = localStorage.getItem(AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY);\n    const active = config.featureToggles.exploreLogsAggregatedMetrics && userOverride !== 'false';\n\n    super({\n      isOpen: false,\n      options: {\n        aggregatedMetrics: {\n          active: active ?? false,\n          userOverride: userOverride === 'true' ?? false,\n          disabled: false,\n        },\n      },\n      ...state,\n    });\n  }\n\n  public toggleAggregatedMetricsOverride = () => {\n    const active = !this.state.options.aggregatedMetrics.active;\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_selection,\n      USER_EVENTS_ACTIONS.service_selection.aggregated_metrics_toggled,\n      {\n        enabled: active,\n      }\n    );\n\n    localStorage.setItem(AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY, active.toString());\n\n    this.setState({\n      options: {\n        aggregatedMetrics: {\n          active,\n          disabled: this.state.options.aggregatedMetrics.disabled,\n          userOverride: active,\n        },\n      },\n    });\n  };\n\n  public onToggleOpen = (isOpen: boolean) => {\n    this.setState({ isOpen });\n  };\n\n  static Component = ({ model }: SceneComponentProps<ToolbarScene>) => {\n    const { isOpen, options } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const renderPopover = () => {\n      return (\n        <div className={styles.popover} onClick={(evt) => evt.stopPropagation()}>\n          <div className={styles.heading}>Query options</div>\n          <div className={styles.options}>\n            <div\n              title={\n                'Aggregated metrics will return service queries results much more quickly, but with lower resolution'\n              }\n            >\n              Aggregated metrics\n            </div>\n            <span\n              title={\n                options.aggregatedMetrics.disabled\n                  ? `Aggregated metrics can only be enabled for queries starting after ${AGGREGATED_METRIC_START_DATE.toLocaleString()}`\n                  : ''\n              }\n            >\n              <Switch\n                label={'Toggle aggregated metrics'}\n                data-testid={testIds.index.aggregatedMetricsToggle}\n                value={options.aggregatedMetrics.active}\n                disabled={options.aggregatedMetrics.disabled}\n                onChange={model.toggleAggregatedMetricsOverride}\n              />\n            </span>\n          </div>\n        </div>\n      );\n    };\n\n    if (options.aggregatedMetrics) {\n      return (\n        <Dropdown overlay={renderPopover} placement=\"bottom\" onVisibleChange={model.onToggleOpen}>\n          <ToolbarButton\n            icon=\"cog\"\n            variant=\"canvas\"\n            isOpen={isOpen}\n            data-testid={testIds.index.aggregatedMetricsMenu}\n          />\n        </Dropdown>\n      );\n    }\n\n    return <></>;\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    popover: css({\n      display: 'flex',\n      padding: theme.spacing(2),\n      flexDirection: 'column',\n      background: theme.colors.background.primary,\n      boxShadow: theme.shadows.z3,\n      borderRadius: theme.shape.radius.default,\n      border: `1px solid ${theme.colors.border.weak}`,\n      zIndex: 1,\n      marginRight: theme.spacing(2),\n    }),\n    heading: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      paddingBottom: theme.spacing(2),\n    }),\n    options: css({\n      display: 'grid',\n      gridTemplateColumns: '1fr 50px',\n      rowGap: theme.spacing(1),\n      columnGap: theme.spacing(2),\n      alignItems: 'center',\n    }),\n  };\n}\n","import {\n  EmbeddedScene,\n  SceneAppPage,\n  SceneAppPageLike,\n  SceneFlexLayout,\n  SceneRouteMatch,\n  SceneTimeRange,\n} from '@grafana/scenes';\nimport {\n  CHILD_ROUTE_DEFINITIONS,\n  ChildDrilldownSlugs,\n  DRILLDOWN_URL_KEYS,\n  extractValuesFromRoute,\n  PageSlugs,\n  ParentDrilldownSlugs,\n  ROUTE_DEFINITIONS,\n  ROUTES,\n  SERVICE_URL_KEYS,\n  SUB_ROUTES,\n  ValueSlugs,\n} from '../services/routing';\nimport { PageLayoutType } from '@grafana/data';\nimport { IndexScene } from './IndexScene/IndexScene';\nimport { navigateToIndex } from '../services/navigate';\nimport { logger } from '../services/logger';\nimport { capitalizeFirstLetter } from '../services/text';\nimport { PLUGIN_BASE_URL, prefixRoute } from '../services/plugin';\n\nexport type RouteProps = { labelName: string; labelValue: string; breakdownLabel?: string };\nexport type RouteMatch = SceneRouteMatch<RouteProps>;\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\nexport type OptionalRouteProps = Optional<RouteProps, 'labelName' | 'labelValue'>;\nexport type OptionalRouteMatch = SceneRouteMatch<OptionalRouteProps>;\n\nexport const DEFAULT_TIME_RANGE = { from: 'now-15m', to: 'now' };\nfunction getServicesScene(routeMatch: OptionalRouteMatch) {\n  return new EmbeddedScene({\n    body: new IndexScene({\n      $timeRange: new SceneTimeRange(DEFAULT_TIME_RANGE),\n      routeMatch,\n    }),\n  });\n}\n\n// Index page\nexport function makeIndexPage() {\n  return new SceneAppPage({\n    // Top level breadcrumb\n    title: 'Logs',\n    url: prefixRoute(PageSlugs.explore),\n    layout: PageLayoutType.Custom,\n    preserveUrlKeys: SERVICE_URL_KEYS,\n    routePath: prefixRoute(PageSlugs.explore),\n    getScene: (routeMatch) => getServicesScene(routeMatch),\n    drilldowns: [\n      {\n        routePath: ROUTE_DEFINITIONS.logs,\n        getPage: (routeMatch, parent) => makeBreakdownPage(routeMatch, parent, PageSlugs.logs),\n        defaultRoute: true,\n      },\n      {\n        routePath: ROUTE_DEFINITIONS.labels,\n        getPage: (routeMatch, parent) => makeBreakdownPage(routeMatch, parent, PageSlugs.labels),\n      },\n      {\n        routePath: ROUTE_DEFINITIONS.patterns,\n        getPage: (routeMatch, parent) => makeBreakdownPage(routeMatch, parent, PageSlugs.patterns),\n      },\n      {\n        routePath: ROUTE_DEFINITIONS.fields,\n        getPage: (routeMatch, parent) => makeBreakdownPage(routeMatch, parent, PageSlugs.fields),\n      },\n      {\n        routePath: CHILD_ROUTE_DEFINITIONS.label,\n        getPage: (routeMatch, parent) => makeBreakdownValuePage(routeMatch, parent, ValueSlugs.label),\n      },\n      {\n        routePath: CHILD_ROUTE_DEFINITIONS.field,\n        getPage: (routeMatch: RouteMatch, parent) => makeBreakdownValuePage(routeMatch, parent, ValueSlugs.field),\n      },\n      {\n        routePath: '*',\n        getPage: () => makeRedirectPage(),\n      },\n    ],\n  });\n}\n\n// Redirect page back to index\nexport function makeRedirectPage() {\n  return new SceneAppPage({\n    title: '',\n    url: PLUGIN_BASE_URL,\n    getScene: makeEmptyScene(),\n    hideFromBreadcrumbs: true,\n    routePath: '*',\n    $behaviors: [\n      () => {\n        navigateToIndex();\n      },\n    ],\n  });\n}\n\nfunction makeEmptyScene(): (routeMatch: SceneRouteMatch) => EmbeddedScene {\n  return () =>\n    new EmbeddedScene({\n      body: new SceneFlexLayout({\n        direction: 'column',\n        children: [],\n      }),\n    });\n}\n\nexport function makeBreakdownPage(\n  routeMatch: RouteMatch,\n  parent: SceneAppPageLike,\n  slug: ParentDrilldownSlugs\n): SceneAppPage {\n  const { labelName, labelValue } = extractValuesFromRoute(routeMatch);\n  return new SceneAppPage({\n    title: capitalizeFirstLetter(slug),\n    layout: PageLayoutType.Custom,\n    url: ROUTES[slug](labelValue, labelName),\n    preserveUrlKeys: DRILLDOWN_URL_KEYS,\n    getParentPage: () => parent,\n    getScene: (routeMatch) => getServicesScene(routeMatch),\n  });\n}\n\nexport function makeBreakdownValuePage(\n  routeMatch: RouteMatch,\n  parent: SceneAppPageLike,\n  slug: ChildDrilldownSlugs\n): SceneAppPage {\n  const { labelName, labelValue, breakdownLabel } = extractValuesFromRoute(routeMatch);\n\n  if (!breakdownLabel) {\n    const e = new Error('Breakdown value missing!');\n    logger.error(e, { labelName, labelValue, breakdownLabel: breakdownLabel ?? '' });\n    throw e;\n  }\n\n  return new SceneAppPage({\n    title: capitalizeFirstLetter(breakdownLabel),\n    layout: PageLayoutType.Custom,\n    url: SUB_ROUTES[slug](labelValue, labelName, breakdownLabel),\n    preserveUrlKeys: DRILLDOWN_URL_KEYS,\n    getParentPage: () => parent,\n    getScene: (routeMatch) => getServicesScene(routeMatch),\n  });\n}\n","import { DataFrame, DataSourceJsonData, TimeRange } from '@grafana/data';\nimport { DataSourceWithBackend, usePluginLinks } from '@grafana/runtime';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState, SceneQueryRunner } from '@grafana/scenes';\nimport { DataQuery, DataSourceRef } from '@grafana/schema';\nimport { IconButton } from '@grafana/ui';\nimport React from 'react';\nimport { ExtensionPoints } from 'services/extensions/links';\nimport { getLokiDatasource } from 'services/scenes';\n\nimport LokiLogo from '../../../img/logo.svg';\n\nexport interface AddToExplorationButtonState extends SceneObjectState {\n  frame?: DataFrame;\n  ds?: DataSourceWithBackend<DataQuery, DataSourceJsonData>;\n  labelName?: string;\n  fieldName?: string;\n  context?: ExtensionContext;\n\n  disabledLinks: string[];\n  queries: DataQuery[];\n}\n\ntype ExtensionContext = {\n  timeRange: TimeRange;\n  queries: DataQuery[];\n  datasource: DataSourceRef;\n  origin: string;\n  url: string;\n  type: string;\n  title: string;\n  id: string;\n  logoPath: string;\n  note?: string;\n  drillDownLabel?: string;\n};\n\nexport class AddToExplorationButton extends SceneObjectBase<AddToExplorationButtonState> {\n  constructor(state: Omit<AddToExplorationButtonState, 'disabledLinks' | 'queries'>) {\n    super({ ...state, disabledLinks: [], queries: [] });\n    this.addActivationHandler(this.onActivate);\n  }\n\n  private onActivate = () => {\n    getLokiDatasource(this).then((ds) => {\n      this.setState({ ds });\n    });\n\n    this._subs.add(\n      this.subscribeToState(() => {\n        this.getQueries();\n        this.getContext();\n      })\n    );\n  };\n\n  private getQueries = () => {\n    const data = sceneGraph.getData(this);\n    const queryRunner = sceneGraph.findObject(data, (o) => o instanceof SceneQueryRunner) as SceneQueryRunner;\n    if (queryRunner) {\n      const filter = this.state.frame ? getFilter(this.state.frame) : null;\n      const queries = queryRunner.state.queries.map((q) => ({\n        ...q,\n        expr: sceneGraph.interpolate(queryRunner, q.expr),\n        legendFormat: filter?.name ? `{{ ${filter.name} }}` : sceneGraph.interpolate(queryRunner, q.legendFormat),\n      }));\n      if (JSON.stringify(queries) !== JSON.stringify(this.state.queries)) {\n        this.setState({ queries });\n      }\n    }\n  };\n\n  private getContext = () => {\n    const { queries, ds, labelName, fieldName } = this.state;\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    if (!timeRange || !queries || !ds?.uid) {\n      return;\n    }\n    const ctx = {\n      origin: 'Explore Logs',\n      type: 'timeseries',\n      queries,\n      timeRange: { ...timeRange.state.value },\n      datasource: { uid: ds.uid },\n      url: window.location.href,\n      id: `${JSON.stringify(queries)}${labelName}${fieldName}`,\n      title: `${labelName}${fieldName ? ` > ${fieldName}` : ''}`,\n      logoPath: LokiLogo,\n      drillDownLabel: fieldName,\n    };\n    if (JSON.stringify(ctx) !== JSON.stringify(this.state.context)) {\n      this.setState({ context: ctx });\n    }\n  };\n\n  public static Component = ({ model }: SceneComponentProps<AddToExplorationButton>) => {\n    const { context, disabledLinks } = model.useState();\n    const { links } = usePluginLinks({ extensionPointId: ExtensionPoints.MetricExploration, context });\n\n    return (\n      <>\n        {links\n          .filter((link) => link.pluginId === 'grafana-explorations-app' && link.onClick)\n          .map((link) => (\n            <IconButton\n              tooltip={link.description}\n              disabled={link.category === 'disabled' || disabledLinks.includes(link.id)}\n              aria-label=\"extension-link-to-open-exploration\"\n              key={link.id}\n              name={link.icon ?? 'panel-add'}\n              onClick={(e) => {\n                if (link.onClick) {\n                  link.onClick(e);\n                }\n                model.setState({ disabledLinks: [...disabledLinks, link.id] });\n              }}\n            />\n          ))}\n      </>\n    );\n  };\n}\n\nconst getFilter = (frame: DataFrame) => {\n  const filterNameAndValueObj = frame.fields[1]?.labels ?? {};\n  if (Object.keys(filterNameAndValueObj).length !== 1) {\n    return;\n  }\n  const name = Object.keys(filterNameAndValueObj)[0];\n  return { name, value: filterNameAndValueObj[name] };\n};\n","import React from 'react';\n\nimport { AdHocVariableFilter, BusEventBase, DataFrame } from '@grafana/data';\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { VariableHide } from '@grafana/schema';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { LEVEL_VARIABLE_VALUE, VAR_FIELDS, VAR_LABELS, VAR_LEVELS, VAR_METADATA } from 'services/variables';\nimport { FilterButton } from 'Components/FilterButton';\nimport { getDetectedLabelsFrame } from '../ServiceScene';\nimport { getParserForField } from '../../../services/fields';\nimport { getAdHocFiltersVariable, getValueFromAdHocVariableFilter } from '../../../services/variableGetters';\nimport { FilterOp } from '../../../services/filterTypes';\n\nimport { addToFavorites } from '../../../services/favorites';\n\nexport interface AddToFiltersButtonState extends SceneObjectState {\n  frame: DataFrame;\n  variableName: VariableFilterType;\n}\n\nexport class AddFilterEvent extends BusEventBase {\n  constructor(public operator: FilterType | NumericFilterType, public key: string, public value: string) {\n    super();\n  }\n  public static type = 'add-filter';\n}\n\nexport class ClearFilterEvent extends BusEventBase {\n  constructor(public key: string, public value?: string, public operator?: FilterType) {\n    super();\n  }\n  public static type = 'add-filter';\n}\n\nexport type NumericFilterType = FilterOp.gt | FilterOp.gte | FilterOp.lt | FilterOp.lte;\n\n/**\n * Filter types:\n * - include/exclude: add a negative or positive filter\n * - clear: remove filter if exists\n * - toggle: if the filter does not exist, add as include; if exists, remove\n */\nexport type FilterType = 'include' | 'clear' | 'exclude' | 'toggle';\n\nexport function addAdHocFilter(filter: AdHocVariableFilter, scene: SceneObject, variableType?: VariableFilterType) {\n  const type: FilterType = filter.operator === '=' ? 'include' : 'exclude';\n  addToFilters(filter.key, filter.value, type, scene, variableType);\n}\n\nexport type VariableFilterType = typeof VAR_LABELS | typeof VAR_FIELDS | typeof VAR_LEVELS | typeof VAR_METADATA;\n\nexport function clearFilters(\n  key: string,\n  scene: SceneObject,\n  variableType?: VariableFilterType,\n  value?: string,\n  operator?: FilterType\n) {\n  if (!variableType) {\n    variableType = resolveVariableTypeForField(key, scene);\n  }\n  const variable = getAdHocFiltersVariable(validateVariableNameForField(key, variableType), scene);\n\n  let filters = variable.state.filters.filter((filter) => {\n    const fieldValue = getValueFromAdHocVariableFilter(variable, filter);\n    if (value && operator) {\n      return !(filter.key === key && fieldValue.value === value && filter.operator === operator);\n    }\n    if (value) {\n      return !(filter.key === key && fieldValue.value === value);\n    }\n    if (operator) {\n      return !(filter.key === key && filter.operator === operator);\n    }\n\n    return !(filter.key === key);\n  });\n\n  scene.publishEvent(new ClearFilterEvent(key, value, operator), true);\n\n  variable.setState({\n    filters,\n  });\n}\n\ntype OperatorType = 'greater' | 'lesser';\nconst getNumericOperatorType = (op: NumericFilterType | string): OperatorType | undefined => {\n  if (op === FilterOp.gt || op === FilterOp.gte) {\n    return 'greater';\n  }\n  if (op === FilterOp.lt || op === FilterOp.lte) {\n    return 'lesser';\n  }\n  return undefined;\n};\n\nexport function removeFilter(\n  key: string,\n  scene: SceneObject,\n  operator?: NumericFilterType,\n  variableType?: VariableFilterType\n) {\n  if (!variableType) {\n    variableType = resolveVariableTypeForField(key, scene);\n  }\n  const variable = getAdHocFiltersVariable(validateVariableNameForField(key, variableType), scene);\n  const operatorType = operator ? getNumericOperatorType(operator) : undefined;\n\n  let filters = variable.state.filters.filter((filter) => {\n    return !(\n      filter.key === key &&\n      (getNumericOperatorType(filter.operator) === operatorType || filter.operator === FilterOp.NotEqual)\n    );\n  });\n\n  variable.setState({\n    filters,\n  });\n}\n\nexport function addNumericFilter(\n  key: string,\n  value: string,\n  operator: NumericFilterType,\n  scene: SceneObject,\n  variableType?: VariableFilterType\n) {\n  const operatorType = getNumericOperatorType(operator);\n\n  if (!variableType) {\n    variableType = resolveVariableTypeForField(key, scene);\n  }\n  const variable = getAdHocFiltersVariable(validateVariableNameForField(key, variableType), scene);\n\n  let valueObject: string | undefined = undefined;\n  if (variableType === VAR_FIELDS) {\n    valueObject = JSON.stringify({\n      value,\n      parser: getParserForField(key, scene),\n    });\n  }\n\n  let filters = variable.state.filters.filter((filter) => {\n    return !(\n      filter.key === key &&\n      (getNumericOperatorType(filter.operator) === operatorType || filter.operator === FilterOp.NotEqual)\n    );\n  });\n\n  filters = [\n    ...filters,\n    {\n      key,\n      operator: operator,\n      value: valueObject ? valueObject : value,\n      valueLabels: [value],\n    },\n  ];\n\n  scene.publishEvent(new AddFilterEvent(operator, key, value), true);\n\n  variable.setState({\n    filters,\n  });\n}\n\nexport function addToFilters(\n  key: string,\n  value: string,\n  operator: FilterType,\n  scene: SceneObject,\n  variableType?: VariableFilterType\n) {\n  if (!variableType) {\n    variableType = resolveVariableTypeForField(key, scene);\n  }\n\n  if (variableType === VAR_LABELS) {\n    addToFavorites(key, value, scene);\n  }\n\n  const variable = getAdHocFiltersVariable(validateVariableNameForField(key, variableType), scene);\n\n  let valueObject: string | undefined = undefined;\n  if (variableType === VAR_FIELDS) {\n    valueObject = JSON.stringify({\n      value,\n      parser: getParserForField(key, scene),\n    });\n  }\n\n  // If the filter exists, filter it\n  let filters = variable.state.filters.filter((filter) => {\n    const fieldValue = getValueFromAdHocVariableFilter(variable, filter);\n\n    // if we're including, we want to remove all filters that have this key\n    if (operator === 'include') {\n      return !(filter.key === key && filter.operator !== FilterOp.Equal);\n    }\n\n    return !(filter.key === key && fieldValue.value === value);\n  });\n\n  const filterExists = filters.length !== variable.state.filters.length;\n\n  if (operator === 'include' || operator === 'exclude' || (!filterExists && operator === 'toggle')) {\n    filters = [\n      ...filters,\n      {\n        key,\n        operator: operator === 'exclude' ? FilterOp.NotEqual : FilterOp.Equal,\n        value: valueObject ? valueObject : value,\n        valueLabels: [value],\n      },\n    ];\n  }\n\n  scene.publishEvent(new AddFilterEvent(operator, key, value), true);\n\n  variable.setState({\n    filters,\n  });\n}\n\nexport function replaceFilter(\n  key: string,\n  value: string,\n  operator: Extract<FilterType, 'include' | 'exclude'>,\n  scene: SceneObject\n) {\n  const variable = getAdHocFiltersVariable(\n    validateVariableNameForField(key, resolveVariableTypeForField(key, scene)),\n    scene\n  );\n\n  variable.setState({\n    filters: [\n      {\n        key,\n        operator: operator === 'exclude' ? FilterOp.NotEqual : FilterOp.Equal,\n        value,\n      },\n    ],\n    hide: VariableHide.hideLabel,\n  });\n}\n\nexport function validateVariableNameForField(field: string, variableName: string) {\n  // Special case: If the key is LEVEL_VARIABLE_VALUE, we need to use the VAR_FIELDS.\n  if (field === LEVEL_VARIABLE_VALUE) {\n    return VAR_LEVELS;\n  }\n  return variableName;\n}\n\nfunction resolveVariableTypeForField(field: string, scene: SceneObject): VariableFilterType {\n  const indexedLabel = getDetectedLabelsFrame(scene)?.fields?.find((label) => label.name === field);\n  return indexedLabel ? VAR_LABELS : VAR_FIELDS;\n}\n\nexport class AddToFiltersButton extends SceneObjectBase<AddToFiltersButtonState> {\n  public onClick = (type: FilterType) => {\n    const filter = getFilter(this.state.frame);\n    if (!filter) {\n      return;\n    }\n\n    addToFilters(filter.name, filter.value, type, this, this.state.variableName);\n\n    const variable = getAdHocFiltersVariable(validateVariableNameForField(filter.name, this.state.variableName), this);\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.add_to_filters_in_breakdown_clicked,\n      {\n        filterType: this.state.variableName,\n        key: filter.name,\n        action: type,\n        filtersLength: variable?.state.filters.length || 0,\n      }\n    );\n  };\n\n  isSelected = () => {\n    const filter = getFilter(this.state.frame);\n    if (!filter) {\n      return { isIncluded: false, isExcluded: false };\n    }\n\n    const variable = getAdHocFiltersVariable(validateVariableNameForField(filter.name, this.state.variableName), this);\n\n    // Check if the filter is already there\n    const filterInSelectedFilters = variable.state.filters.find((f) => {\n      const value = getValueFromAdHocVariableFilter(variable, f);\n      return f.key === filter.name && value.value === filter.value;\n    });\n\n    if (!filterInSelectedFilters) {\n      return { isIncluded: false, isExcluded: false };\n    }\n\n    return {\n      isIncluded: filterInSelectedFilters.operator === FilterOp.Equal,\n      isExcluded: filterInSelectedFilters.operator === FilterOp.NotEqual,\n    };\n  };\n\n  public static Component = ({ model }: SceneComponentProps<AddToFiltersButton>) => {\n    const { isIncluded, isExcluded } = model.isSelected();\n    return (\n      <FilterButton\n        buttonFill={'outline'}\n        isIncluded={isIncluded}\n        isExcluded={isExcluded}\n        onInclude={() => model.onClick('include')}\n        onClear={() => model.onClick('clear')}\n        onExclude={() => model.onClick('exclude')}\n      />\n    );\n  };\n}\n\nconst getFilter = (frame: DataFrame) => {\n  // current filter name and value is format {name: value}\n  const filterNameAndValueObj = frame.fields[1]?.labels ?? {};\n  // Sanity check - filter should have only one key-value pair\n  if (Object.keys(filterNameAndValueObj).length !== 1) {\n    return;\n  }\n  const name = Object.keys(filterNameAndValueObj)[0];\n  const value = filterNameAndValueObj[name];\n  return { name, value };\n};\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Select, useStyles2, InlineField, Icon, ActionMeta, InputActionMeta } from '@grafana/ui';\nimport { testIds } from '../../../services/testIds';\nimport { VariableValueOption } from '@grafana/scenes';\n\nimport { wrapWildcardSearch } from '../../../services/query';\n\ntype Props<T> = {\n  options: VariableValueOption[];\n  value?: T;\n  onChange: (label: T | undefined) => void;\n  label: string;\n};\n\nexport type AsyncFieldSelectorProps = {\n  selectOption: (value: string) => void;\n  isLoading: boolean;\n  initialFilter: SelectableValue<string>;\n} & Props<string>;\n\nexport function FieldSelector<T>({ options, value, onChange, label }: Props<T>) {\n  const styles = useStyles2(getStyles);\n  const [selected, setSelected] = useState(false);\n\n  const selectableOptions: SelectableValue[] = options.map((option) => {\n    return {\n      label: option.label,\n      value: option.value,\n    };\n  });\n  return (\n    <InlineField label={label}>\n      <Select\n        {...{ options: selectableOptions, value }}\n        onOpenMenu={() => setSelected(true)}\n        onCloseMenu={() => setSelected(false)}\n        onChange={(selected: SelectableValue<T>) => onChange(selected.value)}\n        className={styles.select}\n        prefix={selected ? undefined : <Icon name={'search'} />}\n      />\n    </InlineField>\n  );\n}\n\nexport function ServiceFieldSelector({\n  options,\n  value,\n  onChange,\n  label,\n  selectOption,\n  isLoading,\n  initialFilter,\n}: AsyncFieldSelectorProps) {\n  const styles = useStyles2(getStyles);\n  const [selected, setSelected] = useState(false);\n  const [customOption, setCustomOption] = useState<SelectableValue<string>>(initialFilter);\n\n  const selectableOptions: SelectableValue[] = options.map((option) => {\n    return {\n      label: option.label,\n      value: option.value,\n    };\n  });\n  const allOptions =\n    customOption && value && customOption.value?.includes(value)\n      ? [customOption, ...selectableOptions]\n      : selectableOptions;\n\n  const selectedOption = allOptions?.find((opt) => opt.value === value);\n\n  return (\n    <InlineField className={styles.selectWrapper} grow={true} label={label}>\n      <Select\n        isLoading={isLoading}\n        data-testid={testIds.exploreServiceSearch.search}\n        placeholder={`Search values`}\n        options={allOptions}\n        isClearable={true}\n        value={value}\n        onOpenMenu={() => setSelected(true)}\n        onCloseMenu={() => setSelected(false)}\n        allowCustomValue={true}\n        prefix={selected || selectedOption?.__isNew__ ? undefined : <Icon name={'search'} />}\n        onChange={(value: SelectableValue<string>, actionMeta: ActionMeta) => {\n          // Custom added value\n          if (value?.__isNew__ || value?.icon) {\n            setCustomOption({ ...value, icon: 'filter' });\n            return onChange(value.value);\n          }\n\n          // If the user clears the search\n          if (actionMeta.action === 'clear') {\n            return onChange('');\n          }\n\n          // Select the service is the value is not a custom filter\n          if (actionMeta.action === 'select-option' && value.value && !value.__isNew__) {\n            selectOption(value.value);\n          }\n        }}\n        onInputChange={(value: string | undefined, actionMeta: InputActionMeta) => {\n          // Grafana/grafana doesn't have types from react-select, but we need the prevInput to add custom value when user clicks off with active search string\n          const meta = actionMeta as InputActionMeta & { prevInputValue: string };\n\n          // The user is typing\n          if (meta.action === 'input-change') {\n            return onChange(value);\n          }\n\n          // the user closed the menu, with text in search box\n          if (meta.action === 'menu-close' && meta.prevInputValue) {\n            setCustomOption({\n              value: wrapWildcardSearch(meta.prevInputValue),\n              label: meta.prevInputValue,\n              icon: 'filter',\n              __isNew__: true,\n            });\n            return onChange(meta.prevInputValue);\n          }\n        }}\n      />\n    </InlineField>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    input: css({\n      marginBottom: 0,\n    }),\n    select: css({\n      maxWidth: theme.spacing(64),\n      minWidth: theme.spacing(20),\n    }),\n    selectWrapper: css({\n      maxWidth: theme.spacing(62.5),\n      minWidth: theme.spacing(20),\n      marginRight: theme.spacing.x1,\n      marginBottom: 0,\n    }),\n  };\n}\n","import React from 'react';\n\nimport { toURLRange, urlUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { sceneGraph } from '@grafana/scenes';\nimport { ToolbarButton } from '@grafana/ui';\n\nimport { getDataSource, getQueryExpr } from 'services/scenes';\nimport { testIds } from 'services/testIds';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport { USER_EVENTS_ACTIONS, USER_EVENTS_PAGES, reportAppInteraction } from 'services/analytics';\nimport { getDisplayedFields, getLogsVisualizationType } from 'services/store';\ninterface GoToExploreButtonState {\n  exploration: IndexScene;\n}\n\nexport const GoToExploreButton = ({ exploration }: GoToExploreButtonState) => {\n  const onClick = () => {\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.open_in_explore_clicked\n    );\n    const datasource = getDataSource(exploration);\n    const expr = getQueryExpr(exploration).replace(/\\s+/g, ' ').trimEnd();\n    const timeRange = sceneGraph.getTimeRange(exploration).state.value;\n    const displayedFields = getDisplayedFields(exploration);\n    const visualisationType = getLogsVisualizationType();\n    const columns = getUrlColumns();\n    const exploreState = JSON.stringify({\n      ['loki-explore']: {\n        range: toURLRange(timeRange.raw),\n        queries: [{ refId: 'logs', expr, datasource }],\n        panelsState: { logs: { displayedFields, visualisationType, columns } },\n        datasource,\n      },\n    });\n    const subUrl = config.appSubUrl ?? '';\n    const link = urlUtil.renderUrl(`${subUrl}/explore`, { panes: exploreState, schemaVersion: 1 });\n    window.open(link, '_blank');\n  };\n\n  return (\n    <ToolbarButton\n      data-testid={testIds.exploreServiceDetails.openExplore}\n      variant={'canvas'}\n      icon={'compass'}\n      onClick={onClick}\n    >\n      Open in Explore\n    </ToolbarButton>\n  );\n};\n\nfunction getUrlColumns() {\n  const params = new URLSearchParams(window.location.search);\n  const urlColumns = params.get('urlColumns');\n  if (urlColumns) {\n    try {\n      const columns: string[] = JSON.parse(urlColumns);\n      let columnsParam: Record<number, string> = {};\n      for (const key in columns) {\n        columnsParam[key] = columns[key];\n      }\n      return columnsParam;\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  return undefined;\n}\n","import { css } from '@emotion/css';\nimport { Icon, Input } from '@grafana/ui';\nimport React, { HTMLProps } from 'react';\n\ninterface Props extends Omit<HTMLProps<HTMLInputElement>, 'width'> {\n  onClear(): void;\n  suffix?: React.ReactNode;\n}\n\nexport const SearchInput = ({ value, onChange, placeholder, onClear, suffix, ...rest }: Props) => {\n  return (\n    <Input\n      value={value}\n      onChange={onChange}\n      suffix={\n        <>\n          {value ? (\n            <Icon onClick={onClear} title={'Clear search'} name=\"times\" className={styles.clearIcon} />\n          ) : undefined}\n          {suffix && suffix}\n        </>\n      }\n      prefix={<Icon name=\"search\" />}\n      placeholder={placeholder}\n      {...rest}\n    />\n  );\n};\n\nconst styles = {\n  clearIcon: css({\n    cursor: 'pointer',\n  }),\n};\n","import { useTheme2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\ninterface Props {\n  onCaseSensitiveToggle: (state: 'sensitive' | 'insensitive') => void;\n  caseSensitive: boolean;\n}\n\nexport const LineFilterIcon = (props: Props) => {\n  const theme = useTheme2();\n  const fill = props.caseSensitive ? theme.colors.text.maxContrast : theme.colors.text.disabled;\n  const styles = getStyles(theme, fill);\n\n  return (\n    <span className={styles.container} title={`Case ${props.caseSensitive ? 'insensitive' : 'sensitive'} search`}>\n      <svg\n        onClick={() => props.onCaseSensitiveToggle(props.caseSensitive ? 'insensitive' : 'sensitive')}\n        fill={fill}\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <text fontSize=\"13\" width=\"16\" height=\"16\" x=\"50%\" y=\"50%\" dominantBaseline=\"central\" textAnchor=\"middle\">\n          Aa\n        </text>\n      </svg>\n    </span>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2, fill: string) => {\n  return {\n    container: css({\n      display: 'flex',\n      justifyContent: 'center',\n      marginLeft: theme.spacing.x0_5,\n      cursor: 'pointer',\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Field } from '@grafana/ui';\nimport { debounce, escapeRegExp } from 'lodash';\nimport React, { ChangeEvent, KeyboardEvent } from 'react';\nimport { testIds } from 'services/testIds';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { SearchInput } from './Breakdowns/SearchInput';\nimport { LineFilterIcon } from './LineFilterIcon';\nimport { getLineFilterVariable } from '../../services/variableGetters';\n\ninterface LineFilterState extends SceneObjectState {\n  lineFilter: string;\n  caseSensitive: boolean;\n}\n\nexport class LineFilterScene extends SceneObjectBase<LineFilterState> {\n  static Component = LineFilterRenderer;\n\n  constructor(state?: Partial<LineFilterState>) {\n    super({\n      lineFilter: state?.lineFilter || '',\n      caseSensitive: false,\n      ...state,\n    });\n    this.addActivationHandler(this.onActivate);\n  }\n\n  private onActivate = () => {\n    const lineFilterValue = getLineFilterVariable(this).getValue();\n    const lineFilterString = lineFilterValue.toString();\n    if (!lineFilterValue) {\n      return;\n    }\n    const caseSensitive = lineFilterString.includes('|=');\n    const matches = caseSensitive ? lineFilterString.match(/\\|=.`(.+?)`/) : lineFilterString.match(/`\\(\\?i\\)(.+)`/);\n\n    if (!matches || matches.length !== 2) {\n      return;\n    }\n    this.setState({\n      lineFilter: matches[1].replace(/\\\\(.)/g, '$1'),\n      caseSensitive,\n    });\n  };\n\n  updateFilter(lineFilter: string, debounced = true) {\n    this.setState({\n      lineFilter,\n    });\n    if (debounced) {\n      this.updateVariableDebounced(lineFilter);\n    } else {\n      this.updateVariable(lineFilter);\n    }\n  }\n\n  handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n    this.updateFilter(e.target.value);\n  };\n\n  handleEnter = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      this.updateVariable(this.state.lineFilter);\n    }\n  };\n\n  onCaseSensitiveToggle = (newState: 'sensitive' | 'insensitive') => {\n    this.setState({\n      caseSensitive: newState === 'sensitive',\n    });\n\n    this.updateFilter(this.state.lineFilter);\n  };\n\n  updateVariableDebounced = debounce((search: string) => {\n    this.updateVariable(search);\n  }, 1000);\n\n  updateVariable = (search: string) => {\n    const variable = getLineFilterVariable(this);\n    if (search === '') {\n      variable.changeValueTo('');\n    } else {\n      if (this.state.caseSensitive) {\n        variable.changeValueTo(`|= \\`${escapeRegExp(search)}\\``);\n      } else {\n        variable.changeValueTo(`|~ \\`(?i)${escapeRegExp(search)}\\``);\n      }\n    }\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.search_string_in_logs_changed,\n      {\n        searchQueryLength: search.length,\n        containsLevel: search.toLowerCase().includes('level'),\n      }\n    );\n  };\n}\n\nfunction LineFilterRenderer({ model }: SceneComponentProps<LineFilterScene>) {\n  const { lineFilter, caseSensitive } = model.useState();\n  return (\n    <Field className={styles.field}>\n      <SearchInput\n        data-testid={testIds.exploreServiceDetails.searchLogs}\n        value={lineFilter}\n        className={styles.input}\n        onChange={model.handleChange}\n        suffix={<LineFilterIcon caseSensitive={caseSensitive} onCaseSensitiveToggle={model.onCaseSensitiveToggle} />}\n        placeholder=\"Search in log lines\"\n        onClear={() => {\n          model.updateFilter('', false);\n        }}\n        onKeyUp={model.handleEnter}\n      />\n    </Field>\n  );\n}\n\nconst styles = {\n  input: css({\n    width: '100%',\n  }),\n  field: css({\n    label: 'field',\n    width: '100%',\n    marginBottom: 0,\n  }),\n};\n","import { DataFrame, DataFrameType, Field, FieldCache, FieldType, FieldWithIndex, Labels } from '@grafana/data';\n\n// these are like Labels, but their values can be\n// arbitrary structures, not just strings\nexport type LogFrameLabels = Record<string, unknown>;\n\n// the attributes-access is a little awkward, but it's necessary\n// because there are multiple,very different dataFrame-representations.\nexport type LogsFrame = {\n  timeField: FieldWithIndex;\n  bodyField: FieldWithIndex;\n  timeNanosecondField: FieldWithIndex | null;\n  severityField: FieldWithIndex | null;\n  idField: FieldWithIndex | null;\n  getLogFrameLabels: () => LogFrameLabels[] | null; // may be slow, so we only do it when asked for it explicitly\n  getLogFrameLabelsAsLabels: () => Labels[] | null; // temporarily exists to make the labels=>attributes migration simpler\n  getLabelFieldName: () => string | null;\n  extraFields: FieldWithIndex[];\n  raw: DataFrame;\n};\n\nfunction getField(cache: FieldCache, name: string, fieldType: FieldType): FieldWithIndex | undefined {\n  const field = cache.getFieldByName(name);\n  if (field === undefined) {\n    return undefined;\n  }\n\n  return field.type === fieldType ? field : undefined;\n}\n\nexport const DATAPLANE_TIMESTAMP_NAME = 'timestamp';\nexport const DATAPLANE_BODY_NAME = 'body';\nexport const DATAPLANE_SEVERITY_NAME = 'severity';\nexport const DATAPLANE_ID_NAME = 'id';\nexport const DATAPLANE_LABELS_NAME = 'labels';\n\nexport function logFrameLabelsToLabels(logFrameLabels: LogFrameLabels): Labels {\n  const result: Labels = {};\n\n  Object.entries(logFrameLabels).forEach(([k, v]) => {\n    result[k] = typeof v === 'string' ? v : JSON.stringify(v);\n  });\n\n  return result;\n}\n\nexport function parseLogsFrame(frame: DataFrame): LogsFrame | null {\n  if (frame.meta?.type === DataFrameType.LogLines) {\n    return parseDataplaneLogsFrame(frame);\n  } else {\n    return parseLegacyLogsFrame(frame);\n  }\n}\n\nexport function parseDataplaneLogsFrame(frame: DataFrame): LogsFrame | null {\n  const cache = new FieldCache(frame);\n\n  const timestampField = getField(cache, DATAPLANE_TIMESTAMP_NAME, FieldType.time);\n  const bodyField = getField(cache, DATAPLANE_BODY_NAME, FieldType.string);\n\n  // these two are mandatory\n  if (timestampField === undefined || bodyField === undefined) {\n    return null;\n  }\n\n  const severityField = getField(cache, DATAPLANE_SEVERITY_NAME, FieldType.string) ?? null;\n  const idField = getField(cache, DATAPLANE_ID_NAME, FieldType.string) ?? null;\n  const labelsField = getField(cache, DATAPLANE_LABELS_NAME, FieldType.other) ?? null;\n\n  const labels = labelsField === null ? null : labelsField.values;\n\n  const extraFields = cache.fields.filter(\n    (_, i) =>\n      i !== timestampField.index &&\n      i !== bodyField.index &&\n      i !== severityField?.index &&\n      i !== idField?.index &&\n      i !== labelsField?.index\n  );\n\n  return {\n    raw: frame,\n    timeField: timestampField,\n    bodyField,\n    severityField,\n    idField,\n    getLogFrameLabels: () => labels,\n    timeNanosecondField: null,\n    getLogFrameLabelsAsLabels: () => (labels !== null ? labels.map(logFrameLabelsToLabels) : null),\n    getLabelFieldName: () => (labelsField !== null ? labelsField.name : null),\n    extraFields,\n  };\n}\n\n// Copied from https://github.com/grafana/grafana/blob/main/public/app/features/logs/legacyLogsFrame.ts\nexport function parseLegacyLogsFrame(frame: DataFrame): LogsFrame | null {\n  const cache = new FieldCache(frame);\n  const timeField = cache.getFirstFieldOfType(FieldType.time);\n  const bodyField = cache.getFirstFieldOfType(FieldType.string);\n\n  // these two are mandatory\n  if (timeField === undefined || bodyField === undefined) {\n    return null;\n  }\n\n  const timeNanosecondField = cache.getFieldByName('tsNs') ?? null;\n  const severityField = cache.getFieldByName('level') ?? null;\n  const idField = cache.getFieldByName('id') ?? null;\n\n  // extracting the labels is done very differently for old-loki-style and simple-style\n  // dataframes, so it's a little awkward to handle it,\n  // we both need to on-demand extract the labels, and also get teh labelsField,\n  // but only if the labelsField is used.\n  const [labelsField, getL] = makeLabelsGetter(cache, bodyField, frame);\n\n  const extraFields = cache.fields.filter(\n    (_, i) =>\n      i !== timeField.index &&\n      i !== bodyField.index &&\n      i !== timeNanosecondField?.index &&\n      i !== severityField?.index &&\n      i !== idField?.index &&\n      i !== labelsField?.index\n  );\n\n  return {\n    timeField,\n    bodyField,\n    timeNanosecondField,\n    severityField,\n    idField,\n    getLogFrameLabels: getL,\n    getLogFrameLabelsAsLabels: getL,\n    getLabelFieldName: () => labelsField?.name ?? null,\n    extraFields,\n    raw: frame,\n  };\n}\n\n// if the frame has \"labels\" field with type \"other\", adjust the behavior.\n// we also have to return the labels-field (if we used it),\n// to be able to remove it from the unused-fields, later.\nfunction makeLabelsGetter(\n  cache: FieldCache,\n  lineField: Field,\n  frame: DataFrame\n): [FieldWithIndex | null, () => Labels[] | null] {\n  // If we have labels field with type \"other\", use that\n  const labelsField = cache.getFieldByName('labels');\n  if (labelsField !== undefined && labelsField.type === FieldType.other) {\n    const values = labelsField.values.map(logFrameLabelsToLabels);\n    return [labelsField, () => values];\n  } else {\n    // Otherwise we use the labels on the line-field, and make an array with it\n    return [null, () => makeLabelsArray(lineField, frame.length)];\n  }\n}\n\n// take the labels from the line-field, and \"stretch\" it into an array\n// with the length of the frame (so there are the same labels for every row)\nfunction makeLabelsArray(lineField: Field, length: number): Labels[] | null {\n  const lineLabels = lineField.labels;\n  if (lineLabels !== undefined) {\n    const result = new Array(length);\n    result.fill(lineLabels);\n    return result;\n  } else {\n    return null;\n  }\n}\n\nexport function getTimeName(logsFrame?: LogsFrame) {\n  return logsFrame?.timeField.name ?? DATAPLANE_TIMESTAMP_NAME;\n}\n\nexport function getBodyName(logsFrame?: LogsFrame | null): string {\n  return logsFrame?.bodyField.name ?? DATAPLANE_BODY_NAME;\n}\n\nexport function getIdName(logsFrame?: LogsFrame): string {\n  return logsFrame?.idField?.name ?? DATAPLANE_ID_NAME;\n}\n","import React, { createContext, ReactNode, useCallback, useContext, useEffect, useState } from 'react';\nimport { ActiveFieldMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { getBodyName, getTimeName, LogsFrame } from '../../../services/logsFrame';\nimport { logger } from '../../../services/logger';\n\nimport { PLUGIN_ID } from '../../../services/plugin';\n\nconst tableColumnCustomWidths = `${PLUGIN_ID}.tableColumnWidths`;\n\ntype TableColumnsContextType = {\n  // the current list of labels from the dataframe combined with UI metadata\n  columns: FieldNameMetaStore;\n  // The active search results\n  filteredColumns?: FieldNameMetaStore;\n  // Update the column state\n  setColumns(newColumns: FieldNameMetaStore): void;\n  // Update search state\n  setFilteredColumns(newColumns?: FieldNameMetaStore): void;\n  // WIP - sets the visibility of the drawer right now\n  visible: boolean;\n  setVisible: (v: boolean) => void;\n  bodyState: LogLineState;\n  setBodyState: (s: LogLineState) => void;\n  clearSelectedLine: () => void;\n  setColumnWidthMap(map: Record<string, number>): void;\n  columnWidthMap: Record<string, number>;\n};\n\nexport enum LogLineState {\n  text = 'text',\n  labels = 'labels',\n  auto = 'auto',\n}\n\nconst TableColumnsContext = createContext<TableColumnsContextType>({\n  columnWidthMap: {},\n  setColumnWidthMap: () => {},\n  columns: {},\n  filteredColumns: {},\n  setColumns: () => {},\n  setFilteredColumns: () => {},\n  setVisible: () => false,\n  visible: false,\n  bodyState: LogLineState.auto,\n  setBodyState: () => {},\n  clearSelectedLine: () => {},\n});\n\nfunction setDefaultColumns(\n  columns: FieldNameMetaStore,\n  handleSetColumns: (newColumns: FieldNameMetaStore) => void,\n  logsFrame: LogsFrame\n) {\n  const pendingColumns = { ...columns };\n\n  pendingColumns[getTimeName(logsFrame)] = {\n    index: 0,\n    active: true,\n    type: 'TIME_FIELD',\n    percentOfLinesWithLabel: 100,\n    cardinality: Infinity,\n  };\n  pendingColumns[getBodyName(logsFrame)] = {\n    index: 1,\n    active: true,\n    type: 'BODY_FIELD',\n    percentOfLinesWithLabel: 100,\n    cardinality: Infinity,\n  };\n  handleSetColumns(pendingColumns);\n}\n\nfunction getColumnWidthsFromLocalStorage() {\n  let initialColumnWidths = {};\n  const existingWidths = localStorage.getItem(tableColumnCustomWidths);\n  if (existingWidths) {\n    try {\n      initialColumnWidths = JSON.parse(existingWidths);\n    } catch (e) {\n      logger.error(e, { msg: 'error parsing table column widths from local storage' });\n    }\n  }\n  return initialColumnWidths;\n}\n\nexport const TableColumnContextProvider = ({\n  children,\n  initialColumns,\n  logsFrame,\n  setUrlColumns,\n  clearSelectedLine,\n}: {\n  children: ReactNode;\n  initialColumns: FieldNameMetaStore;\n  logsFrame: LogsFrame;\n  setUrlColumns: (columns: string[]) => void;\n  clearSelectedLine: () => void;\n}) => {\n  const [columns, setColumns] = useState<FieldNameMetaStore>(removeExtraColumns(initialColumns));\n  const [bodyState, setBodyState] = useState<LogLineState>(LogLineState.auto);\n  const [filteredColumns, setFilteredColumns] = useState<FieldNameMetaStore | undefined>(undefined);\n  const [visible, setVisible] = useState(false);\n  const initialColumnWidths = getColumnWidthsFromLocalStorage();\n\n  const [columnWidthMap, setColumnWidthMapState] = useState<Record<string, number>>(initialColumnWidths);\n  const setColumnWidthMap = (map: Record<string, number>) => {\n    localStorage.setItem(tableColumnCustomWidths, JSON.stringify(map));\n    setColumnWidthMapState(map);\n  };\n\n  const getActiveColumns = (columns: FieldNameMetaStore): string[] => {\n    let activeColumns: string[] = [];\n    Object.keys(columns).forEach((fieldName) => {\n      if (columns[fieldName].active && columns[fieldName].index !== undefined) {\n        activeColumns.push(fieldName);\n      }\n    });\n    activeColumns.sort((a, b) => {\n      // Typescript doesn't seem to know that the indicies we picked in the loop above are only for ActiveFieldMeta, so we're forced to assert\n      const colA: ActiveFieldMeta = columns[a] as ActiveFieldMeta;\n      const colB: ActiveFieldMeta = columns[b] as ActiveFieldMeta;\n      return colA.index - colB.index;\n    });\n    return activeColumns;\n  };\n\n  const handleSetColumns = useCallback(\n    (newColumns: FieldNameMetaStore) => {\n      if (newColumns) {\n        const columns = removeExtraColumns(newColumns);\n\n        setColumns(columns);\n\n        // Sync react state update with scenes url management\n        setUrlColumns(getActiveColumns(columns));\n      }\n    },\n    [setUrlColumns]\n  );\n\n  const handleClearSelectedLine = () => {\n    clearSelectedLine();\n  };\n\n  const handleSetVisible = useCallback((isVisible: boolean) => {\n    setVisible(isVisible);\n  }, []);\n\n  // When the parent component recalculates new columns on dataframe change, we need to update or the column UI will be stale!\n  useEffect(() => {\n    if (initialColumns) {\n      handleSetColumns(initialColumns);\n    }\n  }, [initialColumns, handleSetColumns]);\n\n  // When the columns are updated, we need to check if nothing is selected so we can set the default\n  useEffect(() => {\n    const activeColumns = getDefaultColumns(columns, logsFrame);\n    if (activeColumns?.length) {\n      const activeFields = Object.keys(columns).filter((col) => columns[col].active);\n\n      // If we're missing all fields, the user must have removed the last column, let's revert back to the default state\n      if (activeFields.length === 0) {\n        setDefaultColumns(columns, handleSetColumns, logsFrame);\n      }\n\n      // Reset any local search state\n      setFilteredColumns(undefined);\n    }\n  }, [columns, logsFrame, setFilteredColumns, handleSetColumns]);\n\n  return (\n    <TableColumnsContext.Provider\n      value={{\n        setColumnWidthMap,\n        columnWidthMap,\n        bodyState,\n        setBodyState,\n        setFilteredColumns,\n        filteredColumns,\n        columns,\n        setColumns: handleSetColumns,\n        visible: visible,\n        setVisible: handleSetVisible,\n        clearSelectedLine: handleClearSelectedLine,\n      }}\n    >\n      {children}\n    </TableColumnsContext.Provider>\n  );\n};\n/**\n * Filter out fields that shouldn't be exposed in the UI\n * @param columns\n */\nconst removeExtraColumns = (columns: FieldNameMetaStore): FieldNameMetaStore => {\n  // Remove label Types\n  if ('labelTypes' in columns) {\n    const { labelTypes, ...columnsToSet }: FieldNameMetaStore = {\n      ...columns,\n    };\n    return columnsToSet;\n  }\n  return columns;\n};\n\nfunction getDefaultColumns(pendingLabelState: FieldNameMetaStore, logsFrame: LogsFrame) {\n  if (!logsFrame) {\n    logger.warn('missing dataframe, cannot set url state');\n    return;\n  }\n  // Get all active columns and sort by index\n  const newColumnsArray = Object.keys(pendingLabelState)\n    // Only include active filters\n    .filter((key) => pendingLabelState[key]?.active)\n    .sort((a, b) => {\n      const pa = pendingLabelState[a];\n      const pb = pendingLabelState[b];\n      if (pa.index !== undefined && pb.index !== undefined) {\n        return pa.index - pb.index; // sort by index\n      }\n      return 0;\n    });\n\n  const timeField = logsFrame.timeField;\n  const bodyField = logsFrame.bodyField;\n\n  if ((timeField && bodyField) || newColumnsArray.length) {\n    const defaultColumns = [];\n    if (timeField?.name) {\n      defaultColumns.push(timeField.name);\n    }\n    if (bodyField?.name) {\n      defaultColumns.push(bodyField.name);\n    }\n\n    // Update url state\n    return newColumnsArray.length ? newColumnsArray : defaultColumns;\n  }\n\n  return [];\n}\n\nexport const useTableColumnContext = () => {\n  return useContext(TableColumnsContext);\n};\n","import React, { createContext, ReactNode, useCallback, useContext, useState } from 'react';\n\nexport type CellIndex = {\n  fieldName?: string;\n  // If the field contains labels (like log line), we need to know which field (line) and which label (e.g. level)\n  subFieldName?: string;\n  index: number | null;\n  numberOfMenuItems?: number;\n};\n\ntype TableCellContextType = {\n  cellIndex: CellIndex;\n  setActiveCellIndex(cellIndex: CellIndex): void;\n};\n\nconst TableCellContext = createContext<TableCellContextType>({\n  cellIndex: { index: null, numberOfMenuItems: 3 },\n  setActiveCellIndex: (cellIndex: CellIndex) => false,\n});\n\nexport const TableCellContextProvider = ({ children }: { children: ReactNode }) => {\n  const [cellActive, setCellActive] = useState<CellIndex>({ index: null });\n\n  const handleCellActive = useCallback((cellIndex: CellIndex) => {\n    setCellActive(cellIndex);\n  }, []);\n\n  return (\n    <TableCellContext.Provider value={{ cellIndex: cellActive, setActiveCellIndex: handleCellActive }}>\n      {children}\n    </TableCellContext.Provider>\n  );\n};\n\nexport const useTableCellContext = () => {\n  return useContext(TableCellContext);\n};\n","import React, { createContext, ReactNode, useCallback, useContext, useState } from 'react';\n\ntype TableHeaderContextType = {\n  isHeaderMenuActive: boolean;\n  setHeaderMenuActive: (isHeaderMenuActive: boolean) => void;\n};\n\nconst TableHeaderContext = createContext<TableHeaderContextType>({\n  isHeaderMenuActive: false,\n  setHeaderMenuActive: (isHeaderMenuActive: boolean) => false,\n});\n\nexport const TableHeaderContextProvider = ({ children }: { children: ReactNode }) => {\n  const [isHeaderMenuActive, setHeaderMenuActive] = useState<boolean>(false);\n\n  const handleisHeaderMenuActive = useCallback((isHeaderMenuActive: boolean) => {\n    setHeaderMenuActive(isHeaderMenuActive);\n  }, []);\n\n  return (\n    <TableHeaderContext.Provider value={{ isHeaderMenuActive, setHeaderMenuActive: handleisHeaderMenuActive }}>\n      {children}\n    </TableHeaderContext.Provider>\n  );\n};\n\nexport const useTableHeaderContext = () => {\n  return useContext(TableHeaderContext);\n};\n","import uFuzzy from '@leeoniya/ufuzzy';\nimport { debounce as debounceLodash } from 'lodash';\n\nconst uf = new uFuzzy({\n  intraMode: 1,\n  intraIns: 1,\n  intraSub: 1,\n  intraTrn: 1,\n  intraDel: 1,\n});\n\nexport function fuzzySearch(haystack: string[], query: string, callback: (data: string[][]) => void) {\n  const [idxs, info, order] = uf.search(haystack, query, 0, 1e5);\n\n  let haystackOrder: string[] = [];\n  let matchesSet: Set<string> = new Set();\n  if (idxs && order) {\n    /**\n     * get the fuzzy matches for highlighting\n     * @param part\n     * @param matched\n     */\n    const mark = (part: string, matched: boolean) => {\n      if (matched) {\n        matchesSet.add(part);\n      }\n    };\n\n    // Iterate to create the order of needles(queries) and the matches\n    for (let i = 0; i < order.length; i++) {\n      let infoIdx = order[i];\n\n      /** Evaluate the match, get the matches for highlighting */\n      uFuzzy.highlight(haystack[info.idx[infoIdx]], info.ranges[infoIdx], mark);\n      /** Get the order */\n      haystackOrder.push(haystack[info.idx[infoIdx]]);\n    }\n\n    callback([haystackOrder, [...matchesSet]]);\n  } else if (!query) {\n    callback([]);\n  }\n}\n\nexport const debouncedFuzzySearch = debounceLodash(fuzzySearch, 300);\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Field, Input, useTheme2 } from '@grafana/ui';\n\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { reportInteraction } from '@grafana/runtime';\nimport { debouncedFuzzySearch } from '../../../services/search';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    searchWrap: css({\n      padding: `${theme.spacing(0.4)} 0 ${theme.spacing(0.4)} ${theme.spacing(0.4)}`,\n    }),\n  };\n}\n\ninterface LogsColumnSearchProps {\n  searchValue: string;\n  setSearchValue: (value: string) => void;\n}\nexport function LogsColumnSearch({ searchValue, setSearchValue }: LogsColumnSearchProps) {\n  const { columns, setFilteredColumns } = useTableColumnContext();\n\n  // uFuzzy search dispatcher, adds any matches to the local state\n  const dispatcher = (data: string[][]) => {\n    const matches = data[0];\n    let newColumnsWithMeta: FieldNameMetaStore = {};\n    let numberOfResults = 0;\n    matches.forEach((match) => {\n      if (match in columns) {\n        newColumnsWithMeta[match] = columns[match];\n        numberOfResults++;\n      }\n    });\n    setFilteredColumns(newColumnsWithMeta);\n    searchFilterEvent(numberOfResults);\n  };\n\n  // uFuzzy search\n  const search = (needle: string) => {\n    debouncedFuzzySearch(Object.keys(columns), needle, dispatcher);\n  };\n\n  // onChange handler for search input\n  const onSearchInputChange = (e: React.FormEvent<HTMLInputElement>) => {\n    const value = e.currentTarget?.value;\n    setSearchValue(value);\n    if (value) {\n      search(value);\n    } else {\n      // If the search input is empty, reset the local search state.\n      setFilteredColumns(undefined);\n    }\n  };\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <Field className={styles.searchWrap}>\n      <Input value={searchValue} type={'text'} placeholder={'Search fields by name'} onChange={onSearchInputChange} />\n    </Field>\n  );\n}\n\nfunction searchFilterEvent(searchResultCount: number) {\n  reportInteraction('grafana_logs_app_table_text_search_result_count', {\n    resultCount: searchResultCount,\n  });\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    empty: css({\n      marginBottom: theme.spacing(2),\n      marginLeft: theme.spacing(1.75),\n      fontSize: theme.typography.fontSize,\n    }),\n  };\n}\n\nexport function LogsTableEmptyFields() {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return <div className={styles.empty}>No fields</div>;\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Checkbox, Icon, useTheme2 } from '@grafana/ui';\n\nimport { FieldNameMeta } from '../TableTypes';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    dragIcon: css({\n      cursor: 'drag',\n      marginLeft: theme.spacing(1),\n      opacity: 0.4,\n    }),\n    labelCount: css({\n      marginLeft: theme.spacing(0.5),\n      marginRight: theme.spacing(0.5),\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      fontSize: theme.typography.pxToRem(11),\n      opacity: 0.6,\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'self-end',\n    }),\n    contentWrap: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      width: '100%',\n    }),\n    customWidthWrap: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      cursor: 'pointer',\n    }),\n    // Hide text that overflows, had to select elements within the Checkbox component, so this is a bit fragile\n    checkboxLabel: css({\n      '> span': {\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n        display: 'block',\n        maxWidth: '100%',\n      },\n    }),\n  };\n}\n\nexport function LogsTableNavField(props: {\n  label: string;\n  onChange: () => void;\n  labels: Record<string, FieldNameMeta>;\n  draggable?: boolean;\n  showCount?: boolean;\n  setColumnWidthMap?: (map: Record<string, number>) => void;\n  columnWidthMap?: Record<string, number>;\n}): React.JSX.Element | null {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  if (props.labels[props.label]) {\n    return (\n      <>\n        <div className={styles.contentWrap}>\n          <Checkbox\n            className={styles.checkboxLabel}\n            label={props.label}\n            onChange={props.onChange}\n            checked={props.labels[props.label]?.active ?? false}\n          />\n          {props.showCount && (\n            <div className={styles.labelCount}>\n              <div>{props.labels[props.label]?.percentOfLinesWithLabel}%</div>\n              <div>\n                {props.labels[props.label]?.cardinality}{' '}\n                {props.labels[props.label]?.cardinality === 1 ? 'value' : 'values'}\n              </div>\n            </div>\n          )}\n          {props.columnWidthMap && props.setColumnWidthMap && props.columnWidthMap?.[props.label] !== undefined && (\n            <div\n              onClick={() => {\n                const { [props.label]: omit, ...map } = { ...props.columnWidthMap };\n                props.setColumnWidthMap?.(map);\n              }}\n              title={'Clear column width override'}\n              className={styles.customWidthWrap}\n            >\n              Width: {props.columnWidthMap?.[props.label]}\n              <Icon name={'x'} />\n            </div>\n          )}\n        </div>\n        {props.draggable && (\n          <Icon\n            aria-label=\"Drag and drop icon\"\n            title=\"Drag and drop to reorder\"\n            name=\"draggabledots\"\n            size=\"lg\"\n            className={styles.dragIcon}\n          />\n        )}\n      </>\n    );\n  }\n\n  return null;\n}\n","import React, { ReactElement } from 'react';\nimport { DragDropContext, Draggable, DraggableProvided, Droppable, DropResult } from '@hello-pangea/dnd';\nimport { css, cx } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data/';\nimport { useTheme2 } from '@grafana/ui/';\n\nimport { FieldNameMeta, FieldNameMetaStore } from '../TableTypes';\n\nimport { LogsTableEmptyFields } from './LogsTableEmptyFields';\nimport { LogsTableNavField } from './LogsTableNavField';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\n\nexport function getLogsFieldsStyles(theme: GrafanaTheme2) {\n  return {\n    wrap: css({\n      marginTop: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n      display: 'flex',\n      background: theme.colors.background.primary,\n    }),\n    dragging: css({\n      background: theme.colors.background.secondary,\n    }),\n    columnWrapper: css({\n      marginBottom: theme.spacing(1.5),\n      // need some space or the outline of the checkbox is cut off\n      paddingLeft: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction sortLabels(labels: Record<string, FieldNameMeta>) {\n  return (a: string, b: string) => {\n    const la = labels[a];\n    const lb = labels[b];\n\n    // Sort by index\n    if (la.index != null && lb.index != null) {\n      return la.index - lb.index;\n    }\n\n    // otherwise do not sort\n    return 0;\n  };\n}\n\nexport const LogsTableActiveFields = (props: {\n  labels: Record<string, FieldNameMeta>;\n  valueFilter: (value: string) => boolean;\n  toggleColumn: (columnName: string) => void;\n  reorderColumn: (cols: FieldNameMetaStore, sourceIndex: number, destinationIndex: number) => void;\n  id: string;\n}): ReactElement => {\n  const { columnWidthMap, setColumnWidthMap } = useTableColumnContext();\n  const { reorderColumn, labels, valueFilter, toggleColumn } = props;\n  const theme = useTheme2();\n  const { columns } = useTableColumnContext();\n  const styles = getLogsFieldsStyles(theme);\n  const labelKeys = Object.keys(labels).filter((labelName) => valueFilter(labelName));\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n    reorderColumn(columns, result.source.index, result.destination.index);\n  };\n\n  const renderTitle = (labelName: string) => {\n    const label = labels[labelName];\n    if (label) {\n      return `${labelName} appears in ${label?.percentOfLinesWithLabel}% of log lines`;\n    }\n\n    return undefined;\n  };\n\n  if (labelKeys.length) {\n    return (\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable droppableId=\"order-fields\" direction=\"vertical\">\n          {(provided) => (\n            <div className={styles.columnWrapper} {...provided.droppableProps} ref={provided.innerRef}>\n              {labelKeys.sort(sortLabels(labels)).map((labelName, index) => (\n                <Draggable draggableId={labelName} key={labelName} index={index}>\n                  {(provided: DraggableProvided, snapshot) => (\n                    <div\n                      className={cx(styles.wrap, snapshot.isDragging ? styles.dragging : undefined)}\n                      ref={provided.innerRef}\n                      {...provided.draggableProps}\n                      {...provided.dragHandleProps}\n                      title={renderTitle(labelName)}\n                    >\n                      <LogsTableNavField\n                        setColumnWidthMap={setColumnWidthMap}\n                        columnWidthMap={columnWidthMap}\n                        label={labelName}\n                        onChange={() => toggleColumn(labelName)}\n                        labels={labels}\n                        draggable={true}\n                      />\n                    </div>\n                  )}\n                </Draggable>\n              ))}\n              {provided.placeholder}\n            </div>\n          )}\n        </Droppable>\n      </DragDropContext>\n    );\n  }\n\n  return <LogsTableEmptyFields />;\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { FieldNameMeta } from '../TableTypes';\n\nimport { LogsTableEmptyFields } from './LogsTableEmptyFields';\nimport { LogsTableNavField } from './LogsTableNavField';\n\nconst collator = new Intl.Collator(undefined, { sensitivity: 'base' });\n\nfunction getLogsFieldsStyles(theme: GrafanaTheme2) {\n  return {\n    wrap: css({\n      marginTop: theme.spacing(0.25),\n      marginBottom: theme.spacing(0.25),\n      display: 'flex',\n      background: theme.colors.background.primary,\n      borderBottom: `1px solid ${theme.colors.background.canvas}`,\n    }),\n    dragging: css({\n      background: theme.colors.background.secondary,\n    }),\n    columnWrapper: css({\n      marginBottom: theme.spacing(1.5),\n      // need some space or the outline of the checkbox is cut off\n      paddingLeft: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction sortLabels(labels: Record<string, FieldNameMeta>) {\n  return (a: string, b: string) => {\n    const la = labels[a];\n    const lb = labels[b];\n\n    // ...sort by type and alphabetically\n    if (la != null && lb != null) {\n      return (\n        Number(lb.type === 'TIME_FIELD') - Number(la.type === 'TIME_FIELD') ||\n        Number(lb.type === 'BODY_FIELD') - Number(la.type === 'BODY_FIELD') ||\n        collator.compare(a, b)\n      );\n    }\n\n    // otherwise do not sort\n    return 0;\n  };\n}\n\nexport const LogsTableAvailableFields = (props: {\n  labels: Record<string, FieldNameMeta>;\n  valueFilter: (value: string) => boolean;\n  toggleColumn: (columnName: string) => void;\n}): React.ReactElement => {\n  const { labels, valueFilter, toggleColumn } = props;\n  const theme = useTheme2();\n  const styles = getLogsFieldsStyles(theme);\n  const labelKeys = Object.keys(labels).filter((labelName) => valueFilter(labelName));\n  if (labelKeys.length) {\n    // Otherwise show list with a hardcoded order\n    return (\n      <div className={styles.columnWrapper}>\n        {labelKeys.sort(sortLabels(labels)).map((labelName) => (\n          <div\n            key={labelName}\n            className={styles.wrap}\n            title={`${labelName} appears in ${labels[labelName]?.percentOfLinesWithLabel}% of log lines`}\n          >\n            <LogsTableNavField\n              showCount={true}\n              label={labelName}\n              onChange={() => toggleColumn(labelName)}\n              labels={labels}\n            />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return <LogsTableEmptyFields />;\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { LogsTableActiveFields } from 'Components/Table/ColumnSelection/LogsTableActiveFields';\nimport { LogsTableAvailableFields } from 'Components/Table/ColumnSelection/LogsTableAvailableFields';\n\nimport { FieldNameMeta, FieldNameMetaStore } from '../TableTypes';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    sidebarWrap: css({\n      overflowY: 'scroll',\n      height: 'calc(100% - 50px)',\n      /* Hide scrollbar for Chrome, Safari, and Opera */\n      '&::-webkit-scrollbar': {\n        display: 'none',\n      },\n      /* Hide scrollbar for Firefox */\n      scrollbarWidth: 'none',\n    }),\n    columnHeaderButton: css({\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      fontSize: theme.typography.pxToRem(11),\n    }),\n    columnHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      fontSize: theme.typography.h6.fontSize,\n      background: theme.colors.background.secondary,\n      position: 'sticky',\n      top: 0,\n      left: 0,\n      paddingTop: theme.spacing(0.75),\n      paddingRight: theme.spacing(0.75),\n      paddingBottom: theme.spacing(0.75),\n      paddingLeft: theme.spacing(1.5),\n      zIndex: 3,\n      marginBottom: theme.spacing(2),\n    }),\n  };\n}\n\nexport const LogsTableMultiSelect = (props: {\n  toggleColumn: (columnName: string) => void;\n  filteredColumnsWithMeta: Record<string, FieldNameMeta> | undefined;\n  columnsWithMeta: Record<string, FieldNameMeta>;\n  clear: () => void;\n  reorderColumn: (cols: FieldNameMetaStore, oldIndex: number, newIndex: number) => void;\n}) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  return (\n    <div className={styles.sidebarWrap}>\n      {/* Sidebar columns */}\n      <>\n        <div className={styles.columnHeader}>\n          Selected fields\n          <button onClick={props.clear} className={styles.columnHeaderButton}>\n            Reset\n          </button>\n        </div>\n        <LogsTableActiveFields\n          reorderColumn={props.reorderColumn}\n          toggleColumn={props.toggleColumn}\n          labels={props.filteredColumnsWithMeta ?? props.columnsWithMeta}\n          valueFilter={(value) => props.columnsWithMeta[value]?.active ?? false}\n          id={'selected-fields'}\n        />\n\n        <div className={styles.columnHeader}>Fields</div>\n        <LogsTableAvailableFields\n          toggleColumn={props.toggleColumn}\n          labels={props.filteredColumnsWithMeta ?? props.columnsWithMeta}\n          valueFilter={(value) => !props.columnsWithMeta[value]?.active}\n        />\n      </>\n    </div>\n  );\n};\n","import React, { useState } from 'react';\n\nimport { ClickOutsideWrapper } from '@grafana/ui';\n\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { LogsColumnSearch } from 'Components/Table/ColumnSelection/LogsColumnSearch';\nimport { LogsTableMultiSelect } from 'Components/Table/ColumnSelection/LogsTableMultiSelect';\n\nimport { FieldNameMetaStore } from '../TableTypes';\nimport { reportInteraction } from '@grafana/runtime';\nimport { logger } from '../../../services/logger';\n\nexport function getReorderColumn(setColumns: (cols: FieldNameMetaStore) => void) {\n  return (columns: FieldNameMetaStore, sourceIndex: number, destinationIndex: number) => {\n    if (sourceIndex === destinationIndex) {\n      return;\n    }\n\n    const pendingLabelState = { ...columns };\n    const keys = Object.keys(pendingLabelState)\n      .filter((key) => pendingLabelState[key].active)\n      .map((key) => ({\n        fieldName: key,\n        index: pendingLabelState[key].index ?? 0,\n      }))\n      .sort((a, b) => a.index - b.index);\n\n    const [source] = keys.splice(sourceIndex, 1);\n    keys.splice(destinationIndex, 0, source);\n\n    keys\n      .filter((key) => key !== undefined)\n      .forEach((key, index) => {\n        pendingLabelState[key.fieldName].index = index;\n      });\n\n    // Set local state\n    setColumns(pendingLabelState);\n  };\n}\n\nfunction logError(columnName: string, columns: FieldNameMetaStore) {\n  let logContext;\n  try {\n    logContext = {\n      columns: JSON.stringify(columns),\n      columnName: columnName,\n    };\n  } catch (e) {\n    logContext = {\n      msg: 'Table: ColumnSelectionDrawerWrap failed to encode context',\n      columnName: columnName,\n    };\n  }\n  logger.warn('failed to get column', logContext);\n}\n\nexport function ColumnSelectionDrawerWrap() {\n  const { columns, setColumns, setVisible, filteredColumns, setFilteredColumns } = useTableColumnContext();\n  const [searchValue, setSearchValue] = useState<string>('');\n  const toggleColumn = (columnName: string) => {\n    if (!columns || !(columnName in columns)) {\n      logError(columnName, columns);\n      return;\n    }\n\n    const length = Object.keys(columns).filter((c) => columns[c].active).length;\n    const isActive = !columns[columnName].active ? true : undefined;\n\n    let pendingLabelState: FieldNameMetaStore;\n    if (isActive) {\n      pendingLabelState = {\n        ...columns,\n        [columnName]: {\n          ...columns[columnName],\n          active: isActive,\n          index: length,\n        },\n      };\n    } else {\n      pendingLabelState = {\n        ...columns,\n        [columnName]: {\n          ...columns[columnName],\n          active: false,\n          index: undefined,\n        },\n      };\n    }\n\n    // Analytics\n    columnFilterEvent(columnName);\n\n    // Set local state\n    setColumns(pendingLabelState);\n\n    // If user is currently filtering, update filtered state\n    if (filteredColumns) {\n      const active = !filteredColumns[columnName]?.active;\n      let pendingFilteredLabelState: FieldNameMetaStore;\n      if (active) {\n        pendingFilteredLabelState = {\n          ...filteredColumns,\n          [columnName]: {\n            ...filteredColumns[columnName],\n            active: active,\n            index: length,\n          },\n        };\n      } else {\n        pendingFilteredLabelState = {\n          ...filteredColumns,\n          [columnName]: {\n            ...filteredColumns[columnName],\n            active: false,\n            index: undefined,\n          },\n        };\n      }\n\n      setFilteredColumns(pendingFilteredLabelState);\n      setSearchValue('');\n    }\n  };\n\n  const reorderColumn = getReorderColumn(setColumns);\n\n  const clearSelection = () => {\n    const pendingLabelState = { ...columns };\n    let index = 0;\n    Object.keys(pendingLabelState).forEach((key) => {\n      const isDefaultField =\n        pendingLabelState[key].type === 'BODY_FIELD' || pendingLabelState[key].type === 'TIME_FIELD';\n      // after reset the only active fields are the special time and body fields\n      pendingLabelState[key].active = isDefaultField;\n      // reset the index\n      pendingLabelState[key].index = isDefaultField ? index++ : undefined;\n    });\n\n    setColumns(pendingLabelState);\n    setFilteredColumns(pendingLabelState);\n    setSearchValue('');\n  };\n\n  // Tracking event for filtering columns\n  function columnFilterEvent(columnName: string) {\n    if (columns) {\n      const newState = !columns[columnName]?.active;\n      const priorActiveCount = Object.keys(columns).filter((column) => columns[column]?.active)?.length;\n      const event = {\n        columnAction: newState ? 'add' : 'remove',\n        columnCount: newState ? priorActiveCount + 1 : priorActiveCount - 1,\n      };\n      reportInteraction('grafana_logs_app_table_column_filter_clicked', event);\n    }\n  }\n\n  return (\n    <ClickOutsideWrapper\n      onClick={() => {\n        setVisible(false);\n        setFilteredColumns(columns);\n        setSearchValue('');\n      }}\n      useCapture={true}\n    >\n      <LogsColumnSearch searchValue={searchValue} setSearchValue={setSearchValue} />\n      <LogsTableMultiSelect\n        toggleColumn={toggleColumn}\n        filteredColumnsWithMeta={filteredColumns}\n        columnsWithMeta={columns}\n        clear={clearSelection}\n        reorderColumn={reorderColumn}\n      />\n    </ClickOutsideWrapper>\n  );\n}\n","import React, { PropsWithChildren } from 'react';\nimport { css, cx } from '@emotion/css';\n\nimport { Field, GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\n\ninterface DefaultCellWrapComponentProps {}\n\ninterface Props extends PropsWithChildren<DefaultCellWrapComponentProps> {\n  rowIndex: number;\n  field: Field;\n  onClick?: () => void;\n  onMouseIn?: () => void;\n  onMouseOut?: () => void;\n}\n\nconst getStyles = (theme: GrafanaTheme2, bgColor?: string, numberOfMenuItems?: number) => ({\n  active: css({\n    // Save 20px for context menu\n    height: `calc(${100}% + 36px)`,\n    zIndex: theme.zIndex.tooltip,\n    background: 'transparent',\n  }),\n  wrap: css({\n    position: 'absolute',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    height: '100%',\n    left: 0,\n    top: 0,\n    margin: 'auto',\n    background: bgColor ?? 'transparent',\n  }),\n});\n\nexport const DefaultCellWrapComponent = (props: Props) => {\n  return (\n    <CellWrapInnerComponent\n      onMouseOut={props.onMouseOut}\n      onMouseIn={props.onMouseIn}\n      onClick={props.onClick}\n      field={props.field}\n      rowIndex={props.rowIndex}\n    >\n      {props.children}\n    </CellWrapInnerComponent>\n  );\n};\n\nconst CellWrapInnerComponent = (props: Props) => {\n  const theme = useTheme2();\n  const cellState = useTableCellContext();\n  const styles = getStyles(theme, undefined, cellState.cellIndex?.numberOfMenuItems);\n\n  return (\n    <div\n      onMouseLeave={props.onMouseOut}\n      onMouseEnter={props.onMouseIn}\n      onClick={props.onClick}\n      className={\n        cellState.cellIndex.index === props.rowIndex && cellState.cellIndex.fieldName === props.field.name\n          ? cx(styles.wrap, styles.active)\n          : styles.wrap\n      }\n    >\n      {props.children}\n    </div>\n  );\n};\n","import React, { createContext, ReactNode, useContext } from 'react';\nimport { LogsFrame } from '../../../services/logsFrame';\nimport { AdHocVariableFilter, TimeRange } from '@grafana/data';\nimport { SelectedTableRow } from '../LogLineCellComponent';\n\nexport type Label = { name: string; values: string[]; indexed: boolean };\n\nexport type QueryContextType = {\n  logsFrame: LogsFrame | null;\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n};\n\nexport const initialState = {\n  logsFrame: null,\n  addFilter: (filter: AdHocVariableFilter) => {},\n  timeRange: undefined,\n  selectedLine: undefined,\n};\n\nexport const QueryContext = createContext<QueryContextType>(initialState);\n\nexport const QueryContextProvider = ({\n  children,\n  logsFrame,\n  addFilter,\n  selectedLine,\n  timeRange,\n}: {\n  children: ReactNode;\n  logsFrame: LogsFrame;\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n}) => {\n  return (\n    <QueryContext.Provider\n      value={{\n        logsFrame,\n        addFilter,\n        selectedLine,\n        timeRange,\n      }}\n    >\n      {children}\n    </QueryContext.Provider>\n  );\n};\n\nexport const useQueryContext = () => {\n  return useContext(QueryContext);\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2, LinkModel } from '@grafana/data';\nimport { Icon, useTheme2 } from '@grafana/ui';\nimport { useQueryContext } from './Context/QueryContext';\n\nimport { FilterOp } from '../../services/filterTypes';\n\ninterface Props {\n  fieldType?: 'derived';\n  label: string;\n  value: string;\n  showColumn?: () => void;\n  links?: LinkModel[];\n  pillType: 'logPill' | 'column';\n}\n\nconst getStyles = (theme: GrafanaTheme2, pillType: 'logPill' | 'column') => ({\n  menu: css({\n    position: 'relative',\n    paddingRight: '5px',\n    display: 'flex',\n    minWidth: '60px',\n    justifyContent: 'flex-start',\n  }),\n  menuItemsWrap: css({\n    boxShadow: theme.shadows.z3,\n    display: 'flex',\n    background: theme.colors.background.secondary,\n    padding: '5px 0',\n    marginLeft: pillType === 'column' ? '5px' : undefined,\n  }),\n  menuItem: css({\n    overflow: 'auto',\n    textOverflow: 'ellipsis',\n    cursor: 'pointer',\n    paddingLeft: '5px',\n    paddingRight: '5px',\n    display: 'flex',\n    alignItems: 'center',\n  }),\n});\n\nexport const CellContextMenu = (props: Props) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.pillType);\n  const { addFilter } = useQueryContext();\n\n  return (\n    <span className={styles.menu}>\n      <span className={styles.menuItemsWrap}>\n        {props.fieldType !== 'derived' && (\n          <>\n            <div\n              className={styles.menuItem}\n              onClick={() => {\n                addFilter({\n                  key: props.label,\n                  value: props.value,\n                  operator: FilterOp.Equal,\n                });\n              }}\n            >\n              <Icon title={'Add to search'} size={'md'} name={'plus-circle'} />\n            </div>\n            <div\n              className={styles.menuItem}\n              onClick={() => {\n                addFilter({\n                  key: props.label,\n                  value: props.value,\n                  operator: FilterOp.NotEqual,\n                });\n              }}\n            >\n              <Icon title={'Exclude from search'} size={'md'} name={'minus-circle'} />\n            </div>\n          </>\n        )}\n\n        {props.showColumn && (\n          <div title={'Add column'} onClick={props.showColumn} className={styles.menuItem}>\n            <svg width=\"18\" height=\"16\" viewBox=\"0 0 18 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path\n                fillRule=\"evenodd\"\n                clipRule=\"evenodd\"\n                d=\"M1.38725 1.33301H13.3872C13.5641 1.33301 13.7336 1.40325 13.8587 1.52827C13.9837 1.65329 14.0539 1.82286 14.0539 1.99967V2.33333C14.0539 2.70152 13.7554 3 13.3872 3H13.0542C12.87 3 12.7206 2.85062 12.7206 2.66634H8.05391V13.333H12.7206C12.7206 13.1491 12.8697 13 13.0536 13H13.3872C13.7554 13 14.0539 13.2985 14.0539 13.6667V13.9997C14.0539 14.1765 13.9837 14.3461 13.8587 14.4711C13.7336 14.5961 13.5641 14.6663 13.3872 14.6663H1.38725C1.21044 14.6663 1.04087 14.5961 0.915843 14.4711C0.790819 14.3461 0.720581 14.1765 0.720581 13.9997V1.99967C0.720581 1.82286 0.790819 1.65329 0.915843 1.52827C1.04087 1.40325 1.21044 1.33301 1.38725 1.33301ZM2.05391 13.333H6.72058V2.66634H2.05391V13.333Z\"\n                fill=\"#CCCCDC\"\n                fillOpacity=\"1\"\n              />\n              <path\n                d=\"M13.8538 7.19999H16.2538C16.466 7.19999 16.6695 7.28429 16.8195 7.4343C16.9696 7.58432 17.0538 7.78783 17.0538 7.99999C17.0538 8.21214 16.9696 8.41566 16.8195 8.56567C16.6695 8.71569 16.466 8.79999 16.2538 8.79999H13.8538V11.2C13.8538 11.4121 13.7696 11.6156 13.6195 11.7657C13.4695 11.9157 13.266 12 13.0538 12C12.8416 12 12.6382 11.9157 12.4881 11.7657C12.3381 11.6156 12.2538 11.4121 12.2538 11.2V8.79999H9.85384C9.64165 8.79999 9.43819 8.71569 9.28815 8.56567C9.13811 8.41566 9.05383 8.21214 9.05383 7.99999C9.05383 7.78783 9.13811 7.58432 9.28815 7.4343C9.43819 7.28429 9.64165 7.19999 9.85384 7.19999H12.2538V4.8C12.2538 4.58784 12.3381 4.38433 12.4881 4.23431C12.6382 4.0843 12.8416 4 13.0538 4C13.266 4 13.4695 4.0843 13.6195 4.23431C13.7696 4.38433 13.8538 4.58784 13.8538 4.8V7.19999Z\"\n                fill=\"#CCCCDC\"\n                fillOpacity=\"1\"\n              />\n            </svg>\n          </div>\n        )}\n\n        {props.links &&\n          props.links.map((link) => {\n            return (\n              <div\n                className={styles.menuItem}\n                onClick={() => {\n                  window.open(link.href, '_blank');\n                }}\n                key={link.href}\n              >\n                <Icon title={link.title ?? 'Link'} key={link.href} size={'md'} name={'link'} />\n              </div>\n            );\n          })}\n      </span>\n    </span>\n  );\n};\n","export const LEVEL_NAME = 'detected_level';\n","import React, { ReactElement } from 'react';\nimport { css, cx } from '@emotion/css';\n\nimport { Field, FieldType, GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { CellContextMenu } from 'Components/Table/CellContextMenu';\nimport { getFieldMappings } from 'Components/Table/Table';\nimport { LEVEL_NAME } from './constants';\n\ninterface DefaultPillProps {\n  label: string;\n  showColumns?: () => void;\n  value: string | unknown | ReactElement;\n  rowIndex: number;\n  field: Field;\n}\n\nconst getStyles = (theme: GrafanaTheme2, levelColor?: string) => ({\n  activePillWrap: css({}),\n  pillWrap: css({\n    width: '100%',\n  }),\n  pill: css({\n    border: `1px solid ${theme.colors.border.weak}`,\n    '&:hover': {\n      border: `1px solid ${theme.colors.border.strong}`,\n    },\n    marginRight: '5px',\n    marginTop: '4px',\n    marginLeft: '5px',\n    padding: '2px 5px',\n    position: 'relative',\n    display: 'inline-flex',\n    flexDirection: 'row-reverse',\n    backgroundColor: 'transparent',\n\n    paddingLeft: levelColor ? `${theme.spacing(0.75)}` : `2px`,\n\n    '&:before': {\n      content: '\"\"',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      height: '100%',\n      width: `${theme.spacing(0.25)}`,\n      backgroundColor: levelColor,\n    },\n  }),\n  menu: css({\n    width: '100%',\n  }),\n  menuItem: css({\n    overflow: 'auto',\n    textOverflow: 'ellipsis',\n  }),\n  menuItemText: css({\n    width: '65px',\n    display: 'inline-block',\n  }),\n});\nexport const DefaultPill = (props: DefaultPillProps) => {\n  const { label, value } = props;\n  const theme = useTheme2();\n  const { cellIndex } = useTableCellContext();\n  let levelColor;\n\n  if (label === LEVEL_NAME) {\n    const mappings = getFieldMappings().options;\n    if (typeof value === 'string' && value in mappings) {\n      levelColor = mappings[value].color;\n    }\n  }\n\n  const isPillActive = cellIndex.index === props.rowIndex && props.field.name === cellIndex.fieldName;\n\n  const styles = getStyles(theme, levelColor);\n  return (\n    <div className={cx(styles.pillWrap, isPillActive ? styles.activePillWrap : undefined)}>\n      {!!value && (\n        <>\n          <span className={styles.pill}>\n            <>{value}</>\n          </span>\n          {isPillActive && typeof value === 'string' && props.field.type !== FieldType.time && (\n            <CellContextMenu label={props.label} value={value} pillType={'column'} />\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n","import { ClipboardButton, IconButton, Modal, useTheme2 } from '@grafana/ui';\nimport React, { useCallback, useState } from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { testIds } from '../../services/testIds';\nimport { generateLogShortlink } from 'services/text';\n\nexport const getStyles = (theme: GrafanaTheme2, bgColor?: string) => ({\n  clipboardButton: css({\n    padding: 0,\n    height: '100%',\n    lineHeight: '1',\n    width: '20px',\n  }),\n  inspectButton: css({\n    display: 'inline-flex',\n    verticalAlign: 'middle',\n    margin: 0,\n    overflow: 'hidden',\n    borderRadius: '5px',\n  }),\n  iconWrapper: css({\n    height: '35px',\n    position: 'sticky',\n    left: 0,\n    display: 'flex',\n    background: theme.colors.background.secondary,\n    padding: `0 ${theme.spacing(0.5)}`,\n    zIndex: 1,\n    boxShadow: theme.shadows.z2,\n  }),\n  inspect: css({\n    padding: '5px 3px',\n\n    '&:hover': {\n      color: theme.colors.text.link,\n      cursor: 'pointer',\n    },\n  }),\n});\nexport function LineActionIcons(props: { rowIndex: number; value: unknown }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const { logsFrame, timeRange } = useQueryContext();\n  const logId = logsFrame?.idField?.values[props.rowIndex];\n  const lineValue = logsFrame?.bodyField.values[props.rowIndex];\n  const [isInspecting, setIsInspecting] = useState(false);\n  const getText = useCallback(() => {\n    if (timeRange) {\n      return generateLogShortlink('selectedLine', { id: logId, row: props.rowIndex }, timeRange);\n    }\n    return '';\n  }, [logId, props.rowIndex, timeRange]);\n  return (\n    <>\n      <div className={styles.iconWrapper}>\n        <div className={styles.inspect}>\n          <IconButton\n            data-testid={testIds.table.inspectLine}\n            className={styles.inspectButton}\n            tooltip=\"View log line\"\n            variant=\"secondary\"\n            aria-label=\"View log line\"\n            tooltipPlacement=\"top\"\n            size=\"md\"\n            name=\"eye\"\n            onClick={() => setIsInspecting(true)}\n            tabIndex={0}\n          />\n        </div>\n        <div className={styles.inspect}>\n          <ClipboardButton\n            className={styles.clipboardButton}\n            icon=\"share-alt\"\n            variant=\"secondary\"\n            fill=\"text\"\n            size=\"md\"\n            tooltip=\"Copy link to log line\"\n            tooltipPlacement=\"top\"\n            tabIndex={0}\n            getText={getText}\n          />\n        </div>\n      </div>\n      <>\n        {isInspecting && (\n          <Modal onDismiss={() => setIsInspecting(false)} isOpen={true} title=\"Inspect value\">\n            <pre>{lineValue}</pre>\n            <Modal.ButtonRow>\n              <ClipboardButton icon=\"copy\" getText={() => props.value as string}>\n                Copy to Clipboard\n              </ClipboardButton>\n            </Modal.ButtonRow>\n          </Modal>\n        )}\n      </>\n    </>\n  );\n}\n","import React, { ReactElement } from 'react';\nimport { Row } from 'react-table';\nimport { css } from '@emotion/css';\n\nimport { FieldType, formattedValueToString, GrafanaTheme2 } from '@grafana/data';\nimport { CustomCellRendererProps, DataLinksContextMenu, getCellLinks, useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { DefaultCellWrapComponent } from 'Components/Table/DefaultCellWrapComponent';\nimport { DefaultPill } from 'Components/Table/DefaultPill';\nimport { LineActionIcons } from 'Components/Table/LineActionIcons';\n\nconst getStyles = (theme: GrafanaTheme2, fieldType?: FieldType) => ({\n  flexWrap: css({\n    display: 'flex',\n    alignItems: 'flex-start',\n    flexDirection: fieldType === FieldType.number ? 'row-reverse' : 'row',\n    textAlign: fieldType === FieldType.number ? 'right' : 'left',\n  }),\n  content: css({\n    position: 'relative',\n    overflow: 'hidden',\n    display: 'flex',\n    height: '100%',\n  }),\n  linkWrapper: css({\n    color: theme.colors.text.link,\n    marginTop: '7px',\n    marginLeft: '7px',\n    '&:hover': {\n      textDecoration: 'underline',\n    },\n  }),\n});\n\ninterface DefaultCellComponentCustomProps {\n  fieldIndex: number;\n}\nexport const DefaultCellComponent = (props: CustomCellRendererProps & DefaultCellComponentCustomProps) => {\n  let value = props.value;\n  const field = props.field;\n  const displayValue = field.display!(value);\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.field.type);\n  const { setVisible } = useTableColumnContext();\n  const { cellIndex, setActiveCellIndex } = useTableCellContext();\n\n  // We don't get back the full react.table row here, but the calling function only uses the index, which are in `CustomCellRendererProps`\n  const row = { index: props.rowIndex } as Row;\n  const hasLinks = Boolean(getCellLinks(props.field, row)?.length);\n\n  if (value === null) {\n    return <></>;\n  }\n\n  if (React.isValidElement(props.value)) {\n    value = props.value;\n  } else if (typeof value === 'object') {\n    value = JSON.stringify(props.value);\n  } else {\n    value = formattedValueToString(displayValue);\n  }\n\n  const renderValue = (value: string | unknown | ReactElement, label: string) => {\n    return (\n      <DefaultPill\n        field={props.field}\n        rowIndex={props.rowIndex}\n        showColumns={() => setVisible(true)}\n        label={label}\n        value={value}\n      />\n    );\n  };\n\n  return (\n    <DefaultCellWrapComponent\n      onClick={() => {\n        if (props.rowIndex === cellIndex.index && props.field.name === cellIndex.fieldName) {\n          return setActiveCellIndex({ index: null });\n        }\n        return setActiveCellIndex({ index: props.rowIndex, fieldName: props.field.name, numberOfMenuItems: 3 });\n      }}\n      field={props.field}\n      rowIndex={props.rowIndex}\n    >\n      <div className={styles.content}>\n        {props.fieldIndex === 0 && <LineActionIcons value={value} rowIndex={props.rowIndex} />}\n        <div className={styles.flexWrap}></div>\n\n        {!hasLinks && renderValue(value, field.name)}\n\n        {hasLinks && field.getLinks && (\n          <DataLinksContextMenu links={() => getCellLinks(field, row) ?? []}>\n            {(api) => {\n              if (api.openMenu) {\n                return (\n                  <div className={styles.linkWrapper} onClick={api.openMenu}>\n                    <>{value}</>\n                  </div>\n                );\n              } else {\n                return (\n                  <div className={styles.linkWrapper}>\n                    <>{value}</>\n                  </div>\n                );\n              }\n            }}\n          </DataLinksContextMenu>\n        )}\n      </div>\n    </DefaultCellWrapComponent>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { Row } from 'react-table';\nimport { css, cx } from '@emotion/css';\n\nimport { DataFrame, Field, FieldType, getLinksSupplier, GrafanaTheme2, LinkModel } from '@grafana/data';\nimport { getCellLinks, useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { CellContextMenu } from 'Components/Table/CellContextMenu';\nimport { getFieldMappings } from 'Components/Table/Table';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { LEVEL_NAME } from './constants';\n\ninterface LogLinePillProps {\n  originalField?: Field;\n  field?: Field;\n  columns: FieldNameMetaStore;\n  label: string;\n  showColumns: () => void;\n  rowIndex: number;\n  frame: DataFrame;\n  originalFrame: DataFrame | undefined;\n  isDerivedField: boolean;\n  value: string;\n}\n\nconst getStyles = (theme: GrafanaTheme2, levelColor?: string) => ({\n  pill: css({\n    flex: '0 1 auto',\n    marginLeft: theme.spacing(0.5),\n    marginRight: theme.spacing(0.5),\n    padding: `${theme.spacing(0.25)} ${theme.spacing(0.25)}`,\n    position: 'relative',\n    display: 'inline-flex',\n    flexDirection: 'column',\n    marginTop: theme.spacing(0.5),\n  }),\n  activePill: css({}),\n  valueWrap: css({\n    border: `1px solid ${theme.colors.background.secondary}`,\n    boxShadow: `-2px 2px 5px 0px ${theme.colors.background.secondary}`,\n    backgroundColor: 'transparent',\n    cursor: 'pointer',\n    position: 'relative',\n\n    paddingRight: `${theme.spacing(0.5)}`,\n    paddingLeft: levelColor ? `${theme.spacing(0.75)}` : `${theme.spacing(0.5)}`,\n\n    '&:before': {\n      content: '\"\"',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      height: '100%',\n      width: `${theme.spacing(0.25)}`,\n      backgroundColor: levelColor,\n    },\n\n    '&:hover': {\n      border: `1px solid ${theme.colors.border.strong}`,\n    },\n  }),\n});\n\nfunction LogLinePillValue(props: {\n  fieldType?: 'derived';\n  onClick: () => void;\n  label: string;\n  value: string;\n  menuActive: boolean;\n  onClickAdd: () => void;\n  links?: LinkModel[];\n}) {\n  const theme = useTheme2();\n\n  let levelColor;\n  if (props.label === LEVEL_NAME) {\n    const mappings = getFieldMappings().options;\n    if (props.value in mappings) {\n      levelColor = mappings[props.value].color;\n    }\n  }\n\n  const styles = getStyles(theme, levelColor);\n\n  return (\n    <span className={cx(styles.pill, props.menuActive ? styles.activePill : undefined)} onClick={props.onClick}>\n      <span className={styles.valueWrap}>\n        {props.label}={props.value}\n      </span>\n      {props.menuActive && (\n        <CellContextMenu\n          pillType={'logPill'}\n          fieldType={props.fieldType}\n          links={props.links}\n          label={props.label}\n          value={props.value}\n          showColumn={props.onClickAdd}\n        />\n      )}\n    </span>\n  );\n}\n\nexport const LogLinePill = (props: LogLinePillProps) => {\n  const { label } = props;\n  const { cellIndex, setActiveCellIndex } = useTableCellContext();\n  const { columns, setColumns } = useTableColumnContext();\n  const value = props.value;\n  const templateSrv = getTemplateSrv();\n  const replace = useMemo(() => templateSrv.replace.bind(templateSrv), [templateSrv]);\n\n  // Need untransformed frame for links?\n  const field = props.field;\n\n  if (!field || field?.type === FieldType.other) {\n    return null;\n  }\n  const row = { index: props.rowIndex } as Row;\n\n  if (props.originalField && props.isDerivedField && props.originalFrame) {\n    props.originalField.getLinks = getLinksSupplier(props.originalFrame, props.originalField, {}, replace);\n  }\n\n  const links = props.originalField && getCellLinks(props.originalField, row);\n\n  /**\n   * This Could be moved?\n   * Callback called by the pill context menu\n   * @param fieldName\n   */\n  const addFieldToColumns = (fieldName: string) => {\n    const pendingColumns = { ...columns };\n\n    const length = Object.keys(columns).filter((c) => columns[c].active).length;\n    if (pendingColumns[fieldName].active) {\n      pendingColumns[fieldName].active = false;\n      pendingColumns[fieldName].index = undefined;\n    } else {\n      pendingColumns[fieldName].active = true;\n      pendingColumns[fieldName].index = length;\n    }\n\n    setColumns(pendingColumns);\n  };\n\n  return (\n    <LogLinePillValue\n      onClick={() => {\n        if (\n          props.rowIndex === cellIndex.index &&\n          field.name === cellIndex.fieldName &&\n          label === cellIndex.subFieldName\n        ) {\n          return setActiveCellIndex({ index: null });\n        }\n\n        return setActiveCellIndex({\n          index: props.rowIndex,\n          fieldName: field.name,\n          subFieldName: label,\n          numberOfMenuItems: props.isDerivedField ? 2 : 3,\n        });\n      }}\n      menuActive={\n        cellIndex.index === props.rowIndex && cellIndex.fieldName === field.name && cellIndex.subFieldName === label\n      }\n      fieldType={props.isDerivedField ? 'derived' : undefined}\n      label={label}\n      value={value}\n      onClickAdd={() => addFieldToColumns(label)}\n      links={links}\n    />\n  );\n};\n","import { Icon, useTheme2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  scroller: css`\n    position: absolute;\n    right: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 20px;\n    top: 32px;\n    margin-top: -24px;\n    // For some reason clicking on this button causes text to be selected in the following row\n    user-select: none;\n  `,\n  scrollLeft: css`\n    cursor: pointer;\n    background: ${theme.colors.background.primary};\n\n    &:hover {\n      background: ${theme.colors.background.secondary};\n    }\n  `,\n  scrollRight: css`\n    cursor: pointer;\n    background: ${theme.colors.background.primary};\n\n    &:hover {\n      background: ${theme.colors.background.secondary};\n    }\n  `,\n});\n\nconst stopScroll = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    left: id.current?.scrollLeft,\n  });\n};\n\nconst goLeft = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    top: 0,\n    left: 0,\n    behavior: 'smooth',\n  });\n};\n\nconst goRight = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    top: 0,\n    left: id.current.scrollWidth,\n    behavior: 'smooth',\n  });\n};\n\nexport function Scroller({ scrollerRef: ref }: { scrollerRef: React.MutableRefObject<HTMLDivElement | null> }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <div className={styles.scroller}>\n      <span onPointerDown={() => goLeft(ref)} onPointerUp={() => stopScroll(ref)} className={styles.scrollLeft}>\n        <Icon name={'arrow-left'} />\n      </span>\n      <span onPointerDown={() => goRight(ref)} onPointerUp={() => stopScroll(ref)} className={styles.scrollRight}>\n        <Icon name={'arrow-right'} />\n      </span>\n    </div>\n  );\n}\n","import React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { useTheme2 } from '@grafana/ui';\n\nexport function RawLogLineText(props: { value: unknown }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <div className={styles.rawLogLine}>\n      <>{props.value}</>\n    </div>\n  );\n}\n\nexport const getStyles = (theme: GrafanaTheme2, bgColor?: string) => ({\n  rawLogLine: css({\n    fontFamily: theme.typography.fontFamilyMonospace,\n    height: '35px',\n    lineHeight: '35px',\n    paddingRight: theme.spacing(1.5),\n    paddingLeft: theme.spacing(1),\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import React, { useRef, useState } from 'react';\nimport { ScrollSyncPane } from 'react-scroll-sync';\n\nimport { FieldType, formattedValueToString, GrafanaTheme2, Labels } from '@grafana/data';\nimport { CustomCellRendererProps, useTheme2 } from '@grafana/ui';\n\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { LogLineState, useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { DefaultCellWrapComponent } from 'Components/Table/DefaultCellWrapComponent';\nimport { LogLinePill } from 'Components/Table/LogLinePill';\nimport { Scroller } from 'Components/Table/Scroller';\nimport { css } from '@emotion/css';\nimport { LineActionIcons } from 'Components/Table/LineActionIcons';\nimport { RawLogLineText } from 'Components/Table/RawLogLineText';\nimport { getBodyName } from '../../services/logsFrame';\nimport { LEVEL_NAME } from './constants';\n\nexport type SelectedTableRow = {\n  row: number;\n  id: string;\n};\n\ninterface Props extends CustomCellRendererProps {\n  labels: Labels;\n  fieldIndex: number;\n}\nexport const LogLineCellComponent = (props: Props) => {\n  let value = props.value;\n  const field = props.field;\n  const displayValue = field.display!(value);\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const { columns, setVisible, bodyState } = useTableColumnContext();\n  const { logsFrame } = useQueryContext();\n  const [isHover, setIsHover] = useState(false);\n  const ref = useRef<HTMLDivElement | null>(null);\n\n  if (React.isValidElement(props.value)) {\n    value = props.value;\n  } else if (typeof value === 'object') {\n    value = JSON.stringify(props.value);\n  } else {\n    value = formattedValueToString(displayValue);\n  }\n\n  /**\n   * Render labels as log line pills\n   * @param labels Label[]\n   */\n  const renderLabels = (labels: Labels) => {\n    const columnLabelNames = Object.keys(columns);\n    const labelNames = columnLabelNames\n      .filter((name) => name !== getBodyName(logsFrame))\n      .sort((a, b) => {\n        // Sort level first\n        if (a === LEVEL_NAME) {\n          return -1;\n        }\n        if (b === LEVEL_NAME) {\n          return 1;\n        }\n        // Then sort links\n        if (columns[a].type === 'LINK_FIELD') {\n          return -1;\n        }\n        if (columns[b].type === 'LINK_FIELD') {\n          return 1;\n        }\n\n        // Finally sort fields by cardinality descending\n        return columns[a].cardinality > columns[b].cardinality ? -1 : 1;\n      });\n\n    const filteredLabels = labelNames.filter(\n      (label) =>\n        // Not already visible in another column\n        !columns[label].active &&\n        // And the cardinality is greater than 1\n        columns[label].cardinality > 1\n    );\n\n    return filteredLabels\n      .map((label) => {\n        const labelValue = labels[label];\n        const untransformedField = logsFrame?.raw?.fields.find((field) => field.name === label);\n        const rawValue = field?.values[props.rowIndex];\n        const isDerived = !labelValue && !!rawValue;\n\n        // If we have a label value, the field is not derived\n        if (labelValue) {\n          return (\n            <LogLinePill\n              originalFrame={undefined}\n              field={field}\n              columns={columns}\n              rowIndex={props.rowIndex}\n              frame={props.frame}\n              showColumns={() => setVisible(true)}\n              key={label}\n              label={label}\n              isDerivedField={false}\n              value={labelValue}\n            />\n          );\n        }\n\n        // Otherwise, the field might be derived\n        if (isDerived && untransformedField?.name) {\n          const untransformedValue = untransformedField?.values[props.rowIndex];\n          if (untransformedField?.type === FieldType.string && untransformedValue) {\n            return (\n              <LogLinePill\n                originalFrame={logsFrame?.raw}\n                originalField={untransformedField}\n                field={field}\n                value={untransformedValue}\n                columns={columns}\n                rowIndex={props.rowIndex}\n                frame={props.frame}\n                showColumns={() => setVisible(true)}\n                key={untransformedField.name}\n                label={untransformedField.name}\n                isDerivedField={true}\n              />\n            );\n          }\n        }\n\n        return null;\n      })\n      .filter((v) => v);\n  };\n\n  const labels = renderLabels(props.labels);\n  const isAuto = bodyState === LogLineState.auto;\n  const hasLabels = labels.length > 0;\n\n  return (\n    <DefaultCellWrapComponent\n      onMouseIn={() => {\n        setIsHover(true);\n      }}\n      onMouseOut={() => {\n        setIsHover(false);\n      }}\n      rowIndex={props.rowIndex}\n      field={props.field}\n    >\n      <ScrollSyncPane innerRef={ref} group=\"horizontal\">\n        <div className={styles.content}>\n          {/* First Field gets the icons */}\n          {props.fieldIndex === 0 && <LineActionIcons rowIndex={props.rowIndex} value={value} />}\n          {/* Labels */}\n          {isAuto && hasLabels && <>{labels}</>}\n          {bodyState === LogLineState.labels && hasLabels && <>{labels}</>}\n          {bodyState === LogLineState.labels && !hasLabels && <RawLogLineText value={value} />}\n\n          {/* Raw log line*/}\n          {isAuto && !hasLabels && <RawLogLineText value={value} />}\n          {bodyState === LogLineState.text && <RawLogLineText value={value} />}\n\n          {isHover && <Scroller scrollerRef={ref} />}\n        </div>\n      </ScrollSyncPane>\n    </DefaultCellWrapComponent>\n  );\n};\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  content: css`\n    white-space: nowrap;\n    overflow-x: auto;\n    -ms-overflow-style: none; /* IE and Edge */\n    scrollbar-width: none; /* Firefox */\n    padding-right: 30px;\n    display: flex;\n    align-items: flex-start;\n    height: 100%;\n    &::-webkit-scrollbar {\n      display: none; /* Chrome, Safari and Opera */\n    }\n\n    &:after {\n      pointer-events: none;\n      content: '';\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      left: 0;\n      top: 0;\n      // Fade out text in last 10px to background color to add affordance to horiziontal scroll\n      background: linear-gradient(to right, transparent calc(100% - 10px), ${theme.colors.background.primary});\n    }\n  `,\n});\n","import React, { PropsWithChildren, useRef } from 'react';\nimport { css } from '@emotion/css';\n\nimport { Field, GrafanaTheme2 } from '@grafana/data';\nimport { ClickOutsideWrapper, Icon, Popover, useTheme2 } from '@grafana/ui';\n\nimport { useTableHeaderContext } from 'Components/Table/Context/TableHeaderContext';\nimport { useQueryContext } from './Context/QueryContext';\nimport { getBodyName } from '../../services/logsFrame';\n\nexport interface LogsTableHeaderProps extends PropsWithChildren<CustomHeaderRendererProps> {\n  fieldIndex: number;\n}\n//@todo delete when released in Grafana core\nexport interface CustomHeaderRendererProps {\n  field: Field;\n  defaultContent: React.ReactNode;\n}\n\nconst getStyles = (theme: GrafanaTheme2, isFirstColumn: boolean, isLine: boolean) => ({\n  tableHeaderMenu: css({\n    label: 'tableHeaderMenu',\n    width: '100%',\n    minWidth: '250px',\n    height: '100%',\n    maxHeight: '400px',\n    backgroundColor: theme.colors.background.primary,\n    border: `1px solid ${theme.colors.border.weak}`,\n    padding: theme.spacing(2),\n    margin: theme.spacing(1, 0),\n    boxShadow: theme.shadows.z3,\n    borderRadius: theme.shape.radius.default,\n  }),\n  button: css({\n    appearance: 'none',\n    right: '5px',\n    background: 'none',\n    border: 'none',\n    padding: 0,\n  }),\n  wrapper: css({\n    display: 'flex',\n    marginLeft: isFirstColumn ? '56px' : '6px',\n    // Body has extra padding then other columns\n    width: isLine ? 'calc(100% + 6px)' : '100%',\n\n    // Hack to show a visible resize indicator, despite 6px of padding on the header in grafana/table\n    borderRight: `1px solid ${theme.colors.border.weak}`,\n    marginRight: '-6px',\n  }),\n  defaultContentWrapper: css({\n    borderLeft: isFirstColumn ? `1px solid ${theme.colors.border.weak}` : 'none',\n    marginLeft: isFirstColumn ? '-6px' : 0,\n    paddingLeft: isFirstColumn ? '12px' : 0,\n    display: 'flex',\n  }),\n});\n\nexport const LogsTableHeader = (props: LogsTableHeaderProps) => {\n  const { setHeaderMenuActive, isHeaderMenuActive } = useTableHeaderContext();\n  const { logsFrame } = useQueryContext();\n  const referenceElement = useRef<HTMLButtonElement | null>(null);\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.fieldIndex === 0, props.field.name === getBodyName(logsFrame));\n\n  return (\n    <span className={styles.wrapper}>\n      <span className={styles.defaultContentWrapper}>{props.defaultContent}</span>\n      <button\n        className={styles.button}\n        ref={referenceElement}\n        onClick={(e) => {\n          setHeaderMenuActive(!isHeaderMenuActive);\n        }}\n      >\n        <Icon title={'Show menu'} name={'ellipsis-v'} />\n      </button>\n      {referenceElement.current && (\n        //@ts-ignore\n        <Popover\n          show={isHeaderMenuActive}\n          content={\n            <ClickOutsideWrapper onClick={() => setHeaderMenuActive(false)} useCapture={true}>\n              <div className={styles.tableHeaderMenu}>{props.children}</div>\n            </ClickOutsideWrapper>\n          }\n          referenceElement={referenceElement.current}\n        />\n      )}\n    </span>\n  );\n};\n","import { LogsTableHeader, LogsTableHeaderProps } from 'Components/Table/LogsTableHeader';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useTableHeaderContext } from 'Components/Table/Context/TableHeaderContext';\nimport { LogLineState, useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { Icon } from '@grafana/ui';\nimport React, { useCallback } from 'react';\nimport { Field } from '@grafana/data';\nimport { getBodyName } from '../../services/logsFrame';\nimport { css, cx } from '@emotion/css';\nimport { useQueryContext } from './Context/QueryContext';\n\nexport function LogsTableHeaderWrap(props: {\n  headerProps: LogsTableHeaderProps;\n  openColumnManagementDrawer: () => void;\n\n  // Moves the current column forward or backward one index\n  slideLeft?: (cols: FieldNameMetaStore) => void;\n  slideRight?: (cols: FieldNameMetaStore) => void;\n\n  autoColumnWidths?: () => void;\n}) {\n  const { setHeaderMenuActive } = useTableHeaderContext();\n  const { columns, setColumns, bodyState, setBodyState } = useTableColumnContext();\n  const { logsFrame } = useQueryContext();\n  const styles = getStyles();\n\n  const hideColumn = useCallback(\n    (field: Field) => {\n      const pendingColumnState = { ...columns };\n\n      const columnsThatNeedIndexUpdate = Object.keys(pendingColumnState)\n        .filter((col) => {\n          const columnIndex = pendingColumnState[col].index;\n          const fieldIndex = pendingColumnState[field.name].index;\n          return pendingColumnState[col].active && fieldIndex && columnIndex && columnIndex > fieldIndex;\n        })\n        .map((cols) => pendingColumnState[cols]);\n\n      columnsThatNeedIndexUpdate.forEach((col) => {\n        if (col.index !== undefined) {\n          col.index--;\n        }\n      });\n\n      pendingColumnState[field.name].active = false;\n      pendingColumnState[field.name].index = undefined;\n      setColumns(pendingColumnState);\n    },\n    [columns, setColumns]\n  );\n\n  const isBodyField = props.headerProps.field.name === getBodyName(logsFrame);\n\n  return (\n    <LogsTableHeader {...props.headerProps}>\n      <div className={styles.linkWrap}>\n        <a\n          className={styles.link}\n          onClick={() => {\n            props.openColumnManagementDrawer();\n            setHeaderMenuActive(false);\n          }}\n        >\n          <Icon className={styles.icon} name={'columns'} size={'md'} />\n          Manage columns\n        </a>\n      </div>\n      <div className={styles.linkWrap}>\n        <a className={styles.link} onClick={() => hideColumn(props.headerProps.field)}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 17 16\"\n            width=\"17\"\n            height=\"16\"\n            className=\"css-q2u0ig-Icon\"\n          >\n            <path\n              fillRule=\"evenodd\"\n              clipRule=\"evenodd\"\n              d=\"M1.73446 1.33301H12.2345C12.3892 1.33301 12.5375 1.40325 12.6469 1.52827C12.7563 1.65329 12.8178 1.82286 12.8178 1.99967V4.74967C12.8178 5.07184 12.5566 5.33301 12.2345 5.33301C11.9123 5.33301 11.6511 5.07184 11.6511 4.74967V2.66634H7.56779V13.333H11.6511V10.9163C11.6511 10.5942 11.9123 10.333 12.2345 10.333C12.5566 10.333 12.8178 10.5942 12.8178 10.9163V13.9997C12.8178 14.1765 12.7563 14.3461 12.6469 14.4711C12.5375 14.5961 12.3892 14.6663 12.2345 14.6663H1.73446C1.57975 14.6663 1.43137 14.5961 1.32198 14.4711C1.21258 14.3461 1.15112 14.1765 1.15112 13.9997V1.99967C1.15112 1.82286 1.21258 1.65329 1.32198 1.52827C1.43137 1.40325 1.57975 1.33301 1.73446 1.33301ZM2.31779 13.333H6.40112V2.66634H2.31779V13.333Z\"\n              fill=\"#CCCCDC\"\n              fillOpacity=\"1\"\n            />\n            <path\n              d=\"M15.9893 10.6315C15.9498 10.7263 15.8919 10.8123 15.819 10.8846C15.7467 10.9575 15.6607 11.0154 15.5659 11.0549C15.4712 11.0943 15.3695 11.1147 15.2668 11.1147C15.1641 11.1147 15.0625 11.0943 14.9677 11.0549C14.8729 11.0154 14.7869 10.9575 14.7146 10.8846L12.9335 9.09573L11.1524 10.8846C11.0801 10.9575 10.9941 11.0154 10.8993 11.0549C10.8045 11.0943 10.7028 11.1147 10.6002 11.1147C10.4975 11.1147 10.3958 11.0943 10.301 11.0549C10.2063 11.0154 10.1202 10.9575 10.0479 10.8846C9.97504 10.8123 9.91717 10.7263 9.87769 10.6315C9.8382 10.5367 9.81787 10.4351 9.81787 10.3324C9.81787 10.2297 9.8382 10.1281 9.87769 10.0333C9.91717 9.9385 9.97504 9.85248 10.0479 9.78017L11.8368 7.99906L10.0479 6.21795C9.90148 6.07149 9.8192 5.87285 9.8192 5.66573C9.8192 5.4586 9.90148 5.25996 10.0479 5.1135C10.1944 4.96705 10.393 4.88477 10.6002 4.88477C10.8073 4.88477 11.0059 4.96705 11.1524 5.1135L12.9335 6.90239L14.7146 5.1135C14.8611 4.96705 15.0597 4.88477 15.2668 4.88477C15.4739 4.88477 15.6726 4.96705 15.819 5.1135C15.9655 5.25996 16.0478 5.4586 16.0478 5.66573C16.0478 5.87285 15.9655 6.07149 15.819 6.21795L14.0302 7.99906L15.819 9.78017C15.8919 9.85248 15.9498 9.9385 15.9893 10.0333C16.0288 10.1281 16.0491 10.2297 16.0491 10.3324C16.0491 10.4351 16.0288 10.5367 15.9893 10.6315Z\"\n              fill=\"#CCCCDC\"\n              fillOpacity=\"1\"\n            />\n          </svg>\n          Remove column\n        </a>\n      </div>\n      {props.slideLeft && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.slideLeft?.(columns)}>\n            <Icon className={cx(styles.icon, styles.reverse)} name={'arrow-from-right'} size={'md'} />\n            Move left\n          </a>\n        </div>\n      )}\n      {props.slideRight && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.slideRight?.(columns)}>\n            <Icon className={styles.icon} name={'arrow-from-right'} size={'md'} />\n            Move right\n          </a>\n        </div>\n      )}\n      {isBodyField && (\n        <div className={styles.linkWrap}>\n          <a\n            className={styles.link}\n            onClick={() => {\n              if (bodyState === LogLineState.text) {\n                setBodyState(LogLineState.labels);\n              } else {\n                setBodyState(LogLineState.text);\n              }\n            }}\n          >\n            {bodyState === LogLineState.text ? (\n              <Icon className={styles.icon} name={'brackets-curly'} size={'md'} />\n            ) : (\n              <Icon className={styles.icon} name={'text-fields'} size={'md'} />\n            )}\n\n            {bodyState === LogLineState.text ? 'Show labels' : 'Show log text'}\n          </a>\n        </div>\n      )}\n\n      {props.autoColumnWidths && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.autoColumnWidths?.()}>\n            <Icon className={styles.icon} name={'arrows-h'} size={'md'} />\n            Reset column widths\n          </a>\n        </div>\n      )}\n    </LogsTableHeader>\n  );\n}\n\nconst getStyles = () => {\n  return {\n    reverse: css({\n      transform: 'scaleX(-1)',\n    }),\n    link: css({\n      paddingTop: '5px',\n      paddingBottom: '5px',\n    }),\n    icon: css({\n      marginRight: '10px',\n    }),\n    linkWrap: css({}),\n  };\n};\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { ScrollSync } from 'react-scroll-sync';\nimport { css } from '@emotion/css';\nimport { lastValueFrom } from 'rxjs';\n\nimport {\n  applyFieldOverrides,\n  CustomTransformOperator,\n  DataFrame,\n  DataFrameType,\n  DataTransformerConfig,\n  Field,\n  FieldType,\n  FieldWithIndex,\n  Labels,\n  MappingType,\n  transformDataFrame,\n  ValueMap,\n} from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { TableCellHeight, TableColoredBackgroundCellOptions } from '@grafana/schema';\nimport { Drawer, Table as GrafanaTable, TableCellDisplayMode, TableCustomCellOptions, useTheme2 } from '@grafana/ui';\n\nimport { TableCellContextProvider } from 'Components/Table/Context/TableCellContext';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { TableHeaderContextProvider } from 'Components/Table/Context/TableHeaderContext';\nimport {\n  ColumnSelectionDrawerWrap,\n  getReorderColumn,\n} from 'Components/Table/ColumnSelection/ColumnSelectionDrawerWrap';\nimport { DefaultCellComponent } from 'Components/Table/DefaultCellComponent';\nimport { LogLineCellComponent } from 'Components/Table/LogLineCellComponent';\nimport { CustomHeaderRendererProps } from 'Components/Table/LogsTableHeader';\nimport { FieldName, FieldNameMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { guessLogsFieldTypeForValue } from 'Components/Table/TableWrap';\nimport { LogsTableHeaderWrap } from 'Components/Table/LogsTableHeaderWrap';\nimport { getBodyName, getIdName, getTimeName, LogsFrame } from '../../services/logsFrame';\nimport { useQueryContext } from './Context/QueryContext';\nimport { testIds } from '../../services/testIds';\nimport { debounce } from 'lodash';\n\ninterface Props {\n  height: number;\n  timeZone: string;\n  logsFrame: LogsFrame;\n  width: number;\n  labels: Labels[];\n}\n\nconst getStyles = () => ({\n  section: css({\n    position: 'relative',\n  }),\n  tableWrap: css({\n    '.cellActions': {\n      // Hacky but without inspect turned on the table will change the width of the row on hover, but we don't want the default icons to show\n      display: 'none !important',\n    },\n  }),\n});\n\nfunction TableAndContext(props: {\n  data: DataFrame;\n  height: number;\n  width: number;\n  selectedLine?: number;\n  logsFrame: LogsFrame;\n  onResize: (fieldDisplayName: string, width: number) => void;\n}) {\n  return (\n    <GrafanaTable\n      onColumnResize={props.onResize}\n      initialSortBy={[{ displayName: getTimeName(props.logsFrame), desc: true }]}\n      initialRowIndex={props.selectedLine}\n      cellHeight={TableCellHeight.Sm}\n      data={props.data}\n      height={props.height}\n      width={props.width}\n      footerOptions={{ show: true, reducer: ['count'], countRows: true }}\n    />\n  );\n}\n\nexport const Table = (props: Props) => {\n  const { height, timeZone, logsFrame, width, labels } = props;\n  const theme = useTheme2();\n  const styles = getStyles();\n\n  const [tableFrame, setTableFrame] = useState<DataFrame | undefined>(undefined);\n  const {\n    columns,\n    visible,\n    setVisible,\n    setFilteredColumns,\n    setColumns,\n    clearSelectedLine,\n    columnWidthMap,\n    setColumnWidthMap,\n  } = useTableColumnContext();\n\n  const { selectedLine } = useQueryContext();\n\n  // Create a local state for selected line so we can clear the state tied to the URL\n  const [localSelectedLine] = useState(selectedLine);\n\n  const reorderColumn = getReorderColumn(setColumns);\n\n  const templateSrv = getTemplateSrv();\n  const replace = useMemo(() => templateSrv.replace.bind(templateSrv), [templateSrv]);\n\n  const prepareTableFrame = useCallback(\n    (frame: DataFrame): DataFrame => {\n      if (!frame.length) {\n        return frame;\n      }\n\n      const [frameWithOverrides] = applyFieldOverrides({\n        data: [frame],\n        timeZone: timeZone,\n        theme: theme,\n        replaceVariables: replace,\n        fieldConfig: {\n          defaults: {\n            custom: {},\n          },\n          overrides: [],\n        },\n      });\n\n      // `getLinks` and `applyFieldOverrides` are taken from TableContainer.tsx\n      for (const [index, field] of frameWithOverrides.fields.entries()) {\n        // If it's a string, then try to guess for a better type for numeric support in viz\n        field.type =\n          field.type === FieldType.string ? guessLogsFieldTypeForField(field) ?? FieldType.string : field.type;\n\n        field.config = {\n          ...field.config,\n\n          custom: {\n            inspect: true,\n            filterable: true, // This sets the columns to be filterable\n            headerComponent: (props: CustomHeaderRendererProps) => (\n              <TableHeaderContextProvider>\n                <LogsTableHeaderWrap\n                  headerProps={{ ...props, fieldIndex: index }}\n                  openColumnManagementDrawer={() => setVisible(true)}\n                  slideLeft={\n                    index !== 0 ? (cols: FieldNameMetaStore) => reorderColumn(cols, index, index - 1) : undefined\n                  }\n                  slideRight={\n                    index !== frame.fields.length - 1\n                      ? (cols: FieldNameMetaStore) => reorderColumn(cols, index, index + 1)\n                      : undefined\n                  }\n                  autoColumnWidths={\n                    Object.keys(columnWidthMap).length > 0\n                      ? () => {\n                          setColumnWidthMap({});\n                        }\n                      : undefined\n                  }\n                />\n              </TableHeaderContextProvider>\n            ),\n            width:\n              columnWidthMap[field.name] ??\n              getInitialFieldWidth(field, index, columns, width, frameWithOverrides.fields.length, logsFrame),\n            cellOptions: getTableCellOptions(field, index, labels, logsFrame),\n            ...field.config.custom,\n          },\n          // This sets the individual field value as filterable\n          // filterable: isFieldFilterable(field, logsFrame?.bodyField.name ?? '', logsFrame?.timeField.name ?? ''),\n          filterable: true,\n        };\n      }\n\n      return frameWithOverrides;\n    },\n    // This function is building the table dataframe that will be transformed, even though the components within the dataframe (cells, headers) can mutate the dataframe!\n    // If we try to update the dataframe whenever the columns are changed (which are rebuilt using this dataframe after being transformed), react will infinitely update frame -> columns -> frame -> ...\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [timeZone, theme, labels, width, replace, setVisible, columnWidthMap]\n  );\n\n  // prepare dataFrame\n  useEffect(() => {\n    const prepare = async () => {\n      const transformations: Array<DataTransformerConfig | CustomTransformOperator> = getExtractFieldsTransform(\n        logsFrame.raw\n      );\n\n      let labelFilters = buildColumnsWithMeta(columns);\n\n      const labelFiltersTransform = getOrganizeFieldsTransform(labelFilters);\n      if (labelFiltersTransform) {\n        transformations.push(labelFiltersTransform);\n      } else {\n        const specialFields = {\n          time: logsFrame.timeField,\n          body: logsFrame.bodyField,\n          extraFields: logsFrame.extraFields,\n        };\n        if (specialFields && specialFields.body !== undefined && specialFields.time !== undefined) {\n          transformations.push(\n            getDefaultStateOrganizeFieldsTransform(\n              specialFields as {\n                time: FieldWithIndex;\n                body: FieldWithIndex;\n              }\n            )\n          );\n        }\n      }\n\n      if (transformations.length > 0) {\n        const transformedDataFrame: DataFrame[] = await lastValueFrom(\n          // @ts-ignore\n          transformDataFrame(transformations, [logsFrame.raw])\n        );\n        const tableFrame = prepareTableFrame(transformedDataFrame[0]);\n        setTableFrame(tableFrame);\n      } else {\n        setTableFrame(prepareTableFrame(logsFrame.raw));\n      }\n    };\n    prepare();\n  }, [logsFrame.raw, logsFrame.bodyField, logsFrame.timeField, logsFrame.extraFields, prepareTableFrame, columns]);\n\n  // Clear selected line from URL so it doesn't pollute future queries\n  useEffect(() => {\n    if (localSelectedLine && selectedLine) {\n      clearSelectedLine();\n      return;\n    }\n  }, [localSelectedLine, clearSelectedLine, selectedLine]);\n\n  const idField = logsFrame.raw.fields.find((field) => field.name === getIdName(logsFrame));\n  const lineIndex = idField?.values.findIndex((v) => v === localSelectedLine?.id);\n  const cleanLineIndex = lineIndex && lineIndex !== -1 ? lineIndex : undefined;\n\n  if (!tableFrame) {\n    return <></>;\n  }\n\n  const onResize = (fieldDisplayName: string, width: number) => {\n    const key = Object.keys(columns)\n      .filter((key) => columns[key].active)\n      .find((key) => key === fieldDisplayName);\n\n    if (key && width > 0) {\n      const map = { ...columnWidthMap };\n      map[key] = width;\n      setColumnWidthMap(map);\n    }\n  };\n\n  return (\n    <div data-testid={testIds.table.wrapper} className={styles.section}>\n      {visible && (\n        <Drawer\n          size={'sm'}\n          onClose={() => {\n            setVisible(false);\n            setFilteredColumns(columns);\n          }}\n        >\n          <ColumnSelectionDrawerWrap />\n        </Drawer>\n      )}\n\n      <div className={styles.tableWrap}>\n        <TableCellContextProvider>\n          <ScrollSync horizontal={true} vertical={false} proportional={false}>\n            <TableAndContext\n              logsFrame={logsFrame}\n              selectedLine={cleanLineIndex}\n              data={tableFrame}\n              height={height}\n              width={width}\n              onResize={debounce(onResize, 100)}\n            />\n          </ScrollSync>\n        </TableCellContextProvider>\n      </div>\n    </div>\n  );\n};\n\nfunction getDefaultStateOrganizeFieldsTransform(specialFields: { time: FieldWithIndex; body: FieldWithIndex }) {\n  return {\n    id: 'organize',\n    options: {\n      indexByName: {\n        [specialFields.time.name]: 0,\n        [specialFields.body.name]: 1,\n      },\n      includeByName: {\n        [specialFields.body.name]: true,\n        [specialFields.time.name]: true,\n      },\n    },\n  };\n}\n\nfunction guessLogsFieldTypeForField(field: Field): FieldType | undefined {\n  // 1. Use the column name to guess\n  if (field.name) {\n    const name = field.name.toLowerCase();\n    if (name === 'date' || name === 'time') {\n      return FieldType.time;\n    }\n  }\n\n  // 2. Check the first non-null value\n  for (let i = 0; i < field.values.length; i++) {\n    const v = field.values[i];\n    if (v != null) {\n      return guessLogsFieldTypeForValue(v);\n    }\n  }\n\n  // Could not find anything\n  return undefined;\n}\n\nexport const getFieldMappings = (): ValueMap => {\n  return {\n    options: {\n      critical: {\n        color: '#705da0',\n        index: 0,\n      },\n      crit: {\n        color: '#705da0',\n        index: 1,\n      },\n      error: {\n        color: '#e24d42',\n        index: 2,\n      },\n      err: {\n        color: '#e24d42',\n        index: 3,\n      },\n      eror: {\n        color: '#e24d42',\n        index: 4,\n      },\n      warning: {\n        color: '#FF9900',\n        index: 5,\n      },\n      warn: {\n        color: '#FF9900',\n        index: 6,\n      },\n      info: {\n        color: '#7eb26d',\n        index: 7,\n      },\n      debug: {\n        color: '#1f78c1',\n        index: 8,\n      },\n      trace: {\n        color: '#6ed0e0',\n        index: 9,\n      },\n    },\n    type: MappingType.ValueToText,\n  };\n};\n\nfunction buildColumnsWithMeta(columnsWithMeta: Record<FieldName, FieldNameMeta>) {\n  // Create object of label filters to include columns selected by the user\n  let labelFilters: Record<FieldName, number> = {};\n  Object.keys(columnsWithMeta)\n    .filter((key) => columnsWithMeta[key].active)\n    .forEach((key) => {\n      const index = columnsWithMeta[key].index;\n      // Index should always be defined for any active column\n      if (index !== undefined) {\n        labelFilters[key] = index;\n      }\n    });\n\n  return labelFilters;\n}\n\nfunction getOrganizeFieldsTransform(labelFilters: Record<FieldName, number>) {\n  let labelFiltersInclude: Record<FieldName, boolean> = {};\n\n  for (const key in labelFilters) {\n    labelFiltersInclude[key] = true;\n  }\n\n  if (Object.keys(labelFilters).length > 0) {\n    return {\n      id: 'organize',\n      options: {\n        indexByName: labelFilters,\n        includeByName: labelFiltersInclude,\n      },\n    };\n  }\n  return null;\n}\n\nexport function getExtractFieldsTransform(dataFrame: DataFrame) {\n  return dataFrame.fields\n    .filter((field: Field & { typeInfo?: { frame: string } }) => {\n      const isFieldLokiLabels =\n        field.typeInfo?.frame === 'json.RawMessage' &&\n        field.name === 'labels' &&\n        dataFrame?.meta?.type !== DataFrameType.LogLines;\n      const isFieldDataplaneLabels =\n        field.name === 'labels' && field.type === FieldType.other && dataFrame?.meta?.type === DataFrameType.LogLines;\n      return isFieldLokiLabels || isFieldDataplaneLabels;\n    })\n    .flatMap((field: Field) => {\n      return [\n        {\n          id: 'extractFields',\n          options: {\n            format: 'json',\n            keepTime: false,\n            replace: false,\n            source: field.name,\n          },\n        },\n      ];\n    });\n}\n\nfunction getTableCellOptions(\n  field: Field,\n  fieldIndex: number,\n  labels: Labels[],\n  logsFrame: LogsFrame\n): TableCustomCellOptions | TableColoredBackgroundCellOptions {\n  if (field.name === getBodyName(logsFrame)) {\n    return {\n      cellComponent: (props) => (\n        <LogLineCellComponent {...props} fieldIndex={fieldIndex} labels={labels[props.rowIndex]} />\n      ),\n      type: TableCellDisplayMode.Custom,\n    };\n  }\n\n  return {\n    cellComponent: (props) => <DefaultCellComponent {...props} fieldIndex={fieldIndex} />,\n    type: TableCellDisplayMode.Custom,\n  };\n}\n\nfunction getInitialFieldWidth(\n  field: Field,\n  fieldIndex: number,\n  columns: FieldNameMetaStore,\n  tableWidth: number,\n  numberOfFields: number,\n  logsFrame: LogsFrame\n): number | undefined {\n  const minWidth = 90;\n\n  // Columns shouldn't take more than half the available space, unless there are only 2 columns\n  const maxWidth = numberOfFields <= 2 ? tableWidth : Math.min(tableWidth / 2);\n\n  // First field gets icons, and a little extra width\n  const extraPadding = fieldIndex === 0 ? 50 : 0;\n\n  // Time fields have consistent widths\n  if (field.type === FieldType.time) {\n    return 200 + extraPadding;\n  }\n\n  const columnMeta = columns[field.name];\n\n  if (columnMeta === undefined) {\n    return undefined;\n  }\n\n  const maxLength = Math.max(columnMeta.maxLength ?? 0, field.name.length);\n\n  if (columnMeta.maxLength) {\n    // Super rough estimate, about 6.5px per char, and 95px for some space for the header icons (remember when sorted a new icon is added to the table header).\n    // I guess to be a little tighter we could only add the extra padding IF the field name is longer then the longest value\n    return Math.min(Math.max(maxLength * 6.5 + 95 + extraPadding, minWidth + extraPadding), maxWidth);\n  }\n\n  if (field.name === getBodyName(logsFrame)) {\n    return undefined;\n  }\n\n  // Just derived fields, which should have uniform length\n  return Math.min(\n    Math.max((field.values?.[0]?.length ?? 80) * 6.5 + 95 + extraPadding, minWidth + extraPadding),\n    maxWidth\n  );\n}\n","import React, { useCallback, useState } from 'react';\nimport { css } from '@emotion/css';\n\nimport { DataFrame, FieldType, FieldWithIndex, getTimeZone, guessFieldTypeFromValue, Labels } from '@grafana/data';\n\nimport { TableColumnContextProvider } from 'Components/Table/Context/TableColumnsContext';\nimport { Table } from 'Components/Table/Table';\nimport { FieldNameMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { useResizeObserver } from '@react-aria/utils';\n\nexport type SpecialFieldsType = {\n  time: FieldWithIndex;\n  body: FieldWithIndex;\n  extraFields: FieldWithIndex[];\n};\n\n// matches common ISO 8601\nconst iso8601Regex = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d{3,})?(?:Z|[-+]\\d{2}:?\\d{2})$/;\n\ninterface TableWrapProps {\n  urlColumns: string[];\n  setUrlColumns: (columns: string[]) => void;\n  panelWrap: React.RefObject<HTMLDivElement>;\n  clearSelectedLine: () => void;\n}\n\nconst getStyles = () => ({\n  section: css({\n    position: 'relative',\n  }),\n});\n\nexport const TableWrap = (props: TableWrapProps) => {\n  const { logsFrame } = useQueryContext();\n\n  const [panelWrapSize, setPanelWrapSize] = useState({ width: 0, height: 0 });\n\n  // Table needs to be positioned absolutely, passing in reference wrapping panelChrome from parent\n  useResizeObserver({\n    ref: props.panelWrap,\n    onResize: () => {\n      const element = props.panelWrap.current;\n      if (element) {\n        if (panelWrapSize.width !== element.clientWidth || panelWrapSize.height !== element.clientHeight) {\n          setPanelWrapSize({\n            width: element.clientWidth,\n            height: element.clientHeight,\n          });\n        }\n      }\n    },\n  });\n\n  const styles = getStyles();\n  const timeZone = getTimeZone();\n\n  // This function is called when we want to grab the column names that are currently stored in the URL.\n  // So instead we have to grab the current columns directly from the URL.\n  const getColumnsFromProps = useCallback(\n    (fieldNames: FieldNameMetaStore) => {\n      const previouslySelected = props.urlColumns;\n      if (previouslySelected?.length) {\n        Object.values(previouslySelected).forEach((key, index) => {\n          if (fieldNames[key]) {\n            fieldNames[key].active = true;\n            fieldNames[key].index = index;\n          }\n        });\n      }\n\n      return fieldNames;\n    },\n    [props.urlColumns]\n  );\n\n  // If the data frame is empty, there's nothing to viz, it could mean the user has unselected all columns\n  if (!logsFrame || !logsFrame.raw.length) {\n    return null;\n  }\n\n  const labels = logsFrame.getLogFrameLabelsAsLabels() ?? [];\n  const numberOfLogLines = logsFrame ? logsFrame.raw.length : 0;\n\n  // If we have labels and log lines\n  let pendingLabelState = mapLabelsToInitialState(logsFrame.raw, labels);\n  const specialFields = {\n    time: logsFrame.timeField,\n    body: logsFrame.bodyField,\n    extraFields: logsFrame.extraFields,\n  };\n\n  // Normalize the other fields\n  if (specialFields) {\n    addSpecialLabelsState(\n      [specialFields.time, specialFields.body, ...specialFields.extraFields],\n      pendingLabelState,\n      numberOfLogLines\n    );\n\n    pendingLabelState = getColumnsFromProps(pendingLabelState);\n\n    // Get all active columns\n    const active = Object.keys(pendingLabelState).filter((key) => pendingLabelState[key].active);\n\n    // If nothing is selected, then select the default columns\n    setSpecialFieldMeta(active, specialFields, pendingLabelState);\n  }\n\n  return (\n    <section className={styles.section}>\n      <TableColumnContextProvider\n        logsFrame={logsFrame}\n        initialColumns={pendingLabelState}\n        setUrlColumns={props.setUrlColumns}\n        clearSelectedLine={props.clearSelectedLine}\n      >\n        <Table\n          logsFrame={logsFrame}\n          timeZone={timeZone}\n          height={panelWrapSize.height - 50}\n          width={panelWrapSize.width - 25}\n          labels={labels}\n        />\n      </TableColumnContextProvider>\n    </section>\n  );\n};\n\nconst normalize = (value: number, total: number): number => {\n  return Math.ceil((100 * value) / total);\n};\n\ntype labelName = string;\ntype labelValue = string;\n\nexport function getCardinalityMapFromLabels(labels: Labels[]) {\n  const cardinalityMap = new Map<labelName, { valueSet: Set<labelValue>; maxLength: number }>();\n  labels.forEach((fieldLabels) => {\n    const labelNames = Object.keys(fieldLabels);\n    labelNames.forEach((labelName) => {\n      if (cardinalityMap.has(labelName)) {\n        const setObj = cardinalityMap.get(labelName);\n        const values = setObj?.valueSet;\n        const maxLength = setObj?.maxLength;\n\n        if (values && !values?.has(fieldLabels[labelName])) {\n          values?.add(fieldLabels[labelName]);\n          if (maxLength && fieldLabels[labelName].length > maxLength) {\n            cardinalityMap.set(labelName, { maxLength: fieldLabels[labelName].length, valueSet: values });\n          }\n        }\n      } else {\n        cardinalityMap.set(labelName, {\n          maxLength: fieldLabels[labelName].length,\n          valueSet: new Set([fieldLabels[labelName]]),\n        });\n      }\n    });\n  });\n\n  return cardinalityMap;\n}\n\n/**\n * Guess the field type of the value\n * @param value\n */\nexport function guessLogsFieldTypeForValue(value: string) {\n  let fieldType = guessFieldTypeFromValue(value);\n  const isISO8601 = fieldType === 'string' && iso8601Regex.test(value);\n  if (isISO8601) {\n    fieldType = FieldType.time;\n  }\n  return fieldType;\n}\n\nfunction mapLabelsToInitialState(dataFrame: DataFrame, labels: Labels[]) {\n  let pendingLabelState: FieldNameMetaStore = {};\n\n  // Use a map to dedupe labels and count their occurrences in the logs\n  const labelMap = new Map<string, FieldNameMeta>();\n  const cardinality = getCardinalityMapFromLabels(labels);\n  const numberOfLogLines = dataFrame ? dataFrame.length : 0;\n\n  if (labels?.length && numberOfLogLines) {\n    // Iterate through all of Labels\n    labels.forEach((labels: Labels) => {\n      const labelsArray = Object.keys(labels);\n      // Iterate through the label values\n      labelsArray.forEach((label) => {\n        const cardinalityMap = cardinality.get(label);\n        const cardinalityCount = cardinalityMap?.valueSet?.size ?? 0;\n        // If it's already in our map, increment the count\n        if (labelMap.has(label)) {\n          const value = labelMap.get(label);\n\n          if (value) {\n            if (value?.active) {\n              labelMap.set(label, {\n                percentOfLinesWithLabel: value.percentOfLinesWithLabel + 1,\n                active: true,\n                index: value.index,\n                cardinality: cardinalityCount,\n                maxLength: cardinalityMap?.maxLength,\n              });\n            } else {\n              labelMap.set(label, {\n                percentOfLinesWithLabel: value.percentOfLinesWithLabel + 1,\n                active: false,\n                index: undefined,\n                cardinality: cardinalityCount,\n                maxLength: cardinalityMap?.maxLength,\n              });\n            }\n          }\n          // Otherwise add it\n        } else {\n          labelMap.set(label, {\n            percentOfLinesWithLabel: 1,\n            active: false,\n            index: undefined,\n            cardinality: cardinalityCount,\n            maxLength: cardinalityMap?.maxLength,\n          });\n        }\n      });\n    });\n\n    // Converting the map to an object\n    pendingLabelState = Object.fromEntries(labelMap);\n\n    // Convert count to percent of log lines\n    Object.keys(pendingLabelState).forEach((key) => {\n      pendingLabelState[key].percentOfLinesWithLabel = normalize(\n        pendingLabelState[key].percentOfLinesWithLabel,\n        numberOfLogLines\n      );\n    });\n  }\n  return pendingLabelState;\n}\n\n/**\n * Add special fields like time and body\n * @param specialFieldArray\n * @param pendingLabelState\n * @param numberOfLogLines\n */\nfunction addSpecialLabelsState(\n  specialFieldArray: Array<FieldWithIndex | undefined>,\n  pendingLabelState: FieldNameMetaStore,\n  numberOfLogLines: number\n) {\n  specialFieldArray.forEach((field) => {\n    if (!field) {\n      return;\n    }\n    const isActive = pendingLabelState[field.name]?.active;\n    const index = pendingLabelState[field.name]?.index;\n    if (isActive && index !== undefined) {\n      pendingLabelState[field.name] = {\n        percentOfLinesWithLabel: normalize(\n          field.values.filter((value) => value !== null && value !== undefined).length,\n          numberOfLogLines\n        ),\n        active: true,\n        index: index,\n        cardinality: numberOfLogLines,\n      };\n    } else {\n      pendingLabelState[field.name] = {\n        percentOfLinesWithLabel: normalize(\n          field.values.filter((value) => value !== null && value !== undefined).length,\n          numberOfLogLines\n        ),\n        active: false,\n        index: undefined,\n        cardinality: numberOfLogLines,\n      };\n    }\n  });\n\n  return pendingLabelState;\n}\n\nfunction setSpecialFieldMeta(\n  active: string[],\n  specialFields: SpecialFieldsType,\n  pendingLabelState: FieldNameMetaStore\n) {\n  // If no fields are visible, set defaults\n  if (active.length === 0) {\n    if (specialFields.body?.name) {\n      pendingLabelState[specialFields.body?.name].active = true;\n      pendingLabelState[specialFields.body?.name].index = 1;\n    }\n    if (specialFields.time?.name) {\n      pendingLabelState[specialFields.time?.name].active = true;\n      pendingLabelState[specialFields.time?.name].index = 0;\n    }\n  }\n\n  if (specialFields.time?.name && specialFields.body?.name) {\n    pendingLabelState[specialFields.body?.name].type = 'BODY_FIELD';\n    pendingLabelState[specialFields.time?.name].type = 'TIME_FIELD';\n  }\n\n  if (specialFields.extraFields.length) {\n    specialFields.extraFields.forEach((field) => {\n      const hasLinks = field.config.links?.length;\n      if (hasLinks) {\n        pendingLabelState[field.name].type = 'LINK_FIELD';\n      }\n    });\n  }\n}\n","import React from 'react';\n\nimport { TableWrap } from 'Components/Table/TableWrap';\nimport { AdHocVariableFilter, DataFrame, TimeRange } from '@grafana/data';\nimport { QueryContextProvider } from 'Components/Table/Context/QueryContext';\nimport { parseLogsFrame } from '../../services/logsFrame';\nimport { SelectedTableRow } from './LogLineCellComponent';\n\ninterface TableProviderProps {\n  dataFrame: DataFrame;\n  setUrlColumns: (columns: string[]) => void;\n  urlColumns: string[];\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n  panelWrap: React.RefObject<HTMLDivElement>;\n  clearSelectedLine: () => void;\n}\n\nexport const TableProvider = ({\n  dataFrame,\n  setUrlColumns,\n  urlColumns,\n  addFilter,\n  selectedLine,\n  timeRange,\n  panelWrap,\n  clearSelectedLine,\n}: TableProviderProps) => {\n  if (!dataFrame) {\n    return null;\n  }\n\n  const logsFrame = parseLogsFrame(dataFrame);\n  if (!logsFrame) {\n    return null;\n  }\n\n  return (\n    <QueryContextProvider addFilter={addFilter} selectedLine={selectedLine} timeRange={timeRange} logsFrame={logsFrame}>\n      <TableWrap\n        setUrlColumns={setUrlColumns}\n        urlColumns={urlColumns}\n        panelWrap={panelWrap}\n        clearSelectedLine={clearSelectedLine}\n      />\n    </QueryContextProvider>\n  );\n};\n","import React from 'react';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { LogsVisualizationType } from 'services/store';\n\nexport function LogsPanelHeaderActions(props: {\n  vizType: LogsVisualizationType;\n  onChange: (type: LogsVisualizationType) => void;\n}) {\n  return (\n    <div className={styles.visualisationType}>\n      <RadioButtonGroup\n        className={styles.visualisationTypeRadio}\n        options={[\n          {\n            label: 'Logs',\n            value: 'logs',\n            description: 'Show results in logs visualisation',\n          },\n          {\n            label: 'Table',\n            value: 'table',\n            description: 'Show results in table visualisation',\n          },\n        ]}\n        size=\"sm\"\n        value={props.vizType}\n        onChange={props.onChange}\n      />\n    </div>\n  );\n}\n\nconst styles = {\n  visualisationType: css({\n    display: 'flex',\n    flex: '1',\n    justifyContent: 'space-between',\n    marginTop: '8px',\n  }),\n  visualisationTypeRadio: css({\n    margin: `0 0 0 8px`,\n  }),\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase } from '@grafana/scenes';\nimport { LogsListScene } from './LogsListScene';\nimport { AdHocVariableFilter } from '@grafana/data';\nimport { TableProvider } from '../Table/TableProvider';\nimport React, { useRef } from 'react';\nimport { PanelChrome } from '@grafana/ui';\nimport { LogsPanelHeaderActions } from '../Table/LogsHeaderActions';\nimport { css } from '@emotion/css';\nimport { addAdHocFilter } from './Breakdowns/AddToFiltersButton';\nimport { areArraysEqual } from '../../services/comparison';\nimport { getLogsPanelFrame } from './ServiceScene';\nimport { getVariableForLabel } from '../../services/fields';\n\nexport class LogsTableScene extends SceneObjectBase {\n  public static Component = ({ model }: SceneComponentProps<LogsTableScene>) => {\n    const styles = getStyles();\n    // Get state from parent model\n    const parentModel = sceneGraph.getAncestor(model, LogsListScene);\n    const { data } = sceneGraph.getData(model).useState();\n    const { selectedLine, urlColumns, visualizationType } = parentModel.useState();\n\n    // Get time range\n    const timeRange = sceneGraph.getTimeRange(model);\n    const { value: timeRangeValue } = timeRange.useState();\n\n    const dataFrame = getLogsPanelFrame(data);\n\n    // Define callback function to update filters in react\n    const addFilter = (filter: AdHocVariableFilter) => {\n      const variableType = getVariableForLabel(dataFrame, filter.key, model);\n      addAdHocFilter(filter, parentModel, variableType);\n    };\n\n    // Get reference to panel wrapper so table knows how much space it can use to render\n    const panelWrap = useRef<HTMLDivElement>(null);\n\n    // Define callback function to update url columns in react\n    const setUrlColumns = (urlColumns: string[]) => {\n      if (!areArraysEqual(urlColumns, parentModel.state.urlColumns)) {\n        parentModel.setState({ urlColumns });\n      }\n    };\n\n    const clearSelectedLine = () => {\n      if (parentModel.state.selectedLine) {\n        parentModel.clearSelectedLine();\n      }\n    };\n\n    return (\n      <div className={styles.panelWrapper} ref={panelWrap}>\n        <PanelChrome\n          loadingState={data?.state}\n          title={'Logs'}\n          actions={<LogsPanelHeaderActions vizType={visualizationType} onChange={parentModel.setVisualizationType} />}\n        >\n          {dataFrame && (\n            <TableProvider\n              panelWrap={panelWrap}\n              addFilter={addFilter}\n              timeRange={timeRangeValue}\n              selectedLine={selectedLine}\n              urlColumns={urlColumns ?? []}\n              setUrlColumns={setUrlColumns}\n              dataFrame={dataFrame}\n              clearSelectedLine={clearSelectedLine}\n            />\n          )}\n        </PanelChrome>\n      </div>\n    );\n  };\n}\n\nconst getStyles = () => ({\n  panelWrapper: css({\n    height: '100%',\n  }),\n});\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, sceneGraph } from '@grafana/scenes';\nimport { Button, InlineField, InlineSwitch, Tooltip } from '@grafana/ui';\nimport React, { ChangeEvent } from 'react';\nimport { getLogOption, setLogOption } from 'services/store';\nimport { LogsListScene } from './LogsListScene';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\n\ninterface LogOptionsState extends SceneObjectState {\n  wrapLines?: boolean;\n}\n\nexport class LogOptionsScene extends SceneObjectBase<LogOptionsState> {\n  static Component = LogOptionsRenderer;\n\n  constructor(state?: Partial<LogOptionsState>) {\n    super({\n      ...state,\n      wrapLines: Boolean(getLogOption('wrapLines')),\n    });\n  }\n\n  handleWrapLinesChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const checked = e.target.checked;\n    this.setState({ wrapLines: checked });\n    setLogOption('wrapLines', checked);\n    this.getParentScene().setLogsVizOption({ wrapLogMessage: checked });\n  };\n\n  getParentScene = () => {\n    return sceneGraph.getAncestor(this, LogsListScene);\n  };\n\n  clearDisplayedFields = () => {\n    const parentScene = this.getParentScene();\n    parentScene.clearDisplayedFields();\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_clear_displayed_fields\n    );\n  };\n}\n\nfunction LogOptionsRenderer({ model }: SceneComponentProps<LogOptionsScene>) {\n  const { wrapLines } = model.useState();\n  const { displayedFields } = model.getParentScene().useState();\n\n  return (\n    <>\n      <InlineField label=\"Wrap lines\" transparent htmlFor=\"wrap-lines-switch\">\n        <InlineSwitch\n          value={wrapLines}\n          onChange={model.handleWrapLinesChange}\n          className={styles.horizontalInlineSwitch}\n          transparent\n          id=\"wrap-lines-switch\"\n        />\n      </InlineField>\n      {displayedFields.length > 0 && (\n        <Tooltip content={`Clear displayed fields: ${displayedFields.join(', ')}`}>\n          <Button variant=\"secondary\" fill=\"outline\" onClick={model.clearDisplayedFields}>\n            Show original log line\n          </Button>\n        </Tooltip>\n      )}\n    </>\n  );\n}\n\nconst styles = {\n  input: css({\n    width: '100%',\n  }),\n  field: css({\n    label: 'field',\n    marginBottom: 0,\n  }),\n  horizontalInlineSwitch: css({\n    padding: `0 4px 0 0`,\n  }),\n};\n","import { LogRowModel } from '@grafana/data';\nimport { IconButton } from '@grafana/ui';\nimport React, { MouseEvent, useCallback, useEffect, useState } from 'react';\n\ninterface Props {\n  onClick(event: MouseEvent<HTMLElement>, row?: LogRowModel): void;\n}\n\nexport const CopyLinkButton = ({ onClick }: Props) => {\n  const [copied, setCopied] = useState(false);\n\n  useEffect(() => {\n    let timeoutId: ReturnType<typeof setTimeout>;\n\n    if (copied) {\n      timeoutId = setTimeout(() => {\n        setCopied(false);\n      }, 2000);\n    }\n\n    return () => {\n      clearTimeout(timeoutId);\n    };\n  }, [copied]);\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLElement>, row?: LogRowModel) => {\n      onClick(event, row);\n      setCopied(true);\n    },\n    [onClick]\n  );\n\n  return (\n    <IconButton\n      aria-label={copied ? 'Copied' : 'Copy link to log line'}\n      tooltip={copied ? 'Copied' : 'Copy link to log line'}\n      tooltipPlacement=\"top\"\n      variant={copied ? 'primary' : 'secondary'}\n      size=\"md\"\n      name={copied ? 'check' : 'share-alt'}\n      onClick={handleClick}\n    />\n  );\n};\n","import {\n  AdHocFiltersVariable,\n  PanelBuilders,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { DataFrame, LogRowModel } from '@grafana/data';\nimport { getLogOption, setDisplayedFields } from '../../services/store';\nimport { LogsPanelHeaderActions } from '../Table/LogsHeaderActions';\nimport React, { MouseEvent } from 'react';\nimport { LogsListScene } from './LogsListScene';\nimport { LoadingPlaceholder } from '@grafana/ui';\nimport { addToFilters, FilterType } from './Breakdowns/AddToFiltersButton';\nimport { getVariableForLabel } from '../../services/fields';\nimport { VAR_FIELDS, VAR_LABELS, VAR_LEVELS, VAR_METADATA } from '../../services/variables';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { getAdHocFiltersVariable, getValueFromFieldsFilter } from '../../services/variableGetters';\nimport { copyText, generateLogShortlink } from 'services/text';\nimport { CopyLinkButton } from './CopyLinkButton';\n\ninterface LogsPanelSceneState extends SceneObjectState {\n  body?: VizPanel;\n}\n\nexport class LogsPanelScene extends SceneObjectBase<LogsPanelSceneState> {\n  constructor(state: Partial<LogsPanelSceneState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public onActivate() {\n    if (!this.state.body) {\n      this.setState({\n        body: this.getLogsPanel(),\n      });\n    }\n  }\n\n  onClickShowField = (field: string) => {\n    const parent = this.getParentScene();\n    const index = parent.state.displayedFields.indexOf(field);\n\n    if (index === -1 && this.state.body) {\n      const displayedFields = [...parent.state.displayedFields, field];\n      this.setLogsVizOption({\n        displayedFields,\n      });\n      parent.setState({ displayedFields });\n      setDisplayedFields(this, parent.state.displayedFields);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_toggle_displayed_field\n      );\n    }\n  };\n\n  onClickHideField = (field: string) => {\n    const parent = this.getParentScene();\n    const index = parent.state.displayedFields.indexOf(field);\n\n    if (index >= 0 && this.state.body) {\n      const displayedFields = parent.state.displayedFields.filter((displayedField) => field !== displayedField);\n      this.setLogsVizOption({\n        displayedFields,\n      });\n      parent.setState({ displayedFields });\n      setDisplayedFields(this, parent.state.displayedFields);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_toggle_displayed_field\n      );\n    }\n  };\n\n  setLogsVizOption(options = {}) {\n    if (!this.state.body) {\n      return;\n    }\n    this.state.body.onOptionsChange(options);\n  }\n\n  clearDisplayedFields = () => {\n    if (!this.state.body) {\n      return;\n    }\n    this.setLogsVizOption({\n      displayedFields: [],\n    });\n    setDisplayedFields(this, []);\n  };\n\n  private getParentScene() {\n    return sceneGraph.getAncestor(this, LogsListScene);\n  }\n\n  private getLogsPanel() {\n    const parentModel = this.getParentScene();\n    const visualizationType = parentModel.state.visualizationType;\n\n    return (\n      PanelBuilders.logs()\n        .setTitle('Logs')\n        .setOption('showTime', true)\n        .setOption('onClickFilterLabel', this.handleLabelFilterClick)\n        .setOption('onClickFilterOutLabel', this.handleLabelFilterOutClick)\n        .setOption('isFilterLabelActive', this.handleIsFilterLabelActive)\n        .setOption('onClickFilterString', this.handleFilterStringClick)\n        .setOption('onClickShowField', this.onClickShowField)\n        .setOption('onClickHideField', this.onClickHideField)\n        .setOption('displayedFields', parentModel.state.displayedFields)\n        .setOption('wrapLogMessage', Boolean(getLogOption('wrapLines')))\n        .setOption('showLogContextToggle', true)\n        .setOption('showLogContextToggle', true)\n        // @ts-expect-error\n        .setOption('logRowMenuIconsAfter', [<CopyLinkButton onClick={this.handleShareLogLineClick} key={0} />])\n        .setHeaderActions(\n          <LogsPanelHeaderActions vizType={visualizationType} onChange={parentModel.setVisualizationType} />\n        )\n        .build()\n    );\n  }\n\n  private handleShareLogLineClick = (event: MouseEvent<HTMLElement>, row?: LogRowModel) => {\n    if (row?.rowId && this.state.body) {\n      const parent = this.getParentScene();\n      const timeRange = sceneGraph.getTimeRange(this.state.body);\n      const buttonRef = event.currentTarget instanceof HTMLButtonElement ? event.currentTarget : undefined;\n      copyText(\n        generateLogShortlink(\n          'panelState',\n          {\n            logs: { id: row.uid, displayedFields: parent.state.displayedFields },\n          },\n          timeRange.state.value\n        ),\n        buttonRef\n      );\n    }\n  };\n\n  private handleLabelFilterClick = (key: string, value: string, frame?: DataFrame) => {\n    this.handleLabelFilter(key, value, frame, 'toggle');\n  };\n\n  private handleLabelFilterOutClick = (key: string, value: string, frame?: DataFrame) => {\n    this.handleLabelFilter(key, value, frame, 'exclude');\n  };\n\n  private handleIsFilterLabelActive = (key: string, value: string) => {\n    const labels = getAdHocFiltersVariable(VAR_LABELS, this);\n    const fields = getAdHocFiltersVariable(VAR_FIELDS, this);\n    const levels = getAdHocFiltersVariable(VAR_LEVELS, this);\n    const metadata = getAdHocFiltersVariable(VAR_METADATA, this);\n\n    const hasKeyValueFilter = (filter: AdHocFiltersVariable | null) => {\n      return (\n        filter &&\n        filter.state.filters.findIndex(\n          (filter) => filter.operator === '=' && filter.key === key && filter.value === value\n        ) >= 0\n      );\n    };\n\n    // Fields have json encoded values unlike the other variables, get the value for the matching filter and parse it before comparing\n    const hasKeyValueFilterField = (filter: AdHocFiltersVariable | null) => {\n      if (filter) {\n        const fieldFilter = filter.state.filters.find((filter) => filter.operator === '=' && filter.key === key);\n\n        if (fieldFilter) {\n          const fieldValue = getValueFromFieldsFilter(fieldFilter, key);\n          return fieldValue.value === value;\n        }\n      }\n      return false;\n    };\n\n    return (\n      hasKeyValueFilter(labels) ||\n      hasKeyValueFilterField(fields) ||\n      hasKeyValueFilter(levels) ||\n      hasKeyValueFilter(metadata)\n    );\n  };\n\n  private handleFilterStringClick = (value: string) => {\n    const parentModel = sceneGraph.getAncestor(this, LogsListScene);\n    const lineFilterScene = parentModel.getLineFilterScene();\n    if (lineFilterScene) {\n      lineFilterScene.updateFilter(value, false);\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_popover_line_filter,\n        {\n          selectionLength: value.length,\n        }\n      );\n    }\n  };\n\n  private handleLabelFilter(key: string, value: string, frame: DataFrame | undefined, operator: FilterType) {\n    const variableType = getVariableForLabel(frame, key, this);\n\n    addToFilters(key, value, operator, this, variableType);\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_detail_filter_applied,\n      {\n        filterType: variableType,\n        key,\n        action: operator,\n      }\n    );\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LogsPanelScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import React from 'react';\n\nimport {\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneTimeRangeLike,\n} from '@grafana/scenes';\nimport { LineFilterScene } from './LineFilterScene';\nimport { SelectedTableRow } from '../Table/LogLineCellComponent';\nimport { LogsTableScene } from './LogsTableScene';\nimport { css } from '@emotion/css';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { locationService } from '@grafana/runtime';\nimport { LogOptionsScene } from './LogOptionsScene';\nimport { LogsPanelScene } from './LogsPanelScene';\nimport {\n  getDisplayedFields,\n  getLogsVisualizationType,\n  LogsVisualizationType,\n  setLogsVisualizationType,\n} from 'services/store';\nimport { logger } from '../../services/logger';\n\nexport interface LogsListSceneState extends SceneObjectState {\n  loading?: boolean;\n  panel?: SceneFlexLayout;\n  visualizationType: LogsVisualizationType;\n  urlColumns?: string[];\n  selectedLine?: SelectedTableRow;\n  $timeRange?: SceneTimeRangeLike;\n  displayedFields: string[];\n}\n\nexport class LogsListScene extends SceneObjectBase<LogsListSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: ['urlColumns', 'selectedLine', 'visualizationType', 'displayedFields'],\n  });\n  private lineFilterScene?: LineFilterScene = undefined;\n  private logsPanelScene?: LogsPanelScene = undefined;\n  constructor(state: Partial<LogsListSceneState>) {\n    super({\n      ...state,\n      visualizationType: getLogsVisualizationType(),\n      displayedFields: [],\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  getUrlState() {\n    const urlColumns = this.state.urlColumns ?? [];\n    const selectedLine = this.state.selectedLine;\n    const visualizationType = this.state.visualizationType;\n    const displayedFields = this.state.displayedFields ?? getDisplayedFields(this) ?? [];\n    return {\n      urlColumns: JSON.stringify(urlColumns),\n      selectedLine: JSON.stringify(selectedLine),\n      visualizationType: JSON.stringify(visualizationType),\n      displayedFields: JSON.stringify(displayedFields),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<LogsListSceneState> = {};\n    try {\n      if (typeof values.urlColumns === 'string') {\n        const decodedUrlColumns: string[] = JSON.parse(values.urlColumns);\n        if (decodedUrlColumns !== this.state.urlColumns) {\n          stateUpdate.urlColumns = decodedUrlColumns;\n        }\n      }\n      if (typeof values.selectedLine === 'string') {\n        const decodedSelectedTableRow: SelectedTableRow = JSON.parse(values.selectedLine);\n        if (decodedSelectedTableRow !== this.state.selectedLine) {\n          stateUpdate.selectedLine = decodedSelectedTableRow;\n        }\n      }\n\n      if (typeof values.visualizationType === 'string') {\n        const decodedVisualizationType: LogsVisualizationType = JSON.parse(values.visualizationType);\n        if (decodedVisualizationType !== this.state.visualizationType) {\n          stateUpdate.visualizationType = decodedVisualizationType;\n        }\n      }\n\n      if (typeof values.displayedFields === 'string') {\n        const displayedFields = JSON.parse(values.displayedFields);\n        if (displayedFields && displayedFields.length) {\n          stateUpdate.displayedFields = displayedFields;\n        }\n      }\n    } catch (e) {\n      // URL Params can be manually changed and it will make JSON.parse() fail.\n      logger.error(e, { msg: 'LogsListScene: updateFromUrl unexpected error' });\n    }\n\n    if (Object.keys(stateUpdate).length) {\n      this.setState(stateUpdate);\n    }\n  }\n\n  clearSelectedLine() {\n    this.setState({\n      selectedLine: undefined,\n    });\n  }\n\n  clearDisplayedFields = () => {\n    this.setState({ displayedFields: [] });\n    if (this.logsPanelScene) {\n      this.logsPanelScene.clearDisplayedFields();\n    }\n  };\n\n  public onActivate() {\n    const searchParams = new URLSearchParams(locationService.getLocation().search);\n    this.setStateFromUrl(searchParams);\n\n    if (!this.state.panel) {\n      this.updateLogsPanel();\n    }\n\n    this._subs.add(\n      this.subscribeToState((newState, prevState) => {\n        if (newState.visualizationType !== prevState.visualizationType) {\n          this.updateLogsPanel();\n        }\n      })\n    );\n  }\n\n  public getLineFilterScene() {\n    return this.lineFilterScene;\n  }\n\n  private setStateFromUrl(searchParams: URLSearchParams) {\n    const selectedLineUrl = searchParams.get('selectedLine');\n    const urlColumnsUrl = searchParams.get('urlColumns');\n    const vizTypeUrl = searchParams.get('visualizationType');\n    const displayedFieldsUrl = searchParams.get('displayedFields') ?? JSON.stringify(getDisplayedFields(this));\n\n    this.updateFromUrl({\n      selectedLine: selectedLineUrl,\n      urlColumns: urlColumnsUrl,\n      vizType: vizTypeUrl,\n      displayedFields: displayedFieldsUrl,\n    });\n  }\n\n  public setLogsVizOption = (options = {}) => {\n    if (this.logsPanelScene) {\n      this.logsPanelScene.setLogsVizOption(options);\n    }\n  };\n\n  public updateLogsPanel = () => {\n    this.setState({\n      panel: this.getVizPanel(),\n    });\n  };\n\n  public setVisualizationType = (type: LogsVisualizationType) => {\n    this.setState({\n      visualizationType: type,\n    });\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_visualization_toggle,\n      {\n        visualisationType: type,\n      }\n    );\n    setLogsVisualizationType(type);\n  };\n\n  private getVizPanel() {\n    this.lineFilterScene = new LineFilterScene();\n    this.logsPanelScene = new LogsPanelScene({});\n\n    return new SceneFlexLayout({\n      direction: 'column',\n      children:\n        this.state.visualizationType === 'logs'\n          ? [\n              new SceneFlexLayout({\n                children: [\n                  new SceneFlexItem({\n                    body: this.lineFilterScene,\n                    xSizing: 'fill',\n                  }),\n                  new LogOptionsScene(),\n                ],\n              }),\n              new SceneFlexItem({\n                height: 'calc(100vh - 220px)',\n                body: this.logsPanelScene,\n              }),\n            ]\n          : [\n              new SceneFlexItem({\n                body: this.lineFilterScene,\n                xSizing: 'fill',\n              }),\n              new SceneFlexItem({\n                height: 'calc(100vh - 220px)',\n                body: new LogsTableScene({}),\n              }),\n            ],\n    });\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LogsListScene>) => {\n    const { panel } = model.useState();\n\n    if (!panel) {\n      return;\n    }\n\n    return (\n      <div className={styles.panelWrapper}>\n        <panel.Component model={panel} />\n      </div>\n    );\n  };\n}\n\nconst styles = {\n  panelWrapper: css({\n    // If you use hover-header without any header options we must manually hide the remnants, or it shows up as a 1px line in the top-right corner of the viz\n    '.show-on-hover': {\n      display: 'none',\n    },\n\n    // Hack to select internal div\n    'section > div[class$=\"panel-content\"]': css({\n      // A components withing the Logs viz sets contain, which creates a new containing block that is not body which breaks the popover menu\n      contain: 'none',\n      // Prevent overflow from spilling out of parent container\n      overflow: 'auto',\n    }),\n  }),\n};\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\nimport { BusEventBase, DataFrame, FieldReducerInfo, ReducerID, SelectableValue, fieldReducers } from '@grafana/data';\nimport { getLabelValueFromDataFrame } from 'services/levels';\nimport { InlineField, Select } from '@grafana/ui';\nimport { getSortByPreference, setSortByPreference } from 'services/store';\nimport { testIds } from '../../../services/testIds';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\n\nexport type SortBy = 'changepoint' | 'outliers' | ReducerID | '';\nexport type SortDirection = 'asc' | 'desc';\nexport interface SortBySceneState extends SceneObjectState {\n  target: 'fields' | 'labels';\n  sortBy: SortBy;\n  direction: SortDirection;\n}\n\nexport class SortCriteriaChanged extends BusEventBase {\n  constructor(public target: 'fields' | 'labels', public sortBy: string, public direction: string) {\n    super();\n  }\n  public static type = 'sort-criteria-changed';\n}\n\nexport class SortByScene extends SceneObjectBase<SortBySceneState> {\n  public sortingOptions: Array<{ label: string; options: SelectableValue<SortBy> }> = [\n    {\n      label: '',\n      options: [\n        {\n          value: 'changepoint',\n          label: 'Most relevant',\n          description: 'Smart ordering of graphs based on the most significant spikes in the data',\n        },\n        {\n          value: 'outliers',\n          label: 'Outlying values',\n          description: 'Order by the amount of outlying values in the data',\n        },\n        {\n          value: ReducerID.stdDev,\n          label: 'Widest spread',\n          description: 'Sort graphs by deviation from the average value',\n        },\n        {\n          value: 'alphabetical',\n          label: 'Name',\n          description: 'Alphabetical order',\n        },\n        {\n          value: ReducerID.sum,\n          label: 'Count',\n          description: 'Sort graphs by total number of logs',\n        },\n        {\n          value: ReducerID.max,\n          label: 'Highest spike',\n          description: 'Sort graphs by the highest values (max)',\n        },\n        {\n          value: ReducerID.min,\n          label: 'Lowest dip',\n          description: 'Sort graphs by the smallest values (min)',\n        },\n      ],\n    },\n    {\n      label: 'Percentiles',\n      options: [...fieldReducers.selectOptions([], filterReducerOptions).options],\n    },\n  ];\n\n  constructor(state: Pick<SortBySceneState, 'target'>) {\n    const { sortBy, direction } = getSortByPreference(state.target, DEFAULT_SORT_BY, 'desc');\n    super({\n      target: state.target,\n      sortBy,\n      direction,\n    });\n  }\n\n  public onCriteriaChange = (criteria: SelectableValue<SortBy>) => {\n    if (!criteria.value) {\n      return;\n    }\n    this.setState({ sortBy: criteria.value });\n    setSortByPreference(this.state.target, criteria.value, this.state.direction);\n    this.publishEvent(new SortCriteriaChanged(this.state.target, criteria.value, this.state.direction), true);\n  };\n\n  public onDirectionChange = (direction: SelectableValue<SortDirection>) => {\n    if (!direction.value) {\n      return;\n    }\n    this.setState({ direction: direction.value });\n    setSortByPreference(this.state.target, this.state.sortBy, direction.value);\n    this.publishEvent(new SortCriteriaChanged(this.state.target, this.state.sortBy, direction.value), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SortByScene>) => {\n    const { sortBy, direction } = model.useState();\n    const group = model.sortingOptions.find((group) =>\n      group.options.find((option: SelectableValue<SortBy>) => option.value === sortBy)\n    );\n    const sortByValue: SelectableValue<SortBy> | undefined = group?.options.find(\n      (option: SelectableValue<SortBy>) => option.value === sortBy\n    );\n    return (\n      <>\n        <InlineField>\n          <Select\n            data-testid={testIds.breakdowns.common.sortByDirection}\n            onChange={model.onDirectionChange}\n            aria-label=\"Sort direction\"\n            placeholder=\"\"\n            value={direction}\n            options={[\n              {\n                label: 'Asc',\n                value: 'asc',\n              },\n              {\n                label: 'Desc',\n                value: 'desc',\n              },\n            ]}\n          ></Select>\n        </InlineField>\n        <InlineField\n          label=\"Sort by\"\n          htmlFor=\"sort-by-criteria\"\n          tooltip=\"Calculate a derived quantity from the values in your time series and sort by this criteria. Defaults to standard deviation.\"\n        >\n          <Select\n            data-testid={testIds.breakdowns.common.sortByFunction}\n            value={sortByValue}\n            width={20}\n            isSearchable={true}\n            options={model.sortingOptions}\n            placeholder={'Choose criteria'}\n            onChange={model.onCriteriaChange}\n            inputId=\"sort-by-criteria\"\n          />\n        </InlineField>\n      </>\n    );\n  };\n}\n\nconst ENABLED_PERCENTILES = ['p10', 'p25', 'p75', 'p90', 'p99'];\nfunction filterReducerOptions(ext: FieldReducerInfo) {\n  if (ext.id >= 'p1' && ext.id <= 'p99') {\n    return ENABLED_PERCENTILES.includes(ext.id);\n  }\n  return false;\n}\n\nexport function getLabelValue(frame: DataFrame) {\n  return getLabelValueFromDataFrame(frame) ?? 'No labels';\n}\n","import React from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Field, RadioButtonGroup } from '@grafana/ui';\nimport { USER_EVENTS_ACTIONS, USER_EVENTS_PAGES, reportAppInteraction } from 'services/analytics';\nimport { getDrilldownSlug } from '../../../services/routing';\n\nexport interface LayoutSwitcherState extends SceneObjectState {\n  active: LayoutType;\n  layouts: SceneObject[];\n  options: Array<SelectableValue<LayoutType>>;\n}\n\nexport type LayoutType = 'single' | 'grid' | 'rows';\n\nexport class LayoutSwitcher extends SceneObjectBase<LayoutSwitcherState> {\n  public Selector({ model }: { model: LayoutSwitcher }) {\n    const { active, options } = model.useState();\n\n    return (\n      <Field>\n        <RadioButtonGroup options={options} value={active} onChange={model.onLayoutChange} />\n      </Field>\n    );\n  }\n\n  public onLayoutChange = (active: LayoutType) => {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.layout_type_changed, {\n      layout: active,\n      view: getDrilldownSlug(),\n    });\n    this.setState({ active });\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LayoutSwitcher>) => {\n    const { layouts, options, active } = model.useState();\n\n    const index = options.findIndex((o) => o.value === active);\n    if (index === -1) {\n      return null;\n    }\n\n    const layout = layouts[index];\n\n    return <layout.Component model={layout} />;\n  };\n}\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, ClickOutsideWrapper, Field, FieldSet, Input, Label, Select, Stack, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { SelectLabelActionScene } from './SelectLabelActionScene';\nimport { addNumericFilter, removeFilter, validateVariableNameForField, VariableFilterType } from './AddToFiltersButton';\nimport { FilterOp } from '../../../services/filterTypes';\nimport { getAdHocFiltersVariable, getValueFromFieldsFilter } from '../../../services/variableGetters';\nimport { logger } from '../../../services/logger';\nimport { testIds } from '../../../services/testIds';\n\nexport interface NumericFilterPopoverSceneState extends SceneObjectState {\n  labelName: string;\n  variableType: VariableFilterType;\n  gt?: number;\n  gte?: boolean;\n  lt?: number;\n  lte?: boolean;\n  fieldType: 'float' | 'duration' | 'bytes';\n  hasExistingFilter?: boolean;\n}\n\nexport type NumericFilterPopoverSceneStateTotal =\n  | (NumericFilterPopoverSceneState & FloatTypes)\n  | (NumericFilterPopoverSceneState & DurationTypes)\n  | (NumericFilterPopoverSceneState & ByteTypes);\n\nenum durationUnitValues {\n  ns = 'ns',\n  us = 'µs',\n  ms = 'ms',\n  s = 's',\n  m = 'm',\n  h = 'h',\n}\n\nenum byteUnitValues {\n  B = 'B',\n  KB = 'KB',\n  MB = 'MB',\n  GB = 'GB',\n  TB = 'TB',\n\n  // Supported but potentially confusing values, commented out for now\n  // kB = 'kB',\n  // KiB = 'KiB',\n  // MiB = 'MiB',\n  // GiB = 'GiB',\n  // TiB = 'TiB',\n}\n\ninterface FloatUnitTypes {\n  ltu: '';\n  gtu: '';\n}\n\ninterface FloatTypes extends FloatUnitTypes {\n  fieldType: 'float';\n}\n\ninterface DurationUnitTypes {\n  ltu: durationUnitValues;\n  gtu: durationUnitValues;\n}\n\ninterface DurationTypes extends DurationUnitTypes {\n  fieldType: 'duration';\n}\n\ninterface ByteUnitTypes {\n  ltu: byteUnitValues;\n  gtu: byteUnitValues;\n}\n\ninterface ByteTypes extends ByteUnitTypes {\n  fieldType: 'bytes';\n}\n\nexport class NumericFilterPopoverScene extends SceneObjectBase<NumericFilterPopoverSceneStateTotal> {\n  constructor(state: Omit<NumericFilterPopoverSceneStateTotal, 'gtu' | 'ltu'>) {\n    let units: FloatUnitTypes | DurationUnitTypes | ByteUnitTypes;\n    const fieldType: 'float' | 'bytes' | 'duration' = state.fieldType;\n    if (fieldType === 'bytes') {\n      units = { ltu: byteUnitValues.B, gtu: byteUnitValues.B };\n    } else if (fieldType === 'duration') {\n      units = { ltu: durationUnitValues.s, gtu: durationUnitValues.s };\n    } else if (fieldType === 'float') {\n      units = { ltu: '', gtu: '' };\n    } else {\n      throw new Error(`field type incorrectly defined: ${fieldType}`);\n    }\n\n    // @todo - how to avoid type assertion?\n    super({ ...state, ...units } as NumericFilterPopoverSceneStateTotal);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    // get existing values if they exist\n    const variable = getAdHocFiltersVariable(\n      validateVariableNameForField(this.state.labelName, this.state.variableType),\n      this\n    );\n    const filters = variable.state.filters.filter((f) => f.key === this.state.labelName);\n    const gtFilter = filters.find((f) => f.operator === FilterOp.gte || f.operator === FilterOp.gt);\n    const ltFilter = filters.find((f) => f.operator === FilterOp.lte || f.operator === FilterOp.lt);\n    let stateUpdate: Partial<NumericFilterPopoverSceneStateTotal> = {};\n\n    if (this.state.fieldType === 'duration' || this.state.fieldType === 'bytes') {\n      if (gtFilter) {\n        const extractedValue = extractValueFromString(getValueFromFieldsFilter(gtFilter).value, this.state.fieldType);\n\n        if (extractedValue) {\n          stateUpdate.gt = extractedValue.value;\n          stateUpdate.gtu = extractedValue.unit;\n          stateUpdate.gte = gtFilter.operator === FilterOp.gte;\n        }\n      }\n\n      if (ltFilter) {\n        const extractedValue = extractValueFromString(getValueFromFieldsFilter(ltFilter).value, this.state.fieldType);\n\n        if (extractedValue) {\n          stateUpdate.lt = extractedValue.value;\n          stateUpdate.ltu = extractedValue.unit;\n          stateUpdate.lte = ltFilter.operator === FilterOp.lte;\n        }\n      }\n    } else {\n      // Floats have no unit\n      if (gtFilter) {\n        const extractedValue = getValueFromFieldsFilter(gtFilter).value;\n        stateUpdate.gt = Number(extractedValue);\n        stateUpdate.gtu = '';\n        stateUpdate.gte = gtFilter.operator === FilterOp.gte;\n      }\n      if (ltFilter) {\n        const extractedValue = getValueFromFieldsFilter(ltFilter).value;\n        stateUpdate.lt = Number(extractedValue);\n        stateUpdate.ltu = '';\n        stateUpdate.lte = ltFilter.operator === FilterOp.lte;\n      }\n    }\n\n    if (Object.keys(stateUpdate).length !== 0) {\n      stateUpdate.hasExistingFilter = true;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onSubmit() {\n    // \"0\" values break byte queries see https://github.com/grafana/loki/issues/14993, for now we remove the filter when a 0 value is entered to prevent breakage\n    // numeric values can only be fields or metadata variable\n    if (this.state.gt) {\n      addNumericFilter(\n        this.state.labelName,\n        this.state.gt.toString() + this.state.gtu,\n        this.state.gte ? FilterOp.gte : FilterOp.gt,\n        this,\n        this.state.variableType\n      );\n    } else {\n      removeFilter(this.state.labelName, this, this.state.gte ? FilterOp.gte : FilterOp.gt, this.state.variableType);\n    }\n\n    if (this.state.lt) {\n      addNumericFilter(\n        this.state.labelName,\n        this.state.lt.toString() + this.state.ltu,\n        this.state.lte ? FilterOp.lte : FilterOp.lt,\n        this,\n        this.state.variableType\n      );\n    } else {\n      removeFilter(this.state.labelName, this, this.state.lte ? FilterOp.lte : FilterOp.lt, this.state.variableType);\n    }\n\n    const selectLabelActionScene = sceneGraph.getAncestor(this, SelectLabelActionScene);\n    selectLabelActionScene.togglePopover();\n  }\n  onInputKeydown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    const formDisabled = this.state.gt === undefined && this.state.lt === undefined;\n    if (e.key === 'Enter' && !formDisabled) {\n      this.onSubmit();\n    }\n  };\n\n  public static Component = ({ model }: SceneComponentProps<NumericFilterPopoverScene>) => {\n    const popoverStyles = useStyles2(getPopoverStyles);\n    const { labelName, gt, lt, gte, lte, gtu, ltu, fieldType, hasExistingFilter } = model.useState();\n    const subTitle = fieldType !== 'float' && fieldType !== labelName ? `(${fieldType})` : undefined;\n\n    const selectLabelActionScene = sceneGraph.getAncestor(model, SelectLabelActionScene);\n    const formDisabled = gt === undefined && lt === undefined;\n\n    return (\n      <ClickOutsideWrapper useCapture={true} onClick={() => selectLabelActionScene.togglePopover()}>\n        <Stack direction=\"column\" gap={0} role=\"tooltip\">\n          <div className={popoverStyles.card.body}>\n            <div className={popoverStyles.card.title}>\n              {labelName} {subTitle}\n            </div>\n\n            <div className={popoverStyles.card.fieldWrap}>\n              {/* greater than */}\n              <FieldSet className={popoverStyles.card.fieldset}>\n                <Field\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.inputGreaterThanInclusive}\n                  horizontal={true}\n                  className={cx(popoverStyles.card.field, popoverStyles.card.inclusiveField)}\n                >\n                  <Select<string>\n                    className={popoverStyles.card.inclusiveInput}\n                    menuShouldPortal={false}\n                    value={gte !== undefined ? gte.toString() : 'false'}\n                    options={[\n                      { label: 'Greater than', value: 'false' },\n                      { label: 'Greater than or equal', value: 'true' },\n                    ]}\n                    onChange={(value) => model.setState({ gte: value.value === 'true' })}\n                  />\n                </Field>\n                <Field\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.inputGreaterThan}\n                  horizontal={true}\n                  className={popoverStyles.card.field}\n                >\n                  <Input\n                    onKeyDownCapture={model.onInputKeydown}\n                    autoFocus={true}\n                    onChange={(e) => {\n                      model.setState({\n                        gt: e.currentTarget.value !== '' ? Number(e.currentTarget.value) : undefined,\n                      });\n                    }}\n                    className={popoverStyles.card.numberInput}\n                    value={gt}\n                    type={'number'}\n                  />\n                </Field>\n                {fieldType !== 'float' && (\n                  <Label>\n                    <Field\n                      data-testid={testIds.breakdowns.common.filterNumericPopover.inputGreaterThanUnit}\n                      horizontal={true}\n                      className={popoverStyles.card.field}\n                      label={<span className={popoverStyles.card.unitFieldLabel}>Unit</span>}\n                    >\n                      <Select\n                        onChange={(e) => {\n                          model.setState({\n                            gtu: e.value,\n                          });\n                        }}\n                        menuShouldPortal={false}\n                        options={getUnitOptions(fieldType)}\n                        className={popoverStyles.card.selectInput}\n                        value={gtu}\n                      />\n                    </Field>\n                  </Label>\n                )}\n              </FieldSet>\n\n              {/* less than */}\n              <FieldSet className={popoverStyles.card.fieldset}>\n                <Field\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.inputLessThanInclusive}\n                  horizontal={true}\n                  className={cx(popoverStyles.card.field, popoverStyles.card.inclusiveField)}\n                >\n                  <Select<string>\n                    className={popoverStyles.card.inclusiveInput}\n                    menuShouldPortal={false}\n                    value={lte !== undefined ? lte.toString() : 'false'}\n                    options={[\n                      { label: 'Less than', value: 'false' },\n                      { label: 'Less than or equal', value: 'true' },\n                    ]}\n                    onChange={(value) => model.setState({ lte: value.value === 'true' })}\n                  />\n                </Field>\n                <Field\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.inputLessThan}\n                  horizontal={true}\n                  className={popoverStyles.card.field}\n                >\n                  <Input\n                    onKeyDownCapture={model.onInputKeydown}\n                    onChange={(e) =>\n                      model.setState({ lt: e.currentTarget.value !== '' ? Number(e.currentTarget.value) : undefined })\n                    }\n                    className={popoverStyles.card.numberInput}\n                    value={lt}\n                    type={'number'}\n                  />\n                </Field>\n                {fieldType !== 'float' && (\n                  <Label>\n                    <Field\n                      data-testid={testIds.breakdowns.common.filterNumericPopover.inputLessThanUnit}\n                      horizontal={true}\n                      className={popoverStyles.card.field}\n                      label={<span className={popoverStyles.card.unitFieldLabel}>Unit</span>}\n                    >\n                      <Select\n                        onChange={(e) => {\n                          model.setState({\n                            ltu: e.value,\n                          });\n                        }}\n                        menuShouldPortal={false}\n                        options={getUnitOptions(fieldType)}\n                        className={popoverStyles.card.selectInput}\n                        value={ltu}\n                      />\n                    </Field>\n                  </Label>\n                )}\n              </FieldSet>\n            </div>\n\n            {/* buttons */}\n            <div className={popoverStyles.card.buttons}>\n              {hasExistingFilter && (\n                <Button\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.removeButton}\n                  disabled={!hasExistingFilter}\n                  onClick={() => {\n                    model.setState({\n                      gt: undefined,\n                      lt: undefined,\n                    });\n                    model.onSubmit();\n                  }}\n                  size={'sm'}\n                  variant={'destructive'}\n                  fill={'outline'}\n                >\n                  Remove\n                </Button>\n              )}\n              <Button\n                data-testid={testIds.breakdowns.common.filterNumericPopover.submitButton}\n                disabled={formDisabled}\n                onClick={() => model.onSubmit()}\n                size={'sm'}\n                variant={'primary'}\n                fill={'outline'}\n                type={'submit'}\n              >\n                Add\n              </Button>\n\n              <Button\n                data-testid={testIds.breakdowns.common.filterNumericPopover.cancelButton}\n                onClick={() => selectLabelActionScene.togglePopover()}\n                size={'sm'}\n                variant={'secondary'}\n                fill={'outline'}\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        </Stack>\n      </ClickOutsideWrapper>\n    );\n  };\n}\n\nexport function extractValueFromString(\n  inputString: string,\n  inputType: 'bytes' | 'duration'\n): { value: number; unit: byteUnitValues | durationUnitValues } | undefined {\n  if (inputType === 'duration') {\n    const durationValues = Object.values(durationUnitValues);\n\n    // Check the end of the filter value for a unit that exactly matches\n    const durationValue = durationValues.find((durationValue) => {\n      const durationValueLength = durationValue.length;\n      return inputString.slice(durationValueLength * -1) === durationValue;\n    });\n\n    if (durationValue) {\n      const value = Number(inputString.replace(durationValue, ''));\n      if (!isNaN(value)) {\n        return {\n          unit: durationValue,\n          value: value,\n        };\n      }\n    }\n  }\n\n  if (inputType === 'bytes') {\n    const bytesValues = Object.values(byteUnitValues)\n      // must be sorted from longest to shortest\n      .sort((a, b) => b.length - a.length);\n\n    // Check the end of the filter value for a unit that exactly matches\n    const bytesValue = bytesValues.find((bytesValue) => {\n      const byteValueLength = bytesValue.length;\n      return inputString.slice(byteValueLength * -1) === bytesValue;\n    });\n\n    if (bytesValue) {\n      const value = Number(inputString.replace(bytesValue, ''));\n      if (!isNaN(value)) {\n        return {\n          unit: bytesValue,\n          value: value,\n        };\n      }\n    }\n  }\n\n  return undefined;\n}\n\nfunction getUnitOptions(fieldType: 'duration' | 'bytes'): Array<SelectableValue<durationUnitValues | byteUnitValues>> {\n  if (fieldType === 'duration') {\n    const keys = Object.keys(durationUnitValues) as Array<keyof typeof durationUnitValues>;\n    return keys.map((key) => {\n      return {\n        text: key,\n        value: durationUnitValues[key],\n        label: key,\n      };\n    });\n  }\n\n  if (fieldType === 'bytes') {\n    const keys = Object.keys(byteUnitValues) as Array<keyof typeof byteUnitValues>;\n    return keys.map((key) => {\n      return {\n        text: key,\n        value: byteUnitValues[key],\n        label: key,\n      };\n    });\n  }\n\n  const error = new Error(`invalid field type: ${fieldType}`);\n  logger.error(error);\n  throw error;\n}\n\nconst getPopoverStyles = (theme: GrafanaTheme2) => ({\n  card: {\n    buttons: css({\n      display: 'flex',\n      flexWrap: 'wrap',\n      justifyContent: 'flex-end',\n      gap: theme.spacing(1.5),\n      marginTop: theme.spacing(1),\n    }),\n    inclusiveInput: css({\n      minWidth: '185px',\n    }),\n    selectInput: css({\n      minWidth: '65px',\n    }),\n    numberInput: css({\n      width: '75px',\n    }),\n    fieldWrap: css({\n      display: 'flex',\n      flexDirection: 'column',\n      paddingTop: theme.spacing(2),\n      paddingBottom: 0,\n    }),\n    field: css({\n      display: 'flex',\n      alignItems: 'center',\n      marginBottom: theme.spacing(1),\n    }),\n    inclusiveField: css({\n      marginRight: theme.spacing(1),\n    }),\n    unitFieldLabel: css({\n      marginLeft: theme.spacing(2),\n      marginRight: theme.spacing(1.5),\n    }),\n    numberFieldLabel: css({\n      width: '100px',\n    }),\n    switchFieldLabel: css({\n      marginLeft: theme.spacing(2),\n      marginRight: theme.spacing(1),\n    }),\n    fieldset: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      width: '100%',\n      marginBottom: 0,\n    }),\n    title: css({}),\n    body: css({\n      padding: theme.spacing(2),\n    }),\n    p: css({\n      maxWidth: 300,\n    }),\n  },\n});\n","import {\n  AdHocFiltersVariable,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanel,\n} from '@grafana/scenes';\nimport { getDetectedFieldsFrame, getLogsPanelFrame, ServiceScene } from '../ServiceScene';\nimport { navigateToValueBreakdown } from '../../../services/navigate';\nimport { getPrimaryLabelFromUrl, ValueSlugs } from '../../../services/routing';\nimport { Button, ButtonGroup, ButtonSelect, IconButton, Popover, PopoverController, useStyles2 } from '@grafana/ui';\nimport React, { useRef } from 'react';\nimport { addToFilters, clearFilters, VariableFilterType } from './AddToFiltersButton';\nimport { EMPTY_VARIABLE_VALUE, LEVEL_VARIABLE_VALUE, VAR_FIELDS } from '../../../services/variables';\nimport { AdHocVariableFilter, Field, GrafanaTheme2, Labels, LoadingState, SelectableValue } from '@grafana/data';\nimport {\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getValueFromAdHocVariableFilter,\n  getValueFromFieldsFilter,\n} from '../../../services/variableGetters';\nimport { FilterOp } from '../../../services/filterTypes';\nimport { LokiQuery } from '../../../services/lokiQuery';\nimport { css } from '@emotion/css';\nimport { rest } from 'lodash';\nimport { NumericFilterPopoverScene } from './NumericFilterPopoverScene';\nimport { getDetectedFieldType } from '../../../services/fields';\nimport { logger } from '../../../services/logger';\nimport { testIds } from '../../../services/testIds';\n\ninterface SelectLabelActionSceneState extends SceneObjectState {\n  labelName: string;\n  fieldType: ValueSlugs;\n  hideValueDrilldown?: boolean;\n  hasSparseFilters?: boolean;\n  hasNumericFilters?: boolean;\n  selectedValue?: SelectableValue<string>;\n  popover?: NumericFilterPopoverScene;\n  showPopover: boolean;\n}\n\nconst INCLUDE_VALUE = 'Include';\nconst EXCLUDE_VALUE = 'Exclude';\nconst NUMERIC_FILTER_VALUE = 'Add to filter';\n\nexport class SelectLabelActionScene extends SceneObjectBase<SelectLabelActionSceneState> {\n  constructor(state: Omit<SelectLabelActionSceneState, 'showPopover'>) {\n    super({ ...state, showPopover: false });\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onChange(value: SelectableValue<string>) {\n    const variable = this.getVariable();\n    const variableName = variable.state.name as VariableFilterType;\n    const existingFilter = this.getExistingFilter(variable);\n    const fieldValue = getValueFromAdHocVariableFilter(variable, existingFilter);\n    const isIncluded = existingFilter?.operator === FilterOp.NotEqual && fieldValue.value === EMPTY_VARIABLE_VALUE;\n\n    if (isIncluded && value.value === INCLUDE_VALUE) {\n      this.clearFilter(variableName);\n    } else if (value.value === INCLUDE_VALUE) {\n      this.onClickExcludeEmpty(variableName);\n    } else if (value.value === EXCLUDE_VALUE) {\n      this.onClickIncludeEmpty(variableName);\n    } else if (value.value === NUMERIC_FILTER_VALUE) {\n      this.onClickNumericFilter(variableName);\n    }\n\n    this.setState({\n      selectedValue: value,\n    });\n  }\n\n  public static Component = ({ model }: SceneComponentProps<SelectLabelActionScene>) => {\n    const {\n      hideValueDrilldown,\n      labelName,\n      hasSparseFilters,\n      hasNumericFilters,\n      selectedValue,\n      popover,\n      showPopover,\n      fieldType,\n    } = model.useState();\n    const variable = model.getVariable();\n    const variableName = variable.useState().name as VariableFilterType;\n    const existingFilter = model.getExistingFilter(variable);\n    const fieldValue = getValueFromAdHocVariableFilter(variable, existingFilter);\n    const styles = useStyles2(getStyles);\n    const popoverRef = useRef<HTMLButtonElement>(null);\n    const filterButtonDisabled =\n      fieldType === ValueSlugs.label &&\n      variable.state.filters.filter((f) => f.key !== labelName && f.operator === FilterOp.Equal).length === 0;\n\n    const isIncluded = existingFilter?.operator === FilterOp.NotEqual && fieldValue.value === EMPTY_VARIABLE_VALUE;\n    const hasOtherFilter = !!existingFilter;\n\n    const selectedOptionValue =\n      selectedValue?.value ?? (isIncluded ? INCLUDE_VALUE : hasNumericFilters ? NUMERIC_FILTER_VALUE : INCLUDE_VALUE);\n\n    const hasExistingNumericFilter = existingFilter?.operator\n      ? [FilterOp.gte, FilterOp.gt, FilterOp.lte, FilterOp.lt].includes(existingFilter.operator as FilterOp)\n      : false;\n    const numericSelected = selectedOptionValue === NUMERIC_FILTER_VALUE || hasExistingNumericFilter;\n    const includeSelected = selectedOptionValue === INCLUDE_VALUE && !numericSelected;\n\n    const sparseIncludeOption: SelectableValue<string> = {\n      value: INCLUDE_VALUE,\n      component: () => (\n        <SelectableValueComponent selected={includeSelected} text={`Include all log lines with ${labelName}`} />\n      ),\n    };\n    const sparseExcludeOption: SelectableValue<string> = {\n      value: EXCLUDE_VALUE,\n      component: () => <SelectableValueComponent selected={false} text={`Exclude all log lines with ${labelName}`} />,\n    };\n    const numericFilterOption: SelectableValue<string> = {\n      value: NUMERIC_FILTER_VALUE,\n      component: () => (\n        <SelectableValueComponent selected={numericSelected} text={`Add an expression, i.e. ${labelName} > 30`} />\n      ),\n    };\n\n    const options: Array<SelectableValue<string>> = [];\n    if (hasNumericFilters) {\n      options.push(numericFilterOption);\n    }\n\n    if (hasSparseFilters) {\n      if (!hasExistingNumericFilter) {\n        options.push(sparseIncludeOption);\n      }\n\n      options.push(sparseExcludeOption);\n    }\n\n    const defaultOption = isIncluded\n      ? sparseIncludeOption\n      : hasNumericFilters\n      ? numericFilterOption\n      : sparseIncludeOption;\n\n    return (\n      <>\n        {hasOtherFilter && (\n          <IconButton\n            disabled={filterButtonDisabled}\n            name={'filter'}\n            tooltip={`Clear ${labelName} filters`}\n            onClick={() => model.clearFilters(variableName)}\n          />\n        )}\n        {(hasNumericFilters || hasSparseFilters) && (\n          <>\n            <ButtonGroup data-testid={testIds.breakdowns.common.filterButtonGroup}>\n              <Button\n                data-testid={testIds.breakdowns.common.filterButton}\n                ref={popoverRef}\n                onClick={() => model.onChange(selectedValue ?? defaultOption)}\n                size={'sm'}\n                fill={'outline'}\n                variant={'secondary'}\n              >\n                {selectedValue?.value ?? defaultOption.value}\n              </Button>\n              <ButtonSelect\n                data-testid={testIds.breakdowns.common.filterSelect}\n                className={styles.buttonSelect}\n                variant={'default'}\n                options={options}\n                onChange={(value) => {\n                  model.onChange(value);\n                }}\n              />\n            </ButtonGroup>\n          </>\n        )}\n        {hideValueDrilldown !== true && (\n          <Button\n            title={`View breakdown of values for ${labelName}`}\n            variant=\"primary\"\n            fill=\"outline\"\n            size=\"sm\"\n            onClick={model.onClickViewValues}\n            aria-label={`Select ${labelName}`}\n          >\n            Select\n          </Button>\n        )}\n\n        {popover && (\n          <PopoverController content={<popover.Component model={popover} />}>\n            {(showPopper, hidePopper, popperProps) => {\n              const blurFocusProps = {\n                onBlur: hidePopper,\n                onFocus: showPopper,\n              };\n\n              return (\n                <>\n                  {popoverRef.current && (\n                    <>\n                      {/* @ts-expect-error @todo upgrade typescript */}\n                      <Popover\n                        {...popperProps}\n                        {...rest}\n                        show={showPopover}\n                        wrapperClassName={styles.popover}\n                        referenceElement={popoverRef.current}\n                        renderArrow={true}\n                        {...blurFocusProps}\n                      />\n                    </>\n                  )}\n                </>\n              );\n            }}\n          </PopoverController>\n        )}\n      </>\n    );\n  };\n\n  private getExistingFilter(variable?: AdHocFiltersVariable): AdHocVariableFilter | undefined {\n    let { labelName } = getPrimaryLabelFromUrl();\n    if (this.state.labelName !== labelName) {\n      return variable?.state.filters.find((filter) => {\n        return filter.key === this.state.labelName;\n      });\n    }\n\n    return undefined;\n  }\n\n  public onActivate() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n\n    if (serviceScene.state.$data?.state.data?.state === LoadingState.Done) {\n      this.calculateSparsity();\n    }\n\n    this._subs.add(\n      sceneGraph.getData(this).subscribeToState((newState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          if (serviceScene.state.$data?.state.data?.state === LoadingState.Done) {\n            this.calculateSparsity();\n          }\n\n          this._subs.add(\n            serviceScene.state.$data?.subscribeToState((newLogsPanelState) => {\n              if (newLogsPanelState.data?.state === LoadingState.Done) {\n                this.calculateSparsity();\n              }\n            })\n          );\n        }\n      })\n    );\n  }\n\n  public onClickNumericFilter = (variableType: VariableFilterType) => {\n    const detectedFieldFrame = getDetectedFieldsFrame(this);\n    const fieldType = getDetectedFieldType(this.state.labelName, detectedFieldFrame);\n\n    if (!fieldType || fieldType === 'string' || fieldType === 'boolean' || fieldType === 'int') {\n      const error = new Error(`Incorrect field type: ${fieldType}`);\n      logger.error(error);\n      throw error;\n    }\n\n    this.setState({\n      popover: new NumericFilterPopoverScene({ labelName: this.state.labelName, variableType, fieldType }),\n    });\n    this.togglePopover();\n  };\n\n  public onClickViewValues = () => {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    navigateToValueBreakdown(this.state.fieldType, this.state.labelName, serviceScene);\n  };\n\n  public onClickExcludeEmpty = (variableType: VariableFilterType) => {\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'exclude', this, variableType);\n  };\n\n  public onClickIncludeEmpty = (variableType: VariableFilterType) => {\n    // If json do we want != '{}'?\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'include', this, variableType);\n  };\n\n  public clearFilter = (variableType: VariableFilterType) => {\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'clear', this, variableType);\n  };\n\n  public clearFilters = (variableType: VariableFilterType) => {\n    clearFilters(this.state.labelName, this, variableType);\n  };\n\n  public togglePopover() {\n    this.setState({\n      showPopover: !this.state.showPopover,\n    });\n  }\n\n  private calculateSparsity() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const logsPanelData = getLogsPanelFrame(serviceScene.state.$data?.state.data);\n    const labels: Field<Labels> | undefined = logsPanelData?.fields.find((field) => field.name === 'labels');\n\n    const data = sceneGraph.getData(this);\n    const queryRunner = sceneGraph.findObject(data, (o) => o instanceof SceneQueryRunner) as SceneQueryRunner;\n    if (queryRunner) {\n      const queries = queryRunner.state.queries;\n      const query = queries[0] as LokiQuery | undefined;\n      if (query?.expr.includes('avg_over_time')) {\n        this.setState({\n          hasNumericFilters: true,\n        });\n      }\n    }\n\n    if (!labels || !logsPanelData) {\n      this.setState({\n        hasSparseFilters: false,\n      });\n      return;\n    }\n    const variable = this.getVariable();\n    // iterate through all the labels on the log panel query result and count how many times this exists\n    const logLinesWithLabelCount = labels.values.reduce((acc, labels) => {\n      if (labels?.[this.state.labelName]) {\n        acc++;\n      }\n      return acc;\n    }, 0);\n\n    const panel = sceneGraph.getAncestor(this, VizPanel);\n    if (logLinesWithLabelCount !== undefined && logsPanelData.length > 0) {\n      const percentage = ((logLinesWithLabelCount / logsPanelData.length) * 100).toLocaleString();\n      const description = `${this.state.labelName} exists on ${percentage}% of ${logsPanelData.length} sampled log lines`;\n\n      // Update the desc\n      panel.setState({\n        description,\n      });\n    } else {\n      panel.setState({\n        description: undefined,\n      });\n    }\n\n    // Only show for sparse fields and existing include and exclude filters, which will match an empty string in the value\n    const existingFilter = this.getExistingFilter(variable);\n    const existingFilterValue =\n      existingFilter && variable.state.name === VAR_FIELDS ? getValueFromFieldsFilter(existingFilter) : undefined;\n\n    if (logLinesWithLabelCount < logsPanelData.length || existingFilterValue?.value === EMPTY_VARIABLE_VALUE) {\n      this.setState({\n        hasSparseFilters: true,\n      });\n    } else {\n      this.setState({\n        hasSparseFilters: false,\n      });\n    }\n  }\n\n  private getVariable() {\n    if (this.state.fieldType === ValueSlugs.field) {\n      return getFieldsVariable(this);\n    } else if (this.state.labelName === LEVEL_VARIABLE_VALUE) {\n      return getLevelsVariable(this);\n    } else {\n      return getLabelsVariable(this);\n    }\n  }\n}\n\nfunction SelectableValueComponent(props: { text: string; selected: boolean }) {\n  const styles = useStyles2(getSelectableValueComponentStyles);\n  return (\n    <span className={styles.description}>\n      {props.selected && <span className={styles.selected}></span>}\n      {props.text}\n    </span>\n  );\n}\n\nconst getSelectableValueComponentStyles = (theme: GrafanaTheme2) => {\n  return {\n    selected: css({\n      label: 'selectable-value-selected',\n      '&:before': {\n        content: '\"\"',\n        position: 'absolute',\n        left: 0,\n        top: '4px',\n        height: 'calc(100% - 8px)',\n        width: '2px',\n        backgroundColor: theme.colors.warning.main,\n      },\n    }),\n    description: css({\n      textAlign: 'left',\n      fontSize: theme.typography.pxToRem(12),\n    }),\n  };\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    popover: css({\n      borderRadius: theme.shape.radius.default,\n      boxShadow: theme.shadows.z3,\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.weak}`,\n    }),\n    description: css({\n      textAlign: 'left',\n      fontSize: theme.typography.pxToRem(12),\n    }),\n    buttonSelect: css({\n      border: `1px solid ${theme.colors.border.strong}`,\n      borderLeft: 'none',\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n      padding: 1,\n      height: '24px',\n    }),\n  };\n};\n","import { Button, Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2, LoadingState, PanelData } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport {\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\n\nexport const MAX_NUMBER_OF_TIME_SERIES = 20;\n\nexport interface TimeSeriesLimitSeriesTitleItemSceneState extends SceneObjectState {\n  toggleShowAllSeries: (model: TimeSeriesLimitSeriesTitleItemScene) => void;\n  showAllSeries: boolean;\n  currentSeriesCount?: number;\n}\n\nexport class TimeSeriesLimitSeriesTitleItemScene extends SceneObjectBase<TimeSeriesLimitSeriesTitleItemSceneState> {\n  constructor(state: TimeSeriesLimitSeriesTitleItemSceneState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const panel = sceneGraph.getAncestor(this, VizPanel);\n    this._subs.add(\n      panel.subscribeToState((newState, prevState) => {\n        const $data = sceneGraph.getData(this);\n        if ($data.state.data?.state === LoadingState.Done) {\n          this.setState({\n            currentSeriesCount: $data.state.data?.series.length,\n          });\n        }\n      })\n    );\n  }\n  public static Component = ({ model }: SceneComponentProps<TimeSeriesLimitSeriesTitleItemScene>) => {\n    const { toggleShowAllSeries, showAllSeries, currentSeriesCount } = model.useState();\n    const $data = sceneGraph.getData(model);\n    const { data } = $data.useState();\n    const styles = useStyles2(getStyles);\n\n    if (\n      !($data instanceof SceneDataTransformer) ||\n      showAllSeries ||\n      data?.state !== LoadingState.Done ||\n      !currentSeriesCount ||\n      data.series.length < MAX_NUMBER_OF_TIME_SERIES\n    ) {\n      return null;\n    }\n\n    //@todo is there a better way to get the total number of series before transforming then accessing a private prop?\n    const prevData: PanelData | undefined = $data['_prevDataFromSource'];\n    const totalLength = prevData?.series.length;\n\n    return (\n      <div key=\"disclaimer\" className={styles.timeSeriesDisclaimer}>\n        <span className={styles.warningMessage}>\n          <>\n            <Icon\n              title={`Showing only ${MAX_NUMBER_OF_TIME_SERIES} series`}\n              name=\"exclamation-triangle\"\n              aria-hidden=\"true\"\n            />\n          </>\n        </span>\n        <Tooltip\n          content={\n            'Rendering too many series in a single panel may impact performance and make data harder to read. Consider adding more filters.'\n          }\n        >\n          <Button variant=\"secondary\" size=\"sm\" onClick={() => toggleShowAllSeries(model)}>\n            <>Show all {totalLength}</>\n          </Button>\n        </Tooltip>\n      </div>\n    );\n  };\n}\n\nexport function limitMaxNumberOfSeriesForPanel(child: SceneCSSGridItem) {\n  const panel = child.state.body as VizPanel | undefined;\n  const dataTransformer = child.state.body?.state.$data;\n  if (dataTransformer instanceof SceneDataTransformer) {\n    panel?.setState({\n      titleItems: [\n        new TimeSeriesLimitSeriesTitleItemScene({\n          showAllSeries: false,\n          toggleShowAllSeries: (timeSeriesLimiter) => {\n            dataTransformer.setState({\n              transformations: [],\n            });\n            timeSeriesLimiter.setState({\n              showAllSeries: true,\n            });\n            dataTransformer.reprocessTransformations();\n          },\n        }),\n      ],\n    });\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  timeSeriesDisclaimer: css({\n    label: 'time-series-disclaimer',\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(1),\n  }),\n  warningMessage: css({\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(0.5),\n    color: theme.colors.warning.main,\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import {\n  PanelBuilders,\n  QueryRunnerState,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { ALL_VARIABLE_VALUE, DetectedFieldType, ParserType } from '../../../services/variables';\nimport { buildDataQuery } from '../../../services/query';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { DrawStyle, LoadingPlaceholder, StackingMode } from '@grafana/ui';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS, FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport {\n  getDetectedFieldsFrame,\n  getDetectedFieldsFrameFromQueryRunnerState,\n  getDetectedFieldsNamesFromQueryRunnerState,\n  getDetectedFieldsParsersFromQueryRunnerState,\n  ServiceScene,\n} from '../ServiceScene';\nimport React from 'react';\nimport { SelectLabelActionScene } from './SelectLabelActionScene';\nimport { ValueSlugs } from '../../../services/routing';\nimport { DataFrame, LoadingState } from '@grafana/data';\nimport { limitMaxNumberOfSeriesForPanel, MAX_NUMBER_OF_TIME_SERIES } from './TimeSeriesLimitSeriesTitleItem';\nimport { map, Observable } from 'rxjs';\nimport {\n  buildFieldsQueryString,\n  extractParserFromArray,\n  getDetectedFieldType,\n  isAvgField,\n} from '../../../services/fields';\nimport {\n  getFieldGroupByVariable,\n  getFieldsVariable,\n  getValueFromFieldsFilter,\n} from '../../../services/variableGetters';\nimport { AddToExplorationButton } from './AddToExplorationButton';\nimport { logger } from '../../../services/logger';\n\nexport interface FieldsAggregatedBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher;\n}\n\nexport class FieldsAggregatedBreakdownScene extends SceneObjectBase<FieldsAggregatedBreakdownSceneState> {\n  constructor(state: Partial<FieldsAggregatedBreakdownSceneState>) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onDetectedFieldsChange = (newState: QueryRunnerState) => {\n    if (newState.data?.state === LoadingState.Done) {\n      //@todo cardinality looks wrong in API response\n      this.updateChildren(newState);\n    }\n  };\n\n  private updateChildren(newState: QueryRunnerState, newParser: ParserType | undefined = undefined) {\n    const detectedFieldsFrame = getDetectedFieldsFrameFromQueryRunnerState(newState);\n    const newNamesField = getDetectedFieldsNamesFromQueryRunnerState(newState);\n    const newParsersField = getDetectedFieldsParsersFromQueryRunnerState(newState);\n    const cardinalityMap = this.calculateCardinalityMap(newState);\n\n    // Iterate through all the layouts\n    this.state.body?.state.layouts.forEach((layout) => {\n      if (layout instanceof SceneCSSGridLayout) {\n        // populate set of new list of fields\n        const newFieldsSet = new Set<string>(newNamesField?.values);\n        const updatedChildren = layout.state.children as SceneCSSGridItem[];\n\n        // Iterate through all the existing panels\n        for (let i = 0; i < updatedChildren.length; i++) {\n          const gridItem = layout.state.children[i];\n          if (gridItem instanceof SceneCSSGridItem) {\n            const panel = gridItem.state.body;\n            if (panel instanceof VizPanel) {\n              if (newParser) {\n                const index = newNamesField?.values.indexOf(panel.state.title);\n                const existingParser = index && index !== -1 ? newParsersField?.values[index] : undefined;\n\n                // If a new field filter was added that updated the parsers, we'll need to rebuild the query\n                if (existingParser !== newParser) {\n                  const fieldType = getDetectedFieldType(panel.state.title, detectedFieldsFrame);\n                  const dataTransformer = this.getDataTransformerForPanel(\n                    panel.state.title,\n                    detectedFieldsFrame,\n                    fieldType\n                  );\n                  panel.setState({\n                    $data: dataTransformer,\n                  });\n                }\n              }\n\n              if (newFieldsSet.has(panel.state.title)) {\n                // If the new response has this field, delete it from the set, but leave it in the layout\n                newFieldsSet.delete(panel.state.title);\n              } else {\n                // Otherwise if the panel doesn't exist in the response, delete it from the layout\n                updatedChildren.splice(i, 1);\n                // And make sure to update the index, or we'll skip the next one\n                i--;\n              }\n            } else {\n              logger.warn('panel is not VizPanel!');\n            }\n          } else {\n            logger.warn('gridItem is not SceneCSSGridItem');\n          }\n        }\n\n        const fieldsToAdd = Array.from(newFieldsSet);\n        const options = fieldsToAdd.map((fieldName) => {\n          return {\n            label: fieldName,\n            value: fieldName,\n          };\n        });\n\n        updatedChildren.push(...this.buildChildren(options));\n        updatedChildren.sort(this.sortChildren(cardinalityMap));\n\n        updatedChildren.map((child) => {\n          limitMaxNumberOfSeriesForPanel(child);\n          this.subscribeToPanel(child);\n        });\n\n        layout.setState({\n          children: updatedChildren,\n        });\n      } else {\n        logger.warn('Layout is not SceneCSSGridLayout');\n      }\n    });\n  }\n\n  private sortChildren(cardinalityMap: Map<string, number>) {\n    return (a: SceneCSSGridItem, b: SceneCSSGridItem) => {\n      const aPanel = a.state.body as VizPanel;\n      const bPanel = b.state.body as VizPanel;\n      const aCardinality = cardinalityMap.get(aPanel.state.title) ?? 0;\n      const bCardinality = cardinalityMap.get(bPanel.state.title) ?? 0;\n      return bCardinality - aCardinality;\n    };\n  }\n\n  private calculateCardinalityMap(newState?: QueryRunnerState) {\n    const detectedFieldsFrame = getDetectedFieldsFrameFromQueryRunnerState(newState);\n    const cardinalityMap = new Map<string, number>();\n    if (detectedFieldsFrame?.length) {\n      for (let i = 0; i < detectedFieldsFrame?.length; i++) {\n        const name: string = detectedFieldsFrame.fields[0].values[i];\n        const cardinality: number = detectedFieldsFrame.fields[1].values[i];\n        cardinalityMap.set(name, cardinality);\n      }\n    }\n    return cardinalityMap;\n  }\n\n  onActivate() {\n    this.setState({\n      body: this.build(),\n    });\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    if (serviceScene.state.fieldsCount === undefined) {\n      this.updateFieldCount();\n    }\n\n    this._subs.add(serviceScene.state.$detectedFieldsData?.subscribeToState(this.onDetectedFieldsChange));\n    this._subs.add(this.subscribeToFieldsVar());\n  }\n\n  private subscribeToFieldsVar() {\n    const fieldsVar = getFieldsVariable(this);\n\n    return fieldsVar.subscribeToState((newState, prevState) => {\n      const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n      const newParsers = newState.filters.map((f) => getValueFromFieldsFilter(f).parser);\n      const oldParsers = prevState.filters.map((f) => getValueFromFieldsFilter(f).parser);\n\n      const newParser = extractParserFromArray(newParsers);\n      const oldParser = extractParserFromArray(oldParsers);\n\n      if (newParser !== oldParser) {\n        const detectedFieldsState = serviceScene.state.$detectedFieldsData?.state;\n        if (detectedFieldsState) {\n          this.updateChildren(detectedFieldsState, newParser);\n        }\n      }\n    });\n  }\n\n  private build() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const options = groupByVariable.state.options.map((opt) => ({ label: opt.label, value: String(opt.value) }));\n\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    fieldsBreakdownScene.state.search.reset();\n\n    const children = this.buildChildren(options);\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const cardinalityMap = this.calculateCardinalityMap(serviceScene.state.$detectedFieldsData?.state);\n    children.sort(this.sortChildren(cardinalityMap));\n    const childrenClones = children.map((child) => child.clone());\n\n    // We must subscribe to the data providers for all children after the clone, or we'll see bugs in the row layout\n    [...children, ...childrenClones].map((child) => {\n      limitMaxNumberOfSeriesForPanel(child);\n      this.subscribeToPanel(child);\n    });\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneCSSGridLayout({\n          templateColumns: FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n          autoRows: '200px',\n          children: children,\n          isLazy: true,\n        }),\n        new SceneCSSGridLayout({\n          templateColumns: '1fr',\n          autoRows: '200px',\n          children: childrenClones,\n          isLazy: true,\n        }),\n      ],\n    });\n  }\n\n  private subscribeToPanel(child: SceneCSSGridItem) {\n    const panel = child.state.body as VizPanel | undefined;\n    if (panel) {\n      this._subs.add(\n        panel?.state.$data?.getResultsStream().subscribe((result) => {\n          if (result.data.errors && result.data.errors.length > 0) {\n            child.setState({ isHidden: true });\n            this.updateFieldCount();\n          }\n        })\n      );\n    }\n  }\n\n  private buildChildren(options: Array<{ label: string; value: string }>): SceneCSSGridItem[] {\n    const children: SceneCSSGridItem[] = [];\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n\n    for (const option of options) {\n      const { value: optionValue } = option;\n      if (optionValue === ALL_VARIABLE_VALUE || !optionValue) {\n        continue;\n      }\n\n      const fieldType = getDetectedFieldType(optionValue, detectedFieldsFrame);\n      const dataTransformer = this.getDataTransformerForPanel(optionValue, detectedFieldsFrame, fieldType);\n      let body = PanelBuilders.timeseries().setTitle(optionValue).setData(dataTransformer);\n\n      const headerActions = [];\n      if (!isAvgField(fieldType)) {\n        body = body\n          .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n          .setCustomFieldConfig('fillOpacity', 100)\n          .setCustomFieldConfig('lineWidth', 0)\n          .setCustomFieldConfig('pointSize', 0)\n          .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n          .setOverrides(setLevelColorOverrides);\n        headerActions.push(new SelectLabelActionScene({ labelName: String(optionValue), fieldType: ValueSlugs.field }));\n      } else {\n        headerActions.push(\n          new SelectLabelActionScene({\n            labelName: String(optionValue),\n            hideValueDrilldown: true,\n            fieldType: ValueSlugs.field,\n          })\n        );\n      }\n      body.setHeaderActions([...headerActions, new AddToExplorationButton({ labelName: optionValue })]);\n\n      const viz = body.build();\n      const gridItem = new SceneCSSGridItem({\n        body: viz,\n      });\n\n      children.push(gridItem);\n    }\n    return children;\n  }\n\n  private getDataTransformerForPanel(\n    optionValue: string,\n    detectedFieldsFrame: DataFrame | undefined,\n    fieldType?: DetectedFieldType\n  ) {\n    const fieldsVariable = getFieldsVariable(this);\n    const queryString = buildFieldsQueryString(optionValue, fieldsVariable, detectedFieldsFrame);\n    const query = buildDataQuery(queryString, {\n      legendFormat: isAvgField(fieldType) ? optionValue : `{{${optionValue}}}`,\n      refId: optionValue,\n    });\n\n    const queryRunner = getQueryRunner([query]);\n\n    return new SceneDataTransformer({\n      $data: queryRunner,\n      transformations: [() => limitFramesTransformation(MAX_NUMBER_OF_TIME_SERIES)],\n    });\n  }\n\n  private updateFieldCount() {\n    const activeLayout = (this.state.body?.state.layouts.find((l) => l.isActive) ??\n      this.state.body?.state.layouts[0]) as SceneCSSGridLayout | undefined;\n    const activeLayoutChildren = activeLayout?.state.children as SceneCSSGridItem[] | undefined;\n    const activePanels = activeLayoutChildren?.filter((child) => !child.state.isHidden);\n\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    fieldsBreakdownScene.state.changeFieldCount?.(activePanels?.length ?? 0);\n  }\n\n  public static Selector({ model }: SceneComponentProps<FieldsAggregatedBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && <body.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<FieldsAggregatedBreakdownScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <>{body && <body.Component model={body} />}</>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n\nexport function limitFramesTransformation(limit: number) {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map((frames) => {\n        return frames.slice(0, limit);\n      })\n    );\n  };\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n} from '@grafana/scenes';\nimport { buildDataQuery } from '../../../services/query';\nimport { getSortByPreference } from '../../../services/store';\nimport { DataQueryError, LoadingState } from '@grafana/data';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { getQueryRunner } from '../../../services/panel';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { Alert, DrawStyle, LoadingPlaceholder } from '@grafana/ui';\nimport { buildFieldsQueryString, getFilterBreakdownValueScene, getParserForField } from '../../../services/fields';\nimport { getLabelValue } from './SortByScene';\nimport { VAR_FIELDS, VAR_METADATA } from '../../../services/variables';\nimport React from 'react';\nimport { FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS, FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport { AddFilterEvent } from './AddToFiltersButton';\nimport { navigateToDrilldownPage } from '../../../services/navigate';\nimport { PageSlugs } from '../../../services/routing';\nimport { getDetectedFieldsFrame, ServiceScene } from '../ServiceScene';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { getFieldGroupByVariable, getFieldsVariable } from '../../../services/variableGetters';\nimport { LokiQuery } from '../../../services/lokiQuery';\n\nexport interface FieldValuesBreakdownSceneState extends SceneObjectState {\n  body?: (LayoutSwitcher & SceneObject) | (SceneReactObject & SceneObject);\n  $data?: SceneDataProvider;\n  lastFilterEvent?: AddFilterEvent;\n}\n\nexport class FieldValuesBreakdownScene extends SceneObjectBase<FieldValuesBreakdownSceneState> {\n  constructor(state: Partial<FieldValuesBreakdownSceneState>) {\n    super(state);\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Selector({ model }: SceneComponentProps<FieldValuesBreakdownScene>) {\n    const { body } = model.useState();\n    if (body instanceof LayoutSwitcher) {\n      return <>{body && <body.Selector model={body} />}</>;\n    }\n\n    return <></>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<FieldValuesBreakdownScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <>{body && <body.Component model={body} />}</>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n\n  onActivate() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const tagKey = String(groupByVariable.state.value);\n\n    const fieldsVariable = getFieldsVariable(this);\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    const queryString = buildFieldsQueryString(tagKey, fieldsVariable, detectedFieldsFrame);\n    const query = buildDataQuery(queryString, { legendFormat: `{{${tagKey}}}`, refId: tagKey });\n\n    this.setState({\n      body: this.build(query),\n      $data: getQueryRunner([query]),\n    });\n\n    this._subs.add(\n      this.subscribeToEvent(AddFilterEvent, (event) => {\n        this.setState({\n          lastFilterEvent: event,\n        });\n      })\n    );\n\n    this._subs.add(\n      this.state.$data?.subscribeToState((newState) => {\n        this.onValuesDataQueryChange(newState, query);\n      })\n    );\n  }\n\n  private onValuesDataQueryChange(newState: SceneDataState, query: LokiQuery) {\n    if (newState.data?.state === LoadingState.Done) {\n      // No panels for the user to select, presumably because everything has been excluded\n      const event = this.state.lastFilterEvent;\n\n      // @todo discuss: Do we want to let users exclude all fields? Or should we redirect when excluding the penultimate panel?\n      if (newState.data?.state === LoadingState.Done && event) {\n        if (event.operator === 'exclude' && newState.data.series.length < 1) {\n          this.navigateToFields();\n        }\n\n        // @todo discuss: wouldn't include always return in 1 result? Do we need to wait for the query to run or should we navigate on receiving the include event and cancel the ongoing query?\n        if (event.operator === 'include' && newState.data.series.length <= 1) {\n          this.navigateToFields();\n        }\n      }\n\n      if (this.state.body instanceof SceneReactObject) {\n        this.setState({\n          body: this.build(query),\n        });\n      }\n    }\n    if (newState.data?.state === LoadingState.Error) {\n      this.setErrorState(newState.data.errors);\n    }\n  }\n\n  private setErrorState(errors: DataQueryError[] | undefined) {\n    this.setState({\n      body: new SceneReactObject({\n        reactNode: (\n          <Alert title={'Something went wrong with your request'} severity={'error'}>\n            {errors?.map((err, key) => (\n              <div key={key}>\n                {err.status && (\n                  <>\n                    <strong>Status</strong>: {err.status} <br />\n                  </>\n                )}\n                {err.message && (\n                  <>\n                    <strong>Message</strong>: {err.message} <br />\n                  </>\n                )}\n                {err.traceId && (\n                  <>\n                    <strong>TraceId</strong>: {err.traceId}\n                  </>\n                )}\n              </div>\n            ))}\n          </Alert>\n        ),\n      }),\n    });\n  }\n\n  private navigateToFields() {\n    this.setState({\n      lastFilterEvent: undefined,\n    });\n    navigateToDrilldownPage(PageSlugs.fields, sceneGraph.getAncestor(this, ServiceScene));\n  }\n\n  private build(query: LokiQuery) {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const optionValue = String(groupByVariable.state.value);\n\n    const { sortBy, direction } = getSortByPreference('fields', DEFAULT_SORT_BY, 'desc');\n\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    const getFilter = () => fieldsBreakdownScene.state.search.state.filter ?? '';\n\n    const parserForThisField = getParserForField(optionValue, this);\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'single', label: 'Single' },\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneFlexItem({\n              minHeight: 300,\n              body: PanelBuilders.timeseries().setTitle(optionValue).build(),\n            }),\n          ],\n        }),\n        new ByFrameRepeater({\n          body: new SceneCSSGridLayout({\n            templateColumns: FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n            autoRows: '200px',\n            children: [\n              new SceneFlexItem({\n                body: new SceneReactObject({\n                  reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                }),\n              }),\n            ],\n            isLazy: true,\n          }),\n          getLayoutChild: getFilterBreakdownValueScene(\n            getLabelValue,\n            query?.expr.includes('count_over_time') ? DrawStyle.Bars : DrawStyle.Line,\n            parserForThisField === 'structuredMetadata' ? VAR_METADATA : VAR_FIELDS,\n            sceneGraph.getAncestor(this, FieldsBreakdownScene).state.sort,\n            optionValue\n          ),\n          sortBy,\n          direction,\n          getFilter,\n        }),\n        new ByFrameRepeater({\n          body: new SceneCSSGridLayout({\n            templateColumns: '1fr',\n            autoRows: '200px',\n            children: [\n              new SceneFlexItem({\n                body: new SceneReactObject({\n                  reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                }),\n              }),\n            ],\n            isLazy: true,\n          }),\n          getLayoutChild: getFilterBreakdownValueScene(\n            getLabelValue,\n            query?.expr.includes('count_over_time') ? DrawStyle.Bars : DrawStyle.Line,\n            parserForThisField === 'structuredMetadata' ? VAR_METADATA : VAR_FIELDS,\n            sceneGraph.getAncestor(this, FieldsBreakdownScene).state.sort,\n            optionValue\n          ),\n          sortBy,\n          direction,\n          getFilter,\n        }),\n      ],\n    });\n  }\n}\n","import { css } from '@emotion/css';\nimport React, { ReactNode } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { LoadingPlaceholder, useStyles2 } from '@grafana/ui';\n\ntype Props = {\n  blockingMessage?: string;\n  isLoading?: boolean;\n  children?: ReactNode;\n};\n\nexport function StatusWrapper({ blockingMessage, isLoading, children }: Props) {\n  const styles = useStyles2(getStyles);\n\n  if (isLoading && !blockingMessage) {\n    blockingMessage = 'Loading...';\n  }\n\n  if (isLoading) {\n    return <LoadingPlaceholder className={styles.statusMessage} text={blockingMessage} />;\n  }\n\n  if (!blockingMessage) {\n    return <>{children}</>;\n  }\n\n  return <div className={styles.statusMessage}>{blockingMessage}</div>;\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    statusMessage: css({\n      fontStyle: 'italic',\n      marginTop: theme.spacing(7),\n      textAlign: 'center',\n    }),\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { GrotError } from '../../GrotError';\nimport { Alert } from '@grafana/ui';\nimport React from 'react';\nimport { emptyStateStyles } from './FieldsBreakdownScene';\n\nexport interface EmptyLayoutSceneState extends SceneObjectState {\n  type: 'fields' | 'labels';\n}\n\nexport class EmptyLayoutScene extends SceneObjectBase<EmptyLayoutSceneState> {\n  public static Component({ model }: SceneComponentProps<EmptyLayoutScene>) {\n    const { type } = model.useState();\n    return (\n      <GrotError>\n        <Alert title=\"\" severity=\"warning\">\n          We did not find any {type} for the given timerange. Please{' '}\n          <a\n            className={emptyStateStyles.link}\n            href=\"https://forms.gle/1sYWCTPvD72T1dPH9\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            let us know\n          </a>{' '}\n          if you think this is a mistake.\n        </Alert>\n      </GrotError>\n    );\n  }\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { DataFrame, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  QueryRunnerState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n  SceneVariable,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  VariableValueOption,\n} from '@grafana/scenes';\nimport { Alert, Button, useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getSortByPreference } from 'services/store';\nimport { ALL_VARIABLE_VALUE, SERVICE_NAME, SERVICE_UI_LABEL, VAR_FIELD_GROUP_BY, VAR_LABELS } from 'services/variables';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { CustomConstantVariable, CustomConstantVariableState } from '../../../services/CustomConstantVariable';\nimport { navigateToValueBreakdown } from '../../../services/navigate';\nimport { checkPrimaryLabel, getPrimaryLabelFromUrl, ValueSlugs } from '../../../services/routing';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { GrotError } from '../../GrotError';\nimport { IndexScene } from '../../IndexScene/IndexScene';\nimport { getDetectedFieldsFrame, ServiceScene } from '../ServiceScene';\nimport { BreakdownSearchReset, BreakdownSearchScene } from './BreakdownSearchScene';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { FieldsAggregatedBreakdownScene } from './FieldsAggregatedBreakdownScene';\nimport { FieldSelector } from './FieldSelector';\nimport { FieldValuesBreakdownScene } from './FieldValuesBreakdownScene';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { SortByScene, SortCriteriaChanged } from './SortByScene';\nimport { StatusWrapper } from './StatusWrapper';\nimport { getFieldOptions } from 'services/filters';\nimport { EmptyLayoutScene } from './EmptyLayoutScene';\nimport { getFieldGroupByVariable, getLabelsVariable } from '../../../services/variableGetters';\n\nexport const averageFields = ['duration', 'count', 'total', 'bytes'];\nexport const FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\n\nexport interface FieldsBreakdownSceneState extends SceneObjectState {\n  body?:\n    | (SceneReactObject & SceneObject)\n    | (FieldsAggregatedBreakdownScene & SceneObject)\n    | (FieldValuesBreakdownScene & SceneObject)\n    | (EmptyLayoutScene & SceneObject);\n  search: BreakdownSearchScene;\n  sort: SortByScene;\n  value?: string;\n  loading?: boolean;\n  error?: string;\n  blockingMessage?: string;\n  changeFieldCount?: (n: number) => void;\n}\n\nexport class FieldsBreakdownScene extends SceneObjectBase<FieldsBreakdownSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LABELS],\n  });\n\n  constructor(state: Partial<FieldsBreakdownSceneState> & { options?: VariableValueOption[]; value?: string }) {\n    super({\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [\n            new CustomConstantVariable({\n              name: VAR_FIELD_GROUP_BY,\n              defaultToAll: false,\n              includeAll: true,\n              value: state.value ?? ALL_VARIABLE_VALUE,\n              options: state.options ?? [],\n            }),\n          ],\n        }),\n      loading: true,\n      sort: new SortByScene({ target: 'fields' }),\n      search: new BreakdownSearchScene('fields'),\n      value: state.value ?? ALL_VARIABLE_VALUE,\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n\n    this.setState({\n      loading: serviceScene.state.$detectedLabelsData?.state.data?.state !== LoadingState.Done,\n    });\n\n    // Subscriptions\n    this._subs.add(\n      this.subscribeToEvent(BreakdownSearchReset, () => {\n        this.state.search.clearValueFilter();\n      })\n    );\n    this._subs.add(this.subscribeToEvent(SortCriteriaChanged, this.handleSortByChange));\n    this._subs.add(groupByVariable.subscribeToState(this.variableChanged));\n\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState((newState, prevState) => {\n        const variable = getFieldGroupByVariable(this);\n        let { labelName } = getPrimaryLabelFromUrl();\n\n        const newService = newState.filters.find((filter) => filter.key === labelName);\n        const prevService = prevState.filters.find((filter) => filter.key === labelName);\n\n        // If the user changes the primary label\n        if (variable.state.value === ALL_VARIABLE_VALUE && newService !== prevService) {\n          this.setState({\n            loading: true,\n            body: undefined,\n          });\n        }\n      })\n    );\n\n    this._subs.add(\n      serviceScene.state.$detectedFieldsData?.subscribeToState(\n        (newState: QueryRunnerState, oldState: QueryRunnerState) => {\n          if (newState.data?.state === LoadingState.Done) {\n            if (newState.data.series?.[0]) {\n              this.updateOptions(newState.data.series?.[0]);\n            }\n          }\n        }\n      )\n    );\n\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    // Need to update labels with current state\n    if (detectedFieldsFrame) {\n      this.updateOptions(detectedFieldsFrame);\n    }\n\n    checkPrimaryLabel(this);\n  }\n\n  private variableChanged = (newState: CustomConstantVariableState, oldState: CustomConstantVariableState) => {\n    if (\n      newState.value !== oldState.value ||\n      !areArraysEqual(newState.options, oldState.options) ||\n      this.state.body === undefined ||\n      this.state.body instanceof EmptyLayoutScene ||\n      this.state.body instanceof SceneReactObject\n    ) {\n      this.updateBody(newState);\n    }\n  };\n\n  private updateOptions(dataFrame: DataFrame) {\n    if (!dataFrame || !dataFrame.length) {\n      const indexScene = sceneGraph.getAncestor(this, IndexScene);\n      const variablesToClear = this.getVariablesThatCanBeCleared(indexScene);\n\n      let body;\n      if (variablesToClear.length > 1) {\n        this.state.changeFieldCount?.(0);\n        body = this.buildClearFiltersLayout(() => this.clearVariables(variablesToClear));\n      } else {\n        body = new EmptyLayoutScene({ type: 'fields' });\n      }\n      this.setState({\n        loading: false,\n        body,\n      });\n      return;\n    }\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const variable = getFieldGroupByVariable(this);\n    variable.setState({\n      options: getFieldOptions(dataFrame.fields[0].values.map((v) => String(v))),\n      loading: false,\n      value: serviceScene.state.drillDownLabel ?? ALL_VARIABLE_VALUE,\n    });\n    this.setState({\n      loading: false,\n    });\n  }\n\n  private handleSortByChange = (event: SortCriteriaChanged) => {\n    if (event.target !== 'fields') {\n      return;\n    }\n    if (this.state.body instanceof FieldValuesBreakdownScene && this.state.body.state.body instanceof LayoutSwitcher) {\n      this.state.body.state.body?.state.layouts.forEach((layout) => {\n        if (layout instanceof ByFrameRepeater) {\n          layout.sort(event.sortBy, event.direction);\n        }\n      });\n    }\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.value_breakdown_sort_change,\n      {\n        target: 'fields',\n        criteria: event.sortBy,\n        direction: event.direction,\n      }\n    );\n  };\n\n  private updateBody(newState: CustomConstantVariableState) {\n    const fieldsVariable = getFieldGroupByVariable(this);\n\n    // We get the labels from the service scene, if we don't have them yet, assume we're loading\n    if (!fieldsVariable.state.options || !fieldsVariable.state.options.length) {\n      return;\n    }\n\n    const stateUpdate: Partial<FieldsBreakdownSceneState> = {};\n\n    if (fieldsVariable.state.options && fieldsVariable.state.options.length <= 1) {\n      // If there's 1 or fewer fields build the empty or clear layout UI\n      const indexScene = sceneGraph.getAncestor(this, IndexScene);\n      const variablesToClear = this.getVariablesThatCanBeCleared(indexScene);\n\n      if (variablesToClear.length > 1) {\n        this.state.changeFieldCount?.(0);\n        stateUpdate.body = this.buildClearFiltersLayout(() => this.clearVariables(variablesToClear));\n      } else {\n        stateUpdate.body = new EmptyLayoutScene({ type: 'fields' });\n      }\n    } else {\n      // Otherwise update the body, but don't re-instantiate if it's already the right class\n      if (newState.value === ALL_VARIABLE_VALUE && this.state.body instanceof FieldValuesBreakdownScene) {\n        stateUpdate.body = new FieldsAggregatedBreakdownScene({});\n      } else if (newState.value !== ALL_VARIABLE_VALUE && this.state.body instanceof FieldsAggregatedBreakdownScene) {\n        stateUpdate.body = new FieldValuesBreakdownScene({});\n      } else if (\n        // If the body hasn't been created, or the no-data views are active, we want to replace and render the correct scene\n        this.state.body === undefined ||\n        this.state.body instanceof EmptyLayoutScene ||\n        this.state.body instanceof SceneReactObject\n      ) {\n        stateUpdate.body =\n          newState.value === ALL_VARIABLE_VALUE\n            ? new FieldsAggregatedBreakdownScene({})\n            : new FieldValuesBreakdownScene({});\n      }\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  private getVariablesThatCanBeCleared(indexScene: IndexScene) {\n    const variables = sceneGraph.getVariables(indexScene);\n    let variablesToClear: SceneVariable[] = [];\n\n    for (const variable of variables.state.variables) {\n      if (variable instanceof AdHocFiltersVariable && variable.state.filters.length) {\n        variablesToClear.push(variable);\n      }\n      if (variable instanceof CustomConstantVariable && variable.state.value && variable.state.name !== 'logsFormat') {\n        variablesToClear.push(variable);\n      }\n    }\n    return variablesToClear;\n  }\n\n  private clearVariables = (variablesToClear: SceneVariable[]) => {\n    // clear patterns: needs to happen first, or it won't work as patterns is split into a variable and a state, and updating the variable triggers a state update\n    const indexScene = sceneGraph.getAncestor(this, IndexScene);\n    indexScene.setState({\n      patterns: [],\n    });\n\n    variablesToClear.forEach((variable) => {\n      if (variable instanceof AdHocFiltersVariable && variable.state.key === 'adhoc_service_filter') {\n        let { labelName } = getPrimaryLabelFromUrl();\n        // getPrimaryLabelFromUrl returns the label name that exists in the URL, which is \"service\" not \"service_name\"\n        if (labelName === SERVICE_UI_LABEL) {\n          labelName = SERVICE_NAME;\n        }\n        variable.setState({\n          filters: variable.state.filters.filter((filter) => filter.key === labelName),\n        });\n      } else if (variable instanceof AdHocFiltersVariable) {\n        variable.setState({\n          filters: [],\n        });\n      } else if (variable instanceof CustomConstantVariable) {\n        variable.setState({\n          value: '',\n          text: '',\n        });\n      }\n    });\n  };\n\n  private buildClearFiltersLayout(clearCallback: () => void) {\n    return new SceneReactObject({\n      reactNode: (\n        <GrotError>\n          <Alert title=\"\" severity=\"info\">\n            No labels match these filters.{' '}\n            <Button className={emptyStateStyles.button} onClick={() => clearCallback()}>\n              Clear filters\n            </Button>{' '}\n          </Alert>\n        </GrotError>\n      ),\n    });\n  }\n\n  public onFieldSelectorChange = (value?: string) => {\n    if (!value) {\n      return;\n    }\n\n    const variable = getFieldGroupByVariable(this);\n    const { sortBy, direction } = getSortByPreference('fields', DEFAULT_SORT_BY, 'desc');\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.select_field_in_breakdown_clicked,\n      {\n        field: value,\n        previousField: variable.getValueText(),\n        view: 'fields',\n        sortBy,\n        sortByDirection: direction,\n      }\n    );\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    navigateToValueBreakdown(ValueSlugs.field, value, serviceScene);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<FieldsBreakdownScene>) => {\n    const { body, loading, blockingMessage, search, sort } = model.useState();\n    const variable = getFieldGroupByVariable(model);\n    const { options, value } = variable.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          <div className={styles.controls}>\n            {body instanceof FieldsAggregatedBreakdownScene && <FieldsAggregatedBreakdownScene.Selector model={body} />}\n            {body instanceof FieldValuesBreakdownScene && <FieldValuesBreakdownScene.Selector model={body} />}\n            {!loading && value !== ALL_VARIABLE_VALUE && (\n              <>\n                <sort.Component model={sort} />\n                <search.Component model={search} />\n              </>\n            )}\n            {!loading && options.length > 1 && (\n              <FieldSelector\n                label=\"Field\"\n                options={options}\n                value={String(value)}\n                onChange={model.onFieldSelectorChange}\n              />\n            )}\n          </div>\n\n          <div className={styles.content}>{body && <body.Component model={body} />}</div>\n        </StatusWrapper>\n      </div>\n    );\n  };\n}\n\nexport const emptyStateStyles = {\n  link: css({\n    textDecoration: 'underline',\n  }),\n  button: css({\n    marginLeft: '1.5rem',\n  }),\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      justifyContent: 'space-between',\n      flexDirection: 'row-reverse',\n      gap: theme.spacing(2),\n    }),\n  };\n}\n","import { SceneFlexItem, SceneFlexLayout, SceneObject } from '@grafana/scenes';\nimport { LEVEL_VARIABLE_VALUE } from './variables';\nimport { getParserFromFieldsFilters } from './fields';\nimport { buildDataQuery } from './query';\nimport { LabelBreakdownScene } from '../Components/ServiceScene/Breakdowns/LabelBreakdownScene';\nimport { getFieldsVariable, getLogsStreamSelector } from './variableGetters';\n\nexport const LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\n\nexport function buildLabelValuesBreakdownActionScene(value: string) {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new LabelBreakdownScene({ value }),\n      }),\n    ],\n  });\n}\n\nexport function buildLabelsQuery(sceneRef: SceneObject, optionValue: string, optionName: string) {\n  let labelExpressionToAdd = '';\n  let structuredMetadataToAdd = '';\n\n  const fields = getFieldsVariable(sceneRef);\n  const parser = getParserFromFieldsFilters(fields);\n\n  if (optionName && optionName !== LEVEL_VARIABLE_VALUE) {\n    labelExpressionToAdd = ` ,${optionName} != \"\"`;\n  } else if (optionName && optionName === LEVEL_VARIABLE_VALUE) {\n    structuredMetadataToAdd = ` | ${optionName} != \"\"`;\n  }\n\n  return buildDataQuery(\n    `sum(count_over_time(${getLogsStreamSelector({\n      labelExpressionToAdd,\n      structuredMetadataToAdd,\n      parser,\n    })} [$__auto])) by (${optionValue})`,\n    { legendFormat: `{{${optionValue}}}`, refId: 'LABEL_BREAKDOWN_VALUES' }\n  );\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n} from '@grafana/scenes';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { getLabelValue } from './SortByScene';\nimport { Alert, DrawStyle, LoadingPlaceholder, StackingMode } from '@grafana/ui';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { getSortByPreference } from '../../../services/store';\nimport { AppEvents, DataQueryError, LoadingState } from '@grafana/data';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { getFilterBreakdownValueScene } from '../../../services/fields';\nimport { ALL_VARIABLE_VALUE, VAR_LABEL_GROUP_BY_EXPR, VAR_LABELS } from '../../../services/variables';\nimport React from 'react';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { navigateToDrilldownPage } from '../../../services/navigate';\nimport { PageSlugs } from '../../../services/routing';\nimport { ServiceScene } from '../ServiceScene';\nimport { AddFilterEvent } from './AddToFiltersButton';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { buildLabelsQuery, LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS } from '../../../services/labels';\nimport { getAppEvents } from '@grafana/runtime';\nimport { getLabelGroupByVariable } from '../../../services/variableGetters';\n\ntype DisplayError = DataQueryError & { displayed: boolean };\ntype DisplayErrors = Record<string, DisplayError>;\n\nexport interface LabelValueBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher & SceneObject;\n  $data?: SceneDataProvider;\n  lastFilterEvent?: AddFilterEvent;\n  errors: DisplayErrors;\n}\n\nexport class LabelValuesBreakdownScene extends SceneObjectBase<LabelValueBreakdownSceneState> {\n  constructor(state: Partial<LabelValueBreakdownSceneState>) {\n    super({\n      ...state,\n      errors: {},\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({\n      $data: getQueryRunner([\n        buildLabelsQuery(this, VAR_LABEL_GROUP_BY_EXPR, String(getLabelGroupByVariable(this).state.value)),\n      ]),\n      body: this.build(),\n    });\n    const groupByVariable = getLabelGroupByVariable(this);\n    this._subs.add(\n      groupByVariable.subscribeToState((newState) => {\n        if (newState.value === ALL_VARIABLE_VALUE) {\n          this.setState({\n            $data: undefined,\n            body: undefined,\n          });\n        }\n      })\n    );\n\n    this.subscribeToEvent(AddFilterEvent, (event) => {\n      this.setState({\n        lastFilterEvent: event,\n      });\n    });\n\n    this._subs.add(\n      this.state.$data?.subscribeToState((newState, prevState) => {\n        this.onValuesDataQueryChange(newState, prevState);\n      })\n    );\n  }\n\n  private onValuesDataQueryChange(newState: SceneDataState, prevState: SceneDataState) {\n    if (newState?.data?.errors && newState.data?.state !== LoadingState.Done) {\n      const errors: DisplayErrors = this.state.errors;\n      newState?.data?.errors.forEach((err) => {\n        const errorIndex = `${err.status}_${err.traceId}_${err.message}`;\n        if (errors[errorIndex] === undefined) {\n          errors[errorIndex] = { ...err, displayed: false };\n        }\n      });\n      this.setState({\n        errors,\n      });\n\n      this.showErrorToast(this.state.errors);\n    }\n\n    if (newState.data?.state === LoadingState.Done || newState.data?.state === LoadingState.Streaming) {\n      // No panels for the user to select, presumably because everything has been excluded\n      const event = this.state.lastFilterEvent;\n\n      // @todo discuss: Do we want to let users exclude all labels? Or should we redirect when excluding the penultimate panel?\n      if (event) {\n        if (event.operator === 'exclude' && newState.data.series.length < 1) {\n          this.navigateToLabels();\n        }\n\n        // @todo discuss: wouldn't include always return in 1 result? Do we need to wait for the query to run or should we navigate on receiving the include event and cancel the ongoing query?\n        if (event.operator === 'include' && newState.data.series.length <= 1) {\n          this.navigateToLabels();\n        }\n      }\n    }\n\n    // If we're in an error state\n    if (newState.data?.state === LoadingState.Error && this.activeLayoutContainsNoPanels()) {\n      const activeLayout = this.getActiveLayout();\n      // And the active layout is grid or rows, and doesn't have any panels\n      if (activeLayout instanceof ByFrameRepeater) {\n        const errorState = this.getErrorStateAlert(newState.data.errors);\n        // Replace the loading or error state with new error\n        activeLayout.state.body.setState({\n          children: [errorState],\n        });\n      }\n    }\n  }\n\n  private getActiveLayout(): ByFrameRepeater | SceneFlexLayout | undefined {\n    const layoutSwitcher = this.state.body;\n    const activeLayout = layoutSwitcher?.state.layouts.find((layout) => layout.isActive);\n    if (activeLayout instanceof ByFrameRepeater || activeLayout instanceof SceneFlexLayout) {\n      return activeLayout;\n    }\n    return undefined;\n  }\n\n  private activeLayoutContainsNoPanels(): boolean {\n    const activeLayout = this.getActiveLayout();\n\n    if (activeLayout instanceof ByFrameRepeater) {\n      const child = activeLayout.state.body.state.children[0];\n      if (child instanceof SceneFlexItem || child instanceof SceneReactObject) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  private getErrorStateAlert(errors: DataQueryError[] | undefined) {\n    return new SceneReactObject({\n      reactNode: (\n        <Alert title={'Something went wrong with your request'} severity={'error'}>\n          {errors?.map((err, key) => this.renderError(key, err))}\n        </Alert>\n      ),\n    });\n  }\n\n  private navigateToLabels() {\n    this.setState({\n      lastFilterEvent: undefined,\n    });\n    navigateToDrilldownPage(PageSlugs.labels, sceneGraph.getAncestor(this, ServiceScene));\n  }\n\n  private build(): LayoutSwitcher {\n    const variable = getLabelGroupByVariable(this);\n    const variableState = variable.state;\n    const labelBreakdownScene = sceneGraph.getAncestor(this, LabelBreakdownScene);\n    const tagKey = String(variableState?.value);\n\n    let bodyOpts = PanelBuilders.timeseries();\n    bodyOpts = bodyOpts\n      .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n      .setCustomFieldConfig('fillOpacity', 100)\n      .setCustomFieldConfig('lineWidth', 0)\n      .setCustomFieldConfig('pointSize', 0)\n      .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n      .setOverrides(setLevelColorOverrides)\n      .setTitle(tagKey);\n\n    const body = bodyOpts.build();\n    const { sortBy, direction } = getSortByPreference('labels', DEFAULT_SORT_BY, 'desc');\n\n    const getFilter = () => labelBreakdownScene.state.search.state.filter ?? '';\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'single', label: 'Single' },\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneFlexItem({\n              minHeight: 300,\n              body,\n            }),\n          ],\n        }),\n        new ByFrameRepeater({\n          body: new SceneCSSGridLayout({\n            isLazy: true,\n            templateColumns: LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n            autoRows: '200px',\n            children: [\n              new SceneFlexItem({\n                body: new SceneReactObject({\n                  reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                }),\n              }),\n            ],\n          }),\n          getLayoutChild: getFilterBreakdownValueScene(\n            getLabelValue,\n            DrawStyle.Bars,\n            VAR_LABELS,\n            sceneGraph.getAncestor(this, LabelBreakdownScene).state.sort,\n            tagKey\n          ),\n          sortBy,\n          direction,\n          getFilter,\n        }),\n        new ByFrameRepeater({\n          body: new SceneCSSGridLayout({\n            templateColumns: '1fr',\n            autoRows: '200px',\n            children: [\n              new SceneFlexItem({\n                body: new SceneReactObject({\n                  reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                }),\n              }),\n            ],\n          }),\n          getLayoutChild: getFilterBreakdownValueScene(\n            getLabelValue,\n            DrawStyle.Bars,\n            VAR_LABELS,\n            sceneGraph.getAncestor(this, LabelBreakdownScene).state.sort,\n            tagKey\n          ),\n          sortBy,\n          direction,\n          getFilter,\n        }),\n      ],\n    });\n  }\n\n  private showErrorToast(errors: DisplayErrors) {\n    const appEvents = getAppEvents();\n\n    // Make sure we only display each error once\n    let errorArray: DisplayError[] = [];\n    for (const err in errors) {\n      const displayError = errors[err];\n      if (!displayError.displayed) {\n        errorArray.push(displayError);\n        displayError.displayed = true;\n      }\n    }\n\n    if (errorArray.length) {\n      // If we don't have any panels the error message will replace the loading state, we want to set it as displayed but not render the toast\n      if (!this.activeLayoutContainsNoPanels()) {\n        appEvents.publish({\n          type: AppEvents.alertError.name,\n          payload: errorArray?.map((err, key) => this.renderError(key, err)),\n        });\n      }\n      this.setState({\n        errors,\n      });\n    }\n  }\n\n  private renderError(key: number, err: DataQueryError) {\n    return (\n      <div key={key}>\n        {err.status && (\n          <>\n            <strong>Status</strong>: {err.status} <br />\n          </>\n        )}\n        {err.message && (\n          <>\n            <strong>Message</strong>: {err.message} <br />\n          </>\n        )}\n        {err.traceId && (\n          <>\n            <strong>TraceId</strong>: {err.traceId}\n          </>\n        )}\n      </div>\n    );\n  }\n\n  public static Selector({ model }: SceneComponentProps<LabelValuesBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && body instanceof LayoutSwitcher && <body.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LabelValuesBreakdownScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <>{body && <body.Component model={body} />}</>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React, { ChangeEvent } from 'react';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { SearchInput } from './SearchInput';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport { BusEventBase } from '@grafana/data';\nimport { LabelValuesBreakdownScene } from './LabelValuesBreakdownScene';\nimport { FieldValuesBreakdownScene } from './FieldValuesBreakdownScene';\nimport { logger } from '../../../services/logger';\n\nexport class BreakdownSearchReset extends BusEventBase {\n  public static type = 'breakdown-search-reset';\n}\n\nexport interface BreakdownSearchSceneState extends SceneObjectState {\n  filter?: string;\n}\n\nconst recentFilters: Record<string, string> = {};\n\nexport class BreakdownSearchScene extends SceneObjectBase<BreakdownSearchSceneState> {\n  private cacheKey: string;\n  constructor(cacheKey: string) {\n    super({\n      filter: recentFilters[cacheKey] ?? '',\n    });\n    this.cacheKey = cacheKey;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<BreakdownSearchScene>) => {\n    const { filter } = model.useState();\n    return (\n      <SearchInput\n        value={filter}\n        onChange={model.onValueFilterChange}\n        onClear={model.clearValueFilter}\n        placeholder=\"Search for value\"\n      />\n    );\n  };\n\n  public onValueFilterChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ filter: event.target.value });\n    this.filterValues(event.target.value);\n  };\n\n  public clearValueFilter = () => {\n    this.setState({ filter: '' });\n    this.filterValues('');\n  };\n\n  public reset = () => {\n    this.setState({ filter: '' });\n    recentFilters[this.cacheKey] = '';\n  };\n\n  private filterValues(filter: string) {\n    if (this.parent instanceof LabelBreakdownScene || this.parent instanceof FieldsBreakdownScene) {\n      recentFilters[this.cacheKey] = filter;\n      const body = this.parent.state.body;\n      if (body instanceof LabelValuesBreakdownScene || body instanceof FieldValuesBreakdownScene) {\n        body.state.body?.forEachChild((child) => {\n          if (child instanceof ByFrameRepeater && child.state.body.isActive) {\n            child.filterByString(filter);\n          }\n        });\n      } else {\n        logger.warn('invalid parent for search', {\n          typeofBody: typeof body,\n          filter,\n        });\n      }\n    }\n  }\n}\n","import React from 'react';\n\nimport { DataFrame, LoadingState, PanelData } from '@grafana/data';\nimport {\n  SceneByFrameRepeater,\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneLayout,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n} from '@grafana/scenes';\nimport { sortSeries } from 'services/sorting';\nimport { fuzzySearch } from '../../../services/search';\nimport { getLabelValue } from './SortByScene';\nimport { Alert, Button } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { BreakdownSearchReset } from './BreakdownSearchScene';\n\ninterface ByFrameRepeaterState extends SceneObjectState {\n  body: SceneLayout;\n  getLayoutChild(frame: DataFrame, frameIndex: number): SceneFlexItem;\n}\n\ntype FrameFilterCallback = (frame: DataFrame) => boolean;\ntype FrameIterateCallback = (frames: DataFrame[], seriesIndex: number) => void;\n\nexport class ByFrameRepeater extends SceneObjectBase<ByFrameRepeaterState> {\n  private unfilteredChildren: SceneFlexItem[] = [];\n  private sortBy: string;\n  private direction: string;\n  private sortedSeries: DataFrame[] = [];\n  private getFilter: () => string;\n  public constructor({\n    sortBy,\n    direction,\n    getFilter,\n    ...state\n  }: ByFrameRepeaterState & { sortBy: string; direction: string; getFilter: () => string }) {\n    super(state);\n\n    this.sortBy = sortBy;\n    this.direction = direction;\n    this.getFilter = getFilter;\n\n    this.addActivationHandler(() => {\n      const data = sceneGraph.getData(this);\n\n      this._subs.add(\n        data.subscribeToState((data, prevData) => {\n          if (\n            data.data?.state === LoadingState.Done ||\n            (data.data?.state === LoadingState.Streaming &&\n              data.data.series.length > (prevData.data?.series.length ?? 0))\n          ) {\n            this.performRepeat(data.data);\n          }\n        })\n      );\n\n      if (data.state.data) {\n        this.performRepeat(data.state.data);\n      }\n    });\n  }\n\n  public sort = (sortBy: string, direction: string) => {\n    const data = sceneGraph.getData(this);\n    this.sortBy = sortBy;\n    this.direction = direction;\n    if (data.state.data) {\n      this.performRepeat(data.state.data);\n    }\n  };\n\n  private performRepeat(data: PanelData) {\n    const newChildren: SceneFlexItem[] = [];\n    const sortedSeries = sortSeries(data.series, this.sortBy, this.direction);\n\n    for (let seriesIndex = 0; seriesIndex < sortedSeries.length; seriesIndex++) {\n      const layoutChild = this.state.getLayoutChild(sortedSeries[seriesIndex], seriesIndex);\n      newChildren.push(layoutChild);\n    }\n\n    this.sortedSeries = sortedSeries;\n    this.unfilteredChildren = newChildren;\n\n    if (this.getFilter()) {\n      this.state.body.setState({ children: [] });\n      this.filterByString(this.getFilter());\n    } else {\n      this.state.body.setState({ children: newChildren });\n    }\n  }\n\n  public iterateFrames = (callback: FrameIterateCallback) => {\n    const data = sceneGraph.getData(this).state.data;\n    if (!data) {\n      return;\n    }\n    for (let seriesIndex = 0; seriesIndex < this.sortedSeries.length; seriesIndex++) {\n      callback(this.sortedSeries, seriesIndex);\n    }\n  };\n\n  filterByString = (filter: string) => {\n    let haystack: string[] = [];\n\n    this.iterateFrames((frames, seriesIndex) => {\n      const labelValue = getLabelValue(frames[seriesIndex]);\n      haystack.push(labelValue);\n    });\n    fuzzySearch(haystack, filter, (data) => {\n      if (data && data[0]) {\n        // We got search results\n        this.filterFrames((frame: DataFrame) => {\n          const label = getLabelValue(frame);\n          return data[0].includes(label);\n        });\n      } else {\n        // reset search\n        this.filterFrames(() => true);\n      }\n    });\n  };\n\n  public filterFrames = (filterFn: FrameFilterCallback) => {\n    const newChildren: SceneFlexItem[] = [];\n    this.iterateFrames((frames, seriesIndex) => {\n      if (filterFn(frames[seriesIndex])) {\n        newChildren.push(this.unfilteredChildren[seriesIndex]);\n      }\n    });\n\n    if (newChildren.length === 0) {\n      this.state.body.setState({ children: [buildNoResultsScene(this.getFilter(), this.clearFilter)] });\n    } else {\n      this.state.body.setState({ children: newChildren });\n    }\n  };\n\n  public clearFilter = () => {\n    this.publishEvent(new BreakdownSearchReset(), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SceneByFrameRepeater>) => {\n    const { body } = model.useState();\n    return <body.Component model={body} />;\n  };\n}\n\nfunction buildNoResultsScene(filter: string, clearFilter: () => void) {\n  return new SceneFlexLayout({\n    direction: 'row',\n    children: [\n      new SceneFlexItem({\n        body: new SceneReactObject({\n          reactNode: (\n            <div className={styles.alertContainer}>\n              <Alert title=\"\" severity=\"info\" className={styles.noResultsAlert}>\n                No values found matching &ldquo;{filter}&rdquo;\n                <Button className={styles.clearButton} onClick={clearFilter}>\n                  Clear filter\n                </Button>\n              </Alert>\n            </div>\n          ),\n        }),\n      }),\n    ],\n  });\n}\n\nconst styles = {\n  alertContainer: css({\n    flexGrow: 1,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n  }),\n  noResultsAlert: css({\n    minWidth: '30vw',\n    flexGrow: 0,\n  }),\n  clearButton: css({\n    marginLeft: '1.5rem',\n  }),\n};\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VariableValueOption,\n  VizPanel,\n} from '@grafana/scenes';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { DrawStyle, LoadingPlaceholder, StackingMode } from '@grafana/ui';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { ALL_VARIABLE_VALUE, LEVEL_VARIABLE_VALUE } from '../../../services/variables';\nimport React from 'react';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { SelectLabelActionScene } from './SelectLabelActionScene';\nimport { ValueSlugs } from '../../../services/routing';\nimport { limitMaxNumberOfSeriesForPanel, MAX_NUMBER_OF_TIME_SERIES } from './TimeSeriesLimitSeriesTitleItem';\nimport { limitFramesTransformation } from './FieldsAggregatedBreakdownScene';\nimport { buildLabelsQuery, LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS } from '../../../services/labels';\nimport { getFieldsVariable, getLabelGroupByVariable } from '../../../services/variableGetters';\nimport { LokiQuery } from '../../../services/lokiQuery';\nimport { ServiceScene } from '../ServiceScene';\nimport { DataFrame, LoadingState } from '@grafana/data';\nimport { AddToExplorationButton } from './AddToExplorationButton';\n\nexport interface LabelsAggregatedBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher;\n}\n\nexport class LabelsAggregatedBreakdownScene extends SceneObjectBase<LabelsAggregatedBreakdownSceneState> {\n  constructor(state: Partial<LabelsAggregatedBreakdownSceneState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const fields = getFieldsVariable(this);\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const $detectedLabels = serviceScene.state.$detectedLabelsData;\n\n    // If the body hasn't been built yet, build it\n    if (!this.state.body) {\n      this.setState({\n        body: this.build(),\n      });\n    }\n    // Otherwise if we have the detected labels done loading, update the body\n    else if ($detectedLabels?.state.data?.state === LoadingState.Done) {\n      this.update($detectedLabels?.state.data.series[0]);\n    }\n\n    this._subs.add(\n      $detectedLabels?.subscribeToState((newState, prevState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          this.update(newState.data.series[0]);\n        }\n      })\n    );\n\n    this._subs.add(\n      fields.subscribeToState(() => {\n        this.updateQueriesOnFieldsVariableChange();\n      })\n    );\n  }\n\n  private updateQueriesOnFieldsVariableChange = () => {\n    this.state.body?.state.layouts.forEach((layoutObj) => {\n      const layout = layoutObj as SceneCSSGridLayout;\n      // Iterate through the existing panels\n      for (let i = 0; i < layout.state.children.length; i++) {\n        const { panel, title } = this.getPanelByIndex(layout, i);\n        const queryRunner: SceneDataProvider | SceneQueryRunner | undefined = panel.state.$data;\n        const query = buildLabelsQuery(this, title, title);\n\n        // Don't update if query didn't change\n        if (queryRunner instanceof SceneQueryRunner) {\n          if (query.expr === queryRunner?.state.queries?.[0]?.expr) {\n            break;\n          }\n        }\n\n        panel.setState({\n          $data: this.getDataTransformer(query),\n        });\n      }\n    });\n  };\n\n  private getPanelByIndex(layout: SceneCSSGridLayout, i: number) {\n    const gridItem = layout.state.children[i] as SceneCSSGridItem;\n    const panel = gridItem.state.body as VizPanel;\n\n    const title = panel.state.title;\n    return { panel, title };\n  }\n\n  private update(detectedLabelsFrame: DataFrame) {\n    const variable = getLabelGroupByVariable(this);\n    const newLabels = variable.state.options.filter((opt) => opt.value !== ALL_VARIABLE_VALUE).map((opt) => opt.label);\n\n    this.state.body?.state.layouts.forEach((layoutObj) => {\n      let existingLabels = [];\n      const layout = layoutObj as SceneCSSGridLayout;\n      const newLabelsSet = new Set<string>(newLabels);\n      const updatedChildren = layout.state.children as SceneCSSGridItem[];\n\n      for (let i = 0; i < updatedChildren.length; i++) {\n        const { title } = this.getPanelByIndex(layout, i);\n\n        if (newLabelsSet.has(title)) {\n          // If the new response has this field, delete it from the set, but leave it in the layout\n          newLabelsSet.delete(title);\n        } else {\n          // Otherwise if the panel doesn't exist in the response, delete it from the layout\n          updatedChildren.splice(i, 1);\n          // And make sure to update the index, or we'll skip the next one\n          i--;\n        }\n        existingLabels.push(title);\n      }\n\n      const labelsToAdd = Array.from(newLabelsSet);\n\n      const options = labelsToAdd.map((fieldName) => {\n        return {\n          label: fieldName,\n          value: fieldName,\n        };\n      });\n\n      updatedChildren.push(...this.buildChildren(options));\n\n      const cardinalityMap = this.calculateCardinalityMap(detectedLabelsFrame);\n      updatedChildren.sort(this.sortChildren(cardinalityMap));\n      updatedChildren.map((child) => {\n        limitMaxNumberOfSeriesForPanel(child);\n      });\n\n      layout.setState({\n        children: updatedChildren,\n      });\n    });\n  }\n\n  private calculateCardinalityMap(detectedLabels?: DataFrame) {\n    const cardinalityMap = new Map<string, number>();\n    if (detectedLabels?.length) {\n      for (let i = 0; i < detectedLabels?.fields.length; i++) {\n        const name: string = detectedLabels.fields[i].name;\n        const cardinality: number = detectedLabels.fields[i].values[0];\n        cardinalityMap.set(name, cardinality);\n      }\n    }\n    return cardinalityMap;\n  }\n\n  private build(): LayoutSwitcher {\n    const variable = getLabelGroupByVariable(this);\n    const labelBreakdownScene = sceneGraph.getAncestor(this, LabelBreakdownScene);\n    labelBreakdownScene.state.search.reset();\n\n    const children = this.buildChildren(variable.state.options);\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const $detectedLabels = serviceScene.state.$detectedLabelsData;\n    if ($detectedLabels?.state.data?.state === LoadingState.Done) {\n      const cardinalityMap = this.calculateCardinalityMap($detectedLabels?.state.data.series[0]);\n      children.sort(this.sortChildren(cardinalityMap));\n    }\n\n    const childrenClones = children.map((child) => child.clone());\n\n    // We must subscribe to the data providers for all children after the clone or we'll see bugs in the row layout\n    [...children, ...childrenClones].map((child) => {\n      limitMaxNumberOfSeriesForPanel(child);\n    });\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneCSSGridLayout({\n          isLazy: true,\n          templateColumns: LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n          autoRows: '200px',\n          children: children,\n        }),\n        new SceneCSSGridLayout({\n          isLazy: true,\n          templateColumns: '1fr',\n          autoRows: '200px',\n          children: childrenClones,\n        }),\n      ],\n    });\n  }\n\n  private buildChildren(options: VariableValueOption[]) {\n    const children: SceneCSSGridItem[] = [];\n    for (const option of options) {\n      const { value } = option;\n      const optionValue = String(value);\n      if (value === ALL_VARIABLE_VALUE || !value) {\n        continue;\n      }\n      const query = buildLabelsQuery(this, String(option.value), String(option.value));\n      const dataTransformer = this.getDataTransformer(query);\n\n      children.push(\n        new SceneCSSGridItem({\n          body: PanelBuilders.timeseries()\n            .setTitle(optionValue)\n            .setData(dataTransformer)\n            .setHeaderActions([\n              new SelectLabelActionScene({ labelName: optionValue, fieldType: ValueSlugs.label }),\n              new AddToExplorationButton({ labelName: optionValue }),\n            ])\n            .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n            .setCustomFieldConfig('fillOpacity', 100)\n            .setCustomFieldConfig('lineWidth', 0)\n            .setCustomFieldConfig('pointSize', 0)\n            .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n            .setOverrides(setLevelColorOverrides)\n            .build(),\n        })\n      );\n    }\n    return children;\n  }\n\n  private sortChildren(cardinalityMap: Map<string, number>) {\n    return (a: SceneCSSGridItem, b: SceneCSSGridItem) => {\n      const aPanel = a.state.body as VizPanel;\n      const bPanel = b.state.body as VizPanel;\n      if (aPanel.state.title === LEVEL_VARIABLE_VALUE) {\n        return -1;\n      }\n      if (bPanel.state.title === LEVEL_VARIABLE_VALUE) {\n        return 1;\n      }\n      const aCardinality = cardinalityMap.get(aPanel.state.title) ?? 0;\n      const bCardinality = cardinalityMap.get(bPanel.state.title) ?? 0;\n      return bCardinality - aCardinality;\n    };\n  }\n\n  private getDataTransformer(query: LokiQuery) {\n    const queryRunner = getQueryRunner([query]);\n    return new SceneDataTransformer({\n      $data: queryRunner,\n      transformations: [() => limitFramesTransformation(MAX_NUMBER_OF_TIME_SERIES)],\n    });\n  }\n\n  public static Selector({ model }: SceneComponentProps<LabelsAggregatedBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && <body.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LabelsAggregatedBreakdownScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <>{body && <body.Component model={body} />}</>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { AdHocVariableFilter, DataFrame, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  QueryRunnerState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneVariableSet,\n  SceneVariableState,\n  VariableDependencyConfig,\n  VariableValueOption,\n} from '@grafana/scenes';\nimport { Alert, useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { checkPrimaryLabel, getPrimaryLabelFromUrl, ValueSlugs } from 'services/routing';\nimport { ALL_VARIABLE_VALUE, SERVICE_NAME, SERVICE_UI_LABEL, VAR_LABEL_GROUP_BY, VAR_LABELS } from 'services/variables';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { FieldSelector } from './FieldSelector';\nimport { StatusWrapper } from './StatusWrapper';\nimport { getLabelOptions } from 'services/filters';\nimport { BreakdownSearchReset, BreakdownSearchScene } from './BreakdownSearchScene';\nimport { getSortByPreference } from 'services/store';\nimport { SortByScene, SortCriteriaChanged } from './SortByScene';\nimport { getDetectedLabelsFrame, ServiceScene } from '../ServiceScene';\nimport { CustomConstantVariable, CustomConstantVariableState } from '../../../services/CustomConstantVariable';\nimport { navigateToValueBreakdown } from '../../../services/navigate';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { LabelValuesBreakdownScene } from './LabelValuesBreakdownScene';\nimport { LabelsAggregatedBreakdownScene } from './LabelsAggregatedBreakdownScene';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { EmptyLayoutScene } from './EmptyLayoutScene';\nimport { getLabelGroupByVariable, getLabelsVariable } from '../../../services/variableGetters';\n\nexport interface LabelBreakdownSceneState extends SceneObjectState {\n  body?: SceneObject;\n  search: BreakdownSearchScene;\n  sort: SortByScene;\n  loading?: boolean;\n  error?: boolean;\n  blockingMessage?: string;\n  // We have to store the value in state because scenes doesn't allow variables that don't have options. We need to hold on to this until the API call getting values is done, and then reset the state\n  value?: string;\n}\n\nexport class LabelBreakdownScene extends SceneObjectBase<LabelBreakdownSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LABELS],\n  });\n\n  // Labels/options can be passed in when instantiated, but should ONLY exist on the state of the variable\n  constructor(state: Partial<LabelBreakdownSceneState> & { options?: VariableValueOption[]; value?: string }) {\n    super({\n      ...state,\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [\n            new CustomConstantVariable({\n              name: VAR_LABEL_GROUP_BY,\n              defaultToAll: false,\n              includeAll: true,\n\n              value: state.value ?? ALL_VARIABLE_VALUE,\n              options: state.options ?? [],\n            }),\n          ],\n        }),\n      loading: true,\n      sort: new SortByScene({ target: 'labels' }),\n      search: new BreakdownSearchScene('labels'),\n      value: state.value,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const groupByVariable = getLabelGroupByVariable(this);\n\n    this.setState({\n      loading: serviceScene.state.$detectedLabelsData?.state.data?.state !== LoadingState.Done,\n      error: serviceScene.state.$detectedLabelsData?.state.data?.state === LoadingState.Error,\n    });\n\n    this._subs.add(\n      this.subscribeToEvent(BreakdownSearchReset, () => {\n        this.state.search.clearValueFilter();\n      })\n    );\n    this._subs.add(this.subscribeToEvent(SortCriteriaChanged, this.handleSortByChange));\n\n    this._subs.add(serviceScene.state.$detectedLabelsData?.subscribeToState(this.onDetectedLabelsDataChange));\n\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState((newState, prevState) => {\n        this.onLabelsVariableChange(newState, prevState);\n      })\n    );\n\n    this._subs.add(\n      groupByVariable.subscribeToState((newState, prevState) => {\n        this.onGroupByVariableChange(newState, prevState);\n      })\n    );\n\n    const detectedLabelsFrame = getDetectedLabelsFrame(this);\n    // Need to update labels with current state\n    if (detectedLabelsFrame) {\n      this.updateOptions(detectedLabelsFrame);\n    }\n\n    checkPrimaryLabel(this);\n  }\n\n  private onGroupByVariableChange(newState: CustomConstantVariableState, prevState: CustomConstantVariableState) {\n    // If the aggregation value changed, or the body is not yet defined\n    if (\n      newState.value !== prevState.value ||\n      !areArraysEqual(newState.options, prevState.options) ||\n      this.state.body === undefined ||\n      this.state.body instanceof EmptyLayoutScene\n    ) {\n      this.updateBody();\n    }\n  }\n\n  private onLabelsVariableChange(\n    newState: SceneVariableState & { filters: AdHocVariableFilter[] },\n    prevState: SceneVariableState & { filters: AdHocVariableFilter[] }\n  ) {\n    let { labelName } = getPrimaryLabelFromUrl();\n    if (labelName === SERVICE_UI_LABEL) {\n      labelName = SERVICE_NAME;\n    }\n    const variable = getLabelGroupByVariable(this);\n    const newPrimaryLabel = newState.filters.find((filter) => filter.key === labelName);\n    const prevPrimaryLabel = prevState.filters.find((filter) => filter.key === labelName);\n\n    // If the user changes the service\n    if (variable.state.value === ALL_VARIABLE_VALUE && newPrimaryLabel !== prevPrimaryLabel) {\n      this.setState({\n        loading: true,\n        body: undefined,\n        error: undefined,\n      });\n    }\n  }\n\n  /**\n   * Pull the detected_labels from our service scene, update the variable when they change\n   * @param newState\n   * @param prevState\n   */\n  private onDetectedLabelsDataChange = (newState: QueryRunnerState, prevState: QueryRunnerState) => {\n    if (\n      newState.data?.state === LoadingState.Done &&\n      newState.data.series?.[0] &&\n      !areArraysEqual(newState.data.series?.[0]?.fields, prevState.data?.series?.[0]?.fields)\n    ) {\n      this.updateOptions(newState.data.series?.[0]);\n    } else if (newState.data?.state === LoadingState.Done) {\n      // we got a new response, but nothing changed, just need to clear loading\n      const variable = getLabelGroupByVariable(this);\n      variable.setState({\n        loading: false,\n      });\n    }\n  };\n\n  private handleSortByChange = (event: SortCriteriaChanged) => {\n    if (event.target !== 'labels') {\n      return;\n    }\n    if (this.state.body instanceof LabelValuesBreakdownScene) {\n      this.state.body?.state.body?.state.layouts.forEach((layout) => {\n        if (layout instanceof ByFrameRepeater) {\n          layout.sort(event.sortBy, event.direction);\n        }\n      });\n    }\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.value_breakdown_sort_change,\n      {\n        target: 'labels',\n        criteria: event.sortBy,\n        direction: event.direction,\n      }\n    );\n  };\n\n  private updateOptions(detectedLabels: DataFrame | undefined) {\n    if (!detectedLabels || !detectedLabels.length) {\n      this.setState({\n        loading: false,\n        body: new EmptyLayoutScene({ type: 'labels' }),\n      });\n      return;\n    }\n    const variable = getLabelGroupByVariable(this);\n    const options = getLabelOptions(detectedLabels.fields.map((label) => label.name));\n\n    variable.setState({\n      loading: false,\n      options,\n      value: this.state.value ?? ALL_VARIABLE_VALUE,\n    });\n  }\n\n  private updateBody() {\n    const variable = getLabelGroupByVariable(this);\n    // We get the labels from the service scene, if we don't have them yet, assume we're loading\n    if (!variable.state.options || !variable.state.options.length) {\n      return;\n    }\n\n    const stateUpdate: Partial<LabelBreakdownSceneState> = {\n      loading: false,\n      blockingMessage: undefined,\n      error: false,\n    };\n\n    if (variable.hasAllValue() && this.state.body instanceof LabelValuesBreakdownScene) {\n      stateUpdate.body = new LabelsAggregatedBreakdownScene({});\n    } else if (!variable.hasAllValue() && this.state.body instanceof LabelsAggregatedBreakdownScene) {\n      stateUpdate.body = new LabelValuesBreakdownScene({});\n    } else if (this.state.body === undefined) {\n      if (variable.state.options.length > 0) {\n        stateUpdate.body = variable.hasAllValue()\n          ? new LabelsAggregatedBreakdownScene({})\n          : new LabelValuesBreakdownScene({});\n      } else {\n        stateUpdate.body = new EmptyLayoutScene({ type: 'labels' });\n      }\n    } else if (this.state.body instanceof EmptyLayoutScene) {\n      if (variable.state.options.length > 0) {\n        stateUpdate.body = variable.hasAllValue()\n          ? new LabelsAggregatedBreakdownScene({})\n          : new LabelValuesBreakdownScene({});\n      }\n    }\n\n    this.setState({ ...stateUpdate });\n  }\n\n  public onChange = (value?: string) => {\n    if (!value) {\n      return;\n    }\n\n    const variable = getLabelGroupByVariable(this);\n    variable.changeValueTo(value);\n\n    const { sortBy, direction } = getSortByPreference('labels', DEFAULT_SORT_BY, 'desc');\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.select_field_in_breakdown_clicked,\n      {\n        label: value,\n        previousLabel: variable.getValueText(),\n        view: 'labels',\n        sortBy,\n        sortByDirection: direction,\n      }\n    );\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    navigateToValueBreakdown(ValueSlugs.label, value, serviceScene);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LabelBreakdownScene>) => {\n    const { body, loading, blockingMessage, error, search, sort } = model.useState();\n    const variable = getLabelGroupByVariable(model);\n    const { options, value } = variable.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          <div className={styles.controls}>\n            {body instanceof LabelValuesBreakdownScene && <LabelValuesBreakdownScene.Selector model={body} />}\n            {body instanceof LabelsAggregatedBreakdownScene && <LabelsAggregatedBreakdownScene.Selector model={body} />}\n            {!loading && value !== ALL_VARIABLE_VALUE && (\n              <>\n                <sort.Component model={sort} />\n                <search.Component model={search} />\n              </>\n            )}\n            {!loading && options.length > 0 && (\n              <FieldSelector label=\"Label\" options={options} value={String(value)} onChange={model.onChange} />\n            )}\n          </div>\n          {error && (\n            <Alert title=\"\" severity=\"warning\">\n              The labels are not available at this moment. Try using a different time range or check again later.\n            </Alert>\n          )}\n\n          <div className={styles.content}>{body && <body.Component model={body} />}</div>\n        </StatusWrapper>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      justifyContent: 'space-between',\n      flexDirection: 'row-reverse',\n      gap: theme.spacing(2),\n    }),\n  };\n}\n","import { sceneGraph, SceneObjectState } from '@grafana/scenes';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { logger } from '../../../../services/logger';\n\nexport interface FilterByPatternsButtonState extends SceneObjectState {\n  pattern: string;\n  type: 'exclude' | 'include' | 'undo';\n}\n\nexport interface FilterByPatternsState extends FilterByPatternsButtonState {\n  indexScene: IndexScene;\n}\n\nexport function onPatternClick(props: FilterByPatternsState) {\n  const { indexScene: staleIndex, pattern, type } = { ...props };\n\n  const indexScene = sceneGraph.getAncestor(staleIndex, IndexScene);\n\n  if (!indexScene) {\n    logger.warn('logs exploration scene not found');\n    return;\n  }\n\n  const { patterns = [] } = indexScene.state;\n\n  // Remove the pattern if it's already there\n  const filteredPatterns = patterns.filter((pat) => pat.pattern !== pattern);\n  // Analytics\n  const includePatternsLength = filteredPatterns.filter((p) => p.type === 'include')?.length ?? 0;\n  const excludePatternsLength = filteredPatterns.filter((p) => p.type === 'exclude')?.length ?? 0;\n  reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_selected, {\n    type: type,\n    includePatternsLength: includePatternsLength + (type === 'include' ? 1 : 0),\n    excludePatternsLength: excludePatternsLength + (type === 'exclude' ? 1 : 0),\n  });\n\n  // If we have type undo, then we don't need to add the pattern\n  if (type === 'undo') {\n    indexScene.setState({\n      patterns: filteredPatterns,\n    });\n  } else {\n    // Otherwise, add the pattern\n    indexScene.setState({\n      patterns: [...filteredPatterns, { pattern: pattern, type: type }],\n    });\n  }\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsStatsRow: css({\n    margin: `${theme.spacing(1.15)}px 0`,\n  }),\n  logsStatsRowActive: css({\n    color: theme.colors.primary.text,\n    position: 'relative',\n  }),\n  logsStatsRowLabel: css({\n    display: 'flex',\n    marginBottom: '1px',\n  }),\n  logsStatsRowValue: css({\n    flex: 1,\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n  }),\n  logsStatsRowCount: css({\n    textAlign: 'right',\n    marginLeft: theme.spacing(0.75),\n  }),\n  logsStatsRowPercent: css({\n    textAlign: 'right',\n    marginLeft: theme.spacing(0.75),\n    width: theme.spacing(4.5),\n  }),\n  logsStatsRowBar: css({\n    height: theme.spacing(0.5),\n    overflow: 'hidden',\n    background: theme.colors.text.disabled,\n  }),\n  logsStatsRowInnerBar: css({\n    height: theme.spacing(0.5),\n    overflow: 'hidden',\n    background: theme.colors.primary.main,\n  }),\n});\n\nexport interface Props {\n  active?: boolean;\n  count: number;\n  proportion: number;\n  value?: string;\n}\n\nexport const PatternFieldLabelStatsRow = ({ active, count, proportion, value }: Props) => {\n  const style = useStyles2(getStyles);\n  const percent = `${Math.round(proportion * 100)}%`;\n  const barStyle = { width: percent };\n\n  return (\n    <div className={active ? `${style.logsStatsRow} ${style.logsStatsRowActive}` : style.logsStatsRow}>\n      <div className={style.logsStatsRowLabel}>\n        <div className={style.logsStatsRowValue} title={value}>\n          {value}\n        </div>\n        <div className={style.logsStatsRowCount}>{count}</div>\n        <div className={style.logsStatsRowPercent}>{percent}</div>\n      </div>\n      <div className={style.logsStatsRowBar}>\n        <div className={style.logsStatsRowInnerBar} style={barStyle} />\n      </div>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { LogLabelStatsModel, GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\n//Components\nimport { PatternFieldLabelStatsRow } from './PatternFieldLabelStatsRow';\n\nconst STATS_ROW_LIMIT = 10;\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsStats: css({\n    background: 'inherit',\n    color: theme.colors.text.primary,\n    wordBreak: 'break-all',\n    width: 'fit-content',\n    maxHeight: '40vh',\n    overflowY: 'auto',\n    marginTop: theme.spacing(1),\n  }),\n  logsStatsHeader: css({\n    borderBottom: `1px solid ${theme.colors.border.medium}`,\n    display: 'flex',\n  }),\n  logsStatsTitle: css({\n    fontWeight: theme.typography.fontWeightMedium,\n    paddingRight: theme.spacing(2),\n    display: 'inline-block',\n    whiteSpace: 'nowrap',\n    textOverflow: 'ellipsis',\n    flexGrow: 1,\n  }),\n  logsStatsClose: css({\n    cursor: 'pointer',\n  }),\n  logsStatsBody: css({\n    padding: '5px 0px',\n  }),\n});\n\ninterface PatternFieldLabelStatsProps {\n  stats: LogLabelStatsModel[];\n  value: string;\n}\n\nexport const PatternFieldLabelStats = (props: PatternFieldLabelStatsProps) => {\n  const style = useStyles2(getStyles);\n\n  const { stats, value } = props;\n\n  const topRows = stats.slice(0, STATS_ROW_LIMIT);\n  let activeRow = topRows.find((row) => row.value === value);\n  let otherRows = stats.slice(STATS_ROW_LIMIT);\n  const insertActiveRow = !activeRow;\n\n  // Remove active row from other to show extra\n  if (insertActiveRow) {\n    activeRow = otherRows.find((row) => row.value === value);\n    otherRows = otherRows.filter((row) => row.value !== value);\n  }\n\n  const otherCount = otherRows.reduce((sum, row) => sum + row.count, 0);\n  const topCount = topRows.reduce((sum, row) => sum + row.count, 0);\n  const total = topCount + otherCount;\n\n  // Combine topRows and otherRows\n  let combinedRows = [...topRows];\n\n  // If there's an \"Other\" category, add it to combinedRows\n  if (otherCount > 0) {\n    combinedRows.push({ value: 'Other', count: otherCount, proportion: otherCount / total });\n  }\n\n  // Sort combinedRows by count in descending order\n  combinedRows.sort((a, b) => b.count - a.count);\n\n  return (\n    <div className={style.logsStats}>\n      <div className={style.logsStatsHeader}>\n        <div className={style.logsStatsTitle}>From a sample of {total} rows found</div>\n      </div>\n      <div className={style.logsStatsBody}>\n        {combinedRows.map((stat) => (\n          <PatternFieldLabelStatsRow key={stat.value} {...stat} active={stat.value === value} />\n        ))}\n      </div>\n    </div>\n  );\n};\n","import React, { useMemo, useRef, useState } from 'react';\nimport { AdHocFiltersVariable, sceneGraph } from '@grafana/scenes';\nimport { Spinner, Toggletip, useStyles2 } from '@grafana/ui';\nimport { getLokiDatasource } from 'services/scenes';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport { buildDataQuery } from 'services/query';\nimport { PatternFieldLabelStats } from './PatternFieldLabelStats';\nimport { GrafanaTheme2, LoadingState, LogLabelStatsModel, TimeRange } from '@grafana/data';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { css } from '@emotion/css';\nimport { getLabelsVariable } from '../../../../services/variableGetters';\n\ninterface PatternNameLabelProps {\n  exploration: IndexScene;\n  pattern: string;\n}\n\nconst LINE_LIMIT = 1000;\n\nexport const PatternNameLabel = ({ exploration, pattern }: PatternNameLabelProps) => {\n  const patternIndices = extractPatternIndices(pattern);\n  const [stats, setStats] = useState<LogLabelStatsModel[][] | undefined>(undefined);\n  const [statsError, setStatsError] = useState(false);\n  const styles = useStyles2(getStyles);\n\n  // Refs to store the previous values of query and timeRange\n  const previousQueryRef = useRef<string | null>(null);\n  const previousTimeRangeRef = useRef<TimeRange | null>(null);\n\n  const handlePatternClick = async () => {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_field_clicked);\n    const query = constructQuery(pattern, patternIndices, getLabelsVariable(exploration));\n    const datasource = await getLokiDatasource(exploration);\n    const currentTimeRange = sceneGraph.getTimeRange(exploration).state.value;\n\n    // If the query and timeRange are the same as the previous ones, do not re-query\n    if (stats && query === previousQueryRef.current && currentTimeRange === previousTimeRangeRef.current) {\n      return;\n    }\n\n    // Update the refs with the new values\n    previousQueryRef.current = query;\n    previousTimeRangeRef.current = currentTimeRange;\n\n    datasource\n      ?.query({\n        requestId: '1',\n        interval: '',\n        intervalMs: 0,\n        scopedVars: {},\n        range: currentTimeRange,\n        targets: [buildDataQuery(query, { maxLines: LINE_LIMIT })],\n        timezone: '',\n        app: '',\n        startTime: 0,\n      })\n      .forEach((result) => {\n        if (result.state === LoadingState.Done && !result.errors?.length) {\n          setStats(convertResultToStats(result, patternIndices.length));\n          setStatsError(false);\n        } else if (result.state === LoadingState.Error || result.errors?.length) {\n          setStats(undefined);\n          setStatsError(true);\n        }\n      });\n  };\n\n  const parts = useMemo(() => pattern.split('<_>'), [pattern]);\n\n  return (\n    <div>\n      {parts.map((part, index) => (\n        <span key={index}>\n          {part}\n          {index !== patternIndices.length && (\n            <Toggletip\n              onOpen={handlePatternClick}\n              content={\n                <>\n                  {stats && stats[index].length > 0 && <PatternFieldLabelStats stats={stats[index]} value=\"\" />}\n                  {stats && stats[index].length === 0 && (\n                    <div>No available stats for this field in the current timestamp.</div>\n                  )}\n                  {!stats && statsError && <div>Could not load stats for this pattern.</div>}\n                  {!stats && !statsError && (\n                    <div style={{ padding: '10px' }}>\n                      <Spinner size=\"xl\" />\n                    </div>\n                  )}\n                </>\n              }\n            >\n              <span className={styles.pattern}>&lt;_&gt;</span>\n            </Toggletip>\n          )}\n        </span>\n      ))}\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    pattern: css({\n      cursor: 'pointer',\n      backgroundColor: theme.colors.emphasize(theme.colors.background.primary, 0.1),\n      margin: '0 2px',\n\n      '&:hover': {\n        backgroundColor: theme.colors.emphasize(theme.colors.background.primary, 0.2),\n      },\n    }),\n  };\n}\n\n// Convert the result to statistics data structure\nfunction convertResultToStats(result: any, fieldCount: number): LogLabelStatsModel[][] {\n  const fieldStatsMap = new Map<string, Map<string, number>>();\n\n  // Populate the fieldStatsMap with values from the result\n  result.data[0].fields[0].values.toArray().forEach((value: Record<string, any>) => {\n    Object.keys(value).forEach((key) => {\n      if (!fieldStatsMap.has(key)) {\n        fieldStatsMap.set(key, new Map<string, number>());\n      }\n      fieldStatsMap.get(key)?.set(value[key], (fieldStatsMap.get(key)?.get(value[key]) || 0) + 1);\n    });\n  });\n\n  const stats: LogLabelStatsModel[][] = [];\n\n  // Construct stats array from fieldStatsMap\n  for (let i = 0; i <= fieldCount; i++) {\n    const fieldStats: LogLabelStatsModel[] = [];\n    fieldStatsMap.get(`field_${i + 1}`)?.forEach((count, key) => {\n      fieldStats.push({ value: key, count, proportion: count / LINE_LIMIT });\n    });\n    fieldStats.sort((a, b) => b.count - a.count);\n    stats.push(fieldStats);\n  }\n\n  return stats;\n}\n\n// Extract indices of the pattern '<_>' in the given string\nfunction extractPatternIndices(pattern: string): number[] {\n  const indices: number[] = [];\n  let currentIndex = pattern.indexOf('<_>');\n\n  while (currentIndex !== -1) {\n    indices.push(currentIndex);\n    currentIndex = pattern.indexOf('<_>', currentIndex + 1);\n  }\n  return indices;\n}\n\n// Construct the query string based on pattern and other conditions\nfunction constructQuery(pattern: string, patternIndices: number[], filters: AdHocFiltersVariable): string {\n  let fieldIndex = 1;\n  const patternExtractor = pattern.replace(/<_>/g, () => `<field_${fieldIndex++}>`);\n  const filterExpression = filters.state.filterExpression;\n  const fields = patternIndices.map((_value, index) => `field_${index + 1}`).join(' ,');\n  return `{${filterExpression}} |> \\`${pattern}\\` | pattern \\`${patternExtractor}\\` | keep ${fields} | line_format \"\"`;\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataProviderResult,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n  VizPanel,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { LoadingState } from '@grafana/data';\nimport { Alert, Button } from '@grafana/ui';\nimport {\n  LOG_STREAM_SELECTOR_EXPR,\n  PATTERNS_SAMPLE_SELECTOR_EXPR,\n  VAR_PATTERNS_EXPR,\n} from '../../../../services/variables';\nimport { buildDataQuery, renderPatternFilters } from '../../../../services/query';\nimport { getQueryRunner } from '../../../../services/panel';\nimport { AppliedPattern } from '../../../IndexScene/IndexScene';\nimport { PatternsViewTableScene } from './PatternsViewTableScene';\nimport { emptyStateStyles } from '../FieldsBreakdownScene';\nimport { getFieldsVariable, getLevelsVariable, getLineFilterVariable } from '../../../../services/variableGetters';\nimport { LokiQuery } from '../../../../services/lokiQuery';\nimport { logger } from '../../../../services/logger';\n\ninterface PatternsLogsSampleSceneState extends SceneObjectState {\n  pattern: string;\n  body?: SceneFlexLayout;\n}\nexport class PatternsLogsSampleScene extends SceneObjectBase<PatternsLogsSampleSceneState> {\n  constructor(state: PatternsLogsSampleSceneState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    if (this.state.body) {\n      return;\n    }\n\n    // We start by querying with the users current query context\n    const queryWithFilters = buildDataQuery(LOG_STREAM_SELECTOR_EXPR);\n    this.replacePatternsInQuery(queryWithFilters);\n\n    // but if that fails to return results, we fire the query without the filters, instead of showing no-data in the viz\n    const queryRunnerWithFilters = getQueryRunner([queryWithFilters]);\n    queryRunnerWithFilters.getResultsStream().subscribe((value) => {\n      this.onQueryWithFiltersResult(value);\n    });\n\n    this.setState({\n      body: new SceneFlexLayout({\n        direction: 'column',\n        children: [\n          new SceneFlexItem({\n            body: undefined,\n            width: '100%',\n            height: 0,\n          }),\n          new SceneFlexItem({\n            height: 300,\n            width: '100%',\n            body: PanelBuilders.logs()\n              .setHoverHeader(true)\n              .setOption('showLogContextToggle', true)\n              .setOption('showTime', true)\n              .setData(queryRunnerWithFilters)\n              .build(),\n          }),\n        ],\n      }),\n    });\n  }\n\n  private replacePatternsInQuery(queryWithFilters: LokiQuery) {\n    const pendingPattern: AppliedPattern = {\n      pattern: this.state.pattern,\n      type: 'include',\n    };\n    const patternsLine = renderPatternFilters([pendingPattern]);\n    queryWithFilters.expr = queryWithFilters.expr.replace(VAR_PATTERNS_EXPR, patternsLine);\n  }\n\n  private clearFilters = () => {\n    const filterVariable = getFieldsVariable(this);\n    const lineFilterVariable = getLineFilterVariable(this);\n    const levelsVariable = getLevelsVariable(this);\n    filterVariable.setState({\n      filters: [],\n    });\n    levelsVariable.setState({\n      filters: [],\n    });\n    if (lineFilterVariable.state.value) {\n      lineFilterVariable.changeValueTo('');\n\n      const noticeFlexItem = this.getNoticeFlexItem();\n\n      // The query we just fired is already correct after we clear the filters, we just need to hide the warning, and allow filtering\n      noticeFlexItem?.setState({\n        isHidden: true,\n      });\n\n      this.removePatternFromFilterExclusion();\n    }\n  };\n\n  private removePatternFromFilterExclusion() {\n    const patternsViewTableScene = sceneGraph.getAncestor(this, PatternsViewTableScene);\n    const patternsNotMatchingFilters = patternsViewTableScene.state.patternsNotMatchingFilters ?? [];\n\n    const index = patternsNotMatchingFilters.findIndex((pattern) => pattern === this.state.pattern);\n\n    if (index !== -1) {\n      patternsNotMatchingFilters.splice(index, 1);\n      // remove this pattern, as they can filter by this pattern again\n      patternsViewTableScene.setState({\n        patternsNotMatchingFilters: patternsNotMatchingFilters,\n      });\n    }\n  }\n\n  /**\n   * If the first query with the users filters applied fails, we run another one after removing the filters\n   * @param value\n   */\n  private onQueryError = (value: SceneDataProviderResult) => {\n    if (\n      (value.data.state === LoadingState.Done &&\n        (value.data.series.length === 0 || value.data.series.every((frame) => frame.length === 0))) ||\n      value.data.state === LoadingState.Error\n    ) {\n      // Logging an error so loki folks can debug why some patterns returned from the API seem to fail.\n      let logContext;\n      try {\n        logContext = {\n          pattern: this.state.pattern,\n          traceIds: JSON.stringify(value.data.traceIds),\n          request: JSON.stringify(value.data.request),\n        };\n      } catch (e) {\n        logContext = {\n          pattern: this.state.pattern,\n          msg: 'Failed to encode context',\n        };\n      }\n\n      // Logging an error so loki folks can debug why some patterns returned from the API seem to fail.\n      logger.error(new Error('Pattern sample query returns no results'), logContext);\n\n      this.setWarningMessage(\n        <Alert severity={'error'} title={''}>\n          This pattern returns no logs.\n        </Alert>\n      );\n\n      const panelFlexItem = this.getVizFlexItem();\n\n      // Run another query without the filters so we can still show log lines of what the pattern looks like.\n      if (panelFlexItem instanceof SceneFlexItem) {\n        panelFlexItem.setState({\n          isHidden: true,\n        });\n      }\n    }\n  };\n\n  private setWarningMessage(reactNode: React.ReactNode) {\n    const noticeFlexItem = this.getNoticeFlexItem();\n    const vizFlexItem = this.getVizFlexItem();\n\n    if (noticeFlexItem instanceof SceneFlexItem) {\n      noticeFlexItem.setState({\n        isHidden: false,\n        height: 'auto',\n        body: new SceneReactObject({\n          reactNode: reactNode,\n        }),\n      });\n    }\n    return vizFlexItem;\n  }\n\n  private getNoticeFlexItem() {\n    const children = this.getFlexItemChildren();\n    return children?.[0];\n  }\n  private getVizFlexItem() {\n    const children = this.getFlexItemChildren();\n    return children?.[1];\n  }\n\n  private getFlexItemChildren() {\n    return this.state.body?.state.children;\n  }\n\n  /**\n   * Callback to subscription of pattern sample query with all of the current query filters applied.\n   * If this query fails to return data, we show a warning, and attempt the pattern sample query again without applying the existing filters.\n   * We also add the pattern to the state of the PatternsTableViewScene so we can hide the filter buttons for this pattern, as including it would break the query\n   * @param value\n   */\n  private onQueryWithFiltersResult = (value: SceneDataProviderResult) => {\n    const queryWithoutFilters = buildDataQuery(PATTERNS_SAMPLE_SELECTOR_EXPR);\n    this.replacePatternsInQuery(queryWithoutFilters);\n\n    const queryRunnerWithoutFilters = getQueryRunner([queryWithoutFilters]);\n\n    // Subscribe to the secondary query, so we can log errors and update the UI\n    queryRunnerWithoutFilters.getResultsStream().subscribe(this.onQueryError);\n\n    if (\n      value.data.state === LoadingState.Done &&\n      (value.data.series.length === 0 || value.data.series.every((frame) => frame.length === 0))\n    ) {\n      const noticeFlexItem = this.getNoticeFlexItem();\n      const panelFlexItem = this.getVizFlexItem();\n\n      // Add a warning notice that the patterns shown will not show up in their current log results due to their existing filters.\n      if (noticeFlexItem instanceof SceneFlexItem) {\n        noticeFlexItem.setState({\n          isHidden: false,\n          height: 'auto',\n          body: new SceneReactObject({\n            reactNode: (\n              <Alert severity={'warning'} title={''}>\n                The logs returned by this pattern do not match the current query filters.\n                <Button className={emptyStateStyles.button} onClick={() => this.clearFilters()}>\n                  Clear filters\n                </Button>\n              </Alert>\n            ),\n          }),\n        });\n      }\n\n      // Run another query without the filters so we can still show log lines of what the pattern looks like.\n      if (panelFlexItem instanceof SceneFlexItem) {\n        const panel = panelFlexItem.state.body;\n        if (panel instanceof VizPanel) {\n          panel?.setState({\n            $data: queryRunnerWithoutFilters,\n          });\n        }\n      }\n      this.excludeThisPatternFromFiltering();\n    }\n\n    if (value.data.state === LoadingState.Error) {\n      this.onQueryError(value);\n    }\n  };\n\n  private excludeThisPatternFromFiltering() {\n    const patternsViewTableScene = sceneGraph.getAncestor(this, PatternsViewTableScene);\n    const patternsThatDontMatchCurrentFilters = patternsViewTableScene.state.patternsNotMatchingFilters ?? [];\n\n    // Add this pattern to the array of patterns that don't match current filters\n    patternsViewTableScene.setState({\n      patternsNotMatchingFilters: [...patternsThatDontMatchCurrentFilters, this.state.pattern],\n    });\n  }\n\n  public static Component({ model }: SceneComponentProps<PatternsLogsSampleScene>) {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n    return null;\n  }\n}\n","import React, { useEffect } from 'react';\nimport { PatternsLogsSampleScene } from './PatternsLogsSampleScene';\nimport { PatternsTableCellData, PatternsViewTableScene } from './PatternsViewTableScene';\n\ninterface ExpandedRowProps {\n  tableViz: PatternsViewTableScene;\n  row: PatternsTableCellData;\n}\n\nexport function PatternsTableExpandedRow({ tableViz, row }: ExpandedRowProps) {\n  const { expandedRows } = tableViz.useState();\n\n  const rowScene = expandedRows?.find((scene) => scene.state.key === row.pattern);\n\n  useEffect(() => {\n    if (!rowScene) {\n      const newRowScene = buildExpandedRowScene(row.pattern);\n      tableViz.setState({ expandedRows: [...(tableViz.state.expandedRows ?? []), newRowScene] });\n    }\n  }, [row, tableViz, rowScene]);\n\n  return rowScene ? <rowScene.Component model={rowScene} /> : null;\n}\n\nfunction buildExpandedRowScene(pattern: string) {\n  return new PatternsLogsSampleScene({\n    pattern: pattern,\n    key: pattern,\n  });\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataNode,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n} from '@grafana/scenes';\nimport { PatternFrame } from './PatternsBreakdownScene';\nimport React from 'react';\nimport { AppliedPattern, IndexScene } from '../../../IndexScene/IndexScene';\nimport { DataFrame, GrafanaTheme2, LoadingState, PanelData, scaledUnits } from '@grafana/data';\nimport { AxisPlacement, Column, InteractiveTable, TooltipDisplayMode, useTheme2 } from '@grafana/ui';\nimport { CellProps } from 'react-table';\nimport { css, cx } from '@emotion/css';\nimport { onPatternClick } from './FilterByPatternsButton';\nimport { FilterButton } from '../../../FilterButton';\nimport { config } from '@grafana/runtime';\nimport { testIds } from '../../../../services/testIds';\nimport { PatternsFrameScene } from './PatternsFrameScene';\nimport { PatternNameLabel } from './PatternNameLabel';\nimport { getExplorationFor } from 'services/scenes';\nimport { PatternsTableExpandedRow } from './PatternsTableExpandedRow';\n\n// copied from from grafana repository packages/grafana-data/src/valueFormats/categories.ts\n// that is used in Grafana codebase for \"short\" units\nconst SCALED_UNITS = ['', ' K', ' Mil', ' Bil', ' Tri', ' Quadr', ' Quint', ' Sext', ' Sept'];\nexport interface SingleViewTableSceneState extends SceneObjectState {\n  // The local copy of the pattern frames, the parent breakdown scene decides if we get the filtered subset or not, in this scene we just present the data\n  patternFrames: PatternFrame[] | undefined;\n  expandedRows?: SceneObject[];\n\n  // An array of patterns to exclude links\n  patternsNotMatchingFilters?: string[];\n}\n\nexport interface PatternsTableCellData {\n  pattern: string;\n  dataFrame: DataFrame;\n  sum: number;\n  includeLink: () => void;\n  excludeLink: () => void;\n  undoLink: () => void;\n}\n\nexport class PatternsViewTableScene extends SceneObjectBase<SingleViewTableSceneState> {\n  constructor(state: SingleViewTableSceneState) {\n    super(state);\n  }\n\n  public static Component = PatternTableViewSceneComponent;\n\n  /**\n   * Build columns for interactive table (wrapper for react-table v7)\n   * @param total\n   * @param appliedPatterns\n   * @param theme\n   * @param patternsNotMatchingFilters\n   * @protected\n   */\n  public buildColumns(\n    total: number,\n    appliedPatterns: AppliedPattern[] | undefined,\n    theme: GrafanaTheme2,\n    patternsNotMatchingFilters?: string[]\n  ) {\n    const styles = getColumnStyles(theme);\n    const timeRange = sceneGraph.getTimeRange(this).state.value;\n    const columns: Array<Column<PatternsTableCellData>> = [\n      {\n        id: 'volume-samples',\n        header: '',\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          const panelData: PanelData = {\n            timeRange: timeRange,\n            series: [props.cell.row.original.dataFrame],\n            state: LoadingState.Done,\n          };\n          const dataNode = new SceneDataNode({\n            data: panelData,\n          });\n\n          const timeSeries = PanelBuilders.timeseries()\n            .setData(dataNode)\n            .setHoverHeader(true)\n            .setOption('tooltip', {\n              mode: TooltipDisplayMode.None,\n            })\n            .setCustomFieldConfig('hideFrom', {\n              legend: true,\n              tooltip: true,\n            })\n            .setCustomFieldConfig('axisPlacement', AxisPlacement.Hidden)\n            .setDisplayMode('transparent')\n            .build();\n\n          return (\n            <div className={styles.tableTimeSeriesWrap}>\n              <div className={styles.tableTimeSeries}>\n                <timeSeries.Component model={timeSeries} />\n              </div>\n            </div>\n          );\n        },\n      },\n      {\n        id: 'count',\n        header: 'Count',\n        sortType: 'number',\n        cell: (props) => {\n          const value = scaledUnits(1000, SCALED_UNITS)(props.cell.row.original.sum);\n          return (\n            <div className={styles.countTextWrap}>\n              <div>\n                {value.prefix ?? ''}\n                {value.text}\n                {value.suffix ?? ''}\n              </div>\n            </div>\n          );\n        },\n      },\n      {\n        id: 'percent',\n        header: '%',\n        sortType: 'number',\n        cell: (props) => (\n          <div className={styles.countTextWrap}>\n            <div>{((100 * props.cell.row.original.sum) / total).toFixed(0)}%</div>\n          </div>\n        ),\n      },\n      {\n        id: 'pattern',\n        header: 'Pattern',\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          return (\n            <div className={cx(getTablePatternTextStyles(), styles.tablePatternTextDefault)}>\n              <PatternNameLabel exploration={getExplorationFor(this)} pattern={props.cell.row.original.pattern} />\n            </div>\n          );\n        },\n      },\n      {\n        id: 'include',\n        header: undefined,\n        disableGrow: true,\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          if (patternsNotMatchingFilters?.includes(props.cell.row.original.pattern)) {\n            return undefined;\n          }\n\n          const existingPattern = appliedPatterns?.find(\n            (appliedPattern) => appliedPattern.pattern === props.cell.row.original.pattern\n          );\n          const isIncluded = existingPattern?.type === 'include';\n          const isExcluded = existingPattern?.type === 'exclude';\n          return (\n            <FilterButton\n              isExcluded={isExcluded}\n              isIncluded={isIncluded}\n              onInclude={() => props.cell.row.original.includeLink()}\n              onExclude={() => props.cell.row.original.excludeLink()}\n              onClear={() => props.cell.row.original.undoLink()}\n              buttonFill={'outline'}\n            />\n          );\n        },\n      },\n    ];\n    return columns;\n  }\n\n  /**\n   * Filter visible patterns in table, and return cell data for InteractiveTable\n   * @param patternFrames\n   * @param legendSyncPatterns\n   * @private\n   */\n  public buildTableData(patternFrames: PatternFrame[], legendSyncPatterns: Set<string>): PatternsTableCellData[] {\n    const logExploration = sceneGraph.getAncestor(this, IndexScene);\n    return patternFrames\n      .filter((patternFrame) => {\n        return legendSyncPatterns.size ? legendSyncPatterns.has(patternFrame.pattern) : true;\n      })\n      .map((pattern: PatternFrame) => {\n        return {\n          dataFrame: pattern.dataFrame,\n          pattern: pattern.pattern,\n          sum: pattern.sum,\n          includeLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'include',\n              indexScene: logExploration,\n            }),\n          excludeLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'exclude',\n              indexScene: logExploration,\n            }),\n          undoLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'undo',\n              indexScene: logExploration,\n            }),\n        };\n      });\n  }\n}\n\nconst theme = config.theme2;\n\nconst getTablePatternTextStyles = () => {\n  return css({\n    minWidth: '200px',\n    fontFamily: theme.typography.fontFamilyMonospace,\n    overflow: 'hidden',\n    overflowWrap: 'break-word',\n  });\n};\n\nconst getTableStyles = (theme: GrafanaTheme2) => {\n  return {\n    link: css({\n      textDecoration: 'underline',\n    }),\n    tableWrap: css({\n      // Override interactive table style\n      '> div': {\n        // Need to define explicit height for overflowX\n        height: 'calc(100vh - 450px)',\n        minHeight: '470px',\n      },\n      // Make table headers sticky\n      th: {\n        top: 0,\n        position: 'sticky',\n        backgroundColor: theme.colors.background.canvas,\n        zIndex: theme.zIndex.navbarFixed,\n      },\n    }),\n  };\n};\nconst getColumnStyles = (theme: GrafanaTheme2) => {\n  return {\n    tablePatternTextDefault: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      minWidth: '200px',\n      maxWidth: '100%',\n      overflow: 'hidden',\n      overflowWrap: 'break-word',\n      fontSize: theme.typography.bodySmall.fontSize,\n      wordBreak: 'break-word',\n    }),\n    countTextWrap: css({\n      textAlign: 'right',\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n    tableTimeSeriesWrap: css({\n      width: '230px',\n      pointerEvents: 'none',\n    }),\n    tableTimeSeries: css({\n      height: '30px',\n      overflow: 'hidden',\n    }),\n  };\n};\n\nexport function PatternTableViewSceneComponent({ model }: SceneComponentProps<PatternsViewTableScene>) {\n  const indexScene = sceneGraph.getAncestor(model, IndexScene);\n  const { patterns: appliedPatterns } = indexScene.useState();\n  const theme = useTheme2();\n  const styles = getTableStyles(theme);\n\n  // Get state from parent\n  const patternsFrameScene = sceneGraph.getAncestor(model, PatternsFrameScene);\n  const { legendSyncPatterns } = patternsFrameScene.useState();\n\n  // Must use local patternFrames as the parent decides if we get the filtered or not\n  const { patternFrames: patternFramesRaw, patternsNotMatchingFilters } = model.useState();\n  const patternFrames = patternFramesRaw ?? [];\n\n  // Calculate total for percentages\n  const total = patternFrames.reduce((previousValue, frame) => {\n    return previousValue + frame.sum;\n  }, 0);\n\n  const tableData = model.buildTableData(patternFrames, legendSyncPatterns);\n  const columns = model.buildColumns(total, appliedPatterns, theme, patternsNotMatchingFilters);\n\n  return (\n    <div data-testid={testIds.patterns.tableWrapper} className={styles.tableWrap}>\n      <InteractiveTable\n        columns={columns}\n        data={tableData}\n        getRowId={(r: PatternsTableCellData) => r.pattern}\n        renderExpandedRow={(row) => <PatternsTableExpandedRow tableViz={model} row={row} />}\n      />\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { ConfigOverrideRule, FieldColor, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataNode,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { LegendDisplayMode, PanelContext, SeriesVisibilityChangeMode } from '@grafana/ui';\nimport { ServiceScene } from '../../ServiceScene';\nimport { onPatternClick } from './FilterByPatternsButton';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { PatternsViewTableScene } from './PatternsViewTableScene';\nimport { config } from '@grafana/runtime';\nimport { css } from '@emotion/css';\nimport { PatternFrame, PatternsBreakdownScene } from './PatternsBreakdownScene';\nimport { areArraysEqual } from '../../../../services/comparison';\nimport { logger } from '../../../../services/logger';\n\nconst palette = config.theme2.visualization.palette;\n\nexport interface PatternsFrameSceneState extends SceneObjectState {\n  body?: SceneCSSGridLayout;\n  loading?: boolean;\n  legendSyncPatterns: Set<string>;\n}\n\nexport class PatternsFrameScene extends SceneObjectBase<PatternsFrameSceneState> {\n  constructor(state?: Partial<PatternsFrameSceneState>) {\n    super({\n      loading: true,\n      ...state,\n      legendSyncPatterns: new Set(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  // parent render\n  public static Component = ({ model }: SceneComponentProps<PatternsFrameScene>) => {\n    const { body, loading } = model.useState();\n    const logsByServiceScene = sceneGraph.getAncestor(model, ServiceScene);\n    const { $patternsData } = logsByServiceScene.useState();\n    const patterns = $patternsData?.state.data?.series;\n\n    return (\n      <div className={styles.container}>\n        {!loading && patterns && patterns.length > 0 && <>{body && <body.Component model={body} />}</>}\n      </div>\n    );\n  };\n\n  private onActivate() {\n    this.updateBody();\n\n    // If the patterns have changed, recalculate the dataframes\n    this._subs.add(\n      sceneGraph.getAncestor(this, ServiceScene).subscribeToState((newState, prevState) => {\n        const newFrame = newState?.$patternsData?.state?.data?.series;\n        const prevFrame = prevState?.$patternsData?.state?.data?.series;\n\n        if (!areArraysEqual(newFrame, prevFrame)) {\n          const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n          this.updatePatterns(patternsBreakdownScene.state.patternFrames);\n\n          // In order to keep the search state from clearing, we need to clear the filtered state\n          patternsBreakdownScene.setState({\n            filteredPatterns: undefined,\n          });\n        }\n      })\n    );\n\n    // If the text search results have changed, update the components to use the filtered dataframe\n    this._subs.add(\n      sceneGraph.getAncestor(this, PatternsBreakdownScene).subscribeToState((newState, prevState) => {\n        const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n        if (newState.filteredPatterns && !areArraysEqual(newState.filteredPatterns, prevState.filteredPatterns)) {\n          this.updatePatterns(patternsBreakdownScene.state.filteredPatterns);\n        } else {\n          // If there is no search string, clear the state\n          if (!patternsBreakdownScene.state.patternFilter) {\n            this.updatePatterns(patternsBreakdownScene.state.patternFrames);\n          }\n        }\n      })\n    );\n  }\n\n  private async updatePatterns(patternFrames: PatternFrame[] = []) {\n    // CSS Grid doesn't need rebuilding, just the children need the updated dataframe\n    this.state.body?.forEachChild((child) => {\n      if (child instanceof VizPanel) {\n        child.setState({\n          $data: this.getTimeseriesDataNode(patternFrames),\n        });\n      }\n      if (child instanceof PatternsViewTableScene) {\n        child.setState({\n          patternFrames,\n        });\n      }\n    });\n  }\n\n  private async updateBody() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternsBreakdownScene.state.patternFrames;\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n\n    const lokiPatterns = serviceScene.state.$patternsData?.state.data?.series;\n    if (!lokiPatterns || !patternFrames) {\n      logger.warn('Failed to update PatternsFrameScene body');\n      return;\n    }\n\n    this.setState({\n      body: this.getSingleViewLayout(),\n      legendSyncPatterns: new Set(),\n      loading: false,\n    });\n  }\n\n  private extendTimeSeriesLegendBus(vizPanel: VizPanel, context: PanelContext) {\n    const originalOnToggleSeriesVisibility = context.onToggleSeriesVisibility;\n\n    context.onToggleSeriesVisibility = (label: string, mode: SeriesVisibilityChangeMode) => {\n      originalOnToggleSeriesVisibility?.(label, mode);\n\n      const override: ConfigOverrideRule | undefined = vizPanel.state.fieldConfig.overrides?.[0];\n      const patternsToShow: string[] = override?.matcher.options.names;\n      const legendSyncPatterns = new Set<string>();\n\n      if (patternsToShow) {\n        patternsToShow.forEach(legendSyncPatterns.add, legendSyncPatterns);\n      }\n\n      this.setState({\n        legendSyncPatterns,\n      });\n    };\n  }\n\n  private getSingleViewLayout() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternsBreakdownScene.state.patternFrames;\n\n    if (!patternFrames) {\n      logger.warn('Failed to set getSingleViewLayout');\n      return;\n    }\n\n    const timeSeries = this.getTimeSeries(patternFrames);\n\n    return new SceneCSSGridLayout({\n      templateColumns: '100%',\n      autoRows: '200px',\n      isLazy: true,\n\n      children: [\n        timeSeries,\n        new PatternsViewTableScene({\n          patternFrames,\n        }),\n      ],\n    });\n  }\n\n  private getTimeSeries(patternFrames: PatternFrame[]) {\n    const logExploration = sceneGraph.getAncestor(this, IndexScene);\n\n    const timeSeries = PanelBuilders.timeseries()\n      .setData(this.getTimeseriesDataNode(patternFrames))\n      .setOption('legend', {\n        asTable: true,\n        showLegend: true,\n        displayMode: LegendDisplayMode.Table,\n        placement: 'right',\n        width: 200,\n      })\n      .setHoverHeader(true)\n      .setUnit('short')\n      .setLinks([\n        {\n          url: '#',\n          targetBlank: false,\n          onClick: (event) => {\n            onPatternClick({\n              pattern: event.origin.labels.name,\n              type: 'include',\n              indexScene: logExploration,\n            });\n          },\n          title: 'Include',\n        },\n        {\n          url: '#',\n          targetBlank: false,\n          onClick: (event) => {\n            onPatternClick({\n              pattern: event.origin.labels.name,\n              type: 'exclude',\n              indexScene: logExploration,\n            });\n          },\n          title: 'Exclude',\n        },\n      ])\n      .build();\n\n    timeSeries.setState({\n      extendPanelContext: (vizPanel, context) => this.extendTimeSeriesLegendBus(vizPanel, context),\n    });\n\n    return timeSeries;\n  }\n\n  private getTimeseriesDataNode(patternFrames: PatternFrame[]) {\n    const timeRange = sceneGraph.getTimeRange(this).state.value;\n\n    return new SceneDataNode({\n      data: {\n        series: patternFrames.map((patternFrame, seriesIndex) => {\n          // Mutating the dataframe config here means that we don't need to update the colors in the table view\n          const dataFrame = patternFrame.dataFrame;\n          dataFrame.fields[1].config.color = overrideToFixedColor(seriesIndex);\n          dataFrame.fields[1].name = '';\n          return dataFrame;\n        }),\n        state: LoadingState.Done,\n        timeRange: timeRange,\n      },\n    });\n  }\n}\n\nexport function overrideToFixedColor(key: keyof typeof palette): FieldColor {\n  return {\n    mode: 'fixed',\n    fixedColor: palette[key] as string,\n  };\n}\n\nconst styles = {\n  container: css({\n    width: '100%',\n    // Hide header on hover hack\n    '.show-on-hover': {\n      display: 'none',\n    },\n  }),\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React, { ChangeEvent } from 'react';\nimport { Field } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { PatternFrame, PatternsBreakdownScene } from './PatternsBreakdownScene';\nimport { debouncedFuzzySearch, fuzzySearch } from '../../../../services/search';\nimport { SearchInput } from '../SearchInput';\nimport { areArraysEqual } from '../../../../services/comparison';\n\nexport interface PatternsViewTextSearchState extends SceneObjectState {}\n\nexport class PatternsViewTextSearch extends SceneObjectBase<PatternsViewTextSearchState> {\n  public static Component = PatternTextSearchComponent;\n\n  constructor(state?: Partial<PatternsViewTextSearchState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  /**\n   * On click callback to clear current text search\n   */\n  public clearSearch = () => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      patternFilter: '',\n    });\n  };\n\n  /**\n   * Search input onchange callback\n   * @param e\n   */\n  public handleSearchChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      patternFilter: e.target.value,\n    });\n  };\n\n  /**\n   * Activation handler\n   * @private\n   */\n  private onActivate() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    this._subs.add(\n      patternsBreakdownScene.subscribeToState((newState, prevState) => {\n        if (newState.patternFilter !== prevState.patternFilter) {\n          const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n          if (patternsBreakdownScene.state.patternFrames) {\n            debouncedFuzzySearch(\n              patternsBreakdownScene.state.patternFrames.map((frame) => frame.pattern),\n              patternsBreakdownScene.state.patternFilter,\n              this.onSearchResult\n            );\n          }\n        }\n      })\n    );\n\n    this._subs.add(\n      patternsBreakdownScene.subscribeToState((newState, prevState) => {\n        // If we have a search string, but no filtered patterns, run the search\n        if (\n          newState.patternFilter &&\n          !newState.filteredPatterns &&\n          newState.patternFrames &&\n          !areArraysEqual(newState.filteredPatterns, prevState.filteredPatterns)\n        ) {\n          fuzzySearch(\n            newState.patternFrames.map((frame) => frame.pattern),\n            newState.patternFilter,\n            this.onSearchResult\n          );\n        }\n      })\n    );\n  }\n\n  /**\n   * Sets the patterns filtered by string match\n   * @param patterns\n   * @param patternFramesOverride\n   */\n  setFilteredPatterns(patterns: string[], patternFramesOverride?: PatternFrame[]) {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternFramesOverride ?? patternsBreakdownScene.state.patternFrames;\n\n    if (patternFrames) {\n      const filteredPatternFrames = patternFrames.filter((patternFrame) => {\n        if (patternsBreakdownScene.state.patternFilter && patternFrames?.length) {\n          return patterns.find((pattern) => pattern === patternFrame.pattern);\n        }\n        return false;\n      });\n\n      patternsBreakdownScene.setState({\n        filteredPatterns: filteredPatternFrames,\n      });\n    }\n  }\n\n  /**\n   * Fuzzy search callback\n   * @param data\n   */\n  onSearchResult = (data: string[][]) => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    // If we have a search string\n    if (patternsBreakdownScene.state.patternFilter) {\n      this.setFilteredPatterns(data[0]);\n    } else if (patternsBreakdownScene.state.filteredPatterns && !patternsBreakdownScene.state.patternFilter) {\n      // Wipe the parent filtered state\n      this.setEmptySearch();\n    }\n  };\n\n  /**\n   * Wipes filtered patterns when search string is empty\n   */\n  private setEmptySearch() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      filteredPatterns: undefined,\n    });\n  }\n}\n\nconst styles = {\n  field: css({\n    label: 'field',\n    marginBottom: 0,\n  }),\n  icon: css({\n    cursor: 'pointer',\n  }),\n};\n\nexport function PatternTextSearchComponent({ model }: SceneComponentProps<PatternsViewTextSearch>) {\n  const patternsBreakdownScene = sceneGraph.getAncestor(model, PatternsBreakdownScene);\n  const { patternFilter } = patternsBreakdownScene.useState();\n  return (\n    <Field className={styles.field}>\n      <SearchInput\n        onChange={model.handleSearchChange}\n        onClear={model.clearSearch}\n        value={patternFilter}\n        placeholder=\"Search patterns\"\n      />\n    </Field>\n  );\n}\n","import { GrotError } from '../../../GrotError';\nimport { TextLink } from '@grafana/ui';\nimport React from 'react';\nimport { PATTERNS_MAX_AGE_HOURS } from './PatternsBreakdownScene';\n\nexport function PatternsNotDetected() {\n  return (\n    <GrotError>\n      <div>\n        <p>\n          <strong>Sorry, we could not detect any patterns.</strong>\n        </p>\n        <p>\n          Check back later or reach out to the team in the{' '}\n          <TextLink href=\"https://slack.grafana.com/\" external>\n            Grafana Labs community Slack channel\n          </TextLink>\n        </p>\n        <p>Patterns let you detect similar log lines to include or exclude from your search.</p>\n      </div>\n    </GrotError>\n  );\n}\n\nexport function PatternsTooOld() {\n  return (\n    <GrotError>\n      <div>\n        <p>\n          <strong>Patterns are only available for the most recent {PATTERNS_MAX_AGE_HOURS} hours of data.</strong>\n        </p>\n        <p>\n          See the{' '}\n          <TextLink\n            href=\"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/patterns/\"\n            external\n          >\n            patterns docs\n          </TextLink>{' '}\n          for more info.\n        </p>\n      </div>\n    </GrotError>\n  );\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { DataFrame, dateTime, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  CustomVariable,\n  SceneComponentProps,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport { Text, useStyles2 } from '@grafana/ui';\nimport { StatusWrapper } from 'Components/ServiceScene/Breakdowns/StatusWrapper';\nimport { VAR_LABEL_GROUP_BY } from 'services/variables';\nimport { ServiceScene } from '../../ServiceScene';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { PatternsFrameScene } from './PatternsFrameScene';\nimport { PatternsViewTextSearch } from './PatternsViewTextSearch';\nimport { PatternsNotDetected, PatternsTooOld } from './PatternsNotDetected';\nimport { areArraysEqual } from '../../../../services/comparison';\n\nexport interface PatternsBreakdownSceneState extends SceneObjectState {\n  body?: SceneFlexLayout;\n  value?: string;\n  loading?: boolean;\n  error?: string;\n  blockingMessage?: string;\n  // The dataframe built from the patterns that we get back from the loki Patterns API\n  patternFrames?: PatternFrame[];\n\n  // Subset of patternFrames, undefined if empty, empty array if search results returned nothing (no data)\n  filteredPatterns?: PatternFrame[];\n  patternFilter: string;\n}\n\nexport type PatternFrame = {\n  dataFrame: DataFrame;\n  pattern: string;\n  sum: number;\n  status?: 'include' | 'exclude';\n};\n\nexport const PATTERNS_MAX_AGE_HOURS = 3;\n\nexport class PatternsBreakdownScene extends SceneObjectBase<PatternsBreakdownSceneState> {\n  constructor(state: Partial<PatternsBreakdownSceneState>) {\n    super({\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [new CustomVariable({ name: VAR_LABEL_GROUP_BY, defaultToAll: true, includeAll: true })],\n        }),\n      loading: true,\n      patternFilter: '',\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  // parent render\n  public static Component = ({ model }: SceneComponentProps<PatternsBreakdownScene>) => {\n    const { body, loading, blockingMessage, patternFrames } = model.useState();\n    const { value: timeRange } = sceneGraph.getTimeRange(model).useState();\n    const styles = useStyles2(getStyles);\n    const timeRangeTooOld = dateTime().diff(timeRange.to, 'hours') >= PATTERNS_MAX_AGE_HOURS;\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          {!loading && !patternFrames && (\n            <div className={styles.patternMissingText}>\n              <Text textAlignment=\"center\" color=\"primary\">\n                <p>There are no pattern matches.</p>\n                <p>Pattern matching has not been configured.</p>\n                <p>Patterns let you detect similar log lines and add or exclude them from your search.</p>\n                <p>To see them in action, add the following to your configuration</p>\n                <p>\n                  <code>--pattern-ingester.enabled=true</code>\n                </p>\n              </Text>\n            </div>\n          )}\n\n          {!loading && patternFrames?.length === 0 && timeRangeTooOld && <PatternsTooOld />}\n          {!loading && patternFrames?.length === 0 && !timeRangeTooOld && <PatternsNotDetected />}\n          {!loading && patternFrames && patternFrames.length > 0 && (\n            <div className={styles.content}>{body && <body.Component model={body} />}</div>\n          )}\n        </StatusWrapper>\n      </div>\n    );\n  };\n\n  private onActivate() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    this.setBody();\n\n    const dataFrames = serviceScene.state.$patternsData?.state.data?.series;\n\n    // If the patterns exist already, update the dataframe\n    if (dataFrames) {\n      this.updatePatternFrames(dataFrames);\n    }\n\n    // Subscribe to changes from pattern API call\n    this._subs.add(serviceScene.state.$patternsData?.subscribeToState(this.onDataChange));\n  }\n\n  private onDataChange = (newState: SceneDataState, prevState: SceneDataState) => {\n    const newFrames = newState.data?.series;\n    const prevFrames = prevState.data?.series;\n\n    if (newState.data?.state === LoadingState.Done) {\n      this.setState({\n        loading: false,\n      });\n\n      if (!areArraysEqual(newFrames, prevFrames)) {\n        this.updatePatternFrames(newFrames);\n      }\n    } else if (newState.data?.state === LoadingState.Loading) {\n      this.setState({\n        loading: true,\n      });\n    }\n  };\n\n  private setBody() {\n    this.setState({\n      body: new SceneFlexLayout({\n        direction: 'column',\n        children: [\n          new SceneFlexItem({\n            ySizing: 'content',\n            body: new PatternsViewTextSearch(),\n          }),\n          new SceneFlexItem({\n            body: new PatternsFrameScene(),\n          }),\n        ],\n      }),\n    });\n  }\n\n  private updatePatternFrames(dataFrames?: DataFrame[]) {\n    if (!dataFrames) {\n      return;\n    }\n\n    const patternFrames = this.dataFrameToPatternFrame(dataFrames);\n\n    this.setState({\n      patternFrames,\n    });\n  }\n\n  private dataFrameToPatternFrame(dataFrame: DataFrame[]): PatternFrame[] {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const appliedPatterns = sceneGraph.getAncestor(serviceScene, IndexScene).state.patterns;\n\n    return dataFrame.map((dataFrame) => {\n      const existingPattern = appliedPatterns?.find((appliedPattern) => appliedPattern.pattern === dataFrame.name);\n\n      const sum: number = dataFrame.meta?.custom?.sum;\n      const patternFrame: PatternFrame = {\n        dataFrame,\n        pattern: dataFrame.name ?? '',\n        sum,\n        status: existingPattern?.type,\n      };\n\n      return patternFrame;\n    });\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      gap: theme.spacing(2),\n    }),\n    controlsRight: css({\n      flexGrow: 0,\n      display: 'flex',\n      justifyContent: 'flex-end',\n    }),\n    controlsLeft: css({\n      display: 'flex',\n      justifyContent: 'flex-left',\n      justifyItems: 'left',\n      width: '100%',\n      flexDirection: 'column',\n    }),\n    patternMissingText: css({\n      padding: theme.spacing(2),\n    }),\n  };\n}\n","import {\n  JSON_FORMAT_EXPR,\n  LEVEL_VARIABLE_VALUE,\n  LOGS_FORMAT_EXPR,\n  MIXED_FORMAT_EXPR,\n  VAR_FIELDS_EXPR,\n  VAR_LABELS_EXPR,\n  VAR_LINE_FILTER_EXPR,\n  VAR_METADATA_EXPR,\n  VAR_PATTERNS_EXPR,\n} from './variables';\nimport { SceneObject } from '@grafana/scenes';\nimport { getParserFromFieldsFilters } from './fields';\nimport { getFieldsVariable } from './variableGetters';\n\n/**\n * Crafts count over time query that excludes empty values for stream selector name\n * Will only add parsers if there are filters that require them.\n * @param sceneRef\n * @param streamSelectorName - the name of the stream selector we are aggregating by\n * @param excludeEmpty - if true, the query will exclude empty values for the given streamSelectorName\n */\nexport function getTimeSeriesExpr(sceneRef: SceneObject, streamSelectorName: string, excludeEmpty = true): string {\n  const fieldsVariable = getFieldsVariable(sceneRef);\n\n  let metadataExpressionToAdd = '';\n  if (excludeEmpty) {\n    // `LEVEL_VARIABLE_VALUE` is a special case where we don't want to add this to the stream selector\n    if (streamSelectorName === LEVEL_VARIABLE_VALUE) {\n      metadataExpressionToAdd = `| ${LEVEL_VARIABLE_VALUE} != \"\"`;\n    }\n  }\n\n  const fieldFilters = fieldsVariable.state.filters;\n  const parser = getParserFromFieldsFilters(fieldsVariable);\n\n  // if we have fields, we also need to add parsers\n  if (fieldFilters.length) {\n    if (parser === 'mixed') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_LINE_FILTER_EXPR} ${VAR_PATTERNS_EXPR} ${MIXED_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n    if (parser === 'json') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_LINE_FILTER_EXPR} ${VAR_PATTERNS_EXPR} ${JSON_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n    if (parser === 'logfmt') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_LINE_FILTER_EXPR} ${VAR_PATTERNS_EXPR} ${LOGS_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n  }\n  return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_LINE_FILTER_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n}\n","import React from 'react';\n\nimport { PanelBuilders, SceneComponentProps, SceneObjectBase, SceneObjectState, VizPanel } from '@grafana/scenes';\nimport { LegendDisplayMode, PanelContext, SeriesVisibilityChangeMode } from '@grafana/ui';\nimport { getQueryRunner, setLogsVolumeFieldConfigs, syncLogsPanelVisibleSeries } from 'services/panel';\nimport { buildDataQuery } from 'services/query';\nimport { LEVEL_VARIABLE_VALUE } from 'services/variables';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getTimeSeriesExpr } from '../../services/expressions';\nimport { toggleLevelFromFilter } from 'services/levels';\nimport { LoadingState } from '@grafana/data';\nimport { getFieldsVariable, getLabelsVariable, getLevelsVariable } from '../../services/variableGetters';\nimport { areArraysEqual } from '../../services/comparison';\n\nexport interface LogsVolumePanelState extends SceneObjectState {\n  panel?: VizPanel;\n}\n\nexport class LogsVolumePanel extends SceneObjectBase<LogsVolumePanelState> {\n  constructor(state: LogsVolumePanelState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    if (!this.state.panel) {\n      this.setState({\n        panel: this.getVizPanel(),\n      });\n    }\n\n    const labels = getLabelsVariable(this);\n    const fields = getFieldsVariable(this);\n\n    labels.subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.setState({\n          panel: this.getVizPanel(),\n        });\n      }\n    });\n\n    fields.subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.setState({\n          panel: this.getVizPanel(),\n        });\n      }\n    });\n  }\n\n  private getVizPanel() {\n    const viz = PanelBuilders.timeseries()\n      .setTitle('Log volume')\n      .setOption('legend', { showLegend: true, calcs: ['sum'], displayMode: LegendDisplayMode.List })\n      .setUnit('short')\n      .setData(\n        getQueryRunner([\n          buildDataQuery(getTimeSeriesExpr(this, LEVEL_VARIABLE_VALUE, false), {\n            legendFormat: `{{${LEVEL_VARIABLE_VALUE}}}`,\n          }),\n        ])\n      );\n\n    setLogsVolumeFieldConfigs(viz);\n\n    const panel = viz.build();\n    panel.setState({\n      extendPanelContext: (_, context) => this.extendTimeSeriesLegendBus(context),\n    });\n\n    this._subs.add(\n      panel.state.$data?.subscribeToState((newState) => {\n        if (newState.data?.state !== LoadingState.Done) {\n          return;\n        }\n\n        syncLogsPanelVisibleSeries(panel, newState.data.series, this);\n      })\n    );\n\n    return panel;\n  }\n\n  private extendTimeSeriesLegendBus = (context: PanelContext) => {\n    const levelFilter = getLevelsVariable(this);\n    this._subs.add(\n      levelFilter?.subscribeToState(() => {\n        const panel = this.state.panel;\n        if (!panel?.state.$data?.state.data?.series) {\n          return;\n        }\n\n        syncLogsPanelVisibleSeries(panel, panel?.state.$data?.state.data?.series, this);\n      })\n    );\n\n    context.onToggleSeriesVisibility = (level: string, mode: SeriesVisibilityChangeMode) => {\n      // @TODO. We don't yet support filters with multiple values.\n      if (mode === SeriesVisibilityChangeMode.AppendToSelection) {\n        return;\n      }\n\n      const action = toggleLevelFromFilter(level, this);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.level_in_logs_volume_clicked,\n        {\n          level,\n          action,\n        }\n      );\n    };\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LogsVolumePanel>) => {\n    const { panel } = model.useState();\n    if (!panel) {\n      return;\n    }\n\n    return <panel.Component model={panel} />;\n  };\n}\n","import { PageSlugs, ValueSlugs } from '../../services/routing';\nimport { LogsListScene } from './LogsListScene';\nimport { testIds } from '../../services/testIds';\nimport { LabelBreakdownScene } from './Breakdowns/LabelBreakdownScene';\nimport { FieldsBreakdownScene } from './Breakdowns/FieldsBreakdownScene';\nimport { PatternsBreakdownScene } from './Breakdowns/Patterns/PatternsBreakdownScene';\nimport { SceneFlexItem, SceneFlexLayout, SceneObject } from '@grafana/scenes';\nimport { LogsVolumePanel } from './LogsVolumePanel';\nimport { buildLabelValuesBreakdownActionScene } from '../../services/labels';\n\ninterface ValueBreakdownViewDefinition {\n  displayName: string;\n  value: ValueSlugs;\n  testId: string;\n  getScene: (value: string) => SceneObject;\n}\n\nexport enum TabNames {\n  logs = 'Logs',\n  labels = 'Labels',\n  fields = 'Fields',\n  patterns = 'Patterns',\n}\nexport interface BreakdownViewDefinition {\n  displayName: TabNames;\n  value: PageSlugs;\n  testId: string;\n  getScene: (changeFields: (f: number) => void) => SceneObject;\n}\n\nexport const breakdownViewsDefinitions: BreakdownViewDefinition[] = [\n  {\n    displayName: TabNames.logs,\n    value: PageSlugs.logs,\n    getScene: () => buildLogsListScene(),\n    testId: testIds.exploreServiceDetails.tabLogs,\n  },\n  {\n    displayName: TabNames.labels,\n    value: PageSlugs.labels,\n    getScene: () => buildLabelBreakdownActionScene(),\n    testId: testIds.exploreServiceDetails.tabLabels,\n  },\n  {\n    displayName: TabNames.fields,\n    value: PageSlugs.fields,\n    getScene: (f) => buildFieldsBreakdownActionScene(f),\n    testId: testIds.exploreServiceDetails.tabFields,\n  },\n  {\n    displayName: TabNames.patterns,\n    value: PageSlugs.patterns,\n    getScene: () => buildPatternsScene(),\n    testId: testIds.exploreServiceDetails.tabPatterns,\n  },\n];\nexport const valueBreakdownViews: ValueBreakdownViewDefinition[] = [\n  {\n    displayName: 'Label',\n    value: ValueSlugs.label,\n    getScene: (value: string) => buildLabelValuesBreakdownActionScene(value),\n    testId: testIds.exploreServiceDetails.tabLabels,\n  },\n  {\n    displayName: 'Field',\n    value: ValueSlugs.field,\n    getScene: (value: string) => buildFieldValuesBreakdownActionScene(value),\n    testId: testIds.exploreServiceDetails.tabFields,\n  },\n];\n\nfunction buildPatternsScene() {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new PatternsBreakdownScene({}),\n      }),\n    ],\n  });\n}\n\nfunction buildFieldsBreakdownActionScene(changeFieldNumber: (n: number) => void) {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new FieldsBreakdownScene({ changeFieldCount: changeFieldNumber }),\n      }),\n    ],\n  });\n}\n\nfunction buildFieldValuesBreakdownActionScene(value: string) {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new FieldsBreakdownScene({ value }),\n      }),\n    ],\n  });\n}\n\nfunction buildLogsListScene() {\n  return new SceneFlexLayout({\n    direction: 'column',\n    children: [\n      new SceneFlexItem({\n        minHeight: 200,\n        body: new LogsVolumePanel({}),\n      }),\n      new SceneFlexItem({\n        minHeight: '470px',\n        height: 'calc(100vh - 500px)',\n        body: new LogsListScene({}),\n      }),\n    ],\n  });\n}\n\nfunction buildLabelBreakdownActionScene() {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new LabelBreakdownScene({}),\n      }),\n    ],\n  });\n}\n","import { SceneComponentProps, sceneGraph, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Box, Dropdown, Menu, Stack, Tab, TabsBar, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport { getExplorationFor } from '../../services/scenes';\nimport { getDrilldownSlug, getDrilldownValueSlug, PageSlugs, ValueSlugs } from '../../services/routing';\nimport { GoToExploreButton } from './GoToExploreButton';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { navigateToDrilldownPage } from '../../services/navigate';\nimport React, { useEffect, useState } from 'react';\nimport { ServiceScene, ServiceSceneState } from './ServiceScene';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { BreakdownViewDefinition, breakdownViewsDefinitions } from './BreakdownViews';\nimport { config, usePluginLinks } from '@grafana/runtime';\nimport { getLabelsVariable } from '../../services/variableGetters';\n\nexport interface ActionBarSceneState extends SceneObjectState {}\n\nexport class ActionBarScene extends SceneObjectBase<ActionBarSceneState> {\n  public static Component = ({ model }: SceneComponentProps<ActionBarScene>) => {\n    const styles = useStyles2(getStyles);\n    const exploration = getExplorationFor(model);\n    let currentBreakdownViewSlug = getDrilldownSlug();\n    let allowNavToParent = false;\n\n    if (!Object.values(PageSlugs).includes(currentBreakdownViewSlug)) {\n      const drilldownValueSlug = getDrilldownValueSlug();\n      allowNavToParent = true;\n      if (drilldownValueSlug === ValueSlugs.field) {\n        currentBreakdownViewSlug = PageSlugs.fields;\n      }\n      if (drilldownValueSlug === ValueSlugs.label) {\n        currentBreakdownViewSlug = PageSlugs.labels;\n      }\n    }\n\n    const serviceScene = sceneGraph.getAncestor(model, ServiceScene);\n    const { loading, $data, ...state } = serviceScene.useState();\n    const loadingStates = state.loadingStates;\n\n    return (\n      <Box paddingY={0}>\n        <div className={styles.actions}>\n          <Stack gap={1}>\n            {config.featureToggles.appSidecar && <ToolbarExtensionsRenderer serviceScene={serviceScene} />}\n            <GoToExploreButton exploration={exploration} />\n          </Stack>\n        </div>\n\n        <TabsBar>\n          {breakdownViewsDefinitions.map((tab, index) => {\n            return (\n              <Tab\n                data-testid={tab.testId}\n                key={index}\n                label={tab.displayName}\n                active={currentBreakdownViewSlug === tab.value}\n                counter={loadingStates[tab.displayName] ? undefined : getCounter(tab, { ...state, $data })}\n                icon={loadingStates[tab.displayName] ? 'spinner' : undefined}\n                onChangeTab={() => {\n                  if ((tab.value && tab.value !== currentBreakdownViewSlug) || allowNavToParent) {\n                    reportAppInteraction(\n                      USER_EVENTS_PAGES.service_details,\n                      USER_EVENTS_ACTIONS.service_details.action_view_changed,\n                      {\n                        newActionView: tab.value,\n                        previousActionView: currentBreakdownViewSlug,\n                      }\n                    );\n\n                    const serviceScene = sceneGraph.getAncestor(model, ServiceScene);\n                    navigateToDrilldownPage(tab.value, serviceScene);\n                  }\n                }}\n              />\n            );\n          })}\n        </TabsBar>\n      </Box>\n    );\n  };\n}\nconst getCounter = (tab: BreakdownViewDefinition, state: ServiceSceneState) => {\n  switch (tab.value) {\n    case 'fields':\n      return state.fieldsCount;\n    case 'patterns':\n      return state.patternsCount;\n    case 'labels':\n      return state.labelsCount;\n    default:\n      return undefined;\n  }\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    actions: css({\n      [theme.breakpoints.up(theme.breakpoints.values.md)]: {\n        position: 'absolute',\n        right: 0,\n        zIndex: 2,\n      },\n    }),\n  };\n}\n\n/**\n * Shows extensions in the toolbar.\n * Shows a single button if there is only one extension or a dropdown if there are multiple.\n * @param props\n * @constructor\n */\nfunction ToolbarExtensionsRenderer(props: { serviceScene: SceneObject }) {\n  const [filters, setFilters] = useState<Array<{ key: string; value: string }>>(\n    getLabelsVariable(props.serviceScene).state.filters\n  );\n  useEffect(() => {\n    const sub = getLabelsVariable(props.serviceScene).subscribeToState((newState) => {\n      setFilters(newState.filters);\n    });\n    return () => {\n      sub.unsubscribe();\n    };\n  }, [props.serviceScene]);\n\n  const [isOpen, setIsOpen] = useState<boolean>(false);\n  const extensions = usePluginLinks({\n    extensionPointId: 'grafana-lokiexplore-app/toolbar-open-related/v1',\n    limitPerPlugin: 3,\n    context: { filters },\n  });\n\n  if (extensions.isLoading || extensions.links.length === 0) {\n    return null;\n  }\n\n  if (extensions.links.length === 1) {\n    const e = extensions.links[0];\n\n    return (\n      <div>\n        <ToolbarButton variant={'canvas'} key={e.id} onClick={(event) => e.onClick?.(event)} icon={e.icon}>\n          Related {e.title}\n        </ToolbarButton>\n      </div>\n    );\n  }\n\n  const menu = (\n    <Menu>\n      {extensions.links.map((link) => {\n        return (\n          <Menu.Item\n            ariaLabel={link.title}\n            icon={link?.icon || 'plug'}\n            key={link.id}\n            label={link.title}\n            onClick={(event) => {\n              link.onClick?.(event);\n            }}\n          />\n        );\n      })}\n    </Menu>\n  );\n\n  return (\n    <Dropdown onVisibleChange={setIsOpen} placement=\"bottom-start\" overlay={menu}>\n      <ToolbarButton aria-label=\"Open related\" variant=\"canvas\" isOpen={isOpen}>\n        Open related\n      </ToolbarButton>\n    </Dropdown>\n  );\n}\n","import React from 'react';\n\nimport { LoadingState, PanelData } from '@grafana/data';\nimport {\n  QueryRunnerState,\n  SceneComponentProps,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VariableDependencyConfig,\n} from '@grafana/scenes';\nimport { LoadingPlaceholder } from '@grafana/ui';\nimport { getQueryRunner, getResourceQueryRunner } from 'services/panel';\nimport { buildDataQuery, buildResourceQuery } from 'services/query';\nimport {\n  EMPTY_VARIABLE_VALUE,\n  LEVEL_VARIABLE_VALUE,\n  LOG_STREAM_SELECTOR_EXPR,\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  VAR_DATASOURCE,\n  VAR_FIELDS,\n  VAR_LABELS,\n  VAR_LABELS_EXPR,\n  VAR_LEVELS,\n  VAR_PATTERNS,\n} from 'services/variables';\nimport { getMetadataService } from '../../services/metadata';\nimport { navigateToDrilldownPage, navigateToIndex, navigateToValueBreakdown } from '../../services/navigate';\nimport { areArraysEqual } from '../../services/comparison';\nimport { ActionBarScene } from './ActionBarScene';\nimport { breakdownViewsDefinitions, TabNames, valueBreakdownViews } from './BreakdownViews';\nimport {\n  getDataSourceVariable,\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getMetadataVariable,\n  getPatternsVariable,\n} from '../../services/variableGetters';\nimport { logger } from '../../services/logger';\nimport { IndexScene, showLogsButtonSceneKey } from '../IndexScene/IndexScene';\nimport {\n  getDrilldownSlug,\n  getDrilldownValueSlug,\n  getPrimaryLabelFromUrl,\n  PageSlugs,\n  ValueSlugs,\n} from '../../services/routing';\nimport { replaceSlash } from '../../services/extensions/links';\nimport { ShowLogsButtonScene } from '../IndexScene/ShowLogsButtonScene';\n\nconst LOGS_PANEL_QUERY_REFID = 'logsPanelQuery';\nconst PATTERNS_QUERY_REFID = 'patterns';\nconst DETECTED_LABELS_QUERY_REFID = 'detectedLabels';\nconst DETECTED_FIELDS_QUERY_REFID = 'detectedFields';\n\ntype MakeOptional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\ntype ServiceSceneLoadingStates = {\n  [name in TabNames]: boolean;\n};\n\nexport interface ServiceSceneCustomState {\n  labelsCount?: number;\n  patternsCount?: number;\n  fieldsCount?: number;\n  loading?: boolean;\n}\n\nexport interface ServiceSceneState extends SceneObjectState, ServiceSceneCustomState {\n  body: SceneFlexLayout | undefined;\n  drillDownLabel?: string;\n  $data: SceneDataProvider | undefined;\n  $patternsData: SceneQueryRunner | undefined;\n  $detectedLabelsData: SceneQueryRunner | undefined;\n  $detectedFieldsData: SceneQueryRunner | undefined;\n  loadingStates: ServiceSceneLoadingStates;\n}\n\nexport function getLogsPanelFrame(data: PanelData | undefined) {\n  return data?.series.find((series) => series.refId === LOGS_PANEL_QUERY_REFID);\n}\n\nexport function getDetectedLabelsFrame(sceneRef: SceneObject) {\n  const serviceScene = sceneGraph.getAncestor(sceneRef, ServiceScene);\n  return serviceScene.state.$detectedLabelsData?.state.data?.series?.[0];\n}\n\nexport function getDetectedFieldsFrame(sceneRef: SceneObject) {\n  const serviceScene = sceneGraph.getAncestor(sceneRef, ServiceScene);\n  return getDetectedFieldsFrameFromQueryRunnerState(serviceScene.state.$detectedFieldsData?.state);\n}\n\nexport const getDetectedFieldsFrameFromQueryRunnerState = (state?: QueryRunnerState) => {\n  // Only ever one frame in the response\n  return state?.data?.series?.[0];\n};\n\nexport const getDetectedFieldsNamesFromQueryRunnerState = (state: QueryRunnerState) => {\n  // The first field, DETECTED_FIELDS_NAME_FIELD, has the list of names of the detected fields\n  return state.data?.series?.[0]?.fields?.[0];\n};\n\nexport const getDetectedFieldsParsersFromQueryRunnerState = (state: QueryRunnerState) => {\n  // The third field, DETECTED_FIELDS_PARSER_NAME, has the list of parsers of the detected fields\n  return state.data?.series?.[0]?.fields?.[2];\n};\n\nexport class ServiceScene extends SceneObjectBase<ServiceSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_DATASOURCE, VAR_LABELS, VAR_FIELDS, VAR_PATTERNS, VAR_LEVELS],\n  });\n\n  public constructor(\n    state: MakeOptional<\n      ServiceSceneState,\n      'body' | '$data' | '$patternsData' | '$detectedLabelsData' | '$detectedFieldsData' | 'loadingStates'\n    >\n  ) {\n    super({\n      loadingStates: {\n        [TabNames.patterns]: false,\n        [TabNames.labels]: false,\n        [TabNames.fields]: false,\n        [TabNames.logs]: false,\n      },\n      loading: true,\n      body: state.body ?? buildGraphScene(),\n      $data: getServiceSceneQueryRunner(),\n      $patternsData: getPatternsQueryRunner(),\n      $detectedLabelsData: getDetectedLabelsQueryRunner(),\n      $detectedFieldsData: getDetectedFieldsQueryRunner(),\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private setSubscribeToLabelsVariable() {\n    const variable = getLabelsVariable(this);\n    if (variable.state.filters.length === 0) {\n      this.redirectToStart();\n      return;\n    }\n    this._subs.add(\n      variable.subscribeToState((newState, prevState) => {\n        if (newState.filters.length === 0) {\n          this.redirectToStart();\n        }\n        // If we remove the service name filter, we should redirect to the start\n        let { labelName, labelValue, breakdownLabel } = getPrimaryLabelFromUrl();\n\n        // Before we dynamically pulled label filter keys into the URL, we had hardcoded \"service\" as the primary label slug, we want to keep URLs the same, so overwrite \"service_name\" with \"service\" if that's the primary label\n        if (labelName === SERVICE_UI_LABEL) {\n          labelName = SERVICE_NAME;\n        }\n        const indexScene = sceneGraph.getAncestor(this, IndexScene);\n        const prevRouteMatch = indexScene.state.routeMatch;\n\n        // The \"primary\" label used in the URL is no longer active, pick a new one\n        if (!newState.filters.some((f) => f.key === labelName && f.operator === '=' && f.value === labelValue)) {\n          const newPrimaryLabel = newState.filters.find((f) => f.operator === '=' && f.value !== EMPTY_VARIABLE_VALUE);\n          if (newPrimaryLabel) {\n            indexScene.setState({\n              routeMatch: {\n                ...prevRouteMatch,\n                params: {\n                  ...prevRouteMatch?.params,\n                  labelName: newPrimaryLabel.key === SERVICE_NAME ? SERVICE_UI_LABEL : newPrimaryLabel.key,\n                  labelValue: replaceSlash(newPrimaryLabel.value),\n                },\n                url: prevRouteMatch?.url ?? '',\n                path: prevRouteMatch?.path ?? '',\n                isExact: prevRouteMatch?.isExact ?? true,\n              },\n            });\n\n            this.resetTabCount();\n\n            if (!breakdownLabel) {\n              navigateToDrilldownPage(getDrilldownSlug(), this);\n            } else {\n              navigateToValueBreakdown(getDrilldownValueSlug(), breakdownLabel, this);\n            }\n          } else {\n            this.redirectToStart();\n          }\n        } else if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.state.$patternsData?.runQueries();\n          this.state.$detectedLabelsData?.runQueries();\n          this.state.$detectedFieldsData?.runQueries();\n        }\n      })\n    );\n  }\n\n  private redirectToStart() {\n    // Clear ongoing queries\n    this.setState({\n      $data: undefined,\n      body: undefined,\n      $patternsData: undefined,\n      $detectedLabelsData: undefined,\n      $detectedFieldsData: undefined,\n      patternsCount: undefined,\n      labelsCount: undefined,\n      fieldsCount: undefined,\n    });\n    getMetadataService().setServiceSceneState(this.state);\n    this._subs.unsubscribe();\n\n    this.clearAdHocVariables();\n\n    // Redirect to root with updated params, which will trigger history push back to index route, preventing empty page or empty service query bugs\n    navigateToIndex();\n  }\n\n  /**\n   * If the scene has previously been activated, we can see cached variable states when re-activating\n   * To prevent this we clear out the variable filters\n   */\n  private clearAdHocVariables = () => {\n    const variables = [getLabelsVariable(this), getFieldsVariable(this), getLevelsVariable(this)];\n    variables.forEach((variable) => {\n      variable.setState({\n        filters: [],\n      });\n    });\n  };\n\n  /**\n   * After routing we need to pull any data set to the service scene by other routes from the metadata singleton,\n   * as each route has a different instantiation of this scene\n   * @private\n   */\n  private getMetadata() {\n    const metadataService = getMetadataService();\n    const state = metadataService.getServiceSceneState();\n\n    if (state) {\n      this.setState({\n        ...state,\n      });\n    }\n  }\n\n  private onActivate() {\n    // Hide show logs button\n    const showLogsButton = sceneGraph.findByKeyAndType(this, showLogsButtonSceneKey, ShowLogsButtonScene);\n    showLogsButton.setState({ hidden: true });\n    this.getMetadata();\n    this.resetBodyAndData();\n\n    this.setBreakdownView();\n\n    // Run queries on activate\n    this.runQueries();\n\n    // Query Subscriptions\n    this._subs.add(this.subscribeToPatternsQuery());\n    this._subs.add(this.subscribeToDetectedLabelsQuery());\n\n    // Fields tab will update its own count, and update count when a query fails\n    this._subs.add(this.subscribeToDetectedFieldsQuery(getDrilldownSlug() !== PageSlugs.fields));\n    this._subs.add(this.subscribeToLogsQuery());\n\n    // Variable subscriptions\n    this.setSubscribeToLabelsVariable();\n    this._subs.add(this.subscribeToFieldsVariable());\n    this._subs.add(this.subscribeToMetadataVariable());\n    this._subs.add(this.subscribeToLevelsVariable());\n    this._subs.add(this.subscribeToDataSourceVariable());\n    this._subs.add(this.subscribeToPatternsVariable());\n\n    // Update query runner on manual time range change\n    this._subs.add(this.subscribeToTimeRange());\n  }\n\n  private subscribeToPatternsVariable() {\n    return getPatternsVariable(this).subscribeToState((newState, prevState) => {\n      if (newState.value !== prevState.value) {\n        this.state.$detectedFieldsData?.runQueries();\n      }\n    });\n  }\n\n  private subscribeToDataSourceVariable() {\n    return getDataSourceVariable(this).subscribeToState(() => {\n      this.redirectToStart();\n    });\n  }\n\n  private resetTabCount() {\n    this.setState({\n      fieldsCount: undefined,\n      labelsCount: undefined,\n      patternsCount: undefined,\n    });\n\n    getMetadataService().setServiceSceneState(this.state);\n  }\n\n  private subscribeToFieldsVariable() {\n    return getFieldsVariable(this).subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$detectedFieldsData?.runQueries();\n      }\n    });\n  }\n\n  private subscribeToMetadataVariable() {\n    return getMetadataVariable(this).subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$detectedFieldsData?.runQueries();\n      }\n    });\n  }\n\n  private subscribeToLevelsVariable() {\n    return getLevelsVariable(this).subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$detectedFieldsData?.runQueries();\n      }\n    });\n  }\n\n  private runQueries() {\n    const slug = getDrilldownSlug();\n    const parentSlug = getDrilldownValueSlug();\n\n    // If we don't have a patterns count in the tabs, or we are activating the patterns scene, run the pattern query\n    if (slug === PageSlugs.patterns || this.state.patternsCount === undefined) {\n      this.state.$patternsData?.runQueries();\n    }\n\n    // If we don't have a detected labels count, or we are activating the labels scene, run the detected labels query\n    if (slug === PageSlugs.labels || parentSlug === ValueSlugs.label || this.state.labelsCount === undefined) {\n      this.state.$detectedLabelsData?.runQueries();\n    }\n\n    // If we don't have a detected fields count, or we are activating the fields scene, run the detected fields query\n    if (slug === PageSlugs.fields || parentSlug === ValueSlugs.field || this.state.fieldsCount === undefined) {\n      this.state.$detectedFieldsData?.runQueries();\n    }\n  }\n\n  private subscribeToPatternsQuery() {\n    return this.state.$patternsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.patterns);\n      if (newState.data?.state === LoadingState.Done) {\n        const patternsResponse = newState.data.series;\n        if (patternsResponse?.length !== undefined) {\n          // Save the count of patterns to state\n          this.setState({\n            patternsCount: patternsResponse.length,\n          });\n          getMetadataService().setPatternsCount(patternsResponse.length);\n        }\n      }\n    });\n  }\n\n  private subscribeToDetectedLabelsQuery() {\n    return this.state.$detectedLabelsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.labels);\n      if (newState.data?.state === LoadingState.Done) {\n        const detectedLabelsResponse = newState.data;\n        // Detected labels API call always returns a single frame, with a field for each label\n        const detectedLabelsFields = detectedLabelsResponse.series[0].fields;\n        if (detectedLabelsResponse.series.length !== undefined && detectedLabelsFields.length !== undefined) {\n          const removeSpecialFields = detectedLabelsResponse.series[0].fields.filter(\n            (f) => LEVEL_VARIABLE_VALUE !== f.name\n          );\n\n          this.setState({\n            labelsCount: removeSpecialFields.length + 1, // Add one for detected_level\n          });\n          getMetadataService().setLabelsCount(detectedLabelsFields.length);\n        }\n      }\n    });\n  }\n\n  private updateLoadingState(newState: SceneDataState, key: keyof ServiceSceneLoadingStates) {\n    const loadingStates = this.state.loadingStates;\n    loadingStates[key] = newState.data?.state === LoadingState.Loading;\n    // set loading state to true if any of the queries are loading\n    const loading = Object.values(loadingStates).some((v) => v);\n    this.setState({ loading, loadingStates });\n  }\n\n  private subscribeToLogsQuery() {\n    return this.state.$data?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.logs);\n    });\n  }\n\n  private subscribeToDetectedFieldsQuery(updateFieldsCount: boolean) {\n    return this.state.$detectedFieldsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.fields);\n      if (updateFieldsCount && newState.data?.state === LoadingState.Done) {\n        const detectedFieldsResponse = newState.data;\n        const detectedFieldsFields = detectedFieldsResponse.series[0];\n\n        if (detectedFieldsFields !== undefined && detectedFieldsFields.length !== this.state.fieldsCount) {\n          this.setState({\n            fieldsCount: detectedFieldsFields.length,\n          });\n          getMetadataService().setFieldsCount(detectedFieldsFields.length);\n        }\n      }\n    });\n  }\n\n  private subscribeToTimeRange() {\n    return sceneGraph.getTimeRange(this).subscribeToState(() => {\n      this.state.$patternsData?.runQueries();\n      this.state.$detectedLabelsData?.runQueries();\n      this.state.$detectedFieldsData?.runQueries();\n    });\n  }\n\n  private resetBodyAndData() {\n    let stateUpdate: Partial<ServiceSceneState> = {};\n\n    if (!this.state.$data) {\n      stateUpdate.$data = getServiceSceneQueryRunner();\n    }\n\n    if (!this.state.$patternsData) {\n      stateUpdate.$patternsData = getPatternsQueryRunner();\n    }\n\n    if (!this.state.$detectedLabelsData) {\n      stateUpdate.$detectedLabelsData = getDetectedLabelsQueryRunner();\n    }\n\n    if (!this.state.$detectedFieldsData) {\n      stateUpdate.$detectedFieldsData = getDetectedFieldsQueryRunner();\n    }\n\n    if (!this.state.body) {\n      stateUpdate.body = buildGraphScene();\n    }\n\n    if (Object.keys(stateUpdate).length) {\n      this.setState(stateUpdate);\n    }\n  }\n\n  public setBreakdownView() {\n    const { body } = this.state;\n    const breakdownView = getDrilldownSlug();\n    const breakdownViewDef = breakdownViewsDefinitions.find((v) => v.value === breakdownView);\n\n    if (!body) {\n      const err = new Error('body is not defined in setBreakdownView!');\n      logger.error(err, { msg: 'ServiceScene setBreakdownView error' });\n      throw err;\n    }\n\n    if (breakdownViewDef) {\n      body.setState({\n        children: [\n          ...body.state.children.slice(0, 1),\n          breakdownViewDef.getScene((length) => {\n            if (breakdownViewDef.value === 'fields') {\n              this.setState({ fieldsCount: length });\n            }\n          }),\n        ],\n      });\n    } else {\n      const valueBreakdownView = getDrilldownValueSlug();\n      const valueBreakdownViewDef = valueBreakdownViews.find((v) => v.value === valueBreakdownView);\n\n      if (valueBreakdownViewDef && this.state.drillDownLabel) {\n        body.setState({\n          children: [...body.state.children.slice(0, 1), valueBreakdownViewDef.getScene(this.state.drillDownLabel)],\n        });\n      } else {\n        logger.error(new Error('not setting breakdown view'));\n      }\n    }\n  }\n\n  static Component = ({ model }: SceneComponentProps<ServiceScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n\nfunction buildGraphScene() {\n  return new SceneFlexLayout({\n    direction: 'column',\n    children: [\n      new SceneFlexItem({\n        ySizing: 'content',\n        body: new ActionBarScene({}),\n      }),\n    ],\n  });\n}\n\nfunction getPatternsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(`{${VAR_LABELS_EXPR}}`, 'patterns', { refId: PATTERNS_QUERY_REFID }),\n  ]);\n}\n\nfunction getDetectedLabelsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(`{${VAR_LABELS_EXPR}}`, 'detected_labels', { refId: DETECTED_LABELS_QUERY_REFID }),\n  ]);\n}\n\nfunction getDetectedFieldsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(LOG_STREAM_SELECTOR_EXPR, 'detected_fields', { refId: DETECTED_FIELDS_QUERY_REFID }),\n  ]);\n}\n\nfunction getServiceSceneQueryRunner() {\n  return getQueryRunner([buildDataQuery(LOG_STREAM_SELECTOR_EXPR, { refId: LOGS_PANEL_QUERY_REFID })]);\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\nimport { Icon, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { getFavoriteLabelValuesFromStorage } from '../../services/store';\nimport { addToFavorites, removeFromFavorites } from '../../services/favorites';\n\nexport interface FavoriteServiceHeaderActionSceneState extends SceneObjectState {\n  labelValue: string;\n  labelName: string;\n  ds: string;\n  hover?: boolean;\n}\n\nexport class FavoriteServiceHeaderActionScene extends SceneObjectBase<FavoriteServiceHeaderActionSceneState> {\n  public static Component = ({ model }: SceneComponentProps<FavoriteServiceHeaderActionScene>) => {\n    const { ds, labelValue, labelName, hover } = model.useState();\n    const isFavorite = getFavoriteLabelValuesFromStorage(ds, labelName).includes(labelValue);\n    const styles = useStyles2((theme) => getStyles(theme, isFavorite, hover));\n    const tooltipCopy = isFavorite ? `Remove  ${labelValue} from favorites` : `Add ${labelValue} to favorites`;\n\n    return (\n      <span className={styles.wrapper}>\n        <ToolbarButton\n          onMouseOver={() => {\n            model.setHover(true);\n          }}\n          onMouseOut={() => {\n            model.setHover(false);\n          }}\n          icon={<Icon name={isFavorite ? 'favorite' : 'star'} size=\"lg\" type={isFavorite ? 'mono' : 'default'} />}\n          color={isFavorite ? 'rgb(235, 123, 24)' : '#ccc'}\n          onClick={() => model.onClick(isFavorite)}\n          name={'star'}\n          aria-label={tooltipCopy}\n          tooltip={tooltipCopy}\n        />\n      </span>\n    );\n  };\n\n  public setHover(hover: boolean) {\n    this.setState({\n      hover,\n    });\n  }\n\n  public onClick(isFavorite: boolean) {\n    if (isFavorite) {\n      removeFromFavorites(this.state.labelName, this.state.labelValue, this);\n    } else {\n      addToFavorites(this.state.labelName, this.state.labelValue, this);\n    }\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2, isFavorite: boolean, hover = false) {\n  return {\n    wrapper: css({\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      alignSelf: 'center',\n    }),\n  };\n}\n","import React from 'react';\n\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { navigateToInitialPageAfterServiceSelection } from '../../services/navigate';\nimport { getLabelsVariable } from '../../services/variableGetters';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { SERVICE_NAME, SERVICE_UI_LABEL } from '../../services/variables';\nimport { FilterOp } from '../../services/filterTypes';\nimport { testIds } from '../../services/testIds';\nimport { addToFavorites } from '../../services/favorites';\n\nexport interface SelectServiceButtonState extends SceneObjectState {\n  labelValue: string;\n  labelName: string;\n}\nexport function selectLabel(primaryLabelName: string, primaryLabelValue: string, sceneRef: SceneObject) {\n  const variable = getLabelsVariable(sceneRef);\n\n  reportAppInteraction(USER_EVENTS_PAGES.service_selection, USER_EVENTS_ACTIONS.service_selection.service_selected, {\n    value: primaryLabelValue,\n    label: primaryLabelName,\n  });\n\n  const filteredFilters = variable.state.filters.filter(\n    (f) => !(f.key === primaryLabelName && f.value === primaryLabelValue)\n  );\n\n  const filters = [\n    ...filteredFilters,\n    {\n      key: primaryLabelName,\n      operator: FilterOp.Equal,\n      value: primaryLabelValue,\n    },\n  ];\n\n  variable.setState({\n    filters,\n  });\n\n  addToFavorites(primaryLabelName, primaryLabelValue, sceneRef);\n\n  if (primaryLabelName === SERVICE_NAME) {\n    primaryLabelName = SERVICE_UI_LABEL;\n  }\n\n  // In this case, we don't have a ServiceScene created yet, so we call a special function to navigate there for the first time\n  navigateToInitialPageAfterServiceSelection(primaryLabelName, primaryLabelValue);\n}\n\nexport class SelectServiceButton extends SceneObjectBase<SelectServiceButtonState> {\n  public onClick = () => {\n    if (!this.state.labelValue) {\n      return;\n    }\n    selectLabel(this.state.labelName, this.state.labelValue, this);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SelectServiceButton>) => {\n    const styles = useStyles2(getStyles);\n    return (\n      <Button\n        data-testid={testIds.index.showLogsButton}\n        tooltip={`View logs for ${model.state.labelValue}`}\n        className={styles.button}\n        variant=\"secondary\"\n        size=\"sm\"\n        onClick={model.onClick}\n      >\n        Show logs\n      </Button>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    button: css({\n      alignSelf: 'center',\n    }),\n  };\n}\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\nimport { TextLink, Text } from '@grafana/ui';\n\nexport const ConfigureVolumeError = () => {\n  return (\n    <GrotError>\n      <p>Log volume has not been configured.</p>\n      <p>\n        <TextLink href=\"https://grafana.com/docs/loki/latest/reference/api/#query-log-volume\" external>\n          Instructions to enable volume in the Loki config:\n        </TextLink>\n      </p>\n      <Text textAlignment=\"left\">\n        <pre>\n          <code>\n            limits_config:\n            <br />\n            &nbsp;&nbsp;volume_enabled: true\n          </code>\n        </pre>\n      </Text>\n    </GrotError>\n  );\n};\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\n\nexport const NoServiceSearchResults = () => {\n  return (\n    <GrotError>\n      <p>No service matched your search.</p>\n    </GrotError>\n  );\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Select, Stack, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { ServiceSelectionScene } from './ServiceSelectionScene';\nimport { ServiceSelectionTabsScene, TabOption } from './ServiceSelectionTabsScene';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport interface TabPopoverSceneState extends SceneObjectState {}\n\nexport class TabPopoverScene extends SceneObjectBase<TabPopoverSceneState> {\n  public static Component = ({ model }: SceneComponentProps<TabPopoverScene>) => {\n    const serviceSelectionScene = sceneGraph.getAncestor(model, ServiceSelectionScene);\n    const serviceSelectionTabsScene = sceneGraph.getAncestor(model, ServiceSelectionTabsScene);\n    const { tabOptions, showPopover } = serviceSelectionTabsScene.useState();\n    const popoverStyles = useStyles2(getPopoverStyles);\n\n    const tabOptionsWithIcon: TabOption[] = tabOptions.map((opt) => {\n      return {\n        ...opt,\n        icon: opt.saved ? 'save' : undefined,\n        label: `${opt.label}`,\n      };\n    });\n\n    return (\n      <Stack direction=\"column\" gap={0} role=\"tooltip\">\n        <div className={popoverStyles.card.body}>\n          <Select<string, { options: TabOption[] }>\n            menuShouldPortal={false}\n            width={50}\n            onBlur={() => {\n              serviceSelectionTabsScene.toggleShowPopover();\n            }}\n            autoFocus={true}\n            isOpen={showPopover}\n            placeholder={'Search labels'}\n            options={tabOptionsWithIcon}\n            isSearchable={true}\n            openMenuOnFocus={true}\n            onChange={(option) => {\n              // Add value to variable\n              if (option.value) {\n                // Hide the popover\n                serviceSelectionTabsScene.toggleShowPopover();\n                // Set new tab\n                serviceSelectionScene.setSelectedTab(option.value);\n              }\n            }}\n          />\n        </div>\n      </Stack>\n    );\n  };\n}\n\nconst getPopoverStyles = (theme: GrafanaTheme2) => ({\n  card: {\n    body: css({\n      padding: theme.spacing(1),\n    }),\n    p: css({\n      maxWidth: 300,\n    }),\n  },\n});\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState, SceneQueryRunner } from '@grafana/scenes';\nimport React, { useRef } from 'react';\nimport { Icon, Popover, PopoverController, Tab, TabsBar, Tooltip, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2, LoadingState, SelectableValue } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { SERVICE_NAME, SERVICE_UI_LABEL } from '../../services/variables';\nimport { truncateText } from '../../services/text';\nimport { rest } from 'lodash';\nimport { ServiceSelectionScene } from './ServiceSelectionScene';\nimport { getSceneQueryRunner } from '../../services/panel';\nimport { buildResourceQuery } from '../../services/query';\nimport { TabPopoverScene } from './TabPopoverScene';\nimport { getDataSourceVariable, getServiceSelectionPrimaryLabel } from '../../services/variableGetters';\nimport { getFavoriteTabsFromStorage, removeTabFromLocalStorage } from '../../services/store';\n\nexport interface TabOption extends SelectableValue<string> {\n  label: string;\n  value: string;\n  active?: boolean;\n  saved?: boolean;\n  savedIndex?: number;\n}\n\nexport interface ServiceSelectionTabsSceneState extends SceneObjectState {\n  tabOptions: TabOption[];\n  showPopover: boolean;\n  $labelsData: SceneQueryRunner;\n  popover?: TabPopoverScene;\n}\n\ninterface LabelOptions {\n  label: string;\n  cardinality: number;\n}\n\nexport class ServiceSelectionTabsScene extends SceneObjectBase<ServiceSelectionTabsSceneState> {\n  constructor(state: Partial<ServiceSelectionTabsSceneState>) {\n    super({\n      showPopover: false,\n      $labelsData: getSceneQueryRunner({\n        queries: [buildResourceQuery('', 'detected_labels')],\n        runQueriesMode: 'manual',\n      }),\n      tabOptions: [\n        {\n          label: SERVICE_UI_LABEL,\n          value: SERVICE_NAME,\n          saved: true,\n        },\n      ],\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Component = ({ model }: SceneComponentProps<ServiceSelectionTabsScene>) => {\n    // Scene vars\n    const { tabOptions, showPopover, popover, $labelsData } = model.useState();\n    const { data } = $labelsData.useState();\n    const serviceSelectionScene = sceneGraph.getAncestor(model, ServiceSelectionScene);\n    const primaryLabel = getServiceSelectionPrimaryLabel(model);\n    // Re-render when active tab changes, which is stored in the primary label variable\n    primaryLabel.useState();\n\n    // Constants\n    const styles = useStyles2(getTabsStyles);\n    const popoverRef = useRef<HTMLElement>(null);\n    const maxLabelLength = 15;\n\n    return (\n      <TabsBar>\n        {tabOptions\n          .filter((tabLabel) => tabLabel.saved || tabLabel.active || tabLabel.value === SERVICE_NAME)\n          .sort((a, b) => {\n            // Service name goes first\n            if (a.value === SERVICE_NAME || b.value === SERVICE_NAME) {\n              return a.value === SERVICE_NAME ? -1 : 1;\n            }\n\n            // Then sort by the order added to local storage\n            return (a.savedIndex ?? 0) - (b.savedIndex ?? 0);\n          })\n          .map((tabLabel) => {\n            const tab = (\n              <Tab\n                key={tabLabel.value}\n                onChangeTab={() => {\n                  // Set the new active tab\n                  serviceSelectionScene.setSelectedTab(tabLabel.value);\n                }}\n                label={truncateText(tabLabel.label, maxLabelLength, true)}\n                active={tabLabel.active}\n                suffix={\n                  tabLabel.value !== SERVICE_NAME\n                    ? (props) => {\n                        return (\n                          <>\n                            <Tooltip content={'Remove tab'}>\n                              <Icon\n                                onKeyDownCapture={(e) => {\n                                  if (e.key === 'Enter') {\n                                    model.removeSavedTab(tabLabel.value);\n                                  }\n                                }}\n                                onClick={(e) => {\n                                  // Don't bubble up to the tab component, we don't want to select the tab we're removing\n                                  e.stopPropagation();\n                                  model.removeSavedTab(tabLabel.value);\n                                }}\n                                name={'times'}\n                                className={cx(props.className)}\n                              />\n                            </Tooltip>\n                          </>\n                        );\n                      }\n                    : undefined\n                }\n              />\n            );\n\n            if (tabLabel.label.length > maxLabelLength) {\n              return (\n                <Tooltip key={tabLabel.value} content={tabLabel.label}>\n                  {tab}\n                </Tooltip>\n              );\n            } else {\n              return tab;\n            }\n          })}\n        {data?.state === LoadingState.Loading && <Tab label={'Loading tabs'} icon={'spinner'} />}\n\n        {/* Add more tabs tab */}\n        {data?.state === LoadingState.Done && (\n          <span className={styles.addTab}>\n            <Tab onChangeTab={model.toggleShowPopover} label={'Add label'} ref={popoverRef} icon={'plus-circle'} />\n          </span>\n        )}\n\n        {popover && (\n          <PopoverController content={<popover.Component model={popover} />}>\n            {(showPopper, hidePopper, popperProps) => {\n              const blurFocusProps = {\n                onBlur: hidePopper,\n                onFocus: showPopper,\n              };\n\n              return (\n                <>\n                  {popoverRef.current && (\n                    <>\n                      {/* @ts-expect-error @todo upgrade typescript */}\n                      <Popover\n                        {...popperProps}\n                        {...rest}\n                        show={showPopover}\n                        wrapperClassName={styles.popover}\n                        referenceElement={popoverRef.current}\n                        renderArrow={true}\n                        {...blurFocusProps}\n                      />\n                    </>\n                  )}\n                </>\n              );\n            }}\n          </PopoverController>\n        )}\n      </TabsBar>\n    );\n  };\n\n  removeSavedTab = (labelName: string) => {\n    removeTabFromLocalStorage(getDataSourceVariable(this).getValue().toString(), labelName);\n\n    const labels = this.getLabelsFromQueryRunnerState();\n    if (labels) {\n      this.populatePrimaryLabelsVariableOptions(labels);\n    }\n\n    // If the user is closing the active tab, select the default tab\n    const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n    if (serviceSelectionScene.getSelectedTab() === labelName) {\n      serviceSelectionScene.selectDefaultLabelTab();\n    }\n  };\n\n  toggleShowPopover = () => {\n    this.setState({\n      showPopover: !this.state.showPopover,\n    });\n  };\n\n  getLabelsFromQueryRunnerState(state = this.state.$labelsData?.state): LabelOptions[] | undefined {\n    return state.data?.series[0].fields.map((f) => {\n      return {\n        label: f.name,\n        cardinality: f.values[0],\n      };\n    });\n  }\n\n  public populatePrimaryLabelsVariableOptions(labels: LabelOptions[]) {\n    const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n    const selectedTab = serviceSelectionScene.getSelectedTab();\n    const savedTabs = getFavoriteTabsFromStorage(getDataSourceVariable(this).getValue().toString());\n\n    const tabOptions: TabOption[] = labels\n      .map((l) => {\n        const savedIndex = savedTabs.indexOf(l.label);\n        const option: TabOption = {\n          label: l.label === SERVICE_NAME ? SERVICE_UI_LABEL : l.label,\n          value: l.label,\n          active: selectedTab === l.label,\n          saved: savedIndex !== -1,\n          savedIndex,\n        };\n        return option;\n      })\n      .sort((a, b) => {\n        // Sort service first\n        if (a.value === SERVICE_NAME || b.value === SERVICE_NAME) {\n          return a.value === SERVICE_NAME ? -1 : 1;\n        }\n\n        // Then sort alphabetically\n        return a.label < b.label ? -1 : a.label > b.label ? 1 : 0;\n      });\n    this.setState({\n      tabOptions,\n    });\n  }\n\n  private runDetectedLabels() {\n    this.state.$labelsData.runQueries();\n  }\n\n  private runDetectedLabelsSubs() {\n    // Update labels/tabs on time range change\n    this._subs.add(\n      sceneGraph.getTimeRange(this).subscribeToState(() => {\n        this.runDetectedLabels();\n      })\n    );\n\n    // Update labels (tabs) when datasource is changed\n    this._subs.add(\n      getDataSourceVariable(this).subscribeToState(() => {\n        this.runDetectedLabels();\n      })\n    );\n  }\n\n  private onActivate() {\n    // Get labels\n    this.runDetectedLabels();\n\n    this.setState({\n      popover: new TabPopoverScene({}),\n    });\n\n    this.runDetectedLabelsSubs();\n\n    // Update labels (tabs) when datasource is changed\n    this._subs.add(\n      getDataSourceVariable(this).subscribeToState(() => {\n        this.state.$labelsData.runQueries();\n      })\n    );\n\n    this._subs.add(\n      getServiceSelectionPrimaryLabel(this).subscribeToState(() => {\n        const labels = this.getLabelsFromQueryRunnerState(this.state.$labelsData?.state);\n        if (labels) {\n          this.populatePrimaryLabelsVariableOptions(labels);\n        }\n      })\n    );\n\n    this._subs.add(\n      this.state.$labelsData.subscribeToState((newState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          const labels = this.getLabelsFromQueryRunnerState(newState);\n          const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n\n          if (labels) {\n            this.populatePrimaryLabelsVariableOptions(labels);\n          }\n\n          const selectedTab = serviceSelectionScene.getSelectedTab();\n          // If the tab is no longer available, either because the user changed the datasource, or time range, select the default tab\n          if (!labels?.some((label) => label.label === selectedTab)) {\n            serviceSelectionScene.selectDefaultLabelTab();\n          }\n        }\n      })\n    );\n  }\n}\n\nconst getTabsStyles = (theme: GrafanaTheme2) => ({\n  addTab: css({\n    label: 'add-label-tab',\n    color: theme.colors.primary.text,\n    '& button': {\n      color: theme.colors.primary.text,\n    },\n  }),\n  popover: css({\n    borderRadius: theme.shape.radius.default,\n    boxShadow: theme.shadows.z3,\n    background: theme.colors.background.primary,\n    border: `1px solid ${theme.colors.border.weak}`,\n  }),\n});\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\n\nexport const NoServiceVolume = (props: { labelName: string }) => {\n  return (\n    <GrotError>\n      <p>\n        No logs found in <strong>{props.labelName}</strong>.<br />\n        Please adjust time range or select another label.\n      </p>\n    </GrotError>\n  );\n};\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { testIds } from '../../services/testIds';\nimport { addToFilters, FilterType } from '../ServiceScene/Breakdowns/AddToFiltersButton';\nimport { VAR_LABELS } from '../../services/variables';\nimport { getLabelsVariable, getValueFromAdHocVariableFilter } from '../../services/variableGetters';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { css } from '@emotion/css';\nimport React from 'react';\nimport { FilterOp } from '../../services/filterTypes';\n\nexport interface AddLabelToFiltersHeaderActionSceneState extends SceneObjectState {\n  name: string;\n  value: string;\n  hidden?: boolean;\n  included: boolean | null;\n}\n\nexport class AddLabelToFiltersHeaderActionScene extends SceneObjectBase<AddLabelToFiltersHeaderActionSceneState> {\n  constructor(state: Omit<AddLabelToFiltersHeaderActionSceneState, 'included'>) {\n    super({\n      ...state,\n      included: null,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({ ...this.isSelected() });\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState(() => {\n        const selected = this.isSelected();\n        if (this.state.included !== selected.included) {\n          this.setState({ ...selected });\n        }\n      })\n    );\n  }\n\n  isSelected = () => {\n    const variable = getLabelsVariable(this);\n\n    // Check if the filter is already there\n    const filterInSelectedFilters = variable.state.filters.find((f) => {\n      const value = getValueFromAdHocVariableFilter(variable, f);\n      return f.key === this.state.name && value.value === this.state.value;\n    });\n\n    if (!filterInSelectedFilters) {\n      return { included: false };\n    }\n\n    return {\n      included: filterInSelectedFilters.operator === FilterOp.Equal,\n    };\n  };\n\n  public static Component = ({ model }: SceneComponentProps<AddLabelToFiltersHeaderActionScene>) => {\n    const { value, hidden, included } = model.useState();\n\n    if (hidden) {\n      return <></>;\n    }\n\n    const styles = useStyles2(getStyles);\n    return (\n      <span className={styles.wrapper}>\n        <Button\n          tooltip={included === true ? `Remove ${value} from filters` : `Add ${value} to filters`}\n          variant={'secondary'}\n          fill={'outline'}\n          icon={included === true ? 'minus' : 'plus'}\n          size=\"sm\"\n          aria-selected={included === true}\n          className={styles.includeButton}\n          onClick={() => (included === true ? model.onClick('clear') : model.onClick('include'))}\n          data-testid={testIds.exploreServiceDetails.buttonFilterInclude}\n        />\n      </span>\n    );\n  };\n\n  public getFilter() {\n    return { name: this.state.name, value: this.state.value };\n  }\n\n  public onClick = (type: FilterType) => {\n    const filter = this.getFilter();\n\n    addToFilters(filter.name, filter.value, type, this, VAR_LABELS);\n\n    const variable = getLabelsVariable(this);\n    reportAppInteraction(USER_EVENTS_PAGES.service_selection, USER_EVENTS_ACTIONS.service_selection.add_to_filters, {\n      filterType: 'index-filters',\n      key: filter.name,\n      action: type,\n      filtersLength: variable?.state.filters.length || 0,\n    });\n\n    this.setState({ ...this.isSelected() });\n  };\n}\n\nconst getStyles = () => {\n  return {\n    container: css({\n      display: 'flex',\n      justifyContent: 'center',\n    }),\n    includeButton: css({\n      borderRadius: 0,\n    }),\n    wrapper: css({\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      alignSelf: 'center',\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { debounce } from 'lodash';\nimport React from 'react';\nimport {\n  AdHocVariableFilter,\n  DashboardCursorSync,\n  DataFrame,\n  dateTime,\n  GrafanaTheme2,\n  LoadingState,\n  TimeRange,\n} from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  behaviors,\n  DataSourceVariable,\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneQueryRunner,\n  SceneVariableSet,\n  VizPanel,\n} from '@grafana/scenes';\nimport {\n  DrawStyle,\n  Field,\n  IconButton,\n  LegendDisplayMode,\n  PanelContext,\n  SeriesVisibilityChangeMode,\n  StackingMode,\n  useStyles2,\n} from '@grafana/ui';\nimport { addTabToLocalStorage, getFavoriteLabelValuesFromStorage } from 'services/store';\nimport {\n  EXPLORATION_DS,\n  LEVEL_VARIABLE_VALUE,\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  VAR_AGGREGATED_METRICS,\n  VAR_LABELS_REPLICA,\n  VAR_LABELS_REPLICA_EXPR,\n  VAR_PRIMARY_LABEL,\n  VAR_PRIMARY_LABEL_EXPR,\n  VAR_PRIMARY_LABEL_SEARCH,\n} from 'services/variables';\nimport { selectLabel, SelectServiceButton } from './SelectServiceButton';\nimport {\n  buildDataQuery,\n  buildVolumeQuery,\n  renderLogQLLabelFilters,\n  unwrapWildcardSearch,\n  wrapWildcardSearch,\n} from 'services/query';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getQueryRunner, getSceneQueryRunner, setLevelColorOverrides } from 'services/panel';\nimport { ConfigureVolumeError } from './ConfigureVolumeError';\nimport { NoServiceSearchResults } from './NoServiceSearchResults';\nimport { getLabelsFromSeries, toggleLevelVisibility } from 'services/levels';\nimport { ServiceFieldSelector } from '../ServiceScene/Breakdowns/FieldSelector';\nimport { CustomConstantVariable } from '../../services/CustomConstantVariable';\nimport { areArraysEqual } from '../../services/comparison';\nimport {\n  clearServiceSelectionSearchVariable,\n  getAggregatedMetricsVariable,\n  getDataSourceVariable,\n  getLabelsVariable,\n  getLabelsVariableReplica,\n  getServiceSelectionPrimaryLabel,\n  getServiceSelectionSearchVariable,\n  setServiceSelectionPrimaryLabelKey,\n} from '../../services/variableGetters';\nimport { config, locationService } from '@grafana/runtime';\nimport { VariableHide } from '@grafana/schema';\nimport { ToolbarScene } from '../IndexScene/ToolbarScene';\nimport { IndexScene, showLogsButtonSceneKey } from '../IndexScene/IndexScene';\nimport { ServiceSelectionTabsScene } from './ServiceSelectionTabsScene';\nimport { FavoriteServiceHeaderActionScene } from './FavoriteServiceHeaderActionScene';\nimport { pushUrlHandler } from '../../services/navigate';\nimport { NoServiceVolume } from './NoServiceVolume';\nimport { getQueryRunnerFromChildren } from '../../services/scenes';\nimport { AddLabelToFiltersHeaderActionScene } from './AddLabelToFiltersHeaderActionScene';\nimport { ShowLogsButtonScene } from '../IndexScene/ShowLogsButtonScene';\n\nconst aggregatedMetricsEnabled: boolean | undefined = config.featureToggles.exploreLogsAggregatedMetrics;\n// Don't export AGGREGATED_SERVICE_NAME, we want to rename things so the rest of the application is agnostic to how we got the services\nconst AGGREGATED_SERVICE_NAME = '__aggregated_metric__';\n\n//@todo make start date user configurable, currently hardcoded for experimental cloud release\nexport const AGGREGATED_METRIC_START_DATE = dateTime('2024-08-30', 'YYYY-MM-DD');\nexport const SERVICES_LIMIT = 20;\n\ninterface ServiceSelectionSceneState extends SceneObjectState {\n  // The body of the component\n  body: SceneCSSGridLayout;\n  // Show logs of a certain level for a given service\n  serviceLevel: Map<string, string[]>;\n  // Logs volume API response as dataframe with SceneQueryRunner\n  $data: SceneQueryRunner;\n  tabs?: ServiceSelectionTabsScene;\n  showPopover: boolean;\n  tabOptions: Array<{\n    label: string;\n    value: string;\n  }>;\n}\n\nfunction renderPrimaryLabelFilters(filters: AdHocVariableFilter[]): string {\n  if (filters.length) {\n    const filter = filters[0];\n    return `${filter.key}${filter.operator}\\`${filter.value}\\``;\n  }\n\n  return '';\n}\n\nconst primaryLabelUrlKey = 'var-primary_label';\nconst datasourceUrlKey = 'var-ds';\n\nexport class ServiceSelectionScene extends SceneObjectBase<ServiceSelectionSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: [primaryLabelUrlKey],\n  });\n\n  constructor(state: Partial<ServiceSelectionSceneState>) {\n    super({\n      body: new SceneCSSGridLayout({ children: [] }),\n      $variables: new SceneVariableSet({\n        variables: [\n          // Service search variable\n          new CustomConstantVariable({\n            name: VAR_PRIMARY_LABEL_SEARCH,\n            label: 'Service',\n            hide: VariableHide.hideVariable,\n            skipUrlSync: true,\n            value: '.+',\n          }),\n          // variable that stores if aggregated metrics are supported for the query\n          new CustomConstantVariable({\n            name: VAR_AGGREGATED_METRICS,\n            label: '',\n            hide: VariableHide.hideLabel,\n            value: SERVICE_NAME,\n            skipUrlSync: true,\n            options: [\n              {\n                value: SERVICE_NAME,\n                label: SERVICE_NAME,\n              },\n              {\n                value: AGGREGATED_SERVICE_NAME,\n                label: AGGREGATED_SERVICE_NAME,\n              },\n            ],\n          }),\n          // The active tab expression, hidden variable\n          new AdHocFiltersVariable({\n            name: VAR_PRIMARY_LABEL,\n            hide: VariableHide.hideLabel,\n            expressionBuilder: (filters) => {\n              return renderPrimaryLabelFilters(filters);\n            },\n            filters: [\n              {\n                key: getSelectedTabFromUrl().key ?? SERVICE_NAME,\n                value: '.+',\n                operator: '=~',\n              },\n            ],\n          }),\n          new AdHocFiltersVariable({\n            name: VAR_LABELS_REPLICA,\n            datasource: EXPLORATION_DS,\n            layout: 'vertical',\n            filters: [],\n            expressionBuilder: renderLogQLLabelFilters,\n            hide: VariableHide.hideVariable,\n            key: 'adhoc_service_filter_replica',\n            skipUrlSync: true,\n          }),\n        ],\n      }),\n      $data: getSceneQueryRunner({\n        queries: [],\n        runQueriesMode: 'manual',\n      }),\n      serviceLevel: new Map<string, string[]>(),\n\n      showPopover: false,\n      tabOptions: [\n        {\n          label: SERVICE_UI_LABEL,\n          value: SERVICE_NAME,\n        },\n      ],\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  /**\n   * Set changes from the URL to the state of the primary label variable\n   */\n  getUrlState() {\n    const { key } = getSelectedTabFromUrl();\n    const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n    const filter = primaryLabelVar.state.filters[0];\n\n    if (filter.key && filter.key !== key) {\n      getServiceSelectionPrimaryLabel(this).setState({\n        filters: [\n          {\n            ...filter,\n            key: key ?? filter.key,\n          },\n        ],\n      });\n    }\n\n    return {};\n  }\n\n  /**\n   * Unused, but required\n   * @param values\n   */\n  updateFromUrl(values: SceneObjectUrlValues) {}\n\n  addDatasourceChangeToBrowserHistory(newDs: string) {\n    const location = locationService.getLocation();\n    const search = new URLSearchParams(location.search);\n    const dsUrl = search.get(datasourceUrlKey);\n    if (dsUrl && newDs !== dsUrl) {\n      const currentUrl = location.pathname + location.search;\n      search.set(datasourceUrlKey, newDs);\n      const newUrl = location.pathname + '?' + search.toString();\n      if (currentUrl !== newUrl) {\n        pushUrlHandler(newUrl);\n      }\n    }\n  }\n\n  /**\n   * Attempting to add any change to the primary label variable (i.e. the selected tab) as a browser history event\n   * @param newKey\n   * @param replace\n   */\n  addLabelChangeToBrowserHistory(newKey: string, replace = false) {\n    const { key: primaryLabelRaw, search, location } = getSelectedTabFromUrl();\n    if (primaryLabelRaw) {\n      const primaryLabelSplit = primaryLabelRaw?.split('|');\n      const keyInUrl = primaryLabelSplit?.[0];\n\n      if (keyInUrl !== newKey) {\n        primaryLabelSplit[0] = newKey;\n        search.set(primaryLabelUrlKey, primaryLabelSplit.join('|'));\n        const currentUrl = location.pathname + location.search;\n        const newUrl = location.pathname + '?' + search.toString();\n        if (currentUrl !== newUrl) {\n          if (replace) {\n            locationService.replace(newUrl);\n          } else {\n            pushUrlHandler(newUrl);\n          }\n        }\n      }\n    }\n  }\n\n  public static Component = ({ model }: SceneComponentProps<ServiceSelectionScene>) => {\n    const styles = useStyles2(getStyles);\n    const { body, $data, tabs } = model.useState();\n    const { data } = $data.useState();\n    const selectedTab = model.getSelectedTab();\n\n    const serviceStringVariable = getServiceSelectionSearchVariable(model);\n    const { label, value: searchValue } = serviceStringVariable.useState();\n    const hasSearch = searchValue && searchValue !== '.+';\n\n    const { labelsByVolume, labelsToQuery } = model.getLabels(data?.series);\n    const isLogVolumeLoading =\n      data?.state === LoadingState.Loading || data?.state === LoadingState.Streaming || data === undefined;\n    const volumeApiError = $data.state.data?.state === LoadingState.Error;\n\n    const onSearchChange = (serviceName?: string) => {\n      model.onSearchServicesChange(serviceName);\n    };\n    const totalServices = labelsToQuery?.length ?? 0;\n    // To get the count of services that are currently displayed, divide the number of panels by 2, as there are 2 panels per service (logs and time series)\n    const renderedServices = body.state.children.length / 2;\n\n    const filterLabel = model.formatPrimaryLabelForUI();\n    let customValue = serviceStringVariable.getValue().toString();\n    if (customValue === '.+') {\n      customValue = '';\n    }\n    const customLabel = unwrapWildcardSearch(customValue);\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.bodyWrapper}>\n          {tabs && <tabs.Component model={tabs} />}\n          <Field className={styles.searchField}>\n            <div className={styles.searchWrapper}>\n              <ServiceFieldSelector\n                initialFilter={{\n                  label: customLabel,\n                  value: customValue,\n                  icon: 'filter',\n                }}\n                isLoading={isLogVolumeLoading}\n                value={customValue ? customValue : label}\n                onChange={(serviceName) => onSearchChange(serviceName)}\n                selectOption={(value: string) => {\n                  selectLabel(selectedTab, value, model);\n                }}\n                label={filterLabel}\n                options={\n                  labelsToQuery?.map((serviceName) => ({\n                    value: serviceName,\n                    label: serviceName,\n                  })) ?? []\n                }\n              />\n              {!isLogVolumeLoading && (\n                <span className={styles.searchFieldPlaceholderText}>\n                  Showing {renderedServices} of {totalServices}{' '}\n                  <IconButton\n                    className={styles.icon}\n                    aria-label=\"Count info\"\n                    name={'info-circle'}\n                    tooltip={`${totalServices} labels have values for the selected time range. Total label count may differ`}\n                  />\n                </span>\n              )}\n            </div>\n          </Field>\n          {/** If we don't have any servicesByVolume, volume endpoint is probably not enabled */}\n          {!isLogVolumeLoading && volumeApiError && <ConfigureVolumeError />}\n          {!isLogVolumeLoading && !volumeApiError && hasSearch && !labelsByVolume?.length && <NoServiceSearchResults />}\n          {!isLogVolumeLoading && !volumeApiError && !hasSearch && !labelsByVolume?.length && (\n            <NoServiceVolume labelName={selectedTab} />\n          )}\n          {!(!isLogVolumeLoading && volumeApiError) && (\n            <div className={styles.body}>\n              <body.Component model={body} />\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  // We could also run model.setState in component, but it is recommended to implement the state-modifying methods in the scene object\n  onSearchServicesChange = debounce((primaryLabelSearch?: string) => {\n    // Set search variable\n    const searchVar = getServiceSelectionSearchVariable(this);\n\n    const newSearchString = primaryLabelSearch ? wrapWildcardSearch(primaryLabelSearch) : '.+';\n    if (newSearchString !== searchVar.state.value) {\n      searchVar.setState({\n        value: primaryLabelSearch ? wrapWildcardSearch(primaryLabelSearch) : '.+',\n        label: primaryLabelSearch ?? '',\n      });\n    }\n\n    const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n    const filter = primaryLabelVar.state.filters[0];\n\n    // Update primary label with search string\n    if (wrapWildcardSearch(searchVar.state.value.toString()) !== filter.value) {\n      primaryLabelVar.setState({\n        filters: [\n          {\n            ...filter,\n            value: wrapWildcardSearch(searchVar.state.value.toString()),\n          },\n        ],\n      });\n    }\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_selection,\n      USER_EVENTS_ACTIONS.service_selection.search_services_changed,\n      {\n        searchQuery: primaryLabelSearch,\n      }\n    );\n  }, 500);\n\n  getSelectedTab() {\n    return getServiceSelectionPrimaryLabel(this).state.filters[0]?.key;\n  }\n\n  selectDefaultLabelTab() {\n    // Need to update the history before the state with replace instead of push, or we'll get invalid services saved to url state after changing datasource\n    this.addLabelChangeToBrowserHistory(SERVICE_NAME, true);\n    this.setSelectedTab(SERVICE_NAME);\n  }\n\n  setSelectedTab(labelName: string) {\n    addTabToLocalStorage(getDataSourceVariable(this).getValue().toString(), labelName);\n\n    // clear active search\n    clearServiceSelectionSearchVariable(this);\n\n    // Update the primary label variable\n    setServiceSelectionPrimaryLabelKey(labelName, this);\n  }\n\n  // Creates a layout with timeseries panel\n  buildServiceLayout(\n    primaryLabelName: string,\n    primaryLabelValue: string,\n    timeRange: TimeRange,\n    serviceLabelVar: CustomConstantVariable,\n    primaryLabelVar: AdHocFiltersVariable,\n    datasourceVar: DataSourceVariable\n  ) {\n    let splitDuration;\n    if (timeRange.to.diff(timeRange.from, 'hours') >= 4 && timeRange.to.diff(timeRange.from, 'hours') <= 26) {\n      splitDuration = '2h';\n    }\n    const panel = PanelBuilders.timeseries()\n      // If service was previously selected, we show it in the title\n      .setTitle(primaryLabelValue)\n      .setData(\n        getQueryRunner(\n          [\n            buildDataQuery(this.getMetricExpression(primaryLabelValue, serviceLabelVar, primaryLabelVar), {\n              legendFormat: `{{${LEVEL_VARIABLE_VALUE}}}`,\n              splitDuration,\n              refId: `ts-${primaryLabelValue}`,\n            }),\n          ],\n          { runQueriesMode: 'manual' }\n        )\n      )\n      .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n      .setCustomFieldConfig('fillOpacity', 100)\n      .setCustomFieldConfig('lineWidth', 0)\n      .setCustomFieldConfig('pointSize', 0)\n      .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n      .setUnit('short')\n      .setOverrides(setLevelColorOverrides)\n      .setOption('legend', {\n        showLegend: true,\n        calcs: ['sum'],\n        placement: 'right',\n        displayMode: LegendDisplayMode.Table,\n      })\n      .setHeaderActions([\n        new FavoriteServiceHeaderActionScene({\n          ds: datasourceVar.getValue()?.toString(),\n          labelName: primaryLabelName,\n          labelValue: primaryLabelValue,\n        }),\n        new AddLabelToFiltersHeaderActionScene({\n          name: primaryLabelName,\n          value: primaryLabelValue,\n          hidden: this.isAggregatedMetricsActive(),\n        }),\n        new SelectServiceButton({ labelValue: primaryLabelValue, labelName: primaryLabelName }),\n      ])\n      .build();\n\n    panel.setState({\n      extendPanelContext: (_, context) =>\n        this.extendTimeSeriesLegendBus(primaryLabelName, primaryLabelValue, context, panel),\n    });\n\n    const cssGridItem = new SceneCSSGridItem({\n      $behaviors: [new behaviors.CursorSync({ key: 'serviceCrosshairSync', sync: DashboardCursorSync.Crosshair })],\n      body: panel,\n    });\n\n    cssGridItem.addActivationHandler(() => {\n      const runner = getQueryRunnerFromChildren(cssGridItem)[0];\n      // If the query runner has already ran, the scene must be cached, don't re-run as the volume query will be triggered which will execute another panel query\n      if (runner.state.data?.state !== LoadingState.Done) {\n        this.runPanelQuery(cssGridItem);\n      }\n    });\n\n    return cssGridItem;\n  }\n\n  isAggregatedMetricsActive() {\n    const toolbar = this.getQueryOptionsToolbar();\n    return !toolbar?.state.options.aggregatedMetrics.disabled && toolbar?.state.options.aggregatedMetrics.active;\n  }\n\n  getLevelFilterForService = (service: string) => {\n    let serviceLevels = this.state.serviceLevel.get(service) || [];\n    if (serviceLevels.length === 0) {\n      return '';\n    }\n    const filters = serviceLevels.map((level) => {\n      if (level === 'logs') {\n        level = '';\n      }\n      return `${LEVEL_VARIABLE_VALUE}=\\`${level}\\``;\n    });\n    return ` | ${filters.join(' or ')} `;\n  };\n\n  // Creates a layout with logs panel\n  buildServiceLogsLayout = (labelName: string, labelValue: string) => {\n    const levelFilter = this.getLevelFilterForService(labelValue);\n    const cssGridItem = new SceneCSSGridItem({\n      $behaviors: [new behaviors.CursorSync({ sync: DashboardCursorSync.Off })],\n      body: PanelBuilders.logs()\n        // Hover header set to true removes unused header padding, displaying more logs\n        .setHoverHeader(true)\n        .setData(\n          getQueryRunner(\n            [\n              buildDataQuery(this.getLogExpression(labelName, labelValue, levelFilter), {\n                maxLines: 100,\n                refId: `logs-${labelValue}`,\n              }),\n            ],\n            {\n              runQueriesMode: 'manual',\n            }\n          )\n        )\n        .setTitle(labelValue)\n        .setOption('showTime', true)\n        .setOption('enableLogDetails', false)\n        .build(),\n    });\n\n    cssGridItem.addActivationHandler(() => {\n      const runner = getQueryRunnerFromChildren(cssGridItem)[0];\n      // If the query runner has already ran, the scene must be cached, don't re-run as the volume query will be triggered which will execute another panel query\n      if (runner.state.data?.state !== LoadingState.Done) {\n        this.runPanelQuery(cssGridItem);\n      }\n    });\n\n    return cssGridItem;\n  };\n\n  formatPrimaryLabelForUI() {\n    const selectedTab = this.getSelectedTab();\n    return selectedTab === SERVICE_NAME ? SERVICE_UI_LABEL : selectedTab;\n  }\n\n  private setVolumeQueryRunner() {\n    this.setState({\n      $data: getSceneQueryRunner({\n        queries: [\n          buildVolumeQuery(`{${VAR_PRIMARY_LABEL_EXPR}, ${VAR_LABELS_REPLICA_EXPR}}`, 'volume', this.getSelectedTab()),\n        ],\n        runQueriesMode: 'manual',\n      }),\n    });\n\n    // Need to re-init any subscriptions since we changed the query runner\n    this.subscribeToVolume();\n  }\n\n  private doVariablesNeedSync() {\n    const labelsVarPrimary = getLabelsVariable(this);\n    const labelsVarReplica = getLabelsVariableReplica(this);\n\n    const activeTab = this.getSelectedTab();\n    const filteredFilters = labelsVarPrimary.state.filters.filter((f) => f.key !== activeTab);\n\n    return { filters: filteredFilters, needsSync: !areArraysEqual(filteredFilters, labelsVarReplica.state.filters) };\n  }\n\n  private syncVariables() {\n    const labelsVarReplica = getLabelsVariableReplica(this);\n\n    const { filters, needsSync } = this.doVariablesNeedSync();\n    if (needsSync) {\n      labelsVarReplica.setState({ filters });\n    }\n  }\n\n  private onActivate() {\n    this.fixRequiredUrlParams();\n\n    // Sync initial state from primary labels to local replica\n    this.syncVariables();\n\n    // Clear existing volume data on activate or we'll show stale cached data, potentially from a different datasource\n    this.setVolumeQueryRunner();\n\n    // Subscribe to primary labels for further updates\n    this.subscribeToPrimaryLabelsVariable();\n\n    // Subscribe to variables replica\n    this.subscribeToLabelFilterChanges();\n\n    // Subscribe to tab changes (primary label)\n    this.subscribeToActiveTabVariable(getServiceSelectionPrimaryLabel(this));\n\n    if (this.state.$data.state.data?.state !== LoadingState.Done) {\n      this.runVolumeOnActivate();\n    }\n\n    // Update labels on time range change\n    this.subscribeToTimeRange();\n\n    // Update labels on datasource change\n    this.subscribeToDatasource();\n\n    this.subscribeToAggregatedMetricToggle();\n\n    this.subscribeToAggregatedMetricVariable();\n  }\n\n  private runVolumeOnActivate() {\n    if (this.isTimeRangeTooEarlyForAggMetrics()) {\n      this.onUnsupportedAggregatedMetricTimeRange();\n      if (this.state.$data.state.data?.state !== LoadingState.Done) {\n        this.runVolumeQuery();\n      }\n    } else {\n      this.onSupportedAggregatedMetricTimeRange();\n      if (this.state.$data.state.data?.state !== LoadingState.Done) {\n        this.runVolumeQuery();\n      }\n    }\n  }\n\n  private subscribeToAggregatedMetricToggle() {\n    this._subs.add(\n      this.getQueryOptionsToolbar()?.subscribeToState((newState, prevState) => {\n        if (newState.options.aggregatedMetrics.userOverride !== prevState.options.aggregatedMetrics.userOverride) {\n          this.runVolumeQuery(true);\n        }\n      })\n    );\n  }\n\n  private subscribeToDatasource() {\n    this._subs.add(\n      getDataSourceVariable(this).subscribeToState((newState) => {\n        this.addDatasourceChangeToBrowserHistory(newState.value.toString());\n        this.runVolumeQuery();\n      })\n    );\n  }\n\n  private subscribeToActiveTabVariable(primaryLabelVar: AdHocFiltersVariable) {\n    this._subs.add(\n      primaryLabelVar.subscribeToState((newState, prevState) => {\n        if (newState.filterExpression !== prevState.filterExpression) {\n          const newKey = newState.filters[0].key;\n          this.addLabelChangeToBrowserHistory(newKey);\n          // Need to tear down volume query runner to select other labels, as we need the selected tab to parse the volume response\n          const { needsSync } = this.doVariablesNeedSync();\n\n          if (needsSync) {\n            this.syncVariables();\n          } else {\n            this.runVolumeQuery(true);\n          }\n        }\n      })\n    );\n  }\n\n  /**\n   * agg metrics need parser and unwrap, have to tear down and rebuild panels when the variable changes\n   * @private\n   */\n  private subscribeToAggregatedMetricVariable() {\n    this._subs.add(\n      getAggregatedMetricsVariable(this).subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          // Clear the body panels\n          this.setState({\n            body: new SceneCSSGridLayout({ children: [] }),\n          });\n          // And re-init with the new query\n          this.updateBody(true);\n        }\n      })\n    );\n  }\n\n  private subscribeToPrimaryLabelsVariable() {\n    const labelsVarPrimary = getLabelsVariable(this);\n    this._subs.add(\n      labelsVarPrimary.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.syncVariables();\n        }\n      })\n    );\n  }\n\n  private subscribeToLabelFilterChanges() {\n    const labelsVar = getLabelsVariableReplica(this);\n    this._subs.add(\n      labelsVar.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runVolumeQuery(true);\n        }\n      })\n    );\n  }\n\n  private subscribeToVolume() {\n    this._subs.add(\n      this.state.$data.subscribeToState((newState, prevState) => {\n        // update body if the data is done loading, and the dataframes have changed\n        if (\n          newState.data?.state === LoadingState.Done &&\n          !areArraysEqual(prevState?.data?.series, newState?.data?.series)\n        ) {\n          this.updateBody(true);\n        }\n      })\n    );\n  }\n\n  private subscribeToTimeRange() {\n    this._subs.add(\n      sceneGraph.getTimeRange(this).subscribeToState(() => {\n        if (this.isTimeRangeTooEarlyForAggMetrics()) {\n          this.onUnsupportedAggregatedMetricTimeRange();\n        } else {\n          this.onSupportedAggregatedMetricTimeRange();\n        }\n        this.runVolumeQuery();\n      })\n    );\n  }\n\n  /**\n   * If the user copies a partial URL we want to prevent throwing runtime errors or running invalid queries, so we set the default tab which will trigger updates to the primary_label\n   * @private\n   */\n  private fixRequiredUrlParams() {\n    // If the selected tab is not in the URL, set the default\n    const { key } = getSelectedTabFromUrl();\n    if (!key) {\n      this.selectDefaultLabelTab();\n    }\n  }\n\n  private isTimeRangeTooEarlyForAggMetrics(): boolean {\n    const timeRange = sceneGraph.getTimeRange(this);\n    return timeRange.state.value.from.isBefore(dateTime(AGGREGATED_METRIC_START_DATE));\n  }\n\n  private onUnsupportedAggregatedMetricTimeRange() {\n    const toolbar = this.getQueryOptionsToolbar();\n    toolbar?.setState({\n      options: {\n        aggregatedMetrics: {\n          ...toolbar?.state.options.aggregatedMetrics,\n          disabled: true,\n        },\n      },\n    });\n  }\n\n  private getQueryOptionsToolbar() {\n    const indexScene = sceneGraph.getAncestor(this, IndexScene);\n    return indexScene.state.controls.find((control) => control instanceof ToolbarScene) as ToolbarScene | undefined;\n  }\n\n  private onSupportedAggregatedMetricTimeRange() {\n    const toolbar = this.getQueryOptionsToolbar();\n    toolbar?.setState({\n      options: {\n        aggregatedMetrics: {\n          ...toolbar?.state.options.aggregatedMetrics,\n          disabled: false,\n        },\n      },\n    });\n  }\n  /**\n   * Executes the Volume API call\n   * @param resetQueryRunner - optional param which will replace the query runner state with a new instantiation\n   * @private\n   */\n  private runVolumeQuery(resetQueryRunner = false) {\n    if (resetQueryRunner) {\n      this.setVolumeQueryRunner();\n    }\n\n    this.updateAggregatedMetricVariable();\n    this.state.$data.runQueries();\n  }\n\n  private updateAggregatedMetricVariable() {\n    const serviceLabelVar = getAggregatedMetricsVariable(this);\n    const labelsVar = getLabelsVariable(this);\n    if ((!this.isTimeRangeTooEarlyForAggMetrics() || !aggregatedMetricsEnabled) && this.isAggregatedMetricsActive()) {\n      serviceLabelVar.changeValueTo(AGGREGATED_SERVICE_NAME);\n\n      // Hide combobox and reset filters if aggregated metrics is enabled\n      labelsVar.setState({\n        hide: VariableHide.hideVariable,\n        filters: [],\n      });\n\n      // Hide the show logs button\n      const showLogsButton = sceneGraph.findByKeyAndType(this, showLogsButtonSceneKey, ShowLogsButtonScene);\n      showLogsButton.setState({ hidden: true });\n    } else {\n      serviceLabelVar.changeValueTo(SERVICE_NAME);\n      // Show combobox if not aggregated metrics\n      labelsVar.setState({\n        hide: VariableHide.dontHide,\n      });\n      serviceLabelVar.changeValueTo(SERVICE_NAME);\n\n      // Show the show logs button\n      const showLogsButton = sceneGraph.findByKeyAndType(this, showLogsButtonSceneKey, ShowLogsButtonScene);\n      showLogsButton.setState({ hidden: false });\n    }\n  }\n\n  private updateTabs() {\n    if (!this.state.tabs) {\n      const tabs = new ServiceSelectionTabsScene({});\n      this.setState({\n        tabs,\n      });\n    }\n  }\n\n  private getGridItems(): SceneCSSGridItem[] {\n    return this.state.body.state.children as SceneCSSGridItem[];\n  }\n\n  private getVizPanel(child: SceneCSSGridItem) {\n    return child.state.body instanceof VizPanel ? child.state.body : undefined;\n  }\n\n  /**\n   * Runs logs/volume panel queries if lazy loaded grid item is active\n   * @param child\n   * @private\n   */\n  private runPanelQuery(child: SceneCSSGridItem) {\n    if (child.isActive) {\n      const queryRunners = getQueryRunnerFromChildren(child);\n      if (queryRunners.length === 1) {\n        const queryRunner = queryRunners[0];\n        const query = queryRunner.state.queries[0];\n\n        // If the scene was cached, the time range will still be the same as what was executed in the query\n        const requestTimeRange = queryRunner.state.data?.timeRange;\n        const sceneTimeRange = sceneGraph.getTimeRange(this);\n        const fromDiff = requestTimeRange\n          ? Math.abs(sceneTimeRange.state.value.from.diff(requestTimeRange?.from, 's'))\n          : Infinity;\n        const toDiff = requestTimeRange\n          ? Math.abs(sceneTimeRange.state.value.to.diff(requestTimeRange?.to, 's'))\n          : Infinity;\n\n        const interpolated = sceneGraph.interpolate(this, query.expr);\n        // If we haven't already run this exact same query, run it\n        if (queryRunner.state.key !== interpolated || fromDiff > 0 || toDiff > 0) {\n          queryRunner.setState({\n            key: interpolated,\n          });\n          queryRunner.runQueries();\n        }\n      }\n    }\n  }\n\n  private updateBody(runQueries = false) {\n    const { labelsToQuery } = this.getLabels(this.state.$data.state.data?.series);\n    const selectedTab = this.getSelectedTab();\n    this.updateTabs();\n    // If no services are to be queried, clear the body\n    if (!labelsToQuery || labelsToQuery.length === 0) {\n      this.state.body.setState({ children: [] });\n    } else {\n      // If we have services to query, build the layout with the services. Children is an array of layouts for each service (1 row with 2 columns - timeseries and logs panel)\n      const newChildren: SceneCSSGridItem[] = [];\n      const existingChildren = this.getGridItems();\n      const timeRange = sceneGraph.getTimeRange(this).state.value;\n      const aggregatedMetricsVariable = getAggregatedMetricsVariable(this);\n      const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n      const datasourceVariable = getDataSourceVariable(this);\n\n      for (const primaryLabelValue of labelsToQuery.slice(0, SERVICES_LIMIT)) {\n        const existing = existingChildren.filter((child) => {\n          const vizPanel = this.getVizPanel(child);\n          return vizPanel?.state.title === primaryLabelValue;\n        });\n\n        if (existing.length === 2) {\n          // If we already have grid items for this service, move them over to the new array of children, this will preserve their queryRunners, preventing duplicate queries from getting run\n          newChildren.push(existing[0], existing[1]);\n\n          if (existing[0].isActive && runQueries) {\n            this.runPanelQuery(existing[0]);\n          }\n\n          if (existing[1].isActive && runQueries) {\n            this.runPanelQuery(existing[1]);\n          }\n        } else {\n          const newChildTs = this.buildServiceLayout(\n            selectedTab,\n            primaryLabelValue,\n            timeRange,\n            aggregatedMetricsVariable,\n            primaryLabelVar,\n            datasourceVariable\n          );\n          const newChildLogs = this.buildServiceLogsLayout(selectedTab, primaryLabelValue);\n          // for each service, we create a layout with timeseries and logs panel\n          newChildren.push(newChildTs, newChildLogs);\n        }\n      }\n\n      this.state.body.setState({\n        children: newChildren,\n        isLazy: true,\n        templateColumns: 'repeat(auto-fit, minmax(500px, 1fr) minmax(300px, 70vw))',\n        autoRows: '200px',\n        md: {\n          templateColumns: '1fr',\n          rowGap: 1,\n          columnGap: 1,\n        },\n      });\n    }\n  }\n\n  /**\n   * Redraws service logs after toggling level visibility.\n   */\n  private updateServiceLogs(labelName: string, labelValue: string) {\n    if (!this.state.body) {\n      this.updateBody();\n      return;\n    }\n    const { labelsToQuery } = this.getLabels(this.state.$data.state.data?.series);\n    const serviceIndex = labelsToQuery?.indexOf(labelValue);\n    if (serviceIndex === undefined || serviceIndex < 0) {\n      return;\n    }\n    let newChildren = [...this.getGridItems()];\n    newChildren.splice(serviceIndex * 2 + 1, 1, this.buildServiceLogsLayout(labelName, labelValue));\n    this.state.body.setState({ children: newChildren });\n  }\n\n  private getLogExpression(labelName: string, labelValue: string, levelFilter: string) {\n    return `{${labelName}=\\`${labelValue}\\` , ${VAR_LABELS_REPLICA_EXPR} }${levelFilter}`;\n  }\n\n  private getMetricExpression(\n    labelValue: string,\n    serviceLabelVar: CustomConstantVariable,\n    primaryLabelVar: AdHocFiltersVariable\n  ) {\n    const filter = primaryLabelVar.state.filters[0];\n    if (serviceLabelVar.state.value === AGGREGATED_SERVICE_NAME) {\n      if (filter.key === SERVICE_NAME) {\n        return `sum by (${LEVEL_VARIABLE_VALUE}) (sum_over_time({${AGGREGATED_SERVICE_NAME}=\\`${labelValue}\\` } | logfmt | unwrap count [$__auto]))`;\n      } else {\n        return `sum by (${LEVEL_VARIABLE_VALUE}) (sum_over_time({${AGGREGATED_SERVICE_NAME}=~\\`.+\\` } | logfmt | ${filter.key}=\\`${labelValue}\\` | unwrap count [$__auto]))`;\n      }\n    }\n    return `sum by (${LEVEL_VARIABLE_VALUE}) (count_over_time({ ${filter.key}=\\`${labelValue}\\`, ${VAR_LABELS_REPLICA_EXPR} } [$__auto]))`;\n  }\n\n  private extendTimeSeriesLegendBus = (\n    labelName: string,\n    labelValue: string,\n    context: PanelContext,\n    panel: VizPanel\n  ) => {\n    const originalOnToggleSeriesVisibility = context.onToggleSeriesVisibility;\n\n    context.onToggleSeriesVisibility = (level: string, mode: SeriesVisibilityChangeMode) => {\n      originalOnToggleSeriesVisibility?.(level, mode);\n\n      const allLevels = getLabelsFromSeries(panel.state.$data?.state.data?.series ?? []);\n      const levels = toggleLevelVisibility(level, this.state.serviceLevel.get(labelValue), mode, allLevels);\n      this.state.serviceLevel.set(labelValue, levels);\n\n      this.updateServiceLogs(labelName, labelValue);\n    };\n  };\n\n  private getLabels(series?: DataFrame[]) {\n    const labelsByVolume: string[] = series?.[0]?.fields[0].values ?? [];\n    const dsString = getDataSourceVariable(this).getValue()?.toString();\n    const searchString = getServiceSelectionSearchVariable(this).getValue();\n    const selectedTab = this.getSelectedTab();\n    const labelsToQuery = createListOfLabelsToQuery(labelsByVolume, dsString, String(searchString), selectedTab);\n    return { labelsByVolume, labelsToQuery: labelsToQuery };\n  }\n}\n\n// Create a list of services to query:\n// 1. Filters provided services by searchString\n// 2. Gets favoriteServicesToQuery from localStorage and filters them by searchString\n// 3. Orders them correctly\nfunction createListOfLabelsToQuery(services: string[], ds: string, searchString: string, labelName: string) {\n  if (!services?.length) {\n    return [];\n  }\n\n  if (searchString === '.+') {\n    searchString = '';\n  }\n\n  const favoriteServicesToQuery = getFavoriteLabelValuesFromStorage(ds, labelName).filter(\n    (service) => service.toLowerCase().includes(searchString.toLowerCase()) && services.includes(service)\n  );\n\n  // Deduplicate\n  return Array.from(new Set([...favoriteServicesToQuery, ...services]));\n}\n\nfunction getSelectedTabFromUrl() {\n  const location = locationService.getLocation();\n  const search = new URLSearchParams(location.search);\n  const primaryLabelRaw = search.get(primaryLabelUrlKey);\n  const primaryLabelSplit = primaryLabelRaw?.split('|');\n  const key = primaryLabelSplit?.[0];\n  return { key, search, location };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      flexGrow: 1,\n      position: 'relative',\n    }),\n    headingWrapper: css({\n      marginTop: theme.spacing(1),\n    }),\n    loadingText: css({\n      margin: 0,\n    }),\n    header: css({\n      position: 'absolute',\n      right: 0,\n      top: '4px',\n      zIndex: 2,\n    }),\n    bodyWrapper: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    icon: css({\n      color: theme.colors.text.disabled,\n      marginLeft: theme.spacing.x1,\n    }),\n    searchFieldPlaceholderText: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      color: theme.colors.text.disabled,\n      alignItems: 'center',\n      display: 'flex',\n    }),\n    searchWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      flexWrap: 'wrap',\n    }),\n    searchField: css({\n      marginTop: theme.spacing(1),\n      position: 'relative',\n    }),\n  };\n}\n","import { Observable, of } from 'rxjs';\nimport {\n  MultiValueVariable,\n  MultiValueVariableState,\n  renderSelectForVariable,\n  SceneComponentProps,\n  VariableGetOptionsArgs,\n  VariableValueOption,\n  VariableValueSingle,\n} from '@grafana/scenes';\n\nexport interface CustomConstantVariableState extends MultiValueVariableState {\n  value: VariableValueSingle;\n  isMulti?: false;\n}\n\nexport class CustomConstantVariable extends MultiValueVariable<CustomConstantVariableState> {\n  public constructor(initialState: Partial<CustomConstantVariableState>) {\n    super({\n      type: 'custom',\n      value: '',\n      text: '',\n      options: [],\n      name: '',\n      ...initialState,\n    });\n  }\n\n  public getValueOptions(args: VariableGetOptionsArgs): Observable<VariableValueOption[]> {\n    return of(this.state.options);\n  }\n\n  public static Component = ({ model }: SceneComponentProps<MultiValueVariable>) => {\n    return renderSelectForVariable(model);\n  };\n}\n","import { reportInteraction } from '@grafana/runtime';\nimport pluginJson from '../plugin.json';\n\n// Helper function to create a unique interaction name for analytics\nconst createInteractionName = (page: UserEventPagesType, action: string) => {\n  return `${pluginJson.id.replace(/-/g, '_')}_${page}_${action}`;\n};\n\n// Runs reportInteraction with a standardized interaction name\nexport const reportAppInteraction = (\n  page: UserEventPagesType,\n  action: UserEventActionType,\n  properties?: Record<string, unknown>\n) => {\n  reportInteraction(createInteractionName(page, action), properties);\n};\n\nexport const USER_EVENTS_PAGES = {\n  service_selection: 'service_selection',\n  service_details: 'service_details',\n  all: 'all',\n} as const;\n\ntype UserEventPagesType = keyof typeof USER_EVENTS_PAGES;\ntype UserEventActionType =\n  | keyof (typeof USER_EVENTS_ACTIONS)['service_selection']\n  | keyof (typeof USER_EVENTS_ACTIONS)['service_details']\n  | keyof (typeof USER_EVENTS_ACTIONS)['all'];\n\nexport const USER_EVENTS_ACTIONS = {\n  [USER_EVENTS_PAGES.service_selection]: {\n    // Searching for service using search input. Props: searchQueryLength, containsLevel\n    search_services_changed: 'search_services_changed',\n    // Selecting service. Props: service\n    service_selected: 'service_selected',\n    // Toggling aggregated metrics on/off\n    aggregated_metrics_toggled: 'aggregated_metrics_toggled',\n    add_to_filters: 'add_to_filters',\n  },\n  [USER_EVENTS_PAGES.service_details]: {\n    open_in_explore_clicked: 'open_in_explore_clicked',\n    // Selecting action view tab (logs/labels/fields/patterns). Props: newActionView, previousActionView\n    action_view_changed: 'action_view_changed',\n    // Clicking on \"Include\" button in time series panels. Used in multiple views. The view type is passed as a parameter. Props: filterType, key, isFilterDuplicate, filtersLength\n    add_to_filters_in_breakdown_clicked: 'add_to_filters_in_breakdown_clicked',\n    // Clicking on \"Select\" button button in time series panels. Used in multiple views.The view type is passed as a parameter. Props: field, previousField, view\n    select_field_in_breakdown_clicked: 'select_field_in_breakdown_clicked',\n    // Clicking on one of the levels in the Logs Volume panel\n    level_in_logs_volume_clicked: 'level_in_logs_volume_clicked',\n    // Changing layout type (e.g. single/grid/rows). Used in multiple views. The view type is passed as a parameter. Props: layout, view\n    layout_type_changed: 'layout_type_changed',\n    // Changing search string in logs. Props: searchQuery\n    search_string_in_logs_changed: 'search_string_in_logs_changed',\n    // Removing a pattern (e.g. include/exclude) from the list. Props: includePatternsLength, excludePatternsLength, type\n    pattern_removed: 'pattern_removed',\n    // Selecting a pattern (e.g. include/exclude) from the list. Props: includePatternsLength, excludePatternsLength, type\n    pattern_selected: 'pattern_selected',\n    // Clicking on a pattern field in the pattern name.\n    pattern_field_clicked: 'pattern_field_clicked',\n    // Toggling between logs/table view\n    logs_visualization_toggle: 'logs_visualization_toggle',\n    // Filter (include, exclude) from log details\n    logs_detail_filter_applied: 'logs_detail_filter_applied',\n    // Popover menu filter\n    logs_popover_line_filter: 'logs_popover_line_filter',\n    // Toggle displayed fields\n    logs_toggle_displayed_field: 'logs_toggle_displayed_field',\n    // Clear all displayed fields\n    logs_clear_displayed_fields: 'logs_clear_displayed_fields',\n    // Value breakdown sort change\n    value_breakdown_sort_change: 'value_breakdown_sort_change',\n    // Wasm not supported\n    wasm_not_supported: 'wasm_not_supported',\n  },\n  [USER_EVENTS_PAGES.all]: {\n    interval_too_long: 'interval_too_long',\n  },\n} as const;\n","import _ from 'lodash';\n\n/**\n * Order doesn't matter, converts to sets, deep compare via lodash isEqual\n * @param arr1\n * @param arr2\n */\n\nexport const areArraysEqual = (arr1: any[] | undefined, arr2: any[] | undefined) => {\n  // If one array is undefined, and the other is empty, they will cast to the same set.\n  if (typeof arr1 !== typeof arr2) {\n    return false;\n  }\n  const set1 = new Set(arr1);\n  const set2 = new Set(arr2);\n\n  // Save us from running the isEqual check if the set sizes are different\n  if (set1.size !== set2.size) {\n    return false;\n  }\n\n  return _.isEqual(set1, set2);\n};\n","import { MetricExpr, parser, Selector } from '@grafana/lezer-logql';\nimport { LokiQuery } from './lokiQuery';\nimport { getNodesFromQuery } from './logqlMatchers';\nimport { SceneDataQueryRequest } from './datasourceTypes';\n\nexport function isQueryWithNode(query: string, nodeType: number): boolean {\n  let isQueryWithNode = false;\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: ({ type }): false | void => {\n      if (type.id === nodeType) {\n        isQueryWithNode = true;\n        return false;\n      }\n    },\n  });\n  return isQueryWithNode;\n}\n\nexport function isLogsQuery(query: string): boolean {\n  // As a safeguard we are checking for a length of 2, because at least the query should be `{}`\n  return query.trim().length > 2 && !isQueryWithNode(query, MetricExpr);\n}\n\nexport function isLogsRequest(request: SceneDataQueryRequest) {\n  return request.targets.find((query) => isLogsQuery(query.expr)) !== undefined;\n}\n\nexport function requestSupportsSharding(request: SceneDataQueryRequest) {\n  if (isLogsRequest(request)) {\n    return false;\n  }\n  for (let i = 0; i < request.targets.length; i++) {\n    if (request.targets[i].expr?.includes('avg_over_time')) {\n      return false;\n    }\n  }\n  return true;\n}\n\nconst SHARDING_PLACEHOLDER = '__stream_shard_number__';\nexport const addShardingPlaceholderSelector = (query: string) => {\n  return query.replace('}', `, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`);\n};\n\nexport const interpolateShardingSelector = (queries: LokiQuery[], shards?: number[]) => {\n  if (shards === undefined || shards.length === 0) {\n    return queries.map((query) => ({\n      ...query,\n      expr: query.expr.replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, '}'),\n    }));\n  }\n\n  let shardValue = shards.join('|');\n\n  // -1 means empty shard value\n  if (shardValue === '-1' || shards.length === 1) {\n    shardValue = shardValue === '-1' ? '' : shardValue;\n    return queries.map((query) => ({\n      ...query,\n      expr: query.expr.replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, `, __stream_shard__=\"${shardValue}\"}`),\n    }));\n  }\n\n  return queries.map((query) => ({\n    ...query,\n    expr: query.expr.replace(new RegExp(`${SHARDING_PLACEHOLDER}`, 'g'), shardValue),\n  }));\n};\n\nexport const getSelectorForShardValues = (query: string) => {\n  const selector = getNodesFromQuery(query, [Selector]);\n  if (selector.length > 0) {\n    return query\n      .substring(selector[0].from, selector[0].to)\n      .replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, '}');\n  }\n  return '';\n};\n","import {\n  closestIdx,\n  DataFrame,\n  DataFrameType,\n  DataQueryResponse,\n  DataQueryResponseData,\n  Field,\n  FieldType,\n  QueryResultMetaStat,\n} from '@grafana/data';\nimport { logger } from './logger';\n\nexport function combineResponses(currentResult: DataQueryResponse | null, newResult: DataQueryResponse) {\n  if (!currentResult) {\n    return cloneQueryResponse(newResult);\n  }\n\n  newResult.data.forEach((newFrame) => {\n    const currentFrame = currentResult.data.find((frame) => shouldCombine(frame, newFrame));\n    if (!currentFrame) {\n      currentResult.data.push(cloneDataFrame(newFrame));\n      return;\n    }\n    mergeFrames(currentFrame, newFrame);\n  });\n\n  const mergedErrors = [...(currentResult.errors ?? []), ...(newResult.errors ?? [])];\n\n  // we make sure to have `.errors` as undefined, instead of empty-array\n  // when no errors.\n\n  if (mergedErrors.length > 0) {\n    currentResult.errors = mergedErrors;\n  }\n\n  // the `.error` attribute is obsolete now,\n  // but we have to maintain it, otherwise\n  // some grafana parts do not behave well.\n  // we just choose the old error, if it exists,\n  // otherwise the new error, if it exists.\n  const mergedError = currentResult.error ?? newResult.error;\n  if (mergedError != null) {\n    currentResult.error = mergedError;\n  }\n\n  const mergedTraceIds = [...(currentResult.traceIds ?? []), ...(newResult.traceIds ?? [])];\n  if (mergedTraceIds.length > 0) {\n    currentResult.traceIds = mergedTraceIds;\n  }\n\n  return currentResult;\n}\n\n/**\n * Given two data frames, merge their values. Overlapping values will be added together.\n */\nexport function mergeFrames(dest: DataFrame, source: DataFrame) {\n  const destTimeField = dest.fields.find((field) => field.type === FieldType.time);\n  const destIdField = dest.fields.find((field) => field.type === FieldType.string && field.name === 'id');\n  const sourceTimeField = source.fields.find((field) => field.type === FieldType.time);\n  const sourceIdField = source.fields.find((field) => field.type === FieldType.string && field.name === 'id');\n\n  if (!destTimeField || !sourceTimeField) {\n    logger.error(new Error(`Time fields not found in the data frames`));\n    return;\n  }\n\n  const sourceTimeValues = sourceTimeField?.values.slice(0) ?? [];\n  const totalFields = Math.max(dest.fields.length, source.fields.length);\n\n  for (let i = 0; i < sourceTimeValues.length; i++) {\n    const destIdx = resolveIdx(destTimeField, sourceTimeField, i);\n\n    const entryExistsInDest = compareEntries(destTimeField, destIdField, destIdx, sourceTimeField, sourceIdField, i);\n\n    for (let f = 0; f < totalFields; f++) {\n      // For now, skip undefined fields that exist in the new frame\n      if (!dest.fields[f]) {\n        continue;\n      }\n      // Index is not reliable when frames have disordered fields, or an extra/missing field, so we find them by name.\n      // If the field has no name, we fallback to the old index version.\n      const sourceField = findSourceField(dest.fields[f], source.fields, f);\n      if (!sourceField) {\n        continue;\n      }\n      // Same value, accumulate\n      if (entryExistsInDest) {\n        if (dest.fields[f].type === FieldType.time) {\n          // Time already exists, skip\n          continue;\n        } else if (dest.fields[f].type === FieldType.number) {\n          // Number, add\n          dest.fields[f].values[destIdx] = (dest.fields[f].values[destIdx] ?? 0) + sourceField.values[i];\n        } else if (dest.fields[f].type === FieldType.other) {\n          // Possibly labels, combine\n          if (typeof sourceField.values[i] === 'object') {\n            dest.fields[f].values[destIdx] = {\n              ...dest.fields[f].values[destIdx],\n              ...sourceField.values[i],\n            };\n          } else if (sourceField.values[i] != null) {\n            dest.fields[f].values[destIdx] = sourceField.values[i];\n          }\n        } else {\n          // Replace value\n          dest.fields[f].values[destIdx] = sourceField.values[i];\n        }\n      } else if (sourceField.values[i] !== undefined) {\n        // Insert in the `destIdx` position\n        dest.fields[f].values.splice(destIdx, 0, sourceField.values[i]);\n        if (sourceField.nanos) {\n          dest.fields[f].nanos = dest.fields[f].nanos ?? new Array(dest.fields[f].values.length - 1).fill(0);\n          dest.fields[f].nanos?.splice(destIdx, 0, sourceField.nanos[i]);\n        }\n      }\n    }\n  }\n\n  dest.length = dest.fields[0].values.length;\n\n  dest.meta = {\n    ...dest.meta,\n    stats: getCombinedMetadataStats(dest.meta?.stats ?? [], source.meta?.stats ?? []),\n  };\n}\n\nfunction resolveIdx(destField: Field, sourceField: Field, index: number) {\n  const idx = closestIdx(sourceField.values[index], destField.values);\n  if (idx < 0) {\n    return 0;\n  }\n  if (sourceField.values[index] === destField.values[idx] && sourceField.nanos != null && destField.nanos != null) {\n    return sourceField.nanos[index] > destField.nanos[idx] ? idx + 1 : idx;\n  }\n  if (sourceField.values[index] > destField.values[idx]) {\n    return idx + 1;\n  }\n  return idx;\n}\n\nfunction compareEntries(\n  destTimeField: Field,\n  destIdField: Field | undefined,\n  destIndex: number,\n  sourceTimeField: Field,\n  sourceIdField: Field | undefined,\n  sourceIndex: number\n) {\n  const sameTimestamp = compareNsTimestamps(destTimeField, destIndex, sourceTimeField, sourceIndex);\n  if (!sameTimestamp) {\n    return false;\n  }\n  if (destIdField == null || sourceIdField == null) {\n    return true;\n  }\n  // Log frames, check indexes\n  return (\n    destIdField.values[destIndex] !== undefined && destIdField.values[destIndex] === sourceIdField.values[sourceIndex]\n  );\n}\n\nfunction compareNsTimestamps(destField: Field, destIndex: number, sourceField: Field, sourceIndex: number) {\n  if (destField.nanos && sourceField.nanos) {\n    return (\n      destField.values[destIndex] !== undefined &&\n      destField.values[destIndex] === sourceField.values[sourceIndex] &&\n      destField.nanos[destIndex] !== undefined &&\n      destField.nanos[destIndex] === sourceField.nanos[sourceIndex]\n    );\n  }\n  return destField.values[destIndex] !== undefined && destField.values[destIndex] === sourceField.values[sourceIndex];\n}\n\nfunction findSourceField(referenceField: Field, sourceFields: Field[], index: number) {\n  const candidates = sourceFields.filter((f) => f.name === referenceField.name);\n\n  if (candidates.length === 1) {\n    return candidates[0];\n  }\n\n  return sourceFields[index];\n}\n\nconst TOTAL_BYTES_STAT = 'Summary: total bytes processed';\n// This is specific for Loki\nfunction getCombinedMetadataStats(\n  destStats: QueryResultMetaStat[],\n  sourceStats: QueryResultMetaStat[]\n): QueryResultMetaStat[] {\n  // in the current approach, we only handle a single stat\n  const destStat = destStats.find((s) => s.displayName === TOTAL_BYTES_STAT);\n  const sourceStat = sourceStats.find((s) => s.displayName === TOTAL_BYTES_STAT);\n\n  if (sourceStat != null && destStat != null) {\n    return [{ value: sourceStat.value + destStat.value, displayName: TOTAL_BYTES_STAT, unit: destStat.unit }];\n  }\n\n  // maybe one of them exist\n  const eitherStat = sourceStat ?? destStat;\n  if (eitherStat != null) {\n    return [eitherStat];\n  }\n\n  return [];\n}\n\n/**\n * Deep clones a DataQueryResponse\n */\nexport function cloneQueryResponse(response: DataQueryResponse): DataQueryResponse {\n  const newResponse = {\n    ...response,\n    data: response.data.map(cloneDataFrame),\n  };\n  return newResponse;\n}\n\nfunction cloneDataFrame(frame: DataQueryResponseData): DataQueryResponseData {\n  return {\n    ...frame,\n    fields: frame.fields.map((field: Field) => ({\n      ...field,\n      values: field.values,\n    })),\n  };\n}\n\nfunction shouldCombine(frame1: DataFrame, frame2: DataFrame): boolean {\n  if (frame1.refId !== frame2.refId) {\n    return false;\n  }\n  if (frame1.name != null && frame2.name != null && frame1.name !== frame2.name) {\n    return false;\n  }\n\n  const frameType1 = frame1.meta?.type;\n  const frameType2 = frame2.meta?.type;\n\n  if (frameType1 !== frameType2) {\n    // we do not join things that have a different type\n    return false;\n  }\n\n  // metric range query data\n  if (frameType1 === DataFrameType.TimeSeriesMulti) {\n    return compareLabels(frame1, frame2);\n  }\n\n  // logs query data\n  // logs use a special attribute in the dataframe's \"custom\" section\n  // because we do not have a good \"frametype\" value for them yet.\n  const customType1 = frame1.meta?.custom?.frameType;\n  const customType2 = frame2.meta?.custom?.frameType;\n  // Legacy frames have this custom type\n  if (customType1 === 'LabeledTimeValues' && customType2 === 'LabeledTimeValues') {\n    return true;\n  } else if (customType1 === customType2) {\n    // Data plane frames don't\n    return true;\n  }\n\n  // should never reach here\n  return false;\n}\n\nfunction compareLabels(frame1: DataFrame, frame2: DataFrame) {\n  const field1 = frame1.fields.find((f) => f.type === FieldType.number);\n  const field2 = frame2.fields.find((f) => f.type === FieldType.number);\n  if (field1 === undefined || field2 === undefined) {\n    // should never happen\n    return false;\n  }\n  // undefined == null\n  if (frame1.name == null) {\n    frame1.name = JSON.stringify(field1.labels);\n  }\n  if (frame2.name == null) {\n    frame2.name = JSON.stringify(field2.labels);\n  }\n  return frame1.name === frame2.name;\n}\n","import pluginJson from '../plugin.json';\nimport { Observable, Subscriber, Subscription } from 'rxjs';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { DataQueryRequest, LoadingState, DataQueryResponse, QueryResultMetaStat } from '@grafana/data';\nimport { addShardingPlaceholderSelector, getSelectorForShardValues, interpolateShardingSelector } from './logql';\nimport { combineResponses } from './combineResponses';\nimport { DataSourceWithBackend } from '@grafana/runtime';\nimport { LokiQuery } from './lokiQuery';\nimport { logger } from './logger';\nimport { isValidQuery } from './logqlMatchers';\n\n/**\n * Query splitting by stream shards.\n * Query splitting was introduced in Loki to optimize querying for long intervals and high volume of data,\n * dividing a big request into smaller sub-requests, combining and displaying the results as they arrive.\n *\n * This approach, inspired by the time-based query splitting, takes advantage of the __stream_shard__\n * internal label, representing how data is spread into different sources that can be queried individually.\n *\n * The main entry point of this module is runShardSplitQuery(), which prepares the query for execution and\n * passes it to splitQueriesByStreamShard() to begin the querying loop.\n *\n * splitQueriesByStreamShard() has the following structure:\n * - Creates and returns an Observable to which the UI will subscribe\n * - Requests the __stream_shard__ values of the selected service:\n *   . If there are no shard values, it falls back to the standard querying approach of the data source in runNonSplitRequest()\n *   . If there are shards:\n *     - It sorts them by value, descending. Higher shard numbers correspond with the least volume.\n *     - It defines an initial group size, roughly Math.sqrt(amountOfShards).\n *     - It begins the querying loop with runNextRequest().\n * - runNextRequest() will create a group of groupSize shards from the nth shard (cycle), and has the following internal structure:\n *   . groupShardRequests() returns an array of shards from cycle to cycle + groupSize.\n *   . interpolateShardingSelector() will update the stream selector with the shard numbers in the current group.\n *   . After query execution:\n *     - If the response is successful:\n *       . It will add new data to the response with combineResponses()\n *       . Using the data and meta data of the response, updateGroupSizeFromResponse() will increase or decrease the group size.\n *       . nextRequest() will use the current cycle and group size to determine the next request or complete execution with done().\n *     - If the response is unsuccessful:\n *       . If the response is not a query error, and the group size bigger than 1, it will decrease the group size.\n *       . If the group size is already 1, it will retry the request up to 4 times.\n *       . If there are retry attempts, it will retry the current cycle, or else stop querying.\n * - Once all request groups have been executed, it will be done().\n */\n\nexport function runShardSplitQuery(datasource: DataSourceWithBackend<LokiQuery>, request: DataQueryRequest<LokiQuery>) {\n  const queries = datasource\n    .interpolateVariablesInQueries(request.targets, request.scopedVars)\n    .filter((query) => query.expr)\n    .map((target) => ({\n      ...target,\n      expr: addShardingPlaceholderSelector(target.expr),\n    }));\n\n  return splitQueriesByStreamShard(datasource, request, queries);\n}\n\nfunction splitQueriesByStreamShard(\n  datasource: DataSourceWithBackend<LokiQuery>,\n  request: DataQueryRequest<LokiQuery>,\n  splittingTargets: LokiQuery[]\n) {\n  let shouldStop = false;\n  let mergedResponse: DataQueryResponse = { data: [], state: LoadingState.Streaming, key: uuidv4() };\n  let subquerySubscription: Subscription | null = null;\n  let retriesMap = new Map<number, number>();\n  let retryTimer: ReturnType<typeof setTimeout> | null = null;\n\n  const runNextRequest = (\n    subscriber: Subscriber<DataQueryResponse>,\n    cycle: number,\n    shards: number[],\n    groupSize: number\n  ) => {\n    let nextGroupSize = groupSize;\n    let retrying = false;\n\n    if (subquerySubscription != null) {\n      subquerySubscription.unsubscribe();\n      subquerySubscription = null;\n    }\n\n    const done = () => {\n      mergedResponse.state = shouldStop ? LoadingState.Error : LoadingState.Done;\n      subscriber.next(mergedResponse);\n      subscriber.complete();\n    };\n\n    if (shouldStop) {\n      done();\n      return;\n    }\n\n    const nextRequest = () => {\n      const nextCycle = Math.min(cycle + groupSize, shards.length);\n      if (cycle < shards.length && nextCycle <= shards.length) {\n        runNextRequest(subscriber, nextCycle, shards, nextGroupSize);\n        return;\n      }\n      done();\n    };\n\n    const retry = (errorResponse?: DataQueryResponse) => {\n      try {\n        if (errorResponse && !isRetriableError(errorResponse)) {\n          return false;\n        }\n      } catch (e) {\n        logger.error(e);\n        shouldStop = true;\n        return false;\n      }\n\n      if (groupSize > 1) {\n        groupSize = Math.floor(Math.sqrt(groupSize));\n        debug(`Possible time out, new group size ${groupSize}`);\n        retrying = true;\n        runNextRequest(subscriber, cycle, shards, groupSize);\n        return true;\n      }\n\n      const retries = retriesMap.get(cycle) ?? 0;\n      if (retries > 3) {\n        shouldStop = true;\n        return false;\n      }\n\n      retriesMap.set(cycle, retries + 1);\n\n      retryTimer = setTimeout(() => {\n        logger.info(`Retrying ${cycle} (${retries + 1})`);\n        runNextRequest(subscriber, cycle, shards, groupSize);\n        retryTimer = null;\n      }, 1500 * Math.pow(2, retries)); // Exponential backoff\n\n      retrying = true;\n\n      return true;\n    };\n\n    const shardsToQuery = groupShardRequests(shards, cycle, groupSize);\n    debug(`Querying ${shardsToQuery.join(', ')}`);\n    const subRequest = { ...request, targets: interpolateShardingSelector(splittingTargets, shardsToQuery) };\n    // Request may not have a request id\n    if (request.requestId) {\n      subRequest.requestId = `${request.requestId}_shard_${cycle}_${groupSize}`;\n    }\n\n    // @ts-expect-error\n    subquerySubscription = datasource.runQuery(subRequest).subscribe({\n      next: (partialResponse: DataQueryResponse) => {\n        if ((partialResponse.errors ?? []).length > 0 || partialResponse.error != null) {\n          if (retry(partialResponse)) {\n            return;\n          }\n        }\n        nextGroupSize = constrainGroupSize(\n          cycle + groupSize,\n          updateGroupSizeFromResponse(partialResponse, groupSize),\n          shards.length\n        );\n        if (nextGroupSize !== groupSize) {\n          debug(`New group size ${nextGroupSize}`);\n        }\n        mergedResponse = combineResponses(mergedResponse, partialResponse);\n      },\n      complete: () => {\n        if (retrying) {\n          return;\n        }\n        // Prevent flashing \"no data\"\n        if (mergedResponse.data.length) {\n          subscriber.next(mergedResponse);\n        }\n        nextRequest();\n      },\n      error: (error: unknown) => {\n        logger.error(error, { msg: 'failed to shard' });\n        subscriber.next(mergedResponse);\n        if (retry()) {\n          return;\n        }\n        nextRequest();\n      },\n    });\n  };\n\n  const runNonSplitRequest = (subscriber: Subscriber<DataQueryResponse>) => {\n    subquerySubscription = datasource.query(request).subscribe({\n      next: (partialResponse: DataQueryResponse) => {\n        mergedResponse = partialResponse;\n      },\n      complete: () => {\n        subscriber.next(mergedResponse);\n      },\n      error: (error: unknown) => {\n        logger.error(error, { msg: 'runNonSplitRequest subscription error' });\n        subscriber.error(mergedResponse);\n      },\n    });\n  };\n\n  const response = new Observable<DataQueryResponse>((subscriber) => {\n    const selector = getSelectorForShardValues(splittingTargets[0].expr);\n\n    if (!isValidQuery(selector)) {\n      debug(`Skipping invalid selector: ${selector}`);\n      subscriber.complete();\n      return;\n    }\n\n    datasource.languageProvider\n      .fetchLabelValues('__stream_shard__', {\n        timeRange: request.range,\n        streamSelector: selector ? selector : undefined,\n      })\n      .then((values: string[]) => {\n        const shards = values.map((value) => parseInt(value, 10));\n        if (!shards || !shards.length) {\n          logger.warn(`Shard splitting not supported. Issuing a regular query.`);\n          runNonSplitRequest(subscriber);\n        } else {\n          shards.sort((a, b) => b - a);\n          debug(`Querying ${shards.join(', ')} shards`);\n          runNextRequest(subscriber, 0, shards, getInitialGroupSize(shards));\n        }\n      })\n      .catch((e: unknown) => {\n        logger.error(e, { msg: 'failed to fetch label values for __stream_shard__' });\n        runNonSplitRequest(subscriber);\n      });\n    return () => {\n      shouldStop = true;\n      if (retryTimer) {\n        clearTimeout(retryTimer);\n      }\n      if (subquerySubscription != null) {\n        subquerySubscription.unsubscribe();\n        subquerySubscription = null;\n      }\n    };\n  });\n\n  return response;\n}\n\nfunction updateGroupSizeFromResponse(response: DataQueryResponse, currentSize: number) {\n  if (!response.data.length) {\n    // Empty response, increase group size\n    return currentSize + 1;\n  }\n\n  const metaExecutionTime: QueryResultMetaStat | undefined = response.data[0].meta?.stats?.find(\n    (stat: QueryResultMetaStat) => stat.displayName === 'Summary: exec time'\n  );\n\n  if (metaExecutionTime) {\n    const executionTime = Math.round(metaExecutionTime.value);\n    debug(`${metaExecutionTime.value}`);\n    // Positive scenarios\n    if (executionTime <= 1) {\n      return Math.floor(currentSize * 1.5);\n    } else if (executionTime < 6) {\n      return Math.ceil(currentSize * 1.1);\n    }\n\n    // Negative scenarios\n    if (currentSize === 1) {\n      return currentSize;\n    } else if (executionTime < 20) {\n      return Math.ceil(currentSize * 0.9);\n    } else {\n      return Math.floor(currentSize / 2);\n    }\n  }\n\n  return currentSize;\n}\n\n/**\n * Prevents the group size for ever being more than maxFactor% of the pending shards.\n */\nfunction constrainGroupSize(cycle: number, groupSize: number, shards: number) {\n  const maxFactor = 0.7;\n  return Math.min(groupSize, Math.max(Math.floor((shards - cycle) * maxFactor), 1));\n}\n\nfunction groupShardRequests(shards: number[], start: number, groupSize: number) {\n  if (start === shards.length) {\n    return [-1];\n  }\n  return shards.slice(start, start + groupSize);\n}\n\nfunction getInitialGroupSize(shards: number[]) {\n  return Math.floor(Math.sqrt(shards.length));\n}\n\nfunction isRetriableError(errorResponse: DataQueryResponse) {\n  const message = errorResponse.errors\n    ? (errorResponse.errors[0].message ?? '').toLowerCase()\n    : errorResponse.error?.message ?? '';\n  if (message.includes('timeout')) {\n    return true;\n  } else if (message.includes('parse error')) {\n    // If the error is a parse error, we want to signal to stop querying.\n    throw new Error(message);\n  }\n  return false;\n}\n\n// Enable to output debugging logs\nconst DEBUG_ENABLED = Boolean(localStorage.getItem(`${pluginJson.id}.sharding_debug_enabled`));\nfunction debug(message: string) {\n  if (!DEBUG_ENABLED) {\n    return;\n  }\n  console.log(message);\n}\n","import {\n  createDataFrame,\n  DataFrame,\n  DataQueryRequest,\n  DataQueryResponse,\n  Field,\n  FieldType,\n  LoadingState,\n  TestDataSourceResponse,\n} from '@grafana/data';\nimport { config, DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { RuntimeDataSource, sceneUtils } from '@grafana/scenes';\nimport { DataQuery } from '@grafana/schema';\nimport { Observable, Subscriber } from 'rxjs';\nimport { getDataSource } from './scenes';\nimport { getPrimaryLabelFromUrl } from './routing';\nimport { DetectedFieldsResponse, DetectedLabelsResponse } from './fields';\nimport { FIELDS_TO_REMOVE, LABELS_TO_REMOVE, sortLabelsByCardinality } from './filters';\nimport { SERVICE_NAME } from './variables';\nimport { runShardSplitQuery } from './shardQuerySplitting';\nimport { requestSupportsSharding } from './logql';\nimport { LokiQuery } from './lokiQuery';\nimport { SceneDataQueryRequest, SceneDataQueryResourceRequest, VolumeRequestProps } from './datasourceTypes';\nimport { logger } from './logger';\nimport { PLUGIN_ID } from './plugin';\nimport { PLACEHOLDER_QUERY } from './query';\n\nexport const WRAPPED_LOKI_DS_UID = 'wrapped-loki-ds-uid';\n\ntype TimeStampOfVolumeEval = number;\ntype VolumeCount = string;\ntype VolumeValue = [TimeStampOfVolumeEval, VolumeCount];\ntype VolumeResult = {\n  metric: {\n    service_name?: string;\n    __aggregated_metric__?: string;\n    [index: string]: string | undefined;\n  };\n  value: VolumeValue;\n};\n\ntype IndexVolumeResponse = {\n  data: {\n    result: VolumeResult[];\n  };\n};\n\ntype LabelsResponse = {\n  status: string;\n  data: string[];\n};\n\ntype SampleTimeStamp = number;\ntype SampleCount = number;\ntype PatternSample = [SampleTimeStamp, SampleCount];\n\nexport interface LokiPattern {\n  pattern: string;\n  samples: PatternSample[];\n}\n\ntype PatternsResponse = {\n  data: LokiPattern[];\n};\n\nexport const DETECTED_FIELDS_NAME_FIELD = 'name';\n\nexport const DETECTED_FIELDS_CARDINALITY_NAME = 'cardinality';\n\nexport const DETECTED_FIELDS_PARSER_NAME = 'parser';\n\nexport const DETECTED_FIELDS_TYPE_NAME = 'type';\n\nexport class WrappedLokiDatasource extends RuntimeDataSource<DataQuery> {\n  constructor(pluginId: string, uid: string) {\n    super(pluginId, uid);\n  }\n\n  query(request: SceneDataQueryRequest): Promise<DataQueryResponse> | Observable<DataQueryResponse> {\n    return new Observable<DataQueryResponse>((subscriber) => {\n      if (!request.scopedVars?.__sceneObject) {\n        throw new Error('Scene object not found in request');\n      }\n\n      getDataSourceSrv()\n        .get(getDataSource(request.scopedVars.__sceneObject.valueOf()))\n        .then(async (ds) => {\n          if (!(ds instanceof DataSourceWithBackend)) {\n            throw new Error('Invalid datasource!');\n          }\n\n          // override the target datasource to Loki\n          request.targets = request.targets?.map((target) => {\n            target.datasource = ds;\n            return target;\n          });\n\n          const targetsSet = new Set();\n          request.targets.forEach((target) => {\n            targetsSet.add(target.resource ?? '');\n          });\n\n          if (targetsSet.size !== 1) {\n            throw new Error('A request cannot contain queries to multiple endpoints');\n          }\n\n          const requestType = request.targets[0].resource;\n\n          switch (requestType) {\n            case 'volume': {\n              await this.getVolume(request, ds, subscriber);\n              break;\n            }\n            case 'patterns': {\n              await this.getPatterns(request, ds, subscriber);\n              break;\n            }\n            case 'detected_labels': {\n              await this.getDetectedLabels(request, ds, subscriber);\n              break;\n            }\n            case 'detected_fields': {\n              await this.getDetectedFields(request, ds, subscriber);\n              break;\n            }\n            case 'labels': {\n              await this.getLabels(request, ds, subscriber);\n              break;\n            }\n            default: {\n              this.getData(request, ds, subscriber);\n              break;\n            }\n          }\n        });\n    });\n  }\n\n  private getData(\n    request: SceneDataQueryRequest,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const shardingEnabled = config.featureToggles.exploreLogsShardSplitting;\n\n    // Query the datasource and return either observable or promise\n    const dsResponse =\n      requestSupportsSharding(request) === false || !shardingEnabled\n        ? ds.query(request)\n        : runShardSplitQuery(ds, request);\n    dsResponse.subscribe(subscriber);\n\n    return subscriber;\n  }\n\n  private async getPatterns(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'patterns';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Patterns query can only have a single target!');\n    }\n    const { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const dsResponse = ds.getResource(\n        'patterns',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'patterns',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n      const response: PatternsResponse = await dsResponse;\n      const lokiPatterns = response?.data;\n\n      let maxValue = -Infinity;\n      let minValue = 0;\n\n      const frames: DataFrame[] =\n        lokiPatterns?.map((pattern: LokiPattern) => {\n          const timeValues: number[] = [];\n          const countValues: number[] = [];\n          let sum = 0;\n          pattern.samples.forEach(([time, count]) => {\n            timeValues.push(time * 1000);\n            countValues.push(count);\n            if (count > maxValue) {\n              maxValue = count;\n            }\n            if (count < minValue) {\n              minValue = count;\n            }\n            if (count > maxValue) {\n              maxValue = count;\n            }\n            if (count < minValue) {\n              minValue = count;\n            }\n            sum += count;\n          });\n          return createDataFrame({\n            refId: interpolatedTarget.refId,\n            name: pattern.pattern,\n            fields: [\n              {\n                name: 'time',\n                type: FieldType.time,\n                values: timeValues,\n                config: {},\n              },\n              {\n                name: pattern.pattern,\n                type: FieldType.number,\n                values: countValues,\n                config: {},\n              },\n            ],\n            meta: {\n              preferredVisualisationType: 'graph',\n              custom: {\n                sum,\n              },\n            },\n          });\n        }) ?? [];\n\n      frames.sort((a, b) => (b.meta?.custom?.sum as number) - (a.meta?.custom?.sum as number));\n      subscriber.next({ data: frames, state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  private interpolate(\n    ds: DataSourceWithBackend<LokiQuery>,\n    targets: Array<LokiQuery & SceneDataQueryResourceRequest>,\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>\n  ) {\n    const targetsInterpolated = ds.interpolateVariablesInQueries(targets, request.scopedVars);\n    if (!targetsInterpolated.length) {\n      throw new Error('Datasource failed to interpolate query!');\n    }\n    const interpolatedTarget = targetsInterpolated[0];\n    const expression = interpolatedTarget.expr;\n    return { interpolatedTarget, expression };\n  }\n\n  private async getDetectedLabels(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'detected_labels';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Detected labels query can only have a single target!');\n    }\n\n    let { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n\n    // Detected_labels is a bit different then other queries that interpolate the labels variable, it can be empty, but if it is empty it must be completely empty or we'll get the \"queries require at least one regexp or equality\" error from Loki\n    if (expression.trim() === `{${PLACEHOLDER_QUERY}}`) {\n      expression = '';\n    }\n\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const response = await ds.getResource<DetectedLabelsResponse>(\n        'detected_labels',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'detected_labels',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      const { labelName: primaryLabelName } = getPrimaryLabelFromUrl();\n\n      const labels = response.detectedLabels\n        ?.filter((label) => primaryLabelName !== label.label && !LABELS_TO_REMOVE.includes(label.label))\n        ?.sort((a, b) => sortLabelsByCardinality(a, b));\n\n      const detectedLabelFields: Array<Partial<Field>> = labels?.map((label) => {\n        return {\n          name: label.label,\n          values: [label.cardinality],\n        };\n      });\n\n      const dataFrame = createDataFrame({\n        refId: interpolatedTarget.refId,\n        fields: detectedLabelFields ?? [],\n      });\n\n      subscriber.next({ data: [dataFrame], state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  private async getDetectedFields(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'detected_fields';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Detected fields query can only have a single target!');\n    }\n\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    const { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n\n    try {\n      const response = await ds.getResource<DetectedFieldsResponse>(\n        'detected_fields',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'detected_fields',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      const nameField: Field = { name: DETECTED_FIELDS_NAME_FIELD, type: FieldType.string, values: [], config: {} };\n      const cardinalityField: Field = {\n        name: DETECTED_FIELDS_CARDINALITY_NAME,\n        type: FieldType.number,\n        values: [],\n        config: {},\n      };\n      const parserField: Field = { name: DETECTED_FIELDS_PARSER_NAME, type: FieldType.string, values: [], config: {} };\n      const typeField: Field = { name: DETECTED_FIELDS_TYPE_NAME, type: FieldType.string, values: [], config: {} };\n\n      response.fields?.forEach((field) => {\n        if (!FIELDS_TO_REMOVE.includes(field.label)) {\n          nameField.values.push(field.label);\n          cardinalityField.values.push(field.cardinality);\n          parserField.values.push(field.parsers?.length ? field.parsers.join(', ') : 'structuredMetadata');\n          typeField.values.push(field.type);\n        }\n      });\n\n      const dataFrame = createDataFrame({\n        refId: interpolatedTarget.refId,\n        fields: [nameField, cardinalityField, parserField, typeField],\n      });\n\n      subscriber.next({ data: [dataFrame], state: LoadingState.Done });\n    } catch (e) {\n      logger.error(e, { msg: 'Detected fields error' });\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  //@todo doesn't work with multiple queries\n  private async getVolume(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest & VolumeRequestProps>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    if (request.targets.length !== 1) {\n      throw new Error('Volume query can only have a single target!');\n    }\n\n    const target = request.targets[0];\n    const primaryLabel = target.primaryLabel;\n    if (!primaryLabel) {\n      throw new Error('Primary label is required for volume queries!');\n    }\n\n    const targetsInterpolated = ds.interpolateVariablesInQueries([target], request.scopedVars);\n    const expression = targetsInterpolated[0].expr.replace('.*.*', '.+');\n\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const volumeResponse: IndexVolumeResponse = await ds.getResource(\n        'index/volume',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n          limit: 5000,\n        },\n        {\n          requestId: request.requestId ?? 'volume',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n      volumeResponse?.data.result.sort((lhs: VolumeResult, rhs: VolumeResult) => {\n        const lVolumeCount: VolumeCount = lhs.value[1];\n        const rVolumeCount: VolumeCount = rhs.value[1];\n        return Number(rVolumeCount) - Number(lVolumeCount);\n      });\n\n      // Scenes will only emit dataframes from the SceneQueryRunner, so for now we need to convert the API response to a dataframe\n      const df = createDataFrame({\n        fields: [\n          {\n            // @todo rename\n            name: SERVICE_NAME,\n            values: volumeResponse?.data.result?.map((r) => {\n              return r.metric[primaryLabel];\n            }),\n          },\n          { name: 'volume', values: volumeResponse?.data.result?.map((r) => Number(r.value[1])) },\n        ],\n      });\n\n      subscriber.next({ data: [df] });\n    } catch (e) {\n      logger.error(e);\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    subscriber.complete();\n\n    return subscriber;\n  }\n\n  private async getLabels(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    if (request.targets.length !== 1) {\n      throw new Error('Volume query can only have a single target!');\n    }\n\n    try {\n      const labelsResponse: LabelsResponse = await ds.getResource(\n        'labels',\n        {\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'labels',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      // Scenes will only emit dataframes from the SceneQueryRunner, so for now we need to convert the API response to a dataframe\n      const df = createDataFrame({\n        fields: [{ name: 'labels', values: labelsResponse?.data }],\n      });\n      subscriber.next({ data: [df], state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    subscriber.complete();\n\n    return subscriber;\n  }\n\n  testDatasource(): Promise<TestDataSourceResponse> {\n    return Promise.resolve({ status: 'success', message: 'Data source is working', title: 'Success' });\n  }\n}\n\nfunction init() {\n  sceneUtils.registerRuntimeDataSource({\n    dataSource: new WrappedLokiDatasource('wrapped-loki-ds', WRAPPED_LOKI_DS_UID),\n  });\n}\n\nexport default init;\n","import { sceneGraph, SceneObject } from '@grafana/scenes';\nimport { IndexScene } from '../Components/IndexScene/IndexScene';\nimport { FavoriteServiceHeaderActionScene } from '../Components/ServiceSelectionScene/FavoriteServiceHeaderActionScene';\nimport { ServiceSelectionScene } from '../Components/ServiceSelectionScene/ServiceSelectionScene';\nimport { getDataSourceVariable } from './variableGetters';\nimport { addToFavoriteLabelValueInStorage, removeFromFavoritesInStorage } from './store';\n\nexport function rerenderFavorites(sceneRef: SceneObject) {\n  // Find all FavoriteServiceHeaderActionScene and re-render\n  const indexScene = sceneGraph.getAncestor(sceneRef, IndexScene);\n  const favoriteServiceHeaderActionScene = sceneGraph.findAllObjects(\n    indexScene,\n    (o) => o instanceof FavoriteServiceHeaderActionScene\n  );\n  favoriteServiceHeaderActionScene.forEach((s) => s.forceRender());\n\n  // Find the ServiceFieldSelector's parent (currently service selection scene) and force re-render so dropdown has correct order\n  // @todo move ServiceFieldSelector to new scene\n  const serviceSelectionScene = sceneGraph.findDescendents(indexScene, ServiceSelectionScene);\n  serviceSelectionScene.forEach((s) => s.forceRender());\n}\n\nexport function addToFavorites(labelName: string, labelValue: string, sceneRef: SceneObject) {\n  const ds = getDataSourceVariable(sceneRef).getValue();\n  addToFavoriteLabelValueInStorage(ds, labelName, labelValue);\n  rerenderFavorites(sceneRef);\n}\n\nexport function removeFromFavorites(labelName: string, labelValue: string, sceneRef: SceneObject) {\n  const ds = getDataSourceVariable(sceneRef).getValue();\n  removeFromFavoritesInStorage(ds, labelName, labelValue);\n  rerenderFavorites(sceneRef);\n}\n","import { DataFrame, Field, ReducerID } from '@grafana/data';\nimport { DrawStyle, StackingMode } from '@grafana/ui';\nimport {\n  AdHocFiltersVariable,\n  PanelBuilders,\n  SceneCSSGridItem,\n  SceneDataTransformer,\n  SceneObject,\n} from '@grafana/scenes';\nimport { getColorByIndex } from './scenes';\nimport { AddToFiltersButton, VariableFilterType } from 'Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport {\n  DetectedFieldType,\n  LEVEL_VARIABLE_VALUE,\n  LogsQueryOptions,\n  ParserType,\n  VAR_FIELDS,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_METADATA,\n} from './variables';\nimport { setLevelColorOverrides } from './panel';\nimport { map, Observable } from 'rxjs';\nimport { SortBy, SortByScene } from '../Components/ServiceScene/Breakdowns/SortByScene';\nimport { getDetectedFieldsFrame } from '../Components/ServiceScene/ServiceScene';\nimport { getLogsStreamSelector, getValueFromFieldsFilter } from './variableGetters';\nimport { LabelType } from './fieldsTypes';\nimport { logger } from './logger';\nimport { AddToExplorationButton } from 'Components/ServiceScene/Breakdowns/AddToExplorationButton';\n\nexport type DetectedLabel = {\n  label: string;\n  cardinality: number;\n};\n\nexport type DetectedLabelsResponse = {\n  detectedLabels: DetectedLabel[];\n};\n\nexport type DetectedField = {\n  label: string;\n  cardinality: number;\n  type: string;\n  parsers: string[] | null;\n};\n\nexport type DetectedFieldsResponse = {\n  fields: DetectedField[];\n};\n\nconst getReducerId = (sortBy: SortBy) => {\n  if (sortBy) {\n    const values: string[] = Object.values(ReducerID);\n    if (values.includes(sortBy)) {\n      return sortBy;\n    }\n  }\n  return undefined;\n};\n\n/**\n * Extracts the ExtractedFieldsType from the string returned on the detected_fields api parser field value\n * @param parserString\n */\nexport function extractParserFromString(parserString?: string): ParserType {\n  switch (parserString) {\n    case 'json':\n      return 'json';\n    case 'logfmt':\n      return 'logfmt';\n    case '': // Structured metadata is empty\n      return 'structuredMetadata';\n    case 'structuredMetadata': // Structured metadata is empty\n      return 'structuredMetadata';\n    default: // if we get a parser with multiple\n      return 'mixed';\n  }\n}\n\nexport function extractFieldTypeFromString(fieldString?: string): DetectedFieldType {\n  switch (fieldString) {\n    case 'int':\n    case 'float':\n    case 'duration':\n    case 'boolean':\n    case 'bytes':\n      return fieldString;\n    default:\n      return 'string';\n  }\n}\n\nexport function extractParserFromArray(parsers?: string[]): ParserType {\n  const parsersSet = new Set(parsers?.map((v) => v.toString()) ?? []);\n\n  // Structured metadata doesn't change the parser we use, so remove it\n  parsersSet.delete('structuredMetadata');\n\n  // get unique values\n  const parsersArray = Array.from(parsersSet);\n\n  if (parsersArray.length === 1) {\n    return extractParserFromString(parsersArray[0]);\n  }\n\n  // If the set size is zero, we only had structured metadata detected as a parser\n  if (parsersSet.size === 0) {\n    return 'structuredMetadata';\n  }\n\n  // Otherwise if there was more then one value, return mixed parser\n  return 'mixed';\n}\n\nexport function getParserForField(fieldName: string, sceneRef: SceneObject): ParserType | undefined {\n  const detectedFieldsFrame = getDetectedFieldsFrame(sceneRef);\n  const parserField: Field<string> | undefined = detectedFieldsFrame?.fields[2];\n  const namesField: Field<string> | undefined = detectedFieldsFrame?.fields[0];\n\n  const index = namesField?.values.indexOf(fieldName);\n  const parser =\n    index !== undefined && index !== -1 ? extractParserFromString(parserField?.values?.[index] ?? '') : undefined;\n\n  if (parser === undefined) {\n    logger.warn('missing parser, using mixed format for', { fieldName });\n    return 'mixed';\n  }\n  return parser;\n}\n\nexport function getFilterBreakdownValueScene(\n  getTitle: (df: DataFrame) => string,\n  style: DrawStyle,\n  variableName: typeof VAR_FIELDS | typeof VAR_LABELS | typeof VAR_METADATA,\n  sortByScene: SortByScene,\n  labelKey?: string\n) {\n  return (frame: DataFrame, frameIndex: number) => {\n    const reducerID = getReducerId(sortByScene.state.sortBy);\n    const panel = PanelBuilders.timeseries() //\n      .setOption('legend', { showLegend: false })\n      .setCustomFieldConfig('fillOpacity', 9)\n      .setTitle(getTitle(frame))\n      .setData(\n        new SceneDataTransformer({\n          transformations: [() => selectFrameTransformation(frame)],\n        })\n      )\n      .setColor({ mode: 'fixed', fixedColor: getColorByIndex(frameIndex) })\n      .setOverrides(setLevelColorOverrides)\n      .setHeaderActions([\n        new AddToFiltersButton({ frame, variableName }),\n        new AddToExplorationButton({ frame, fieldName: getTitle(frame), labelName: labelKey }),\n      ]);\n\n    if (style === DrawStyle.Bars) {\n      panel\n        .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n        .setCustomFieldConfig('fillOpacity', 100)\n        .setCustomFieldConfig('lineWidth', 0)\n        .setCustomFieldConfig('pointSize', 0)\n        .setOverrides(setLevelColorOverrides)\n        .setCustomFieldConfig('drawStyle', DrawStyle.Bars);\n    }\n\n    if (reducerID) {\n      panel.setOption('legend', {\n        showLegend: true,\n        calcs: [reducerID],\n      });\n      // These will only have a single series, no need to show the title twice\n      panel.setDisplayName(' ');\n    }\n\n    return new SceneCSSGridItem({\n      body: panel.build(),\n    });\n  };\n}\n\nexport function selectFrameTransformation(frame: DataFrame) {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map(() => {\n        return [frame];\n      })\n    );\n  };\n}\n\nexport function getLabelTypeFromFrame(labelKey: string, frame: DataFrame, index = 0): null | LabelType {\n  const typeField = frame.fields.find((field) => field.name === 'labelTypes')?.values[index];\n  if (!typeField) {\n    return null;\n  }\n  switch (typeField[labelKey]) {\n    case 'I':\n      return LabelType.Indexed;\n    case 'S':\n      return LabelType.StructuredMetadata;\n    case 'P':\n      return LabelType.Parsed;\n    default:\n      return null;\n  }\n}\n\n/**\n * Returns the variable to use when adding filters in a panel.\n * @param frame\n * @param key\n * @param sceneRef\n */\nexport function getVariableForLabel(\n  frame: DataFrame | undefined,\n  key: string,\n  sceneRef: SceneObject\n): VariableFilterType {\n  const labelType = frame ? getLabelTypeFromFrame(key, frame) : LabelType.Parsed;\n\n  if (labelType) {\n    // Use the labelType from the dataframe\n    return getFilterTypeFromLabelType(labelType, key, sceneRef);\n  }\n\n  // If the dataframe doesn't have labelTypes, check if the detected_fields response returned a parser.\n  const parserForThisField = getParserForField(key, sceneRef);\n  if (parserForThisField === 'structuredMetadata') {\n    return VAR_METADATA;\n  }\n\n  logger.warn('unable to determine label variable, falling back to parsed field', {\n    key,\n    parserForThisField: parserForThisField ?? '',\n  });\n\n  return VAR_FIELDS;\n}\n\nexport function getFilterTypeFromLabelType(type: LabelType, key: string, sceneRef: SceneObject): VariableFilterType {\n  switch (type) {\n    case LabelType.Indexed: {\n      return VAR_LABELS;\n    }\n    case LabelType.Parsed: {\n      return VAR_FIELDS;\n    }\n    case LabelType.StructuredMetadata: {\n      // Structured metadata is either a special level variable, or a field variable\n      if (key === LEVEL_VARIABLE_VALUE) {\n        return VAR_LEVELS;\n      }\n      return VAR_METADATA;\n    }\n    default: {\n      const err = new Error(`Invalid label type for ${key}`);\n      logger.error(err, { type, msg: `Invalid label type for ${key}` });\n      throw err;\n    }\n  }\n}\n\nexport function getParserFromFieldsFilters(fields: AdHocFiltersVariable): ParserType {\n  const parsers = fields.state.filters.map((filter) => {\n    return getValueFromFieldsFilter(filter).parser;\n  });\n\n  return extractParserFromArray(parsers);\n}\n\nexport function isAvgField(fieldType: DetectedFieldType | undefined) {\n  return fieldType === 'duration' || fieldType === 'bytes' || fieldType === 'float';\n}\n\nexport function buildFieldsQuery(optionValue: string, options: LogsQueryOptions) {\n  if (options.fieldType && ['bytes', 'duration'].includes(options.fieldType)) {\n    return (\n      `avg_over_time(${getLogsStreamSelector(options)} | unwrap ` +\n      options.fieldType +\n      `(${optionValue}) | __error__=\"\" [$__auto]) by ()`\n    );\n  } else if (options.fieldType && options.fieldType === 'float') {\n    return (\n      `avg_over_time(${getLogsStreamSelector(options)} | unwrap ` + optionValue + ` | __error__=\"\" [$__auto]) by ()`\n    );\n  } else {\n    return `sum by (${optionValue}) (count_over_time(${getLogsStreamSelector(options)} [$__auto]))`;\n  }\n}\n\n/**\n * Returns the DetectedFieldType if available for a specific label\n * @param optionValue\n * @param detectedFieldsFrame\n */\nexport function getDetectedFieldType(optionValue: string, detectedFieldsFrame?: DataFrame) {\n  const namesField: Field<string> | undefined = detectedFieldsFrame?.fields[0];\n  const typesField: Field<string> | undefined = detectedFieldsFrame?.fields[3];\n  const index = namesField?.values.indexOf(optionValue);\n  return index !== undefined && index !== -1 ? extractFieldTypeFromString(typesField?.values?.[index]) : undefined;\n}\n\nexport function buildFieldsQueryString(\n  optionValue: string,\n  fieldsVariable: AdHocFiltersVariable,\n  detectedFieldsFrame?: DataFrame\n) {\n  const parserField: Field<string> | undefined = detectedFieldsFrame?.fields[2];\n  const namesField: Field<string> | undefined = detectedFieldsFrame?.fields[0];\n  const typesField: Field<string> | undefined = detectedFieldsFrame?.fields[3];\n  const index = namesField?.values.indexOf(optionValue);\n\n  const parserForThisField =\n    index !== undefined && index !== -1 ? extractParserFromString(parserField?.values?.[index]) : 'mixed';\n\n  const optionType =\n    index !== undefined && index !== -1 ? extractFieldTypeFromString(typesField?.values?.[index]) : undefined;\n\n  // Get the parser from the json payload of each filter\n  const parsers = fieldsVariable.state.filters.map((filter) => {\n    const index = namesField?.values.indexOf(filter.key);\n    const parserFromFilterValue = getValueFromFieldsFilter(filter);\n    if (parserFromFilterValue.parser) {\n      return parserFromFilterValue.parser;\n    }\n\n    // Then fallback to check the latest response\n    const parser =\n      index !== undefined && index !== -1\n        ? extractParserFromString(parserField?.values?.[index] ?? 'mixed')\n        : undefined;\n    return parser ?? 'mixed';\n  });\n\n  const parser = extractParserFromArray([...parsers, parserForThisField]);\n\n  let fieldExpressionToAdd = '';\n  let structuredMetadataToAdd = '';\n\n  if (parserForThisField === 'structuredMetadata') {\n    structuredMetadataToAdd = `| ${optionValue}!=\"\"`;\n    // Structured metadata\n  } else {\n    fieldExpressionToAdd = `| ${optionValue}!=\"\"`;\n  }\n\n  // is option structured metadata\n  const options: LogsQueryOptions = {\n    structuredMetadataToAdd,\n    fieldExpressionToAdd,\n    parser: parser,\n    fieldType: optionType,\n  };\n\n  return buildFieldsQuery(optionValue, options);\n}\n\n// copied from /grafana/grafana/public/app/plugins/datasource/loki/datasource.ts:1204\nexport function lokiRegularEscape<T>(value: T) {\n  if (typeof value === 'string') {\n    return value.replace(/'/g, \"\\\\\\\\'\");\n  }\n  return value;\n}\n","import { DetectedLabel } from './fields';\nimport { ALL_VARIABLE_VALUE, LEVEL_VARIABLE_VALUE } from './variables';\nimport { VariableValueOption } from '@grafana/scenes';\n\n// We want to show labels with cardinality 1 at the end of the list because they are less useful\n// And then we want to sort by cardinality - from lowest to highest\nexport function sortLabelsByCardinality(a: DetectedLabel, b: DetectedLabel) {\n  if (a.cardinality === 1) {\n    return 1;\n  }\n  if (b.cardinality === 1) {\n    return -1;\n  }\n  return a.cardinality - b.cardinality;\n}\n\n// Creates label options by taking all labels and if LEVEL_VARIABLE_VALUE is not in the list, it is added at the beginning.\n// It also adds 'All' option at the beginning\nexport function getLabelOptions(labels: string[]) {\n  const options = [...labels];\n  if (!labels.includes(LEVEL_VARIABLE_VALUE)) {\n    options.unshift(LEVEL_VARIABLE_VALUE);\n  }\n\n  const labelOptions: VariableValueOption[] = options.map((label) => ({\n    label,\n    value: String(label),\n  }));\n\n  return [{ label: 'All', value: ALL_VARIABLE_VALUE }, ...labelOptions];\n}\nexport const LEVEL_INDEX_NAME = 'level';\nexport const FIELDS_TO_REMOVE = ['level_extracted', LEVEL_VARIABLE_VALUE, LEVEL_INDEX_NAME];\n\nexport const LABELS_TO_REMOVE = ['__aggregated_metric__', '__stream_shard__'];\nexport function getFieldOptions(labels: string[]) {\n  const options = [...labels];\n  const labelOptions: VariableValueOption[] = options.map((label) => ({\n    label,\n    value: String(label),\n  }));\n\n  return [{ label: 'All', value: ALL_VARIABLE_VALUE }, ...labelOptions];\n}\n","import { DataFrame } from '@grafana/data';\nimport { SeriesVisibilityChangeMode } from '@grafana/ui';\nimport { LEVEL_VARIABLE_VALUE } from './variables';\nimport { SceneObject } from '@grafana/scenes';\nimport { addToFilters, replaceFilter } from 'Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport { getLevelsVariable } from './variableGetters';\nimport { FilterOp } from './filterTypes';\n\n/**\n * Given a set of `visibleLevels` in a panel, it returns a list of the new visible levels\n * after applying the visibility change in `mode`.\n */\nexport function toggleLevelVisibility(\n  level: string,\n  visibleLevels: string[] | undefined,\n  mode: SeriesVisibilityChangeMode,\n  allLevels: string[]\n) {\n  if (mode === SeriesVisibilityChangeMode.ToggleSelection) {\n    const levels = visibleLevels ?? [];\n    if (levels.length === 1 && levels.includes(level)) {\n      return [];\n    }\n    return [level];\n  }\n  /**\n   * When the behavior is `AppendToSelection` and the filter is empty, we initialize it\n   * with all levels because the user is excluding this level in their action.\n   */\n  let levels = !visibleLevels?.length ? allLevels : visibleLevels;\n  if (levels.includes(level)) {\n    return levels.filter((existingLevel) => existingLevel !== level);\n  }\n\n  return [...levels, level];\n}\n\nexport function getLabelsFromSeries(series: DataFrame[]) {\n  return series.map((dataFrame) => getLabelValueFromDataFrame(dataFrame) ?? 'logs');\n}\n\nexport function getLabelValueFromDataFrame(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels;\n\n  if (!labels) {\n    return null;\n  }\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return null;\n  }\n\n  return labels[keys[0]];\n}\n\n/*\n * From the current state of the levels filter, return the level names that\n * the user wants to see.\n */\nexport function getVisibleLevels(allLevels: string[], sceneRef: SceneObject) {\n  const levelsFilter = getLevelsVariable(sceneRef);\n  const wantedLevels = levelsFilter.state.filters\n    .filter((filter) => filter.operator === FilterOp.Equal)\n    .map((filter) => normalizeLevelName(filter.value));\n  const unwantedLevels = levelsFilter.state.filters\n    .filter((filter) => filter.operator === FilterOp.NotEqual)\n    .map((filter) => normalizeLevelName(filter.value));\n  return allLevels.filter((level) => {\n    if (unwantedLevels.includes(level)) {\n      return false;\n    }\n    return wantedLevels.length === 0 || wantedLevels.includes(level);\n  });\n}\n\nfunction normalizeLevelName(level: string) {\n  if (level === '\"\"') {\n    return 'logs';\n  }\n  return level;\n}\n\n/**\n * Toggle a level from the filter state.\n * If the filter is empty, it's added.\n * If the filter exists but it's different, it's replaced.\n * If the filter exists, it's removed.\n */\nexport function toggleLevelFromFilter(level: string, sceneRef: SceneObject) {\n  const levelFilter = getLevelsVariable(sceneRef);\n  const empty = levelFilter.state.filters.length === 0;\n  const filterExists = levelFilter.state.filters.find(\n    (filter) => filter.value === level && filter.operator === FilterOp.Equal\n  );\n\n  if (level === 'logs') {\n    level = '\"\"';\n  }\n\n  let action;\n  if (empty || !filterExists) {\n    replaceFilter(LEVEL_VARIABLE_VALUE, level, 'include', sceneRef);\n    action = 'add';\n  } else {\n    addToFilters(LEVEL_VARIABLE_VALUE, level, 'toggle', sceneRef);\n    action = 'remove';\n  }\n\n  return action;\n}\n","import { LogContext } from '@grafana/faro-web-sdk';\nimport { FetchError, logError, logInfo, logWarning } from '@grafana/runtime';\nimport pluginJson from '../plugin.json';\nimport packageJson from '../../package.json';\n\nconst defaultContext = {\n  app: pluginJson.id,\n  version: packageJson.version,\n};\n\nexport const logger = {\n  info: (msg: string, context?: LogContext) => {\n    const ctx = { ...defaultContext, ...context };\n    console.log(msg, ctx);\n    attemptFaroInfo(msg, ctx);\n  },\n  warn: (msg: string, context?: LogContext) => {\n    const ctx = { ...defaultContext, ...context };\n    console.warn(msg, ctx);\n    attemptFaroWarn(msg, ctx);\n  },\n  error: (err: Error | unknown, context?: LogContext) => {\n    const ctx = { ...defaultContext, ...context };\n    console.error(err, ctx);\n    attemptFaroErr(err, ctx);\n  },\n};\n\nconst attemptFaroInfo = (msg: string, context?: LogContext) => {\n  try {\n    logInfo(msg, context);\n  } catch (e) {\n    console.warn('Failed to log faro event!');\n  }\n};\n\nconst attemptFaroWarn = (msg: string, context?: LogContext) => {\n  try {\n    logWarning(msg, context);\n  } catch (e) {\n    console.warn('Failed to log faro warning!', { msg, context });\n  }\n};\n\nconst isRecord = (obj: unknown): obj is Record<string, unknown> => typeof obj === 'object';\n/**\n * Checks unknown error for properties from Records like FetchError and adds them to the context\n * @param err\n * @param context\n */\nfunction populateFetchErrorContext(err: unknown | FetchError, context: LogContext) {\n  if (typeof err === 'object' && err !== null) {\n    if (isRecord(err)) {\n      Object.keys(err).forEach((key: string) => {\n        const value = err[key];\n        if (typeof value === 'string' || typeof value === 'boolean' || typeof value === 'number') {\n          context[key] = value.toString();\n        }\n      });\n    }\n\n    if (hasData(err)) {\n      if (typeof err.data === 'object' && err.data !== null) {\n        try {\n          context.data = JSON.stringify(err.data);\n        } catch (e) {\n          // do nothing\n        }\n      } else if (typeof err.data === 'string' || typeof err.data === 'boolean' || typeof err.data === 'number') {\n        context.data = err.data.toString();\n      }\n    }\n  }\n}\n\nconst attemptFaroErr = (err: Error | FetchError | unknown, context2: LogContext) => {\n  let context = context2;\n  try {\n    populateFetchErrorContext(err, context);\n\n    if (err instanceof Error) {\n      logError(err, context);\n    } else if (typeof err === 'string') {\n      logError(new Error(err), context);\n    } else if (err && typeof err === 'object') {\n      if (context.msg) {\n        logError(new Error(context.msg), context);\n      } else {\n        logError(new Error('error object'), context);\n      }\n    } else {\n      logError(new Error('unknown error'), context);\n    }\n  } catch (e) {\n    console.error('Failed to log faro error!', { err, context });\n  }\n};\n\nconst hasData = (value: object): value is { data: unknown } => {\n  return 'data' in value;\n};\n","import { ServiceSceneCustomState } from '../Components/ServiceScene/ServiceScene';\n\nlet metadataService: MetadataService;\n\nexport function initializeMetadataService(): void {\n  if (!metadataService) {\n    metadataService = new MetadataService();\n  }\n}\n\n/**\n * Singleton class for sharing state across drilldown routes with common parent scene\n */\nexport class MetadataService {\n  private serviceSceneState: ServiceSceneCustomState | undefined = undefined;\n  public getServiceSceneState() {\n    return this.serviceSceneState;\n  }\n\n  public setPatternsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.patternsCount = count;\n  }\n\n  public setLabelsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.labelsCount = count;\n  }\n\n  public setFieldsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.fieldsCount = count;\n  }\n\n  public setServiceSceneState(state: ServiceSceneCustomState) {\n    this.serviceSceneState = {\n      patternsCount: state.patternsCount,\n      labelsCount: state.labelsCount,\n      fieldsCount: state.fieldsCount,\n      loading: state.loading,\n    };\n  }\n}\n\nexport function getMetadataService(): MetadataService {\n  return metadataService;\n}\n","import { ServiceScene } from '../Components/ServiceScene/ServiceScene';\nimport { IndexScene } from '../Components/IndexScene/IndexScene';\nimport { ALL_VARIABLE_VALUE } from './variables';\nimport { getMetadataService } from './metadata';\nimport { locationService } from '@grafana/runtime';\nimport { buildServicesUrl, DRILLDOWN_URL_KEYS, PageSlugs, ROUTES, ValueSlugs } from './routing';\nimport { sceneGraph } from '@grafana/scenes';\nimport { UrlQueryMap, urlUtil } from '@grafana/data';\nimport { replaceSlash } from './extensions/links';\nimport { logger } from './logger';\nimport { prefixRoute } from './plugin';\n\nlet previousRoute: string | undefined = undefined;\n\nfunction buildValueBreakdownUrl(label: string, newPath: ValueSlugs, labelValue: string, labelName = 'service') {\n  if (label === ALL_VARIABLE_VALUE && newPath === ValueSlugs.label) {\n    return prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.labels}`);\n  } else if (label === ALL_VARIABLE_VALUE && newPath === ValueSlugs.field) {\n    return prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.fields}`);\n  } else {\n    return prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${newPath}/${replaceSlash(label)}`\n    );\n  }\n}\n\nexport function buildDrilldownPageUrl(path: PageSlugs | string, extraQueryParams?: UrlQueryMap): string {\n  return urlUtil.renderUrl(path, buildDrilldownPageRoute(extraQueryParams));\n}\n\nexport function buildDrilldownPageRoute(extraQueryParams?: UrlQueryMap): UrlQueryMap {\n  return {\n    ...Object.entries(urlUtil.getUrlSearchParams()).reduce<UrlQueryMap>((acc, [key, value]) => {\n      if (DRILLDOWN_URL_KEYS.includes(key)) {\n        acc[key] = value;\n      }\n\n      return acc;\n    }, {}),\n    ...extraQueryParams,\n  };\n}\n\n/**\n * Navigate to value breakdown url\n * @param newPath\n * @param label\n * @param serviceScene\n */\nexport function navigateToValueBreakdown(newPath: ValueSlugs, label: string, serviceScene: ServiceScene) {\n  const indexScene = sceneGraph.getAncestor(serviceScene, IndexScene);\n\n  if (indexScene) {\n    const urlLabelName = indexScene.state.routeMatch?.params.labelName;\n    const urlLabelValue = indexScene.state.routeMatch?.params.labelValue;\n    if (urlLabelName && urlLabelValue) {\n      let urlPath = buildValueBreakdownUrl(label, newPath, urlLabelValue, urlLabelName);\n      const fullUrl = buildDrilldownPageUrl(urlPath);\n\n      // If we're going to navigate, we need to share the state between this instantiation of the service scene\n      if (serviceScene) {\n        const metadataService = getMetadataService();\n        metadataService.setServiceSceneState(serviceScene.state);\n      }\n\n      pushUrlHandler(fullUrl);\n      return;\n    } else {\n      logger.warn('missing url params', {\n        urlLabelName: urlLabelName ?? '',\n        urlLabelValue: urlLabelValue ?? '',\n      });\n    }\n  }\n}\n\n/**\n * The case for initial navigation from the service selection to the service index is a special case, as we don't yet have a serviceScene constructed to pull the selected service.\n * This function will route users to the initial (logs) page from the service selection view, which will populate the service scene state with the selected service string.\n * @param labelName\n * @param labelValue\n */\nexport function navigateToInitialPageAfterServiceSelection(labelName: string, labelValue: string) {\n  const breakdownUrl = buildDrilldownPageUrl(ROUTES.logs(labelValue, labelName));\n  pushUrlHandler(breakdownUrl);\n}\n\n/**\n * Navigates to the drilldown page specified by the path slug\n *\n * @param path\n * @param serviceScene\n * @param extraQueryParams\n */\nexport function navigateToDrilldownPage(path: PageSlugs, serviceScene: ServiceScene, extraQueryParams?: UrlQueryMap) {\n  const indexScene = sceneGraph.getAncestor(serviceScene, IndexScene);\n  const urlLabelValue = indexScene.state.routeMatch?.params.labelValue;\n  const urlLabelName = indexScene.state.routeMatch?.params.labelName;\n\n  if (urlLabelValue) {\n    const fullUrl = prefixRoute(`${PageSlugs.explore}/${urlLabelName}/${replaceSlash(urlLabelValue)}/${path}`);\n    const breakdownUrl = buildDrilldownPageUrl(fullUrl, extraQueryParams);\n\n    // If we're going to navigate, we need to share the state between this instantiation of the service scene\n    if (serviceScene) {\n      const metadataService = getMetadataService();\n      metadataService.setServiceSceneState(serviceScene.state);\n    }\n\n    pushUrlHandler(breakdownUrl);\n    return;\n  }\n}\n\nexport function pushUrlHandler(newUrl: string) {\n  previousRoute = newUrl;\n  locationService.push(newUrl);\n}\n\n/**\n * Navigate to the services selection url\n */\nexport function navigateToIndex() {\n  const location = locationService.getLocation();\n  const serviceUrl = buildServicesUrl(ROUTES.explore());\n  const currentUrl = location.pathname + location.search;\n  const search = locationService.getSearch();\n\n  if (serviceUrl === currentUrl || currentUrl.includes(serviceUrl)) {\n    return;\n  }\n\n  if (!search.get('var-filters')) {\n    // If we don't have filters, we don't want to keep this url in browser history since this is fired AFTER the url props are made invalid, push the previous route and replace it\n    if (previousRoute) {\n      locationService.replace(previousRoute);\n    }\n    locationService.push(serviceUrl);\n  } else {\n    pushUrlHandler(serviceUrl);\n  }\n}\n","import { QueryRunnerState, sceneGraph, SceneQueryRunner } from '@grafana/scenes';\n\nexport class LogsSceneQueryRunner extends SceneQueryRunner {\n  constructor(initialState: QueryRunnerState) {\n    super(initialState);\n  }\n\n  public runQueries() {\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    // We don't want to subscribe to time range changes, or we'll get duplicate queries\n    // this.subscribeToTimeRangeChanges(timeRange);\n\n    // @todo can we make runWithTimeRange protected? (https://github.com/grafana/scenes/pull/866)\n    // Hack to call private method\n    this['runWithTimeRange'](timeRange);\n  }\n}\n","import { DataFrame, FieldConfig, FieldMatcherID } from '@grafana/data';\nimport {\n  FieldConfigBuilder,\n  FieldConfigBuilders,\n  FieldConfigOverridesBuilder,\n  PanelBuilders,\n  QueryRunnerState,\n  SceneDataProvider,\n  SceneDataTransformer,\n  SceneObject,\n  SceneQueryRunner,\n  VizPanel,\n} from '@grafana/scenes';\nimport { map, Observable } from 'rxjs';\nimport { HideSeriesConfig } from '@grafana/schema';\nimport { WRAPPED_LOKI_DS_UID } from './datasource';\nimport { LogsSceneQueryRunner } from './LogsSceneQueryRunner';\nimport { DrawStyle, StackingMode } from '@grafana/ui';\nimport { getLabelsFromSeries, getVisibleLevels } from './levels';\nimport { LokiQuery } from './lokiQuery';\n\nconst UNKNOWN_LEVEL_LOGS = 'logs';\nexport function setLevelColorOverrides(overrides: FieldConfigOverridesBuilder<FieldConfig>) {\n  overrides.matchFieldsWithName('info').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-green',\n  });\n  overrides.matchFieldsWithName('debug').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-blue',\n  });\n  overrides.matchFieldsWithName('error').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-red',\n  });\n  overrides.matchFieldsWithName('warn').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-orange',\n  });\n  overrides.matchFieldsWithName('logs').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'darkgray',\n  });\n}\n\nexport function setLogsVolumeFieldConfigs(\n  builder: ReturnType<typeof PanelBuilders.timeseries> | ReturnType<typeof FieldConfigBuilders.timeseries>\n) {\n  return builder\n    .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n    .setCustomFieldConfig('fillOpacity', 100)\n    .setCustomFieldConfig('lineWidth', 0)\n    .setCustomFieldConfig('pointSize', 0)\n    .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n    .setOverrides(setLevelColorOverrides);\n}\n\ninterface TimeSeriesFieldConfig extends FieldConfig {\n  hideFrom: HideSeriesConfig;\n}\n\nexport function setLevelSeriesOverrides(levels: string[], overrideConfig: FieldConfigOverridesBuilder<FieldConfig>) {\n  overrideConfig\n    .match({\n      id: FieldMatcherID.byNames,\n      options: {\n        mode: 'exclude',\n        names: levels,\n        prefix: 'All except:',\n        readOnly: true,\n      },\n    })\n    .overrideCustomFieldConfig<TimeSeriesFieldConfig, 'hideFrom'>('hideFrom', {\n      legend: false,\n      tooltip: false,\n      viz: true,\n    });\n\n  // Setting __systemRef to hideSeriesFrom, allows the override to be changed by interacting with the viz\n  const overrides = overrideConfig.build();\n  // @ts-expect-error\n  overrides[overrides.length - 1].__systemRef = 'hideSeriesFrom';\n}\n\nexport function syncLogsPanelVisibleSeries(panel: VizPanel, series: DataFrame[], sceneRef: SceneObject) {\n  const focusedLevels = getVisibleLevels(getLabelsFromSeries(series), sceneRef);\n  if (focusedLevels?.length) {\n    const config = setLogsVolumeFieldConfigs(FieldConfigBuilders.timeseries()).setOverrides(\n      setLevelSeriesOverrides.bind(null, focusedLevels)\n    );\n    if (config instanceof FieldConfigBuilder) {\n      panel.onFieldConfigChange(config.build(), true);\n    }\n  }\n}\n\nexport function sortLevelTransformation() {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map((data: DataFrame[]) => {\n        return data\n          .map((d) => {\n            if (!d.fields[1].config.displayNameFromDS) {\n              d.fields[1].config.displayNameFromDS = UNKNOWN_LEVEL_LOGS;\n            }\n            return d;\n          })\n          .sort((a, b) => {\n            const aName: string | undefined = a.fields[1].config.displayNameFromDS;\n            const aVal = aName?.includes('error') ? 4 : aName?.includes('warn') ? 3 : aName?.includes('info') ? 2 : 1;\n            const bName: string | undefined = b.fields[1].config.displayNameFromDS;\n            const bVal = bName?.includes('error') ? 4 : bName?.includes('warn') ? 3 : bName?.includes('info') ? 2 : 1;\n            return aVal - bVal;\n          });\n      })\n    );\n  };\n}\n\nexport function getResourceQueryRunner(queries: LokiQuery[]) {\n  return new LogsSceneQueryRunner({\n    datasource: { uid: WRAPPED_LOKI_DS_UID },\n    queries: queries,\n  });\n}\n\nexport function getQueryRunner(queries: LokiQuery[], queryRunnerOptions?: Partial<QueryRunnerState>) {\n  // if there's a legendFormat related to any `level` like label, we want to\n  // sort the output equally. That's purposefully not `LEVEL_VARIABLE_VALUE`,\n  // such that the `detected_level` graph looks the same as a graph for the\n  // `level` label.\n\n  const hasLevel = queries.find((query) => query.legendFormat?.toLowerCase().includes('level'));\n\n  if (hasLevel) {\n    return new SceneDataTransformer({\n      $data: getSceneQueryRunner({\n        datasource: { uid: WRAPPED_LOKI_DS_UID },\n        queries: queries,\n        ...queryRunnerOptions,\n      }),\n      transformations: [sortLevelTransformation],\n    });\n  }\n\n  return getSceneQueryRunner({\n    queries: queries,\n    ...queryRunnerOptions,\n  });\n}\n\nexport function getSceneQueryRunner(queryRunnerOptions?: Partial<QueryRunnerState>) {\n  return new SceneQueryRunner({\n    datasource: { uid: WRAPPED_LOKI_DS_UID },\n    queries: [],\n    ...queryRunnerOptions,\n  });\n}\n\nexport function getQueryRunnerFromProvider(provider: SceneDataProvider): SceneQueryRunner {\n  if (provider instanceof SceneQueryRunner) {\n    return provider;\n  }\n\n  if (provider.state.$data instanceof SceneQueryRunner) {\n    return provider.state.$data;\n  }\n\n  throw new Error('SceneDataProvider is missing SceneQueryRunner');\n}\n","import pluginJson from '../plugin.json';\n\n// jest tests struggle with import order when importing from the plugin.json, moving methods that use the plugin_id to its own file makes it simpler to import when mocking\nexport const PLUGIN_ID = pluginJson.id;\nexport const PLUGIN_BASE_URL = `/a/${PLUGIN_ID}`;\n\n// Prefixes the route with the base URL of the plugin\nexport function prefixRoute(route: string): string {\n  return `${PLUGIN_BASE_URL}/${route}`;\n}\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { AppliedPattern, numericOperatorArray } from 'Components/IndexScene/IndexScene';\nimport { EMPTY_VARIABLE_VALUE, VAR_DATASOURCE_EXPR } from './variables';\nimport { groupBy, trim } from 'lodash';\nimport { getValueFromFieldsFilter } from './variableGetters';\nimport { LokiQuery } from './lokiQuery';\nimport { SceneDataQueryResourceRequest } from './datasourceTypes';\nimport { AdHocFilterWithLabels } from './scenes';\nimport { PLUGIN_ID } from './plugin';\nimport { AdHocFiltersVariable } from '@grafana/scenes';\nimport { FilterOp } from './filterTypes';\n\n/**\n * Builds the resource query\n * @param expr string to be interpolated and executed in the resource request\n * @param resource\n * @param queryParamsOverrides\n */\nexport const buildResourceQuery = (\n  expr: string,\n  resource: 'volume' | 'patterns' | 'detected_labels' | 'detected_fields' | 'labels',\n  queryParamsOverrides?: Record<string, unknown>\n): LokiQuery & SceneDataQueryResourceRequest => {\n  return {\n    ...defaultQueryParams,\n    resource,\n    refId: resource,\n    ...queryParamsOverrides,\n    datasource: { uid: VAR_DATASOURCE_EXPR },\n    expr,\n  };\n};\n/**\n * Builds a loki data query\n * @param expr\n * @param queryParamsOverrides\n * @returns LokiQuery\n */\nexport const buildDataQuery = (expr: string, queryParamsOverrides?: Record<string, unknown>): LokiQuery => {\n  return {\n    ...defaultQueryParams,\n    ...queryParamsOverrides,\n    expr,\n  };\n};\n\nconst defaultQueryParams = {\n  refId: 'A',\n  queryType: 'range',\n  editorMode: 'code',\n  supportingQueryType: PLUGIN_ID,\n};\n\nexport const PLACEHOLDER_QUERY = '__placeholder__=\"\"';\n\nexport const buildVolumeQuery = (\n  expr: string,\n  resource: 'volume' | 'patterns' | 'detected_labels' | 'detected_fields' | 'labels',\n  primaryLabel: string,\n  queryParamsOverrides?: Record<string, unknown>\n): LokiQuery & SceneDataQueryResourceRequest => {\n  return buildResourceQuery(expr, resource, { ...queryParamsOverrides, primaryLabel });\n};\n\nexport function getLogQLLabelGroups(filters: AdHocVariableFilter[]) {\n  const positive = filters.filter((filter) => filter.operator === FilterOp.Equal);\n  const negative = filters.filter((filter) => filter.operator === FilterOp.NotEqual);\n\n  const positiveGroups = groupBy(positive, (filter) => filter.key);\n  return { negative, positiveGroups };\n}\n\nexport function getLogQLLabelFilters(filters: AdHocVariableFilter[]) {\n  const { negative, positiveGroups } = getLogQLLabelGroups(filters);\n\n  let positiveFilters: string[] = [];\n  for (const key in positiveGroups) {\n    const values = positiveGroups[key].map((filter) => filter.value);\n    positiveFilters.push(\n      values.length === 1 ? renderMetadata(positiveGroups[key][0]) : renderRegexLabelFilter(key, values)\n    );\n  }\n\n  return { positiveFilters, negative };\n}\n\nexport function renderLogQLLabelFilters(filters: AdHocFilterWithLabels[]) {\n  let { positiveFilters, negative } = getLogQLLabelFilters(filters);\n  const negativeFilters = negative.map((filter) => renderMetadata(filter)).join(', ');\n\n  const result = trim(`${positiveFilters.join(', ')}, ${negativeFilters}`, ' ,');\n  // Since we use this variable after other non-interpolated labels in some queries, and on its own in others, we need to know that this expression can be preceded by a comma, so we output a placeholder value that shouldn't impact the query if the expression is empty, otherwise we'll output invalid logQL\n  if (!result) {\n    return PLACEHOLDER_QUERY;\n  }\n\n  return result;\n}\n\nexport function renderLogQLFieldFilters(filters: AdHocVariableFilter[]) {\n  // @todo partition instead of looping through again and again\n  const positive = filters.filter((filter) => filter.operator === FilterOp.Equal);\n  const negative = filters.filter((filter) => filter.operator === FilterOp.NotEqual);\n\n  const numeric = filters.filter((filter) => {\n    const numericValues: string[] = numericOperatorArray;\n    return numericValues.includes(filter.operator);\n  });\n\n  const positiveGroups = groupBy(positive, (filter) => filter.key);\n\n  let positiveFilters = '';\n  for (const key in positiveGroups) {\n    positiveFilters += ' | ' + positiveGroups[key].map((filter) => `${fieldFilterToQueryString(filter)}`).join(' or ');\n  }\n\n  const negativeFilters = negative.map((filter) => `| ${fieldFilterToQueryString(filter)}`).join(' ');\n\n  let numericFilters = numeric.map((filter) => `| ${fieldNumericFilterToQueryString(filter)}`).join(' ');\n\n  return `${positiveFilters} ${negativeFilters} ${numericFilters}`.trim();\n}\n\nexport function renderLogQLMetadataFilters(filters: AdHocVariableFilter[]) {\n  const positive = filters.filter((filter) => filter.operator === FilterOp.Equal);\n  const negative = filters.filter((filter) => filter.operator === FilterOp.NotEqual);\n\n  const positiveGroups = groupBy(positive, (filter) => filter.key);\n\n  let positiveFilters = '';\n  for (const key in positiveGroups) {\n    positiveFilters += ' | ' + positiveGroups[key].map((filter) => `${renderMetadata(filter)}`).join(' or ');\n  }\n\n  const negativeFilters = negative.map((filter) => `| ${renderMetadata(filter)}`).join(' ');\n\n  return `${positiveFilters} ${negativeFilters}`.trim();\n}\n\nfunction renderMetadata(filter: AdHocVariableFilter) {\n  // If the filter value is an empty string, we don't want to wrap it in backticks!\n  if (filter.value === EMPTY_VARIABLE_VALUE) {\n    return `${filter.key}${filter.operator}${filter.value}`;\n  }\n  return `${filter.key}${filter.operator}\\`${filter.value}\\``;\n}\n\nfunction fieldFilterToQueryString(filter: AdHocVariableFilter) {\n  const fieldObject = getValueFromFieldsFilter(filter);\n  const value = fieldObject.value;\n  // If the filter value is an empty string, we don't want to wrap it in backticks!\n  if (value === EMPTY_VARIABLE_VALUE) {\n    return `${filter.key}${filter.operator}${value}`;\n  }\n  return `${filter.key}${filter.operator}\\`${value}\\``;\n}\n\nfunction fieldNumericFilterToQueryString(filter: AdHocVariableFilter) {\n  const fieldObject = getValueFromFieldsFilter(filter);\n  const value = fieldObject.value;\n  // If the filter value is an empty string, we don't want to wrap it in backticks!\n\n  return `${filter.key}${filter.operator}${value}`;\n}\n\nexport function renderRegexLabelFilter(key: string, values: string[]) {\n  return `${key}=~\"${values.join('|')}\"`;\n}\n\nexport function renderPatternFilters(patterns: AppliedPattern[]) {\n  const excludePatterns = patterns.filter((pattern) => pattern.type === 'exclude');\n  const excludePatternsLine = excludePatterns\n    .map((p) => `!> \\`${p.pattern}\\``)\n    .join(' ')\n    .trim();\n\n  const includePatterns = patterns.filter((pattern) => pattern.type === 'include');\n  let includePatternsLine = '';\n  if (includePatterns.length > 0) {\n    if (includePatterns.length === 1) {\n      includePatternsLine = `|> \\`${includePatterns[0].pattern}\\``;\n    } else {\n      includePatternsLine = `|>  ${includePatterns.map((p) => `\\`${p.pattern}\\``).join(' or ')}`;\n    }\n  }\n  return `${excludePatternsLine} ${includePatternsLine}`.trim();\n}\n\nexport function joinTagFilters(variable: AdHocFiltersVariable) {\n  const { positiveGroups, negative } = getLogQLLabelGroups(variable.state.filters);\n\n  const filters: AdHocFilterWithLabels[] = [];\n  for (const key in positiveGroups) {\n    const values = positiveGroups[key].map((filter) => filter.value);\n    if (values.length === 1) {\n      filters.push({\n        key,\n        value: positiveGroups[key][0].value,\n        operator: '=',\n      });\n    } else {\n      filters.push({\n        key,\n        value: values.join('|'),\n        operator: '=~',\n      });\n    }\n  }\n\n  negative.forEach((filter) => {\n    filters.push(filter);\n  });\n  return filters;\n}\n\nexport function wrapWildcardSearch(input: string) {\n  if (input !== '.+' && input.substring(0, 2) !== '.*') {\n    return `.*${input}.*`;\n  }\n\n  return input;\n}\n\nexport function unwrapWildcardSearch(input: string) {\n  if (input.substring(0, 2) === '.*' && input.slice(-2) === '.*') {\n    return input.slice(2).slice(0, -2);\n  }\n  return input;\n}\n","import { UrlQueryMap, urlUtil } from '@grafana/data';\nimport {\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  VAR_DATASOURCE,\n  VAR_FIELD_GROUP_BY,\n  VAR_FIELDS,\n  VAR_LABEL_GROUP_BY,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_LINE_FILTER,\n  VAR_METADATA,\n  VAR_PATTERNS,\n} from './variables';\nimport { locationService } from '@grafana/runtime';\nimport { RouteMatch, RouteProps } from '../Components/Pages';\nimport { replaceSlash } from './extensions/links';\nimport { SceneObject } from '@grafana/scenes';\nimport { getLabelsVariable } from './variableGetters';\nimport { logger } from './logger';\nimport { PLUGIN_BASE_URL, prefixRoute } from './plugin';\n\nexport enum PageSlugs {\n  explore = 'explore',\n  logs = 'logs',\n  labels = 'labels',\n  patterns = 'patterns',\n  fields = 'fields',\n}\nexport enum ValueSlugs {\n  field = 'field',\n  label = 'label',\n}\n\nexport type ParentDrilldownSlugs =\n  | PageSlugs.explore\n  | PageSlugs.fields\n  | PageSlugs.logs\n  | PageSlugs.labels\n  | PageSlugs.patterns;\nexport type ChildDrilldownSlugs = ValueSlugs.field | ValueSlugs.label;\n\nexport const ROUTES = {\n  explore: () => prefixRoute(PageSlugs.explore),\n  logs: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.logs}`),\n  fields: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.fields}`),\n  patterns: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.patterns}`),\n  labels: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.labels}`),\n};\n\nexport const SUB_ROUTES = {\n  label: (labelValue: string, labelName = 'service', breakdownLabelName: string) =>\n    prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${ValueSlugs.label}/${breakdownLabelName}`\n    ),\n  field: (labelValue: string, labelName = 'service', breakdownLabelName: string) =>\n    prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${ValueSlugs.field}/${breakdownLabelName}`\n    ),\n};\n\nexport const ROUTE_DEFINITIONS: Record<keyof typeof PageSlugs, string> = {\n  explore: prefixRoute(PageSlugs.explore),\n  logs: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.logs}`),\n  fields: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.fields}`),\n  patterns: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.patterns}`),\n  labels: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.labels}`),\n};\n\nexport const CHILD_ROUTE_DEFINITIONS: Record<keyof typeof ValueSlugs, string> = {\n  field: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${ValueSlugs.field}/:breakdownLabel`),\n  label: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${ValueSlugs.label}/:breakdownLabel`),\n};\n\nexport const EXPLORATIONS_ROUTE = `${PLUGIN_BASE_URL}/${PageSlugs.explore}`;\n\n// For redirect back to service, we just want to keep datasource, and timerange\nexport const SERVICE_URL_KEYS = ['from', 'to', `var-${VAR_DATASOURCE}`, `var-${VAR_LABELS}`];\n//@todo why patterns and var-patterns?\nexport const DRILLDOWN_URL_KEYS = [\n  'from',\n  'to',\n  'mode',\n  'urlColumns',\n  'visualizationType',\n  'selectedLine',\n  'displayedFields',\n  VAR_PATTERNS,\n  `var-${VAR_PATTERNS}`,\n  `var-${VAR_DATASOURCE}`,\n  `var-${VAR_LABELS}`,\n  `var-${VAR_FIELDS}`,\n  `var-${VAR_LEVELS}`,\n  `var-${VAR_FIELD_GROUP_BY}`,\n  `var-${VAR_LABEL_GROUP_BY}`,\n  `var-${VAR_DATASOURCE}`,\n  `var-${VAR_LINE_FILTER}`,\n  `var-${VAR_METADATA}`,\n];\n\nexport function getDrilldownSlug() {\n  const location = locationService.getLocation();\n  const slug = location.pathname.slice(location.pathname.lastIndexOf('/') + 1, location.pathname.length);\n  return slug as PageSlugs;\n}\n\n/**\n * The \"primary\" label, is the replacement for the service_name paradigm\n * It must be an indexed label with an include filter\n * Note: Will return the label as it exists in the url, so \"service_name\" will be returned as \"service\", we'll need to adjust for this case if we want to support URLs from before this change\n */\nexport function getPrimaryLabelFromUrl(): RouteProps {\n  const location = locationService.getLocation();\n  const startOfUrl = '/a/grafana-lokiexplore-app/explore';\n  const endOfUrl = location.pathname.slice(location.pathname.indexOf(startOfUrl) + startOfUrl.length + 1);\n  const routeParams = endOfUrl.split('/');\n\n  let labelName = routeParams[0];\n  const labelValue = routeParams[1];\n  const breakdownLabel = routeParams[3];\n  // Keep urls the same\n  if (labelName === SERVICE_NAME) {\n    labelName = SERVICE_UI_LABEL;\n  }\n  return { labelName, labelValue, breakdownLabel };\n}\n\nexport function getDrilldownValueSlug() {\n  const location = locationService.getLocation();\n  const locationArray = location.pathname.split('/');\n  const slug = locationArray[locationArray.length - 2];\n  return slug as ValueSlugs;\n}\n\nexport function buildServicesUrl(path: string, extraQueryParams?: UrlQueryMap): string {\n  return urlUtil.renderUrl(path, buildServicesRoute(extraQueryParams));\n}\nexport function extractValuesFromRoute(routeMatch: RouteMatch): RouteProps {\n  return {\n    labelName: routeMatch.params.labelName,\n    labelValue: routeMatch.params.labelValue,\n    breakdownLabel: routeMatch.params.breakdownLabel,\n  };\n}\n\nexport function buildServicesRoute(extraQueryParams?: UrlQueryMap): UrlQueryMap {\n  return {\n    ...Object.entries(urlUtil.getUrlSearchParams()).reduce<UrlQueryMap>((acc, [key, value]) => {\n      if (SERVICE_URL_KEYS.includes(key)) {\n        acc[key] = value;\n      }\n\n      return acc;\n    }, {}),\n    ...extraQueryParams,\n  };\n}\n\n/**\n * Compare slugs against variable filters and log discrepancies\n * These don't cause errors or render empty UIs, but shouldn't be possible when routing within the app\n * If we see these logged in production it indicates we're navigating users incorrectly\n * @param sceneRef\n */\nexport function checkPrimaryLabel(sceneRef: SceneObject) {\n  const labelsVariable = getLabelsVariable(sceneRef);\n  let { labelName, labelValue } = getPrimaryLabelFromUrl();\n  if (labelName === SERVICE_UI_LABEL) {\n    labelName = SERVICE_NAME;\n  }\n  const primaryLabel = labelsVariable.state.filters.find((filter) => filter.key === labelName);\n  if (!primaryLabel) {\n    const location = locationService.getLocation();\n\n    logger.info('invalid primary label name in url', {\n      labelName,\n      url: `${location.pathname}${location.search}`,\n    });\n  }\n\n  const primaryLabelValue = labelsVariable.state.filters.find((filter) => replaceSlash(filter.value) === labelValue);\n  if (!primaryLabelValue) {\n    const location = locationService.getLocation();\n\n    logger.info('invalid primary label value in url', {\n      labelValue,\n      url: `${location.pathname}${location.search}`,\n    });\n  }\n}\n","import { AdHocVariableFilter, urlUtil } from '@grafana/data';\nimport { config, DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, SceneObject, SceneObjectUrlValues, SceneQueryRunner } from '@grafana/scenes';\nimport { LOG_STREAM_SELECTOR_EXPR, VAR_DATASOURCE_EXPR, VAR_LABELS_EXPR } from './variables';\nimport { EXPLORATIONS_ROUTE } from './routing';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\n\nexport function getExplorationFor(model: SceneObject): IndexScene {\n  return sceneGraph.getAncestor(model, IndexScene);\n}\n\nexport function getUrlForValues(values: SceneObjectUrlValues) {\n  return urlUtil.renderUrl(EXPLORATIONS_ROUTE, values);\n}\n\nexport function getDataSource(sceneObject: SceneObject) {\n  return sceneGraph.interpolate(sceneObject, VAR_DATASOURCE_EXPR);\n}\n\nexport function getQueryExpr(exploration: IndexScene) {\n  return sceneGraph.interpolate(exploration, LOG_STREAM_SELECTOR_EXPR).replace(/\\s+/g, ' ');\n}\n\nexport function getPatternExpr(exploration: IndexScene) {\n  return sceneGraph.interpolate(exploration, VAR_LABELS_EXPR).replace(/\\s+/g, ' ');\n}\n\nexport function getColorByIndex(index: number) {\n  const visTheme = config.theme2.visualization;\n  return visTheme.getColorByName(visTheme.palette[index % 8]);\n}\n\nexport async function getLokiDatasource(sceneObject: SceneObject) {\n  const ds = (await getDataSourceSrv().get(VAR_DATASOURCE_EXPR, { __sceneObject: { value: sceneObject } })) as\n    | DataSourceWithBackend\n    | undefined;\n  return ds;\n}\n\nexport function isDefined<T>(value: T | null | undefined): value is T {\n  return value !== null && value !== undefined;\n}\n\nexport function getQueryRunnerFromChildren(sceneObject: SceneObject) {\n  return sceneGraph.findDescendents(sceneObject, SceneQueryRunner);\n}\n\n//@todo export from scenes\nexport interface AdHocFilterWithLabels extends AdHocVariableFilter {\n  keyLabel?: string;\n  valueLabels?: string[];\n}\n","import { ChangepointDetector } from '@bsull/augurs/changepoint';\nimport { OutlierDetector, OutlierOutput } from '@bsull/augurs/outlier';\nimport { DataFrame, doStandardCalcs, fieldReducers, FieldType, outerJoinDataFrames, ReducerID } from '@grafana/data';\nimport { getLabelValueFromDataFrame } from './levels';\nimport { memoize } from 'lodash';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from './analytics';\nimport { logger } from './logger';\n\nexport const DEFAULT_SORT_BY = 'changepoint';\n\nexport const sortSeries = memoize(\n  (series: DataFrame[], sortBy: string, direction: string) => {\n    if (sortBy === 'alphabetical') {\n      return sortSeriesByName(series, direction);\n    }\n\n    if (sortBy === 'outliers') {\n      initOutlierDetector(series);\n    }\n\n    const reducer = (dataFrame: DataFrame) => {\n      // ML & Wasm sorting options\n      try {\n        if (sortBy === 'changepoint') {\n          return calculateDataFrameChangepoints(dataFrame);\n        } else if (sortBy === 'outliers') {\n          return calculateOutlierValue(series, dataFrame);\n        }\n      } catch (e) {\n        logger.error(e, { msg: 'failed to sort' });\n\n        // ML sorting panicked, fallback to stdDev\n        sortBy = ReducerID.stdDev;\n      }\n      const fieldReducer = fieldReducers.get(sortBy);\n      const value =\n        fieldReducer.reduce?.(dataFrame.fields[1], true, true) ?? doStandardCalcs(dataFrame.fields[1], true, true);\n      return value[sortBy] ?? 0;\n    };\n\n    const seriesCalcs = series.map((dataFrame) => ({\n      value: reducer(dataFrame),\n      dataFrame: dataFrame,\n    }));\n\n    seriesCalcs.sort((a, b) => {\n      if (a.value !== undefined && b.value !== undefined) {\n        return b.value - a.value;\n      }\n      return 0;\n    });\n\n    if (direction === 'asc') {\n      seriesCalcs.reverse();\n    }\n\n    return seriesCalcs.map(({ dataFrame }) => dataFrame);\n  },\n  (series: DataFrame[], sortBy: string, direction: string) => {\n    const firstTimestamp = series.length > 0 ? series[0].fields[0].values[0] : 0;\n    const lastTimestamp =\n      series.length > 0\n        ? series[series.length - 1].fields[0].values[series[series.length - 1].fields[0].values.length - 1]\n        : 0;\n    const firstValue = series.length > 0 ? getLabelValueFromDataFrame(series[0]) : '';\n    const lastValue = series.length > 0 ? getLabelValueFromDataFrame(series[series.length - 1]) : '';\n    // This still isn't good enough, if the dataframe returns the same number of fields, with the same start and end values, we'll fail to update the UI\n    const allSeriesKey = series.map(\n      (frame) =>\n        frame.length +\n        '_' +\n        frame.fields.map((field) => field.name + '_' + field.values[0] + '_' + field.values[field.values.length - 1])\n    );\n    return `${firstValue}_${lastValue}_${firstTimestamp}_${lastTimestamp}_${series.length}_${allSeriesKey}_${sortBy}_${direction}`;\n  }\n);\n\nexport const calculateDataFrameChangepoints = (data: DataFrame) => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported, fall back to stdDev');\n  }\n\n  const fields = data.fields.filter((f) => f.type === FieldType.number);\n\n  const dataPoints = fields[0].values.length;\n\n  let samplingStep = Math.floor(dataPoints / 100) || 1;\n  if (samplingStep > 1) {\n    // Avoiding \"big\" steps for more accuracy\n    samplingStep = Math.ceil(samplingStep / 2);\n  }\n\n  const sample = fields[0].values.filter((_, i) => i % samplingStep === 0);\n\n  const values = new Float64Array(sample);\n  const points = ChangepointDetector.defaultArgpcp().detectChangepoints(values);\n\n  return points.indices.length;\n};\n\nexport const sortSeriesByName = (series: DataFrame[], direction: string) => {\n  const sortedSeries = [...series];\n  sortedSeries.sort((a, b) => {\n    const valueA = getLabelValueFromDataFrame(a);\n    const valueB = getLabelValueFromDataFrame(b);\n    if (!valueA || !valueB) {\n      return 0;\n    }\n    return valueA?.localeCompare(valueB) ?? 0;\n  });\n  if (direction === 'desc') {\n    sortedSeries.reverse();\n  }\n  return sortedSeries;\n};\n\nconst initOutlierDetector = (series: DataFrame[]) => {\n  if (!wasmSupported()) {\n    return;\n  }\n\n  // Combine all frames into one by joining on time.\n  const joined = outerJoinDataFrames({ frames: series });\n  if (!joined) {\n    return;\n  }\n\n  // Get number fields: these are our series.\n  const joinedSeries = joined.fields.filter((f) => f.type === FieldType.number);\n  const points = joinedSeries.flatMap((series) => new Float64Array(series.values));\n\n  try {\n    const detector = OutlierDetector.dbscan({ sensitivity: 0.4 }).preprocess(points);\n    outliers = detector.detect();\n  } catch (e) {\n    logger.error(e, { msg: 'initOutlierDetector: OutlierDetector error' });\n  }\n};\n\nlet outliers: OutlierOutput | undefined = undefined;\n\nexport const calculateOutlierValue = (series: DataFrame[], data: DataFrame): number => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported, fall back to stdDev');\n  }\n  if (!outliers) {\n    throw new Error('Initialize outlier detector first');\n  }\n\n  const index = series.indexOf(data);\n  if (outliers.seriesResults[index].isOutlier) {\n    return outliers.seriesResults[index].outlierIntervals.length;\n  }\n\n  return 0;\n};\n\nexport const wasmSupported = () => {\n  const support = typeof WebAssembly === 'object';\n\n  if (!support) {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.wasm_not_supported);\n  }\n\n  return support;\n};\n","import pluginJson from '../plugin.json';\nimport { SortBy, SortDirection } from '../Components/ServiceScene/Breakdowns/SortByScene';\nimport { SceneObject, VariableValue } from '@grafana/scenes';\nimport { getDataSourceName, getServiceName } from './variableGetters';\nimport { logger } from './logger';\nimport { SERVICE_NAME } from './variables';\n\nconst FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY = `${pluginJson.id}.services.favorite`;\nconst FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY = `${pluginJson.id}.primarylabels.tabs.favorite`;\nconst DS_LOCALSTORAGE_KEY = `${pluginJson.id}.datasource`;\n\n// This should be a string, but we'll accept anything and return an empty array if it's not a string\nexport function getFavoriteLabelValuesFromStorage(dsKey: string | unknown, labelName: string): string[] {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return [];\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let labelValues = [];\n  try {\n    labelValues = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(labelValues)) {\n    labelValues = [];\n  }\n  return labelValues;\n}\n\n// This should be a string, but we'll accept anything and return early\nexport function addToFavoriteLabelValueInStorage(dsKey: string | unknown, labelName: string, labelValue: string) {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return;\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let services = [];\n  try {\n    services = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n\n  // We want to put this service at the top of the list and remove any duplicates\n  const servicesToStore = services.filter((service: string) => service !== labelValue);\n  servicesToStore.unshift(labelValue);\n\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function removeFromFavoritesInStorage(dsKey: VariableValue, labelName: string, labelValue: string) {\n  if (!dsKey || !labelName || !labelValue || typeof dsKey !== 'string') {\n    return;\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let services = [];\n  try {\n    services = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n  const servicesToStore = services.filter((service: string) => service !== labelValue);\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function addTabToLocalStorage(dsKey: string, labelName: string) {\n  if (!dsKey || !labelName) {\n    return;\n  }\n\n  const key = createTabsLocalStorageKey(dsKey);\n\n  let services = [];\n  try {\n    services = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing saved tabs from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n\n  if (services.indexOf(labelName) === -1) {\n    // We want to put this service at the top of the list and remove any duplicates\n    const servicesToStore = services.filter((tabName: string) => tabName !== labelName);\n    servicesToStore.unshift(labelName);\n\n    localStorage.setItem(key, JSON.stringify(servicesToStore));\n  }\n}\n\nexport function removeTabFromLocalStorage(dsKey: string, labelName: string) {\n  if (!dsKey || !labelName) {\n    return;\n  }\n  const key = createTabsLocalStorageKey(dsKey);\n  let services = [];\n  try {\n    services = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n  const servicesToStore = services.filter((tabName: string) => tabName !== labelName);\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function getFavoriteTabsFromStorage(dsKey: string | unknown): string[] {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return [];\n  }\n  const key = createTabsLocalStorageKey(dsKey);\n  let tabNames = [];\n  try {\n    tabNames = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(tabNames)) {\n    tabNames = [];\n  }\n  return tabNames;\n}\n\nfunction createPrimaryLabelLocalStorageKey(ds: string, labelName: string) {\n  if (labelName === SERVICE_NAME) {\n    labelName = '';\n  } else {\n    labelName = `_${labelName}`;\n  }\n  return `${FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY}_${ds}${labelName}`;\n}\n\nfunction createTabsLocalStorageKey(ds: string) {\n  return `${FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY}_${ds}`;\n}\n\nexport function getLastUsedDataSourceFromStorage(): string | undefined {\n  return localStorage.getItem(DS_LOCALSTORAGE_KEY) ?? undefined;\n}\n\nexport function addLastUsedDataSourceToStorage(dsKey: string) {\n  localStorage.setItem(DS_LOCALSTORAGE_KEY, dsKey);\n}\n\nconst SORT_BY_LOCALSTORAGE_KEY = `${pluginJson.id}.values.sort`;\nexport function getSortByPreference(\n  target: string,\n  defaultSortBy: SortBy,\n  defaultDirection: SortDirection\n): { sortBy: SortBy | ''; direction: SortDirection } {\n  const preference = localStorage.getItem(`${SORT_BY_LOCALSTORAGE_KEY}.${target}.by`) ?? '';\n  const parts = preference.split('.');\n  if (!parts[0] || !parts[1]) {\n    return { sortBy: defaultSortBy, direction: defaultDirection };\n  }\n  const sortBy = parts[0] as SortBy;\n  const direction = parts[1] as SortDirection;\n  return { sortBy, direction };\n}\n\nexport function setSortByPreference(target: string, sortBy: string, direction: string) {\n  // Prevent storing empty values\n  if (sortBy && direction) {\n    localStorage.setItem(`${SORT_BY_LOCALSTORAGE_KEY}.${target}.by`, `${sortBy}.${direction}`);\n  }\n}\n\nconst LOG_OPTIONS_LOCALSTORAGE_KEY = `${pluginJson.id}.logs.option`;\nexport type LogOption = 'wrapLines';\nexport function getLogOption(option: LogOption) {\n  return localStorage.getItem(`${LOG_OPTIONS_LOCALSTORAGE_KEY}.${option}`);\n}\n\nexport function setLogOption(option: LogOption, value: string | number | boolean) {\n  let storedValue = value.toString();\n  if (typeof value === 'boolean' && !value) {\n    storedValue = '';\n  }\n  localStorage.setItem(`${LOG_OPTIONS_LOCALSTORAGE_KEY}.${option}`, storedValue);\n}\n\nfunction getExplorationPrefix(sceneRef: SceneObject) {\n  const ds = getDataSourceName(sceneRef);\n  const serviceName = getServiceName(sceneRef);\n  return `${ds}.${serviceName}`;\n}\n\nexport function getDisplayedFields(sceneRef: SceneObject) {\n  const PREFIX = getExplorationPrefix(sceneRef);\n  const storedFields = localStorage.getItem(`${pluginJson.id}.${PREFIX}.logs.fields`);\n  if (storedFields) {\n    return JSON.parse(storedFields);\n  }\n  return [];\n}\n\nexport function setDisplayedFields(sceneRef: SceneObject, fields: string[]) {\n  const PREFIX = getExplorationPrefix(sceneRef);\n  localStorage.setItem(`${pluginJson.id}.${PREFIX}.logs.fields`, JSON.stringify(fields));\n}\n\nexport type LogsVisualizationType = 'logs' | 'table';\n\nconst VISUALIZATION_TYPE_LOCALSTORAGE_KEY = 'grafana.explore.logs.visualisationType';\nexport function getLogsVisualizationType(): LogsVisualizationType {\n  const storedType = localStorage.getItem(VISUALIZATION_TYPE_LOCALSTORAGE_KEY) ?? '';\n  switch (storedType) {\n    case 'table':\n    case 'logs':\n      return storedType;\n    default:\n      return 'logs';\n  }\n}\n\nexport function setLogsVisualizationType(type: string) {\n  localStorage.setItem(VISUALIZATION_TYPE_LOCALSTORAGE_KEY, type);\n}\n","export const testIds = {\n  appConfig: {\n    container: 'data-testid ac-container',\n    apiKey: 'data-testid ac-api-key',\n    apiUrl: 'data-testid ac-api-url',\n    submit: 'data-testid ac-submit-form',\n  },\n  exploreServiceSearch: {\n    search: 'data-testid search-services',\n  },\n  header: {\n    refreshPicker: 'data-testid RefreshPicker run button',\n  },\n  variables: {\n    datasource: {\n      label: 'data-testid Dashboard template variables submenu Label Data source',\n    },\n    combobox: {},\n    serviceName: {\n      label: 'data-testid Dashboard template variables submenu Label Labels',\n    },\n  },\n  breakdowns: {\n    labels: {},\n    fields: {},\n    common: {\n      sortByFunction: 'data-testid SortBy function',\n      sortByDirection: 'data-testid SortBy direction',\n      filterButtonGroup: 'data-testid filter-button-group',\n      filterButton: 'data-testid filter-button',\n      filterSelect: 'data-testid filter-select',\n      filterNumericPopover: {\n        removeButton: 'data-testid filter-numeric-remove',\n        submitButton: 'data-testid filter-numeric-submit',\n        cancelButton: 'data-testid filter-numeric-cancel',\n        inputGreaterThan: 'data-testid filter-numeric-gt',\n        inputGreaterThanUnit: 'data-testid filter-numeric-gtu',\n        inputGreaterThanInclusive: 'data-testid filter-numeric-gte',\n\n        inputLessThan: 'data-testid filter-numeric-lt',\n        inputLessThanUnit: 'data-testid filter-numeric-ltu',\n        inputLessThanInclusive: 'data-testid filter-numeric-lte',\n      },\n    },\n  },\n\n  index: {\n    showLogsButton: 'data-testid Show logs',\n    addNewLabelTab: 'data-testid Tab Add label',\n    searchLabelValueInput: 'data-testid search-services-input',\n    aggregatedMetricsMenu: 'data-testid aggregated-metrics-menu',\n    aggregatedMetricsToggle: 'data-testid aggregated-metrics-toggle',\n    header: {\n      showLogsButton: 'data-testid Show logs header',\n    },\n  },\n\n  exploreServiceDetails: {\n    searchLogs: 'data-testid search-logs',\n    openExplore: 'data-testid open-explore',\n    tabPatterns: 'data-testid tab-patterns',\n    tabLogs: 'data-testid tab-logs',\n    tabFields: 'data-testid tab-fields',\n    tabLabels: 'data-testid tab-labels',\n    buttonRemovePattern: 'data-testid button-remove-pattern',\n    buttonFilterInclude: 'data-testid button-filter-include',\n    buttonFilterExclude: 'data-testid button-filter-exclude',\n  },\n  patterns: {\n    tableWrapper: 'data-testid table-wrapper',\n    buttonIncludedPattern: 'data-testid button-included-pattern',\n    buttonExcludedPattern: 'data-testid button-excluded-pattern',\n  },\n  logsPanelHeader: {\n    header: 'data-testid Panel header Logs',\n    radio: 'data-testid radio-button',\n  },\n  table: {\n    wrapper: 'data-testid table-wrapper',\n    inspectLine: 'data-testid inspect',\n  },\n};\n","import { locationService } from '@grafana/runtime';\nimport { logger } from './logger';\nimport { TimeRange } from '@grafana/data';\n\nexport const copyText = async (\n  text: string,\n  buttonRef?: React.MutableRefObject<HTMLButtonElement | null> | HTMLButtonElement\n) => {\n  if (navigator.clipboard && window.isSecureContext) {\n    return navigator.clipboard.writeText(text);\n    // eslint-disable-next-line deprecation/deprecation\n  } else if (document.execCommand && buttonRef) {\n    // Use a fallback method for browsers/contexts that don't support the Clipboard API.\n    // See https://web.dev/async-clipboard/#feature-detection.\n    // Use textarea so the user can copy multi-line content.\n    const textarea = document.createElement('textarea');\n    // Normally we'd append this to the body. However if we're inside a focus manager\n    // from react-aria, we can't focus anything outside of the managed area.\n    // Instead, let's append it to the button. Then we're guaranteed to be able to focus + copy.\n    const buttonElement = buttonRef instanceof HTMLButtonElement ? buttonRef : buttonRef?.current;\n    buttonElement?.appendChild(textarea);\n    textarea.value = text;\n    textarea.focus();\n    textarea.select();\n    // eslint-disable-next-line deprecation/deprecation\n    document.execCommand('copy');\n    textarea.remove();\n  }\n};\n\nexport enum UrlParameterType {\n  From = 'from',\n  To = 'to',\n}\n\ntype PermalinkDataType =\n  | {\n      id?: string;\n      row?: number;\n    }\n  | {\n      logs: {\n        id: string;\n        displayedFields: string[];\n      };\n    };\n\nexport const generateLogShortlink = (paramName: string, data: PermalinkDataType, timeRange: TimeRange) => {\n  const location = locationService.getLocation();\n  const searchParams = new URLSearchParams(location.search);\n\n  searchParams.set(UrlParameterType.From, timeRange.from.toISOString());\n  searchParams.set(UrlParameterType.To, timeRange.to.toISOString());\n  searchParams.set(paramName, JSON.stringify(data));\n\n  // @todo can encoding + as %20 break other stuff? Can label names or values have + in them that we don't want encoded? Should we just update values?\n  // + encoding for whitespace is for application/x-www-form-urlencoded, which appears to be the default encoding for URLSearchParams, replacing + with %20 to keep urls meant for the browser from breaking\n  const searchString = searchParams.toString().replace(/\\+/g, '%20');\n  return window.location.origin + location.pathname + '?' + searchString;\n};\n\nexport function capitalizeFirstLetter(input: string) {\n  if (input.length) {\n    return input?.charAt(0).toUpperCase() + input.slice(1);\n  }\n\n  logger.warn('invalid string argument');\n  return input;\n}\n\nexport function truncateText(input: string, length: number, ellipsis: boolean) {\n  return input.substring(0, length) + (ellipsis && input.length > length ? '…' : '');\n}\n","import {\n  AdHocFiltersVariable,\n  CustomVariable,\n  DataSourceVariable,\n  sceneGraph,\n  SceneObject,\n  SceneVariableState,\n} from '@grafana/scenes';\nimport { CustomConstantVariable } from './CustomConstantVariable';\nimport {\n  AdHocFieldValue,\n  FieldValue,\n  JSON_FORMAT_EXPR,\n  LOGS_FORMAT_EXPR,\n  LogsQueryOptions,\n  MIXED_FORMAT_EXPR,\n  VAR_AGGREGATED_METRICS,\n  SERVICE_NAME,\n  VAR_DATASOURCE,\n  VAR_FIELD_GROUP_BY,\n  VAR_FIELDS,\n  VAR_FIELDS_EXPR,\n  VAR_LABEL_GROUP_BY,\n  VAR_LABELS,\n  VAR_LABELS_EXPR,\n  VAR_LEVELS,\n  VAR_LEVELS_EXPR,\n  VAR_LINE_FILTER,\n  VAR_LINE_FILTER_EXPR,\n  VAR_PATTERNS,\n  VAR_PATTERNS_EXPR,\n  VAR_PRIMARY_LABEL,\n  VAR_PRIMARY_LABEL_SEARCH,\n  VAR_METADATA_EXPR,\n  VAR_METADATA,\n  VAR_LABELS_REPLICA,\n} from './variables';\nimport { AdHocVariableFilter } from '@grafana/data';\nimport { logger } from './logger';\n\nexport function getLogsStreamSelector(options: LogsQueryOptions) {\n  const {\n    labelExpressionToAdd = '',\n    structuredMetadataToAdd = '',\n    fieldExpressionToAdd = '',\n    parser = undefined,\n  } = options;\n\n  switch (parser) {\n    case 'structuredMetadata':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_METADATA_EXPR} ${VAR_LEVELS_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTER_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    case 'json':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_METADATA_EXPR} ${VAR_LEVELS_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTER_EXPR} ${JSON_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    case 'logfmt':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_METADATA_EXPR} ${VAR_LEVELS_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTER_EXPR} ${LOGS_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    default:\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_METADATA_EXPR} ${VAR_LEVELS_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTER_EXPR} ${MIXED_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n  }\n}\n\nexport function getPatternsVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PATTERNS, scene);\n  if (!(variable instanceof CustomVariable)) {\n    throw new Error('VAR_PATTERNS not found');\n  }\n  return variable;\n}\n\nexport function getLabelsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_LABELS, scene);\n}\n\nexport function getLabelsVariableReplica(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_LABELS_REPLICA, scene);\n}\n\nexport function getMetadataVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_METADATA, scene);\n}\n\nexport function getFieldsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_FIELDS, scene);\n}\n\nexport function getLevelsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_LEVELS, scene);\n}\n\nexport function getLineFilterVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_LINE_FILTER, scene);\n  if (!(variable instanceof CustomVariable)) {\n    throw new Error('VAR_LINE_FILTER not found');\n  }\n  return variable;\n}\n\nexport function getLabelGroupByVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_LABEL_GROUP_BY, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_LABEL_GROUP_BY not found');\n  }\n  return variable;\n}\n\nexport function getAggregatedMetricsVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_AGGREGATED_METRICS, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('SERVICE_LABEL_VAR not found');\n  }\n  return variable;\n}\n\nexport function getFieldGroupByVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_FIELD_GROUP_BY, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_FIELD_GROUP_BY not found');\n  }\n  return variable;\n}\n\nexport function getDataSourceVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_DATASOURCE, scene);\n  if (!(variable instanceof DataSourceVariable)) {\n    throw new Error('VAR_DATASOURCE not found');\n  }\n  return variable;\n}\n\nexport function getAdHocFiltersVariable(variableName: string, scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(variableName, scene);\n\n  if (!(variable instanceof AdHocFiltersVariable)) {\n    throw new Error(`Could not get AdHocFiltersVariable ${variableName}. Variable not found.`);\n  }\n  return variable;\n}\n\nexport function getServiceSelectionSearchVariable(sceneRef: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PRIMARY_LABEL_SEARCH, sceneRef);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_PRIMARY_LABEL_SEARCH not found');\n  }\n  return variable;\n}\n\nexport function clearServiceSelectionSearchVariable(sceneRef: SceneObject) {\n  getServiceSelectionSearchVariable(sceneRef).setState({\n    value: '.+',\n    label: '',\n  });\n}\n\nexport function getServiceSelectionPrimaryLabel(sceneRef: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PRIMARY_LABEL, sceneRef);\n  if (!(variable instanceof AdHocFiltersVariable)) {\n    throw new Error('VAR_PRIMARY_LABEL not found');\n  }\n  return variable;\n}\n\nexport function setServiceSelectionPrimaryLabelKey(key: string, sceneRef: SceneObject) {\n  getServiceSelectionPrimaryLabel(sceneRef).setState({\n    filters: [\n      {\n        // the value is replaced by the value in VAR_PRIMARY_LABEL_SEARCH if a search is active, so we just need to set the filter key (label name)\n        value: '.+',\n        operator: '=~',\n        key: key,\n      },\n    ],\n  });\n}\n\nexport function getUrlParamNameForVariable(variableName: string) {\n  return `var-${variableName}`;\n}\n\nexport function getValueFromFieldsFilter(filter: AdHocVariableFilter, variableName: string = VAR_FIELDS): FieldValue {\n  try {\n    return JSON.parse(filter.value);\n  } catch (e) {\n    logger.warn(`Failed to parse ${variableName}`, { value: filter.value });\n\n    // If the user has a URL from before 0.1.4 where detected_fields changed the format of the fields value to include the parser, fall back to mixed parser if we have a value\n    if (filter.value) {\n      return {\n        value: filter.value,\n        parser: 'mixed',\n      };\n    }\n    throw e;\n  }\n}\n\nexport function getValueFromAdHocVariableFilter(\n  variable: AdHocFiltersVariable,\n  filter?: AdHocVariableFilter\n): AdHocFieldValue {\n  if (variable.state.name === VAR_FIELDS && filter) {\n    return getValueFromFieldsFilter(filter);\n  }\n\n  return {\n    value: filter?.value,\n  };\n}\n\nexport function getServiceName(scene: SceneObject) {\n  const labelsVariable = getLabelsVariable(scene);\n  return getServiceNameFromVariableState(labelsVariable.state);\n}\n\nexport function getServiceNameFromVariableState(\n  adHocFiltersVariableState: SceneVariableState & { filters: AdHocVariableFilter[] }\n) {\n  const serviceName = adHocFiltersVariableState.filters\n    .filter((filter) => filter.key === SERVICE_NAME)\n    .map((filter) => filter.value);\n\n  if (!serviceName) {\n    throw new Error('Service present in filters selected');\n  }\n  return serviceName[0];\n}\n\nexport function getDataSourceName(scene: SceneObject) {\n  const dsVariable = getDataSourceVariable(scene);\n  return dsVariable.getValue();\n}\n"],"names":["FilterButton","props","isExcluded","isIncluded","onInclude","onExclude","onClear","titles","buttonFill","styles","useStyles2","getStyles","div","className","container","Button","variant","fill","size","aria-selected","includeButton","onClick","data-testid","testIds","exploreServiceDetails","buttonFilterInclude","title","include","excludeButton","exclude","buttonFilterExclude","theme","css","display","justifyContent","borderRadius","borderRight","undefined","shape","radius","default","borderLeft","graphicContainer","margin","graphic","width","height","padding","spacing","text","alignItems","wrap","GrotError","children","useTheme2","SVG","src","isDark","Text","textAlignment","color","element","PatternTag","onRemove","pattern","expanded","setExpanded","useState","onMouseLeave","Tag","key","name","getPatternPreview","tag","aria-label","buttonRemovePattern","removeButton","Icon","PREVIEW_WIDTH","sm","lg","Math","round","window","innerWidth","length","substringLength","substring","fontFamily","gap","cursor","overflow","borderTopRightRadius","borderBottomRightRadius","backgroundColor","colors","secondary","main","border","boxSizing","textOverflow","paddingLeft","paddingRight","PatternControls","patterns","includePatterns","filter","type","excludePatterns","onRemovePattern","pat","reportAppInteraction","USER_EVENTS_PAGES","service_details","USER_EVENTS_ACTIONS","pattern_removed","includePatternsLength","excludePatternsLength","patternsContainer","weight","buttonIncludedPattern","map","p","buttonExcludedPattern","paddingBottom","flexWrap","GiveFeedbackButton","wrapper","a","href","feedback","target","rel","marginLeft","position","top","alignSelf","fontSize","typography","bodySmall","link","InterceptBanner","Alert","alert","severity","br","flex","CustomVariableValueSelectors","SceneObjectBase","model","variablesSetState","sceneGraph","getVariables","variables","state","variable","includes","VariableValueSelectWrapper","layout","Component","interceptBannerStorageKey","PLUGIN_ID","LayoutScene","dismiss","this","setState","interceptDismissed","localStorage","setItem","constructor","super","getItem","firstRowWrapper","label","breakpoints","down","flexDirection","bodyContainer","flexGrow","minHeight","maxWidth","body","controlsFirstRowContainer","marginBottom","controlsSecondRowContainer","controlsContainer","filters","filtersWrap","visibility","controlsWrapper","marginTop","controls","textAlign","rotateIcon","svg","transform","parent","contentScene","cx","control","SceneFlexLayout","getDetectedFieldValuesTagValuesProvider","expr","sceneRef","timeRange","datasourceUnknownType","getDataSourceSrv","get","getDataSource","DataSourceWithBackend","logger","error","Error","languageProvider","values","fetchDetectedLabelValues","options","limit","throwError","requestOptions","showErrorAlert","results","isArray","VAR_FIELDS","valueDecoded","getValueFromFieldsFilter","replace","v","value","JSON","stringify","parser","r","e","warn","getLabelsTagValuesProvider","datasource_","datasource","getTagValues","joinTagFilters","f","operator","getDataSourceVariable","result","some","FilterOp","Equal","favoriteValuesArray","getFavoriteLabelValuesFromStorage","getValue","toString","favoriteValuesSet","Set","sort","b","has","getLabelsTagKeysProvider","getTagKeys","tagKeys","filteredResult","Array","LABELS_TO_REMOVE","showLogsButtonSceneKey","IndexScene","onActivate","stateUpdate","drillDownLabel","setVariableTagValuesProviders","findByKeyAndType","ShowLogsButtonScene","hidden","routeMatch","params","breakdownLabel","getDrilldownSlug","PageSlugs","explore","ServiceSelectionScene","ServiceScene","setTagProviders","setVariableOperators","updatePatterns","getPatternsVariable","resetVariablesIfNotInUrl","getFieldsVariable","getUrlParamNameForVariable","getLevelsVariable","VAR_LEVELS","_subs","add","subscribeToState","newState","getTimeRange","limitMaxInterval","fieldsVar","_getOperators","numericOperatorArray","operators","numericOperators","labelsVar","getLabelsVariable","wip","_wip","includeOperators","getTagKeysProvider","getTagValuesProvider","prevState","jsonData","plugin","meta","interval","maxInterval","rangeUtil","intervalToSeconds","timeRangeInterval","to","diff","from","defaultRange","SceneTimeRange","DEFAULT_TIME_RANGE","getAppEvents","publish","AppEvents","alertWarning","payload","attempted_duration_seconds","configured_max_interval","console","fieldsVariable","levelsVariable","metadataVariable","getMetadataVariable","getFieldsTagValuesProvider","VAR_METADATA","variableType","parsed","lokiRegularEscape","otherFiltersString","join","getFieldsTagValuesExpression","PENDING_FIELDS_EXPR","interpolated","interpolate","DETECTED_FIELD_VALUES_EXPR","DETECTED_METADATA_VALUES_EXPR","DETECTED_LEVELS_VALUES_EXPR","urlParamName","location","locationService","getLocation","URLSearchParams","search","patternsVariable","patternsLine","renderPatternFilters","changeValueTo","getUrlState","updateFromUrl","parse","getLastUsedDataSourceFromStorage","variablesScene","unsub","initialDatasourceUid","initialFilters","labelVariable","AdHocFiltersVariable","VAR_LABELS","EXPLORATION_DS","expressionBuilder","renderLogQLLabelFilters","hide","VariableHide","dontHide","applyMode","Promise","resolve","renderLogQLFieldFilters","hideLabel","renderLogQLMetadataFilters","dsVariable","DataSourceVariable","VAR_DATASOURCE","pluginId","dsValue","addLastUsedDataSourceToStorage","SceneVariableSet","CustomVariable","VAR_PATTERNS","hideVariable","VAR_LINE_FILTER","CustomConstantVariable","VAR_LOGS_FORMAT","MIXED_FORMAT_EXPR","skipUrlSync","getVariableSet","direction","SceneFlexItem","disabled","SceneTimePicker","SceneRefreshPicker","config","featureToggles","exploreLogsAggregatedMetrics","push","ToolbarScene","isOpen","$timeRange","$variables","_urlSync","SceneObjectUrlSyncConfig","keys","addActivationHandler","bind","LoadingPlaceholder","NotEqual","gt","gte","lt","lte","hasPositiveFilter","positiveFilter","find","navigateToInitialPageAfterServiceSelection","button","index","header","showLogsButton","AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY","pluginJson","userOverride","active","aggregatedMetrics","toggleAggregatedMetricsOverride","service_selection","aggregated_metrics_toggled","enabled","onToggleOpen","popover","background","primary","boxShadow","shadows","z3","weak","zIndex","marginRight","heading","fontWeight","fontWeightMedium","gridTemplateColumns","rowGap","columnGap","Dropdown","overlay","evt","stopPropagation","span","AGGREGATED_METRIC_START_DATE","toLocaleString","Switch","aggregatedMetricsToggle","onChange","placement","onVisibleChange","ToolbarButton","icon","aggregatedMetricsMenu","getServicesScene","EmbeddedScene","makeIndexPage","SceneAppPage","url","prefixRoute","PageLayoutType","Custom","preserveUrlKeys","SERVICE_URL_KEYS","routePath","getScene","drilldowns","ROUTE_DEFINITIONS","logs","getPage","makeBreakdownPage","defaultRoute","labels","fields","CHILD_ROUTE_DEFINITIONS","makeBreakdownValuePage","ValueSlugs","field","makeRedirectPage","PLUGIN_BASE_URL","hideFromBreadcrumbs","$behaviors","navigateToIndex","slug","labelName","labelValue","extractValuesFromRoute","capitalizeFirstLetter","ROUTES","DRILLDOWN_URL_KEYS","getParentPage","SUB_ROUTES","AddToExplorationButton","disabledLinks","queries","getLokiDatasource","then","ds","getQueries","getContext","data","getData","queryRunner","findObject","o","SceneQueryRunner","frame","getFilter","q","legendFormat","fieldName","uid","ctx","origin","id","logoPath","context","links","usePluginLinks","extensionPointId","ExtensionPoints","MetricExploration","IconButton","tooltip","description","category","filterNameAndValueObj","Object","AddFilterEvent","BusEventBase","ClearFilterEvent","addAdHocFilter","scene","addToFilters","clearFilters","resolveVariableTypeForField","getAdHocFiltersVariable","validateVariableNameForField","fieldValue","getValueFromAdHocVariableFilter","publishEvent","getNumericOperatorType","op","removeFilter","operatorType","addNumericFilter","valueObject","getParserForField","valueLabels","addToFavorites","filterExists","replaceFilter","variableName","LEVEL_VARIABLE_VALUE","getDetectedLabelsFrame","AddToFiltersButton","add_to_filters_in_breakdown_clicked","filterType","action","filtersLength","isSelected","filterInSelectedFilters","FieldSelector","selected","setSelected","selectableOptions","option","InlineField","Select","onOpenMenu","onCloseMenu","select","prefix","ServiceFieldSelector","selectOption","isLoading","initialFilter","customOption","setCustomOption","allOptions","selectedOption","opt","selectWrapper","grow","exploreServiceSearch","placeholder","isClearable","allowCustomValue","__isNew__","actionMeta","onInputChange","prevInputValue","wrapWildcardSearch","input","minWidth","x1","GoToExploreButton","exploration","openExplore","open_in_explore_clicked","getQueryExpr","trimEnd","displayedFields","getDisplayedFields","visualisationType","getLogsVisualizationType","columns","urlColumns","columnsParam","getUrlColumns","exploreState","range","toURLRange","raw","refId","panelsState","subUrl","appSubUrl","urlUtil","renderUrl","panes","schemaVersion","open","SearchInput","suffix","rest","Input","clearIcon","LineFilterIcon","caseSensitive","maxContrast","onCaseSensitiveToggle","viewBox","xmlns","x","y","dominantBaseline","textAnchor","x0_5","LineFilterScene","updateFilter","lineFilter","debounced","updateVariableDebounced","updateVariable","lineFilterValue","getLineFilterVariable","lineFilterString","matches","match","handleChange","handleEnter","debounce","escapeRegExp","search_string_in_logs_changed","searchQueryLength","containsLevel","toLowerCase","Field","searchLogs","onKeyUp","getField","cache","fieldType","getFieldByName","DATAPLANE_TIMESTAMP_NAME","DATAPLANE_BODY_NAME","logFrameLabelsToLabels","logFrameLabels","entries","forEach","k","getTimeName","logsFrame","timeField","getBodyName","bodyField","tableColumnCustomWidths","LogLineState","TableColumnsContext","createContext","columnWidthMap","setColumnWidthMap","filteredColumns","setColumns","setFilteredColumns","setVisible","visible","bodyState","setBodyState","clearSelectedLine","TableColumnContextProvider","initialColumns","setUrlColumns","removeExtraColumns","initialColumnWidths","existingWidths","msg","getColumnWidthsFromLocalStorage","setColumnWidthMapState","handleSetColumns","useCallback","newColumns","activeColumns","colA","colB","getActiveColumns","handleSetVisible","isVisible","useEffect","pendingLabelState","newColumnsArray","pa","pb","defaultColumns","getDefaultColumns","col","pendingColumns","percentOfLinesWithLabel","cardinality","Infinity","setDefaultColumns","Provider","labelTypes","columnsToSet","useTableColumnContext","useContext","TableCellContext","cellIndex","numberOfMenuItems","setActiveCellIndex","TableCellContextProvider","cellActive","setCellActive","handleCellActive","useTableCellContext","TableHeaderContext","isHeaderMenuActive","setHeaderMenuActive","TableHeaderContextProvider","handleisHeaderMenuActive","useTableHeaderContext","uf","uFuzzy","intraMode","intraIns","intraSub","intraTrn","intraDel","fuzzySearch","haystack","query","callback","idxs","info","order","haystackOrder","matchesSet","mark","part","matched","i","infoIdx","highlight","idx","ranges","debouncedFuzzySearch","debounceLodash","LogsColumnSearch","searchValue","setSearchValue","dispatcher","newColumnsWithMeta","numberOfResults","searchResultCount","reportInteraction","resultCount","searchWrap","currentTarget","needle","LogsTableEmptyFields","empty","LogsTableNavField","dragIcon","opacity","labelCount","appearance","pxToRem","contentWrap","customWidthWrap","checkboxLabel","whiteSpace","Checkbox","checked","showCount","omit","draggable","LogsTableActiveFields","reorderColumn","valueFilter","toggleColumn","dragging","columnWrapper","getLogsFieldsStyles","labelKeys","renderTitle","DragDropContext","onDragEnd","destination","source","Droppable","droppableId","provided","droppableProps","ref","innerRef","la","lb","sortLabels","Draggable","draggableId","snapshot","isDragging","draggableProps","dragHandleProps","collator","Intl","Collator","sensitivity","LogsTableAvailableFields","borderBottom","canvas","Number","compare","LogsTableMultiSelect","sidebarWrap","overflowY","scrollbarWidth","columnHeaderButton","columnHeader","h6","left","paddingTop","clear","filteredColumnsWithMeta","columnsWithMeta","getReorderColumn","sourceIndex","destinationIndex","splice","ColumnSelectionDrawerWrap","ClickOutsideWrapper","useCapture","columnName","logContext","logError","c","isActive","priorActiveCount","column","event","columnAction","columnCount","columnFilterEvent","pendingFilteredLabelState","isDefaultField","DefaultCellWrapComponent","CellWrapInnerComponent","onMouseOut","onMouseIn","rowIndex","cellState","bgColor","overflowX","onMouseEnter","initialState","addFilter","selectedLine","QueryContext","QueryContextProvider","useQueryContext","CellContextMenu","pillType","menu","menuItemsWrap","menuItem","showColumn","path","fillRule","clipRule","d","fillOpacity","LEVEL_NAME","DefaultPill","levelColor","mappings","getFieldMappings","isPillActive","activePillWrap","pillWrap","pill","strong","content","menuItemText","FieldType","time","LineActionIcons","clipboardButton","lineHeight","inspectButton","verticalAlign","iconWrapper","z2","inspect","logId","idField","lineValue","isInspecting","setIsInspecting","getText","generateLogShortlink","row","table","inspectLine","tooltipPlacement","tabIndex","ClipboardButton","Modal","onDismiss","pre","ButtonRow","DefaultCellComponent","getCellLinks","displayValue","number","linkWrapper","textDecoration","hasLinks","Boolean","React","formattedValueToString","fieldIndex","showColumns","renderValue","getLinks","DataLinksContextMenu","api","openMenu","LogLinePillValue","activePill","valueWrap","menuActive","onClickAdd","LogLinePill","templateSrv","getTemplateSrv","useMemo","other","originalField","isDerivedField","originalFrame","getLinksSupplier","subFieldName","addFieldToColumns","stopScroll","current","scrollTo","scrollLeft","Scroller","scrollerRef","scroller","scrollRight","onPointerDown","behavior","onPointerUp","scrollWidth","RawLogLineText","rawLogLine","fontFamilyMonospace","LogLineCellComponent","isHover","setIsHover","useRef","untransformedField","rawValue","isDerived","untransformedValue","string","renderLabels","isAuto","auto","hasLabels","ScrollSyncPane","group","LogsTableHeader","referenceElement","isFirstColumn","isLine","tableHeaderMenu","maxHeight","right","defaultContentWrapper","defaultContent","Popover","show","LogsTableHeaderWrap","hideColumn","pendingColumnState","columnIndex","cols","isBodyField","headerProps","linkWrap","openColumnManagementDrawer","slideLeft","reverse","slideRight","autoColumnWidths","TableAndContext","GrafanaTable","onColumnResize","onResize","initialSortBy","displayName","desc","initialRowIndex","cellHeight","TableCellHeight","Sm","footerOptions","reducer","countRows","Table","timeZone","section","tableWrap","tableFrame","setTableFrame","localSelectedLine","prepareTableFrame","frameWithOverrides","applyFieldOverrides","replaceVariables","fieldConfig","defaults","custom","overrides","guessLogsFieldTypeForField","filterable","headerComponent","getInitialFieldWidth","cellOptions","getTableCellOptions","prepare","transformations","dataFrame","isFieldLokiLabels","typeInfo","DataFrameType","LogLines","isFieldDataplaneLabels","flatMap","format","keepTime","labelFiltersTransform","labelFilters","labelFiltersInclude","indexByName","includeByName","getOrganizeFieldsTransform","buildColumnsWithMeta","specialFields","extraFields","getDefaultStateOrganizeFieldsTransform","transformedDataFrame","lastValueFrom","transformDataFrame","getIdName","lineIndex","findIndex","cleanLineIndex","Drawer","onClose","ScrollSync","horizontal","vertical","proportional","fieldDisplayName","guessLogsFieldTypeForValue","critical","crit","err","eror","warning","debug","trace","MappingType","ValueToText","cellComponent","TableCellDisplayMode","tableWidth","numberOfFields","min","extraPadding","columnMeta","maxLength","max","iso8601Regex","TableWrap","panelWrapSize","setPanelWrapSize","useResizeObserver","panelWrap","clientWidth","clientHeight","getTimeZone","getColumnsFromProps","fieldNames","previouslySelected","getLogFrameLabelsAsLabels","numberOfLogLines","labelMap","Map","cardinalityMap","fieldLabels","setObj","valueSet","set","getCardinalityMapFromLabels","cardinalityCount","fromEntries","normalize","mapLabelsToInitialState","specialFieldArray","addSpecialLabelsState","setSpecialFieldMeta","total","ceil","guessFieldTypeFromValue","test","TableProvider","FieldCache","timestampField","severityField","labelsField","_","getLogFrameLabels","timeNanosecondField","getLabelFieldName","parseDataplaneLogsFrame","getFirstFieldOfType","getL","lineField","lineLabels","makeLabelsArray","makeLabelsGetter","parseLegacyLogsFrame","LogsPanelHeaderActions","RadioButtonGroup","visualisationTypeRadio","vizType","LogsTableScene","parentModel","getAncestor","LogsListScene","visualizationType","timeRangeValue","getLogsPanelFrame","panelWrapper","PanelChrome","loadingState","actions","setVisualizationType","getVariableForLabel","areArraysEqual","LogOptionsScene","wrapLines","getLogOption","handleWrapLinesChange","setLogOption","getParentScene","setLogsVizOption","wrapLogMessage","clearDisplayedFields","logs_clear_displayed_fields","transparent","htmlFor","InlineSwitch","horizontalInlineSwitch","Tooltip","CopyLinkButton","copied","setCopied","timeoutId","setTimeout","clearTimeout","handleClick","LogsPanelScene","getLogsPanel","onOptionsChange","PanelBuilders","setTitle","setOption","handleLabelFilterClick","handleLabelFilterOutClick","handleIsFilterLabelActive","handleFilterStringClick","onClickShowField","onClickHideField","handleShareLogLineClick","setHeaderActions","build","handleLabelFilter","logs_detail_filter_applied","indexOf","setDisplayedFields","logs_toggle_displayed_field","displayedField","rowId","buttonRef","HTMLButtonElement","copyText","levels","metadata","hasKeyValueFilter","fieldFilter","hasKeyValueFilterField","lineFilterScene","getLineFilterScene","logs_popover_line_filter","selectionLength","decodedUrlColumns","decodedSelectedTableRow","decodedVisualizationType","searchParams","setStateFromUrl","panel","updateLogsPanel","selectedLineUrl","urlColumnsUrl","vizTypeUrl","displayedFieldsUrl","getVizPanel","logsPanelScene","xSizing","logs_visualization_toggle","setLogsVisualizationType","contain","SortCriteriaChanged","sortBy","SortByScene","getSortByPreference","DEFAULT_SORT_BY","sortingOptions","ReducerID","stdDev","sum","fieldReducers","selectOptions","filterReducerOptions","onCriteriaChange","criteria","setSortByPreference","onDirectionChange","sortByValue","breakdowns","common","sortByDirection","sortByFunction","isSearchable","inputId","ENABLED_PERCENTILES","ext","getLabelValue","getLabelValueFromDataFrame","LayoutSwitcher","Selector","onLayoutChange","layout_type_changed","view","layouts","durationUnitValues","byteUnitValues","NumericFilterPopoverScene","gtFilter","ltFilter","extractedValue","extractValueFromString","gtu","unit","ltu","hasExistingFilter","onSubmit","SelectLabelActionScene","togglePopover","units","onInputKeydown","formDisabled","inputString","inputType","durationValue","durationValueLength","slice","isNaN","bytesValue","byteValueLength","getUnitOptions","popoverStyles","getPopoverStyles","subTitle","selectLabelActionScene","Stack","role","card","fieldWrap","FieldSet","fieldset","filterNumericPopover","inputGreaterThanInclusive","inclusiveField","inclusiveInput","menuShouldPortal","inputGreaterThan","onKeyDownCapture","autoFocus","numberInput","Label","inputGreaterThanUnit","unitFieldLabel","selectInput","inputLessThanInclusive","inputLessThan","inputLessThanUnit","buttons","submitButton","cancelButton","numberFieldLabel","switchFieldLabel","INCLUDE_VALUE","EXCLUDE_VALUE","NUMERIC_FILTER_VALUE","getVariable","existingFilter","getExistingFilter","EMPTY_VARIABLE_VALUE","clearFilter","onClickExcludeEmpty","onClickIncludeEmpty","onClickNumericFilter","selectedValue","getPrimaryLabelFromUrl","serviceScene","$data","LoadingState","Done","calculateSparsity","newLogsPanelState","showPopover","logsPanelData","hasNumericFilters","hasSparseFilters","logLinesWithLabelCount","reduce","acc","VizPanel","percentage","existingFilterValue","detectedFieldFrame","getDetectedFieldsFrame","getDetectedFieldType","onClickViewValues","navigateToValueBreakdown","SelectableValueComponent","getSelectableValueComponentStyles","hideValueDrilldown","popoverRef","filterButtonDisabled","hasOtherFilter","selectedOptionValue","hasExistingNumericFilter","numericSelected","includeSelected","sparseIncludeOption","component","sparseExcludeOption","numericFilterOption","defaultOption","ButtonGroup","filterButtonGroup","filterButton","ButtonSelect","filterSelect","buttonSelect","PopoverController","showPopper","hidePopper","popperProps","blurFocusProps","onBlur","onFocus","wrapperClassName","renderArrow","borderTopLeftRadius","borderBottomLeftRadius","TimeSeriesLimitSeriesTitleItemScene","currentSeriesCount","series","limitMaxNumberOfSeriesForPanel","child","dataTransformer","SceneDataTransformer","titleItems","showAllSeries","toggleShowAllSeries","timeSeriesLimiter","reprocessTransformations","prevData","totalLength","timeSeriesDisclaimer","warningMessage","aria-hidden","FieldsAggregatedBreakdownScene","updateChildren","newParser","detectedFieldsFrame","getDetectedFieldsFrameFromQueryRunnerState","newNamesField","getDetectedFieldsNamesFromQueryRunnerState","newParsersField","getDetectedFieldsParsersFromQueryRunnerState","calculateCardinalityMap","SceneCSSGridLayout","newFieldsSet","updatedChildren","gridItem","SceneCSSGridItem","getDataTransformerForPanel","delete","buildChildren","sortChildren","subscribeToPanel","aPanel","bPanel","aCardinality","fieldsCount","updateFieldCount","$detectedFieldsData","onDetectedFieldsChange","subscribeToFieldsVar","newParsers","oldParsers","extractParserFromArray","detectedFieldsState","getFieldGroupByVariable","String","FieldsBreakdownScene","reset","childrenClones","clone","templateColumns","FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS","autoRows","isLazy","getResultsStream","subscribe","errors","isHidden","optionValue","ALL_VARIABLE_VALUE","timeseries","setData","headerActions","isAvgField","setCustomFieldConfig","mode","StackingMode","Normal","DrawStyle","Bars","setOverrides","setLevelColorOverrides","viz","queryString","buildFieldsQueryString","buildDataQuery","getQueryRunner","limitFramesTransformation","fieldsBreakdownScene","activeLayout","l","activeLayoutChildren","activePanels","changeFieldCount","pipe","frames","FieldValuesBreakdownScene","groupByVariable","tagKey","subscribeToEvent","lastFilterEvent","onValuesDataQueryChange","navigateToFields","SceneReactObject","setErrorState","reactNode","status","message","traceId","navigateToDrilldownPage","parserForThisField","ByFrameRepeater","getLayoutChild","getFilterBreakdownValueScene","Line","StatusWrapper","blockingMessage","statusMessage","fontStyle","EmptyLayoutScene","emptyStateStyles","loading","$detectedLabelsData","BreakdownSearchReset","clearValueFilter","handleSortByChange","variableChanged","newService","prevService","oldState","updateOptions","checkPrimaryLabel","indexScene","variablesToClear","getVariablesThatCanBeCleared","buildClearFiltersLayout","clearVariables","getFieldOptions","updateBody","clearCallback","VAR_FIELD_GROUP_BY","defaultToAll","includeAll","BreakdownSearchScene","_variableDependency","VariableDependencyConfig","variableNames","value_breakdown_sort_change","SERVICE_UI_LABEL","SERVICE_NAME","onFieldSelectorChange","select_field_in_breakdown_clicked","previousField","getValueText","LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS","buildLabelsQuery","optionName","labelExpressionToAdd","structuredMetadataToAdd","getParserFromFieldsFilters","getLogsStreamSelector","LabelValuesBreakdownScene","VAR_LABEL_GROUP_BY_EXPR","getLabelGroupByVariable","errorIndex","displayed","showErrorToast","Streaming","navigateToLabels","activeLayoutContainsNoPanels","getActiveLayout","errorState","getErrorStateAlert","layoutSwitcher","renderError","variableState","labelBreakdownScene","LabelBreakdownScene","bodyOpts","appEvents","errorArray","displayError","alertError","recentFilters","filterValues","cacheKey","forEachChild","filterByString","typeofBody","onValueFilterChange","performRepeat","newChildren","sortedSeries","sortSeries","seriesIndex","layoutChild","unfilteredChildren","iterateFrames","filterFrames","filterFn","alertContainer","noResultsAlert","clearButton","LabelsAggregatedBreakdownScene","$detectedLabels","update","updateQueriesOnFieldsVariableChange","getPanelByIndex","detectedLabelsFrame","newLabels","layoutObj","existingLabels","newLabelsSet","detectedLabels","getDataTransformer","onDetectedLabelsDataChange","onLabelsVariableChange","onGroupByVariableChange","newPrimaryLabel","prevPrimaryLabel","getLabelOptions","hasAllValue","VAR_LABEL_GROUP_BY","previousLabel","onPatternClick","filteredPatterns","staleIndex","pattern_selected","logsStatsRow","logsStatsRowActive","logsStatsRowLabel","logsStatsRowValue","logsStatsRowCount","logsStatsRowPercent","logsStatsRowBar","logsStatsRowInnerBar","PatternFieldLabelStatsRow","count","proportion","style","percent","barStyle","logsStats","wordBreak","logsStatsHeader","medium","logsStatsTitle","logsStatsClose","logsStatsBody","PatternFieldLabelStats","stats","topRows","activeRow","otherRows","otherCount","combinedRows","stat","PatternNameLabel","patternIndices","indices","currentIndex","extractPatternIndices","setStats","statsError","setStatsError","previousQueryRef","previousTimeRangeRef","handlePatternClick","pattern_field_clicked","patternExtractor","filterExpression","_value","constructQuery","currentTimeRange","requestId","intervalMs","scopedVars","targets","maxLines","timezone","app","startTime","fieldCount","fieldStatsMap","toArray","fieldStats","convertResultToStats","parts","split","Toggletip","onOpen","Spinner","emphasize","PatternsLogsSampleScene","queryWithFilters","LOG_STREAM_SELECTOR_EXPR","replacePatternsInQuery","queryRunnerWithFilters","onQueryWithFiltersResult","setHoverHeader","pendingPattern","VAR_PATTERNS_EXPR","removePatternFromFilterExclusion","patternsViewTableScene","PatternsViewTableScene","patternsNotMatchingFilters","setWarningMessage","noticeFlexItem","getNoticeFlexItem","vizFlexItem","getVizFlexItem","getFlexItemChildren","excludeThisPatternFromFiltering","patternsThatDontMatchCurrentFilters","filterVariable","lineFilterVariable","onQueryError","every","traceIds","request","panelFlexItem","queryWithoutFilters","PATTERNS_SAMPLE_SELECTOR_EXPR","queryRunnerWithoutFilters","PatternsTableExpandedRow","tableViz","expandedRows","rowScene","newRowScene","SCALED_UNITS","appliedPatterns","getColumnStyles","cell","panelData","original","dataNode","SceneDataNode","timeSeries","TooltipDisplayMode","None","legend","AxisPlacement","Hidden","setDisplayMode","tableTimeSeriesWrap","tableTimeSeries","sortType","scaledUnits","countTextWrap","toFixed","getTablePatternTextStyles","tablePatternTextDefault","getExplorationFor","disableGrow","existingPattern","appliedPattern","includeLink","excludeLink","undoLink","patternFrames","legendSyncPatterns","logExploration","patternFrame","getTableStyles","patternsFrameScene","PatternsFrameScene","patternFramesRaw","previousValue","tableData","buildTableData","buildColumns","tableWrapper","InteractiveTable","getRowId","renderExpandedRow","theme2","overflowWrap","th","navbarFixed","pointerEvents","palette","visualization","newFrame","$patternsData","prevFrame","patternsBreakdownScene","PatternsBreakdownScene","patternFilter","getTimeseriesDataNode","getSingleViewLayout","extendTimeSeriesLegendBus","vizPanel","originalOnToggleSeriesVisibility","onToggleSeriesVisibility","override","patternsToShow","matcher","names","getTimeSeries","asTable","showLegend","displayMode","LegendDisplayMode","setUnit","setLinks","targetBlank","extendPanelContext","fixedColor","overrideToFixedColor","logsByServiceScene","PatternsViewTextSearch","onSearchResult","setFilteredPatterns","patternFramesOverride","filteredPatternFrames","clearSearch","handleSearchChange","setEmptySearch","PatternsNotDetected","TextLink","external","PatternsTooOld","PATTERNS_MAX_AGE_HOURS","setBody","dataFrames","updatePatternFrames","onDataChange","ySizing","dataFrameToPatternFrame","newFrames","prevFrames","Loading","controlsRight","controlsLeft","justifyItems","patternMissingText","getTimeSeriesExpr","streamSelectorName","excludeEmpty","metadataExpressionToAdd","fieldFilters","VAR_LABELS_EXPR","VAR_METADATA_EXPR","VAR_LINE_FILTER_EXPR","VAR_FIELDS_EXPR","JSON_FORMAT_EXPR","LOGS_FORMAT_EXPR","timeRangeTooOld","dateTime","code","LogsVolumePanel","calcs","List","setLogsVolumeFieldConfigs","syncLogsPanelVisibleSeries","levelFilter","level","SeriesVisibilityChangeMode","AppendToSelection","toggleLevelFromFilter","level_in_logs_volume_clicked","TabNames","breakdownViewsDefinitions","testId","tabLogs","tabLabels","buildFieldsBreakdownActionScene","changeFieldNumber","tabFields","tabPatterns","valueBreakdownViews","buildLabelValuesBreakdownActionScene","buildFieldValuesBreakdownActionScene","ActionBarScene","currentBreakdownViewSlug","allowNavToParent","drilldownValueSlug","getDrilldownValueSlug","loadingStates","Box","paddingY","appSidecar","ToolbarExtensionsRenderer","TabsBar","tab","Tab","counter","getCounter","onChangeTab","action_view_changed","newActionView","previousActionView","patternsCount","labelsCount","up","md","setFilters","sub","unsubscribe","setIsOpen","extensions","limitPerPlugin","Menu","Item","ariaLabel","LOGS_PANEL_QUERY_REFID","setSubscribeToLabelsVariable","redirectToStart","prevRouteMatch","runQueries","replaceSlash","isExact","resetTabCount","getMetadataService","setServiceSceneState","clearAdHocVariables","getServiceSceneState","getMetadata","resetBodyAndData","setBreakdownView","subscribeToPatternsQuery","subscribeToDetectedLabelsQuery","subscribeToDetectedFieldsQuery","subscribeToLogsQuery","subscribeToFieldsVariable","subscribeToMetadataVariable","subscribeToLevelsVariable","subscribeToDataSourceVariable","subscribeToPatternsVariable","subscribeToTimeRange","parentSlug","updateLoadingState","patternsResponse","setPatternsCount","detectedLabelsResponse","detectedLabelsFields","removeSpecialFields","setLabelsCount","updateFieldsCount","detectedFieldsFields","setFieldsCount","getServiceSceneQueryRunner","getPatternsQueryRunner","getDetectedLabelsQueryRunner","getDetectedFieldsQueryRunner","buildGraphScene","breakdownView","breakdownViewDef","valueBreakdownView","valueBreakdownViewDef","getResourceQueryRunner","buildResourceQuery","FavoriteServiceHeaderActionScene","setHover","hover","isFavorite","removeFromFavorites","tooltipCopy","onMouseOver","selectLabel","primaryLabelName","primaryLabelValue","service_selected","SelectServiceButton","ConfigureVolumeError","NoServiceSearchResults","TabPopoverScene","serviceSelectionScene","serviceSelectionTabsScene","ServiceSelectionTabsScene","tabOptions","tabOptionsWithIcon","saved","toggleShowPopover","openMenuOnFocus","setSelectedTab","getLabelsFromQueryRunnerState","$labelsData","populatePrimaryLabelsVariableOptions","selectedTab","getSelectedTab","savedTabs","getFavoriteTabsFromStorage","savedIndex","runDetectedLabels","runDetectedLabelsSubs","getServiceSelectionPrimaryLabel","selectDefaultLabelTab","getSceneQueryRunner","runQueriesMode","removeSavedTab","removeTabFromLocalStorage","getTabsStyles","tabLabel","truncateText","addTab","NoServiceVolume","AddLabelToFiltersHeaderActionScene","included","add_to_filters","aggregatedMetricsEnabled","AGGREGATED_SERVICE_NAME","primaryLabelUrlKey","datasourceUrlKey","getSelectedTabFromUrl","addDatasourceChangeToBrowserHistory","newDs","dsUrl","currentUrl","pathname","newUrl","pushUrlHandler","addLabelChangeToBrowserHistory","newKey","primaryLabelRaw","primaryLabelSplit","addTabToLocalStorage","clearServiceSelectionSearchVariable","setServiceSelectionPrimaryLabelKey","buildServiceLayout","serviceLabelVar","primaryLabelVar","datasourceVar","splitDuration","getMetricExpression","isAggregatedMetricsActive","cssGridItem","behaviors","sync","DashboardCursorSync","Crosshair","runner","getQueryRunnerFromChildren","runPanelQuery","toolbar","getQueryOptionsToolbar","formatPrimaryLabelForUI","setVolumeQueryRunner","buildVolumeQuery","VAR_PRIMARY_LABEL_EXPR","VAR_LABELS_REPLICA_EXPR","subscribeToVolume","doVariablesNeedSync","labelsVarPrimary","labelsVarReplica","getLabelsVariableReplica","activeTab","filteredFilters","needsSync","syncVariables","fixRequiredUrlParams","subscribeToPrimaryLabelsVariable","subscribeToLabelFilterChanges","subscribeToActiveTabVariable","runVolumeOnActivate","subscribeToDatasource","subscribeToAggregatedMetricToggle","subscribeToAggregatedMetricVariable","isTimeRangeTooEarlyForAggMetrics","onUnsupportedAggregatedMetricTimeRange","runVolumeQuery","onSupportedAggregatedMetricTimeRange","getAggregatedMetricsVariable","isBefore","resetQueryRunner","updateAggregatedMetricVariable","updateTabs","tabs","getGridItems","queryRunners","requestTimeRange","sceneTimeRange","fromDiff","abs","toDiff","labelsToQuery","getLabels","existingChildren","aggregatedMetricsVariable","datasourceVariable","existing","newChildTs","newChildLogs","buildServiceLogsLayout","serviceIndex","getLogExpression","labelsByVolume","dsString","searchString","getServiceSelectionSearchVariable","services","favoriteServicesToQuery","service","createListOfLabelsToQuery","VAR_PRIMARY_LABEL_SEARCH","VAR_AGGREGATED_METRICS","VAR_PRIMARY_LABEL","renderPrimaryLabelFilters","VAR_LABELS_REPLICA","serviceLevel","onSearchServicesChange","primaryLabelSearch","searchVar","search_services_changed","searchQuery","getLevelFilterForService","serviceLevels","Off","allLevels","getLabelsFromSeries","toggleLevelVisibility","updateServiceLogs","headingWrapper","loadingText","bodyWrapper","searchFieldPlaceholderText","searchWrapper","searchField","serviceStringVariable","hasSearch","isLogVolumeLoading","volumeApiError","totalServices","renderedServices","filterLabel","customValue","customLabel","unwrapWildcardSearch","serviceName","onSearchChange","MultiValueVariable","getValueOptions","args","of","renderSelectForVariable","page","properties","createInteractionName","all","wasm_not_supported","interval_too_long","arr1","arr2","set1","set2","requestSupportsSharding","trim","nodeType","isQueryWithNode","iterate","enter","MetricExpr","isLogsQuery","isLogsRequest","SHARDING_PLACEHOLDER","addShardingPlaceholderSelector","interpolateShardingSelector","shards","shardValue","RegExp","resolveIdx","destField","sourceField","closestIdx","nanos","compareEntries","destTimeField","destIdField","destIndex","sourceTimeField","sourceIdField","sameTimestamp","compareNsTimestamps","findSourceField","referenceField","sourceFields","candidates","TOTAL_BYTES_STAT","getCombinedMetadataStats","destStats","sourceStats","destStat","s","sourceStat","eitherStat","cloneDataFrame","runShardSplitQuery","interpolateVariablesInQueries","splittingTargets","shouldStop","mergedResponse","uuidv4","subquerySubscription","retriesMap","retryTimer","runNextRequest","subscriber","cycle","groupSize","nextGroupSize","retrying","done","next","complete","nextRequest","nextCycle","retry","errorResponse","isRetriableError","floor","sqrt","retries","pow","shardsToQuery","start","groupShardRequests","subRequest","runQuery","partialResponse","constrainGroupSize","response","currentSize","metaExecutionTime","executionTime","updateGroupSizeFromResponse","currentResult","newResult","currentFrame","frame1","frame2","frameType1","TimeSeriesMulti","field1","field2","compareLabels","customType1","frameType","customType2","shouldCombine","dest","sourceTimeValues","totalFields","destIdx","entryExistsInDest","mergeFrames","mergedErrors","mergedError","mergedTraceIds","combineResponses","runNonSplitRequest","Observable","selector","getNodesFromQuery","getSelectorForShardValues","isValidQuery","fetchLabelValues","streamSelector","parseInt","getInitialGroupSize","catch","splitQueriesByStreamShard","DEBUG_ENABLED","log","WRAPPED_LOKI_DS_UID","DETECTED_FIELDS_NAME_FIELD","DETECTED_FIELDS_CARDINALITY_NAME","DETECTED_FIELDS_PARSER_NAME","DETECTED_FIELDS_TYPE_NAME","WrappedLokiDatasource","RuntimeDataSource","__sceneObject","valueOf","targetsSet","resource","getVolume","getPatterns","getDetectedLabels","getDetectedFields","shardingEnabled","exploreLogsShardSplitting","interpolatedTarget","expression","dsResponse","getResource","utc","toISOString","end","headers","lokiPatterns","maxValue","minValue","timeValues","countValues","samples","createDataFrame","preferredVisualisationType","targetsInterpolated","PLACEHOLDER_QUERY","sortLabelsByCardinality","detectedLabelFields","nameField","cardinalityField","parserField","typeField","FIELDS_TO_REMOVE","parsers","primaryLabel","volumeResponse","lhs","rhs","lVolumeCount","rVolumeCount","df","metric","labelsResponse","testDatasource","sceneUtils","registerRuntimeDataSource","dataSource","rerenderFavorites","findAllObjects","forceRender","findDescendents","addToFavoriteLabelValueInStorage","removeFromFavoritesInStorage","getReducerId","extractParserFromString","parserString","extractFieldTypeFromString","fieldString","parsersSet","parsersArray","namesField","getTitle","sortByScene","labelKey","frameIndex","reducerID","selectFrameTransformation","setColor","getColorByIndex","setDisplayName","labelType","LabelType","Indexed","StructuredMetadata","Parsed","getLabelTypeFromFrame","getFilterTypeFromLabelType","typesField","optionType","parserFromFilterValue","fieldExpressionToAdd","buildFieldsQuery","unshift","labelOptions","visibleLevels","ToggleSelection","existingLevel","getVisibleLevels","levelsFilter","wantedLevels","normalizeLevelName","unwantedLevels","defaultContext","version","attemptFaroInfo","attemptFaroWarn","attemptFaroErr","logInfo","logWarning","context2","hasData","populateFetchErrorContext","metadataService","initializeMetadataService","MetadataService","serviceSceneState","previousRoute","buildDrilldownPageUrl","extraQueryParams","getUrlSearchParams","buildDrilldownPageRoute","newPath","urlLabelName","urlLabelValue","urlPath","buildValueBreakdownUrl","fullUrl","breakdownUrl","serviceUrl","buildServicesUrl","getSearch","LogsSceneQueryRunner","UNKNOWN_LEVEL_LOGS","matchFieldsWithName","overrideColor","builder","setLevelSeriesOverrides","overrideConfig","FieldMatcherID","byNames","readOnly","overrideCustomFieldConfig","__systemRef","focusedLevels","FieldConfigBuilders","FieldConfigBuilder","onFieldConfigChange","sortLevelTransformation","displayNameFromDS","aName","aVal","bName","queryRunnerOptions","route","queryParamsOverrides","defaultQueryParams","VAR_DATASOURCE_EXPR","queryType","editorMode","supportingQueryType","getLogQLLabelGroups","positive","negative","positiveGroups","groupBy","positiveFilters","renderMetadata","renderRegexLabelFilter","getLogQLLabelFilters","negativeFilters","numeric","fieldFilterToQueryString","fieldNumericFilterToQueryString","excludePatternsLine","includePatternsLine","breakdownLabelName","lastIndexOf","routeParams","startOfUrl","locationArray","buildServicesRoute","labelsVariable","sceneObject","visTheme","getColorByName","memoize","sortSeriesByName","initOutlierDetector","fieldReducer","calculateDataFrameChangepoints","calculateOutlierValue","doStandardCalcs","seriesCalcs","firstTimestamp","lastTimestamp","firstValue","lastValue","allSeriesKey","wasmSupported","dataPoints","samplingStep","sample","Float64Array","ChangepointDetector","defaultArgpcp","detectChangepoints","valueA","valueB","localeCompare","joined","outerJoinDataFrames","points","detector","OutlierDetector","dbscan","preprocess","outliers","detect","seriesResults","isOutlier","outlierIntervals","support","WebAssembly","FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY","FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY","DS_LOCALSTORAGE_KEY","dsKey","createPrimaryLabelLocalStorageKey","labelValues","servicesToStore","createTabsLocalStorageKey","tabName","tabNames","SORT_BY_LOCALSTORAGE_KEY","defaultSortBy","defaultDirection","LOG_OPTIONS_LOCALSTORAGE_KEY","storedValue","getExplorationPrefix","getDataSourceName","getServiceName","PREFIX","storedFields","VISUALIZATION_TYPE_LOCALSTORAGE_KEY","storedType","appConfig","apiKey","apiUrl","submit","refreshPicker","combobox","addNewLabelTab","searchLabelValueInput","logsPanelHeader","radio","navigator","clipboard","isSecureContext","writeText","document","execCommand","textarea","createElement","buttonElement","appendChild","focus","remove","UrlParameterType","paramName","charAt","toUpperCase","ellipsis","VAR_LEVELS_EXPR","lookupVariable","adHocFiltersVariableState","getServiceNameFromVariableState"],"sourceRoot":""}