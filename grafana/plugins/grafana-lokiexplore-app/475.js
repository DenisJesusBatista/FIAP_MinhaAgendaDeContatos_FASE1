"use strict";(self.webpackChunkgrafana_lokiexplore_app=self.webpackChunkgrafana_lokiexplore_app||[]).push([[475],{5218:(e,t,n)=>{n.d(t,{F:()=>o});var r=n(6089),a=n(2007),i=n(5959),l=n.n(i),s=n(1220);const o=e=>{const{isExcluded:t,isIncluded:n,onInclude:r,onExclude:i,onClear:o,titles:d,buttonFill:u}=e,p=(0,a.useStyles2)(c,n,t);return l().createElement("div",{className:p.container},l().createElement(a.Button,{variant:n?"primary":"secondary",fill:u,size:"sm","aria-selected":n,className:p.includeButton,onClick:n?o:r,"data-testid":s.b.exploreServiceDetails.buttonFilterInclude,title:null==d?void 0:d.include},"Include"),l().createElement(a.Button,{variant:t?"primary":"secondary",fill:u,size:"sm","aria-selected":t,className:p.excludeButton,onClick:t?o:i,title:null==d?void 0:d.exclude,"data-testid":s.b.exploreServiceDetails.buttonFilterExclude},"Exclude"))},c=(e,t,n)=>({container:(0,r.css)({display:"flex",justifyContent:"center"}),includeButton:(0,r.css)({borderRadius:0,borderRight:t?void 0:"none"}),excludeButton:(0,r.css)({borderRadius:`0 ${e.shape.radius.default} ${e.shape.radius.default} 0`,borderLeft:n?void 0:"none"})})},4482:(e,t,n)=>{n.d(t,{R:()=>c});var r=n(5959),a=n.n(r),i=n(6089),l=n(1575),s=n(2007);const o=e=>({graphicContainer:(0,i.css)({display:"flex",justifyContent:"center",margin:"0 auto"}),graphic:(0,i.css)({width:"200px",height:"120px",padding:e.spacing(1)}),text:(0,i.css)({display:"flex",justifyContent:"center",alignItems:"center"}),wrap:(0,i.css)({margin:"0 auto"})}),c=({children:e})=>{const t=(0,s.useStyles2)(o),n=(0,s.useTheme2)();return a().createElement("div",{className:t.wrap},a().createElement("div",{className:t.graphicContainer},a().createElement(l.A,{className:t.graphic,src:n.isDark?"/public/plugins/grafana-lokiexplore-app/img/grot_err.svg":"/public/plugins/grafana-lokiexplore-app/img/grot_err_light.svg"})),a().createElement("div",{className:t.text},a().createElement(s.Text,{textAlignment:"center",color:"primary",element:"span"},e||"An error occurred")))}},7311:(e,t,n)=>{n.d(t,{P:()=>Oe});var r=n(5959),a=n.n(r),i=n(1119),l=n(3143),s=n(227),o=n(1475),c=n(2007),d=n(6089),u=n(1220);const p=({onRemove:e,pattern:t,size:n="lg"})=>{const i=(0,c.useStyles2)(v),[l,s]=(0,r.useState)(!1);return a().createElement("div",{className:i.pattern,onClick:()=>s(!l),onMouseLeave:()=>s(!1)},a().createElement(c.Tag,{title:t,key:t,name:l?t:m(t,n),className:i.tag}),a().createElement(c.Button,{"aria-label":"Remove pattern","data-testid":u.b.exploreServiceDetails.buttonRemovePattern,variant:"secondary",size:"sm",className:i.removeButton,onClick:e},a().createElement(c.Icon,{name:"times"})))},g={sm:50,lg:Math.round(window.innerWidth/8)};function m(e,t){const n=e.length;if(n<g[t])return e;const r=Math.round(.4*g[t]);return`${e.substring(0,r)} … ${e.substring(n-r)}`}const v=e=>({pattern:(0,d.css)({display:"flex",fontFamily:"monospace",gap:e.spacing(.25),cursor:"pointer",overflow:"hidden"}),tag:(0,d.css)({borderTopRightRadius:0,borderBottomRightRadius:0,backgroundColor:e.colors.secondary.main,border:`solid 1px ${e.colors.secondary.border}`,color:e.colors.secondary.text,boxSizing:"border-box",padding:e.spacing(.25,.75),overflow:"hidden",textOverflow:"ellipsis"}),removeButton:(0,d.css)({paddingLeft:2.5,paddingRight:2.5})});var h=n(2718);const f=({patterns:e,onRemove:t})=>{const n=(0,c.useStyles2)(b);if(!e||0===e.length)return null;const r=e.filter((e=>"include"===e.type)),i=e.filter((e=>"include"!==e.type)),l=n=>{t(e.filter((e=>e!==n))),(0,h.EE)(h.NO.service_details,h.ir.service_details.pattern_removed,{includePatternsLength:r.length-("include"===(null==n?void 0:n.type)?1:0),excludePatternsLength:i.length-("include"!==(null==n?void 0:n.type)?1:0),type:n.type})};return a().createElement("div",null,r.length>0&&a().createElement("div",{className:n.patternsContainer},a().createElement(c.Text,{variant:"bodySmall",weight:"bold","data-testid":u.b.patterns.buttonIncludedPattern},"Included pattern",e.length>1?"s":""),a().createElement("div",{className:n.patterns},r.map((e=>a().createElement(p,{key:e.pattern,pattern:e.pattern,size:"lg",onRemove:()=>l(e)}))))),i.length>0&&a().createElement("div",{className:n.patternsContainer},a().createElement(c.Text,{variant:"bodySmall",weight:"bold","data-testid":u.b.patterns.buttonExcludedPattern},"Excluded pattern",i.length>1?"s":"",":"),a().createElement("div",{className:n.patterns},i.map((e=>a().createElement(p,{key:e.pattern,pattern:e.pattern,size:i.length>1?"sm":"lg",onRemove:()=>l(e)}))))))};function b(e){return{patternsContainer:(0,d.css)({paddingBottom:e.spacing(1),overflow:"hidden"}),patterns:(0,d.css)({display:"flex",gap:e.spacing(1),alignItems:"center",flexWrap:"wrap"})}}const y=()=>{const e=(0,c.useStyles2)(S);return a().createElement("div",{className:e.wrapper},a().createElement("a",{href:"https://forms.gle/1sYWCTPvD72T1dPH9",className:e.feedback,title:"Share your thoughts about Logs in Grafana.",target:"_blank",rel:"noreferrer noopener"},a().createElement(c.Icon,{name:"comment-alt-message"})," Give feedback"))},S=e=>({wrapper:(0,d.css)({display:"flex",marginLeft:"auto",gap:e.spacing(1),position:"relative",top:e.spacing(-1)}),feedback:(0,d.css)({alignSelf:"center",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.link}})});function w(e){return a().createElement(a().Fragment,null,a().createElement(c.Alert,{severity:"info",title:"Welcome to Explore Logs!",onRemove:e.onRemove},a().createElement("div",null,"Check out our"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://grafana.com/docs/grafana-cloud/visualizations/simplified-exploration/logs/",rel:"noreferrer"},"Get started doc"),", or see"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://github.com/grafana/explore-logs/releases",rel:"noreferrer"},"recent changes"),".",a().createElement("br",null),"Help us shape the future of the app."," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://forms.gle/1sYWCTPvD72T1dPH9",rel:"noreferrer"},"Send us feedback")," ","or engage with us on"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://github.com/grafana/explore-logs/?tab=readme-ov-file#explore-logs",rel:"noreferrer"},"GitHub"),".")))}var O=n(892);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const E=`${O.s_}.interceptBannerStorageKey`;class C extends i.Bs{dismiss(){this.setState({interceptDismissed:!0}),localStorage.setItem(E,"true")}constructor(e){var t,n;super((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}({},e),n=null!=(n={interceptDismissed:!!localStorage.getItem(E)})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t))}}function F(e){return{bodyContainer:(0,d.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column"}),container:(0,d.css)({flexGrow:1,display:"flex",gap:e.spacing(1),minHeight:"100%",flexDirection:"column",padding:e.spacing(2),maxWidth:"100vw"}),body:(0,d.css)({flexGrow:1,display:"flex",flexDirection:"column",gap:e.spacing(1)}),controlsContainer:(0,d.css)({display:"flex",gap:e.spacing(2),justifyContent:"space-between",alignItems:"flex-start"}),filters:(0,d.css)({display:"flex",gap:e.spacing(2),width:"calc(100% - 450)",flexWrap:"wrap",alignItems:"flex-end",'& + div[data-testid="data-testid Dashboard template variables submenu Label Filters"]:empty':{visibility:"hidden"},"&:first-child":{"& > div":{"& > div":{flexWrap:"wrap","& > div":{maxWidth:"380px","& > div":{flex:"1 0 auto","&:nth-child(3)":{flex:"0 1 auto"}}}}}},'[data-testid="AdHocFilter-service_name"]':{'div[class*="input-wrapper"]:first-child':{display:"none"},'div[class*="input-wrapper"]:nth-child(2)':{marginLeft:0}},'div >[title="Add filter"]':{border:0,display:"none",width:0,padding:0,margin:0}}),controlsWrapper:(0,d.css)({display:"flex",flexDirection:"column"}),controls:(0,d.css)({display:"flex",gap:e.spacing(1)}),feedback:(0,d.css)({textAlign:"end"}),rotateIcon:(0,d.css)({svg:{transform:"rotate(180deg)"}})}}x(C,"Component",(({model:e})=>{if(!e.parent)return null;const{controls:t,contentScene:n,patterns:r}=e.parent.useState(),{interceptDismissed:l}=e.useState();if(!n)return null;const s=(0,c.useStyles2)(F);return a().createElement("div",{className:s.bodyContainer},!l&&a().createElement(w,{onRemove:()=>{e.dismiss()}}),a().createElement("div",{className:s.container},t&&a().createElement("div",{className:s.controlsContainer},a().createElement("div",{className:s.filters},t.map((e=>e instanceof i.K8?a().createElement(e.Component,{key:e.state.key,model:e}):null))),a().createElement("div",{className:s.controlsWrapper},a().createElement(y,null),a().createElement("div",{className:s.controls},t.map((e=>e instanceof i.K8==0?a().createElement(e.Component,{key:e.state.key,model:e}):null))))),a().createElement(f,{patterns:r,onRemove:t=>{var n;return null===(n=e.parent)||void 0===n?void 0:n.setState({patterns:t})}}),a().createElement("div",{className:s.body},n&&a().createElement(n.Component,{model:n}))))}));var j=n(6001),P=n(3241),L=n(7781),_=n(5435),k=n(8835),T=n(4750);function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $(e,t,n){const r=(0,T.cR)(n);(0,h.EE)(h.NO.service_selection,h.ir.service_selection.service_selected,{value:t,label:e}),r.setState({filters:[...r.state.filters.filter((t=>t.key!==e)),{key:e,operator:j.w7.Equal,value:t}],hide:_.zL.hideLabel});const a=(0,T.S9)(n).getValue();e===l.OX&&(e=l.ky),(0,s.OB)(a,e,t),(0,k.jY)(e,t)}class N extends i.Bs{constructor(...e){super(...e),D(this,"onClick",(()=>{this.state.labelValue&&$(this.state.labelName,this.state.labelValue,this)}))}}function I(e){return{button:(0,d.css)({alignSelf:"center"})}}D(N,"Component",(({model:e})=>{const t=(0,c.useStyles2)(I);return a().createElement(c.Button,{tooltip:`View breakdown for ${e.state.labelValue}`,className:t.button,variant:"secondary",size:"sm",onClick:e.onClick},"Select")}));var A=n(7918),M=n(5183),B=n(4482);const R=()=>a().createElement(B.R,null,a().createElement("p",null,"Log volume has not been configured."),a().createElement("p",null,a().createElement(c.TextLink,{href:"https://grafana.com/docs/loki/latest/reference/api/#query-log-volume",external:!0},"Instructions to enable volume in the Loki config:")),a().createElement(c.Text,{textAlignment:"left"},a().createElement("pre",null,a().createElement("code",null,"limits_config:",a().createElement("br",null),"  volume_enabled: true")))),V=()=>a().createElement(B.R,null,a().createElement("p",null,"No service matched your search."));var W=n(1383),z=n(4462),H=n(5431),q=n(833),Q=n(8531);function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const G=`${n(2533).id}.serviceSelection.aggregatedMetrics`;class J extends i.Bs{constructor(e){const t=localStorage.getItem(G),n=Q.config.featureToggles.exploreLogsAggregatedMetrics&&"false"!==t;var r;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){U(e,t,n[t])}))}return e}({isOpen:!1,options:{aggregatedMetrics:{active:null!=n&&n,userOverride:null!==(r="true"===t)&&void 0!==r&&r,disabled:!1}}},e)),U(this,"toggleAggregatedMetricsOverride",(()=>{const e=!this.state.options.aggregatedMetrics.active;(0,h.EE)(h.NO.service_selection,h.ir.service_selection.aggregated_metrics_toggled,{enabled:e}),localStorage.setItem(G,e.toString()),this.setState({options:{aggregatedMetrics:{active:e,disabled:this.state.options.aggregatedMetrics.disabled,userOverride:e}}})})),U(this,"onToggleOpen",(e=>{this.setState({isOpen:e})}))}}function Y(e){return{popover:(0,d.css)({display:"flex",padding:e.spacing(2),flexDirection:"column",background:e.colors.background.primary,boxShadow:e.shadows.z3,borderRadius:e.shape.radius.default,border:`1px solid ${e.colors.border.weak}`,zIndex:1,marginRight:e.spacing(2)}),heading:(0,d.css)({fontWeight:e.typography.fontWeightMedium,paddingBottom:e.spacing(2)}),options:(0,d.css)({display:"grid",gridTemplateColumns:"1fr 50px",rowGap:e.spacing(1),columnGap:e.spacing(2),alignItems:"center"})}}U(J,"Component",(({model:e})=>{const{isOpen:t,options:n}=e.useState(),r=(0,c.useStyles2)(Y);return n.aggregatedMetrics?a().createElement(c.Dropdown,{overlay:()=>a().createElement("div",{className:r.popover,onClick:e=>e.stopPropagation()},a().createElement("div",{className:r.heading},"Query options"),a().createElement("div",{className:r.options},a().createElement("div",{title:"Aggregated metrics will return service queries results much more quickly, but with lower resolution"},"Aggregated metrics"),a().createElement("span",{title:n.aggregatedMetrics.disabled?`Aggregated metrics can only be enabled for queries starting after ${ve.toLocaleString()}`:""},a().createElement(c.Switch,{value:n.aggregatedMetrics.active,disabled:n.aggregatedMetrics.disabled,onChange:e.toggleAggregatedMetricsOverride})))),placement:"bottom",onVisibleChange:e.onToggleOpen},a().createElement(c.ToolbarButton,{icon:"cog",variant:"canvas",isOpen:t})):a().createElement(a().Fragment,null)}));var X=n(8315);function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class K extends i.Bs{}Z(K,"Component",(({model:e})=>{const t=i.jh.getAncestor(e,be),n=i.jh.getAncestor(e,re),{tabOptions:r,showPopover:l}=n.useState(),s=(0,c.useStyles2)(ee),o=r.map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Z(e,t,n[t])}))}return e}({},e),n=null!=(n={icon:e.saved?"save":void 0,label:`${e.label} (${e.counter})`})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t;var t,n}));return a().createElement(c.Stack,{direction:"column",gap:0,role:"tooltip"},a().createElement("div",{className:s.card.body},a().createElement(c.Select,{menuShouldPortal:!1,width:50,onBlur:()=>{n.toggleShowPopover()},autoFocus:!0,isOpen:l,placeholder:"Search labels",options:o,isSearchable:!0,openMenuOnFocus:!0,onChange:e=>{e.value&&(n.toggleShowPopover(),t.setSelectedTab(e.value))}})))}));const ee=e=>({card:{body:(0,d.css)({padding:e.spacing(1)}),p:(0,d.css)({maxWidth:300})}});function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){te(e,t,n[t])}))}return e}class re extends i.Bs{getLabelsFromQueryRunnerState(e=(()=>{var e;return null===(e=this.state.$labelsData)||void 0===e?void 0:e.state})()){var t;return null===(t=e.data)||void 0===t?void 0:t.series[0].fields.map((e=>({label:e.name,cardinality:e.values[0]})))}populatePrimaryLabelsVariableOptions(e){const t=i.jh.getAncestor(this,be).getSelectedTab(),n=(0,s.sj)((0,T.S9)(this).getValue().toString()),r=e.map((e=>{const r=n.indexOf(e.label);return{label:e.label===l.OX?l.ky:e.label,value:e.label,active:t===e.label,counter:e.cardinality,saved:-1!==r,savedIndex:r}})).sort(((e,t)=>e.value===l.OX||t.value===l.OX?e.value===l.OX?-1:1:e.label<t.label?-1:e.label>t.label?1:0));this.setState({tabOptions:r})}onActivate(){this.state.$labelsData.runQueries(),this.setState({popover:new K({})}),this._subs.add((0,T.S9)(this).subscribeToState((()=>{this.state.$labelsData.runQueries()}))),this._subs.add((0,T.El)(this).subscribeToState((()=>{var e;const t=this.getLabelsFromQueryRunnerState(null===(e=this.state.$labelsData)||void 0===e?void 0:e.state);t&&this.populatePrimaryLabelsVariableOptions(t)}))),this._subs.add(i.jh.getTimeRange(this).subscribeToState((()=>{this.state.$labelsData.runQueries()}))),this._subs.add(this.state.$labelsData.subscribeToState((e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===L.LoadingState.Done){const t=this.getLabelsFromQueryRunnerState(e),n=i.jh.getAncestor(this,be);t&&this.populatePrimaryLabelsVariableOptions(t);const r=n.getSelectedTab();(null==t?void 0:t.some((e=>e.label===r)))||n.selectDefaultLabelTab()}})))}constructor(e){super(ne({showPopover:!1,$labelsData:(0,M.HF)({queries:[(0,A.BM)("","detected_labels")],runQueriesMode:"manual"}),tabOptions:[{label:l.ky,value:l.OX,saved:!0}]},e)),te(this,"removeSavedTab",(e=>{(0,s.Gg)((0,T.S9)(this).getValue().toString(),e);const t=this.getLabelsFromQueryRunnerState();t&&this.populatePrimaryLabelsVariableOptions(t);const n=i.jh.getAncestor(this,be);n.getSelectedTab()===e&&n.selectDefaultLabelTab()})),te(this,"toggleShowPopover",(()=>{this.setState({showPopover:!this.state.showPopover})})),this.addActivationHandler(this.onActivate.bind(this))}}te(re,"Component",(({model:e})=>{const{tabOptions:t,showPopover:n,popover:s,$labelsData:o}=e.useState(),{data:u}=o.useState(),p=i.jh.getAncestor(e,be);(0,T.El)(e).useState();const g=(0,c.useStyles2)(ae),m=(0,r.useRef)(null);return a().createElement(c.TabsBar,null,t.filter((e=>e.saved||e.active||e.value===l.OX)).sort(((e,t)=>{return e.value===l.OX||t.value===l.OX?e.value===l.OX?-1:1:(null!==(n=e.savedIndex)&&void 0!==n?n:0)-(null!==(r=t.savedIndex)&&void 0!==r?r:0);var n,r})).map((t=>{const n=a().createElement(c.Tab,{key:t.value,onChangeTab:()=>{p.setSelectedTab(t.value)},label:(0,X.EJ)(t.label,15,!0),active:t.active,counter:t.counter,suffix:t.value!==l.OX?n=>a().createElement(a().Fragment,null,a().createElement(c.Tooltip,{content:"Remove tab"},a().createElement(c.Icon,{onKeyDownCapture:n=>{"Enter"===n.key&&e.removeSavedTab(t.value)},onClick:n=>{n.stopPropagation(),e.removeSavedTab(t.value)},name:"times",className:(0,d.cx)(n.className)}))):void 0});return t.label.length>15?a().createElement(c.Tooltip,{key:t.value,content:t.label},n):n})),(null==u?void 0:u.state)===L.LoadingState.Loading&&a().createElement(c.Tab,{label:"Loading tabs",icon:"spinner"}),(null==u?void 0:u.state)===L.LoadingState.Done&&a().createElement(c.Tab,{onChangeTab:e.toggleShowPopover,label:"Add label",ref:m,icon:"plus-circle"}),s&&a().createElement(c.PopoverController,{content:a().createElement(s.Component,{model:s})},((e,t,r)=>{const i={onBlur:t,onFocus:e};return a().createElement(a().Fragment,null,m.current&&a().createElement(a().Fragment,null,a().createElement(c.Popover,ne((l=ne({},r,P.rest),s=null!=(s={show:n,wrapperClassName:g.popover,referenceElement:m.current,renderArrow:!0})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(s)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(s)).forEach((function(e){Object.defineProperty(l,e,Object.getOwnPropertyDescriptor(s,e))})),l),i))));var l,s})))}));const ae=e=>({popover:(0,d.css)({borderRadius:e.shape.radius.default,boxShadow:e.shadows.z3,background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`})});class ie extends i.Bs{setHover(e){this.setState({hover:e})}getIconType(e){return e?this.state.hover?"default":"solid":this.state.hover?"solid":"default"}onClick(e){e?(0,s.cC)(this.state.ds,this.state.labelName,this.state.labelValue):(0,s.OB)(this.state.ds,this.state.labelName,this.state.labelValue),this.forceRender()}}var le,se,oe;oe=({model:e})=>{const{ds:t,labelValue:n,labelName:r,hover:i}=e.useState(),l=(0,s.eT)(t,r).includes(n),o=(0,c.useStyles2)((e=>({wrapper:(0,d.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignSelf:"center"})}))),u=l?`Remove  ${n} from favorites`:`Add ${n} to favorites`;return a().createElement("span",{className:o.wrapper},a().createElement(c.ToolbarButton,{onMouseOver:()=>{e.setHover(!0)},onMouseOut:()=>{e.setHover(!1)},icon:a().createElement(c.Icon,{name:l?"favorite":"star",size:"lg",type:l?"mono":"default"}),color:l?"rgb(235, 123, 24)":"#ccc",onClick:()=>e.onClick(l),name:"star","aria-label":u,tooltip:u}))},(se="Component")in(le=ie)?Object.defineProperty(le,se,{value:oe,enumerable:!0,configurable:!0,writable:!0}):le[se]=oe;const ce=e=>a().createElement(B.R,null,a().createElement("p",null,"No logs found in ",a().createElement("strong",null,e.labelName),".",a().createElement("br",null),"Please adjust time range or select another label."));function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){de(e,t,n[t])}))}return e}function pe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const ge=Q.config.featureToggles.exploreLogsAggregatedMetrics,me="__aggregated_metric__",ve=(0,L.dateTime)("2024-08-30","YYYY-MM-DD"),he="var-primary_label",fe="var-ds";class be extends i.Bs{getUrlState(){const{key:e}=ye(),t=(0,T.El)(this).state.filters[0];return t.key&&t.key!==e&&(0,T.El)(this).setState({filters:[pe(ue({},t),{key:null!=e?e:t.key})]}),{}}updateFromUrl(e){console.log("updateFromUrl",e)}addDatasourceChangeToBrowserHistory(e){const t=Q.locationService.getLocation(),n=new URLSearchParams(t.search),r=n.get(fe);if(r&&e!==r){const r=t.pathname+t.search;n.set(fe,e);const a=t.pathname+"?"+n.toString();r!==a&&(0,k.ad)(a)}}addLabelChangeToBrowserHistory(e,t=!1){const{key:n,search:r,location:a}=ye();if(n){const i=null==n?void 0:n.split("|");if((null==i?void 0:i[0])!==e){i[0]=e,r.set(he,i.join("|"));const n=a.pathname+a.search,l=a.pathname+"?"+r.toString();n!==l&&(t?Q.locationService.replace(l):(0,k.ad)(l))}}}getSelectedTab(){var e;return null===(e=(0,T.El)(this).state.filters[0])||void 0===e?void 0:e.key}getSelectedTabLabel(){return(0,T.El)(this).state.filters[0].key}selectDefaultLabelTab(){this.addLabelChangeToBrowserHistory(l.OX,!0),this.setSelectedTab(l.OX)}setSelectedTab(e){(0,s.cO)((0,T.S9)(this).getValue().toString(),e),(0,T.h)(this),(0,T.BL)(e,this)}buildServiceLayout(e,t,n,r,a,s){var o;let d;n.to.diff(n.from,"hours")>=4&&n.to.diff(n.from,"hours")<=26&&(d="2h");const u=i.d0.timeseries().setTitle(t).setData((0,M.rS)([(0,A.l)(this.getMetricExpression(t,r,a),{legendFormat:`{{${l.e4}}}`,splitDuration:d,refId:`ts-${t}`})])).setCustomFieldConfig("stacking",{mode:c.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",c.DrawStyle.Bars).setUnit("short").setOverrides(M.jC).setOption("legend",{showLegend:!0,calcs:["sum"],placement:"right",displayMode:c.LegendDisplayMode.Table}).setHeaderActions([new ie({ds:null===(o=s.getValue())||void 0===o?void 0:o.toString(),labelName:e,labelValue:t}),new N({labelValue:t,labelName:e})]).build();return u.setState({extendPanelContext:(n,r)=>this.extendTimeSeriesLegendBus(e,t,r,u)}),new i.xK({$behaviors:[new i.Gg.K2({key:"serviceCrosshairSync",sync:L.DashboardCursorSync.Crosshair})],body:u})}isAggregatedMetricsActive(){const e=this.getQueryOptionsToolbar();return!(null==e?void 0:e.state.options.aggregatedMetrics.disabled)&&(null==e?void 0:e.state.options.aggregatedMetrics.active)}formatPrimaryLabelForUI(){const e=this.getSelectedTab();return e===l.OX?l.ky:e}onActivate(){var e;this.fixRequiredUrlParams(),this.setState({$data:(0,M.HF)({queries:[(0,A.BM)(`{${l.kl}}`,"volume")],runQueriesMode:"manual"})});const t=(0,T.cR)(this);t.state.filters.length>0&&t.setState({filters:[]});const n=(0,T.El)(this);var r,a;this._subs.add(n.subscribeToState(((e,t)=>{if(e.filterExpression!==t.filterExpression){const t=e.filters[0].key;this.addLabelChangeToBrowserHistory(t),this.runVolumeQuery()}}))),this._subs.add(this.state.$data.subscribeToState(((e,t)=>{var n,r,a;(null===(n=e.data)||void 0===n?void 0:n.state)!==L.LoadingState.Done||(0,q.B)(null==t||null===(r=t.data)||void 0===r?void 0:r.series,null==e||null===(a=e.data)||void 0===a?void 0:a.series)||this.updateBody()}))),this.isTimeRangeTooEarlyForAggMetrics()?(this.onUnsupportedAggregatedMetricTimeRange(),(null===(r=this.state.$data.state.data)||void 0===r?void 0:r.state)!==L.LoadingState.Done&&this.runVolumeQuery()):(this.onSupportedAggregatedMetricTimeRange(),(null===(a=this.state.$data.state.data)||void 0===a?void 0:a.state)!==L.LoadingState.Done&&this.runVolumeQuery()),this._subs.add(i.jh.getTimeRange(this).subscribeToState((()=>{this.isTimeRangeTooEarlyForAggMetrics()?this.onUnsupportedAggregatedMetricTimeRange():this.onSupportedAggregatedMetricTimeRange(),this.runVolumeQuery()}))),this._subs.add((0,T.S9)(this).subscribeToState((e=>{this.addDatasourceChangeToBrowserHistory(e.value.toString()),this.runVolumeQuery()}))),this._subs.add(null===(e=this.getQueryOptionsToolbar())||void 0===e?void 0:e.subscribeToState(((e,t)=>{e.options.aggregatedMetrics.userOverride!==t.options.aggregatedMetrics.userOverride&&this.runVolumeQuery()}))),this._subs.add((0,T.vm)(this).subscribeToState(((e,t)=>{e.value!==t.value&&(this.setState({body:new i.gF({children:[]})}),this.updateBody())})))}fixRequiredUrlParams(){const{key:e}=ye();e||this.selectDefaultLabelTab()}isTimeRangeTooEarlyForAggMetrics(){return i.jh.getTimeRange(this).state.value.from.isBefore((0,L.dateTime)(ve))}onUnsupportedAggregatedMetricTimeRange(){const e=this.getQueryOptionsToolbar();null==e||e.setState({options:{aggregatedMetrics:pe(ue({},null==e?void 0:e.state.options.aggregatedMetrics),{disabled:!0})}})}getQueryOptionsToolbar(){return i.jh.getAncestor(this,Oe).state.controls.find((e=>e instanceof J))}onSupportedAggregatedMetricTimeRange(){const e=this.getQueryOptionsToolbar();null==e||e.setState({options:{aggregatedMetrics:pe(ue({},null==e?void 0:e.state.options.aggregatedMetrics),{disabled:!1})}})}wrapWildcardSearch(e){return".+"!==e&&".*"!==e.substring(0,2)?`.*${e}.*`:e}unwrapWildcardSearch(e){return".*"===e.substring(0,2)&&".*"===e.slice(-2)?e.slice(2).slice(0,-2):e}runVolumeQuery(){this.updateAggregatedMetricVariable(),this.state.$data.runQueries()}updateAggregatedMetricVariable(){const e=(0,T.vm)(this);this.isTimeRangeTooEarlyForAggMetrics()&&ge||!this.isAggregatedMetricsActive()?e.changeValueTo(l.OX):e.changeValueTo(me)}updateTabs(){if(!this.state.tabs){const e=new re({});this.setState({tabs:e})}}updateBody(){var e;const{labelsToQuery:t}=this.getLabels(null===(e=this.state.$data.state.data)||void 0===e?void 0:e.series);if(this.updateTabs(),t&&0!==t.length){const e=[],n=this.state.body.state.children,r=i.jh.getTimeRange(this).state.value,a=(0,T.vm)(this),l=(0,T.El)(this),s=this.getSelectedTab(),o=(0,T.S9)(this);for(const i of t.slice(0,20)){const t=n.filter((e=>{const t=e.state.body;return(null==t?void 0:t.state.title)===i}));2===t.length?e.push(t[0],t[1]):e.push(this.buildServiceLayout(s,i,r,a,l,o),this.buildServiceLogsLayout(s,i))}this.state.body.setState({children:e,isLazy:!0,templateColumns:"repeat(auto-fit, minmax(500px, 1fr) minmax(300px, 70vw))",autoRows:"200px",md:{templateColumns:"1fr",rowGap:1,columnGap:1}})}else this.state.body.setState({children:[]})}updateServiceLogs(e,t){var n;if(!this.state.body)return void this.updateBody();const{labelsToQuery:r}=this.getLabels(null===(n=this.state.$data.state.data)||void 0===n?void 0:n.series),a=null==r?void 0:r.indexOf(t);if(!(void 0===a||a<0)&&this.state.body){let n=[...this.state.body.state.children];n.splice(2*a+1,1,this.buildServiceLogsLayout(e,t)),this.state.body.setState({children:n})}}getLogExpression(e,t,n){return`{${e}=\`${t}\`}${n}`}getMetricExpression(e,t,n){const r=n.state.filters[0];return t.state.value===me?r.key===l.OX?`sum by (${l.e4}) (sum_over_time({${me}=\`${e}\`} | logfmt | unwrap count [$__auto]))`:`sum by (${l.e4}) (sum_over_time({${me}=~\`.+\` } | logfmt | ${r.key}=\`${e}\` | unwrap count [$__auto]))`:`sum by (${l.e4}) (count_over_time({ ${r.key}=\`${e}\` } [$__auto]))`}getLabels(e){var t,n,r;const a=null!==(r=null==e||null===(t=e[0])||void 0===t?void 0:t.fields[0].values)&&void 0!==r?r:[],i=null===(n=(0,T.S9)(this).getValue())||void 0===n?void 0:n.toString(),l=(0,T.eY)(this).getValue(),o=this.getSelectedTab(),c=function(e,t,n,r){if(!(null==e?void 0:e.length))return[];".+"===n&&(n="");const a=(0,s.eT)(t,r).filter((t=>t.toLowerCase().includes(n.toLowerCase())&&e.includes(t)));return Array.from(new Set([...a,...e]))}(a,i,String(l),o);return{labelsByVolume:a,labelsToQuery:c}}constructor(e){var t;super(ue({body:new i.gF({children:[]}),$variables:new i.Pj({variables:[new H.m({name:l.Du,label:"Service",hide:_.zL.hideVariable,skipUrlSync:!0,value:".+"}),new H.m({name:l.Wi,label:"",hide:_.zL.hideLabel,value:l.OX,skipUrlSync:!0,options:[{value:l.OX,label:l.OX},{value:me,label:me}]}),new i.H9({name:l.Gb,hide:_.zL.hideLabel,expressionBuilder:e=>function(e){if(e.length){const t=e[0];return`${t.key}${t.operator}\`${t.value}\``}return""}(e),filters:[{key:null!==(t=ye().key)&&void 0!==t?t:l.OX,value:".+",operator:"=~"}]})]}),$data:(0,M.HF)({queries:[(0,A.BM)(`{${l.kl}}`,"volume")],runQueriesMode:"manual"}),serviceLevel:new Map,showPopover:!1,tabOptions:[{label:l.ky,value:l.OX}]},e)),de(this,"_urlSync",new i.So(this,{keys:[he]})),de(this,"onSearchServicesChange",(0,P.debounce)((e=>{const t=(0,T.eY)(this);(e?this.wrapWildcardSearch(e):".+")!==t.state.value&&t.setState({value:e?this.wrapWildcardSearch(e):".+",label:null!=e?e:""});const n=(0,T.El)(this),r=n.state.filters[0];this.wrapWildcardSearch(t.state.value.toString())!==r.value&&n.setState({filters:[pe(ue({},r),{value:this.wrapWildcardSearch(t.state.value.toString())})]}),(0,h.EE)(h.NO.service_selection,h.ir.service_selection.search_services_changed,{searchQuery:e})}),500)),de(this,"getLevelFilterForService",(e=>{let t=this.state.serviceLevel.get(e)||[];return 0===t.length?"":` | ${t.map((e=>("logs"===e&&(e=""),`${l.e4}=\`${e}\``))).join(" or ")} `})),de(this,"buildServiceLogsLayout",((e,t)=>{const n=this.getLevelFilterForService(t);return new i.xK({$behaviors:[new i.Gg.K2({sync:L.DashboardCursorSync.Off})],body:i.d0.logs().setHoverHeader(!0).setData((0,M.rS)([(0,A.l)(this.getLogExpression(e,t,n),{maxLines:100,refId:`logs-${t}`})])).setTitle(t).setOption("showTime",!0).setOption("enableLogDetails",!1).build()})})),de(this,"extendTimeSeriesLegendBus",((e,t,n,r)=>{const a=n.onToggleSeriesVisibility;n.onToggleSeriesVisibility=(n,i)=>{var l,s,o;null==a||a(n,i);const c=(0,W.de)(null!==(o=null===(s=r.state.$data)||void 0===s||null===(l=s.state.data)||void 0===l?void 0:l.series)&&void 0!==o?o:[]),d=(0,W.pC)(n,this.state.serviceLevel.get(t),i,c);this.state.serviceLevel.set(t,d),this.updateServiceLogs(e,t)}})),this.addActivationHandler(this.onActivate.bind(this))}}function ye(){const e=Q.locationService.getLocation(),t=new URLSearchParams(e.search),n=t.get(he),r=null==n?void 0:n.split("|");return{key:null==r?void 0:r[0],search:t,location:e}}function Se(e){return{container:(0,d.css)({display:"flex",flexDirection:"column",flexGrow:1,position:"relative"}),headingWrapper:(0,d.css)({marginTop:e.spacing(1)}),loadingText:(0,d.css)({margin:0}),header:(0,d.css)({position:"absolute",right:0,top:"4px",zIndex:2}),bodyWrapper:(0,d.css)({flexGrow:1,display:"flex",flexDirection:"column"}),body:(0,d.css)({flexGrow:1,display:"flex",flexDirection:"column"}),icon:(0,d.css)({color:e.colors.text.disabled,marginLeft:e.spacing.x1}),searchFieldPlaceholderText:(0,d.css)({fontSize:e.typography.bodySmall.fontSize,color:e.colors.text.disabled,alignItems:"center",display:"flex"}),searchWrapper:(0,d.css)({display:"flex",alignItems:"center",flexWrap:"wrap"}),searchField:(0,d.css)({marginTop:e.spacing(1),position:"relative"})}}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}de(be,"Component",(({model:e})=>{var t;const n=(0,c.useStyles2)(Se),{body:r,$data:i,tabs:l}=e.useState(),{data:s}=i.useState(),o=e.getSelectedTab(),d=(0,T.eY)(e),{label:u,value:p}=d.useState(),g=p&&".+"!==p,{labelsByVolume:m,labelsToQuery:v}=e.getLabels(null==s?void 0:s.series),h=(null==s?void 0:s.state)===L.LoadingState.Loading||(null==s?void 0:s.state)===L.LoadingState.Streaming||void 0===s,f=(null===(t=i.state.data)||void 0===t?void 0:t.state)===L.LoadingState.Error;var b;const y=null!==(b=null==v?void 0:v.length)&&void 0!==b?b:0,S=r.state.children.length/2;var w;return a().createElement("div",{className:n.container},a().createElement("div",{className:n.bodyWrapper},l&&a().createElement(l.Component,{model:l}),a().createElement(c.Field,{className:n.searchField},a().createElement("div",{className:n.searchWrapper},a().createElement(z.f,{initialFilter:{label:e.unwrapWildcardSearch(d.getValue().toString()),value:d.getValue().toString(),icon:"filter"},isLoading:h,value:u,onChange:t=>(t=>{e.onSearchServicesChange(t)})(t),selectOption:t=>{$(o,t,e)},label:e.formatPrimaryLabelForUI(),options:null!==(w=null==v?void 0:v.map((e=>({value:e,label:e}))))&&void 0!==w?w:[]}),!h&&a().createElement("span",{className:n.searchFieldPlaceholderText},"Showing ",S," of ",y," ",a().createElement(c.IconButton,{className:n.icon,"aria-label":"Count info",name:"info-circle",tooltip:`${y} labels have values for the selected time range. Total label count may differ`})))),!h&&f&&a().createElement(R,null),!h&&!f&&g&&!(null==m?void 0:m.length)&&a().createElement(V,null),!h&&!f&&!g&&!(null==m?void 0:m.length)&&a().createElement(ce,{labelName:o}),v&&v.length>0&&a().createElement("div",{className:n.body},a().createElement(r.Component,{model:r}))))}));class Oe extends i.Bs{onActivate(){const e={};var t,n;this.state.contentScene||(e.contentScene=(n=null===(t=this.state.routeMatch)||void 0===t?void 0:t.params.breakdownLabel,(0,O.FT)()===O.G3.explore?new be({}):new o.Mn({drillDownLabel:n}))),this.setState(e),this.updatePatterns(this.state,(0,T.Ku)(this)),this.resetVariablesIfNotInUrl((0,T.ir)(this),(0,T.n5)(l.mB)),this.resetVariablesIfNotInUrl((0,T.iw)(this),(0,T.n5)(l._Y)),this._subs.add(this.subscribeToState((e=>{this.updatePatterns(e,(0,T.Ku)(this))})))}resetVariablesIfNotInUrl(e,t){const n=Q.locationService.getLocation();null===new URLSearchParams(n.search).get(t)&&e.setState({filters:[]})}updatePatterns(e,t){var n;const r=(0,A.M3)(null!==(n=e.patterns)&&void 0!==n?n:[]);t.changeValueTo(r)}getUrlState(){return{patterns:JSON.stringify(this.state.patterns)}}updateFromUrl(e){const t={};e.patterns&&"string"==typeof e.patterns&&(t.patterns=JSON.parse(e.patterns)),this.setState(t)}constructor(e){var t;const{variablesScene:n,unsub:r}=function(e,t){const n=[j.w7.Equal,j.w7.NotEqual].map((e=>({label:e,value:e}))),r=new i.H9({name:l.MB,datasource:l.eL,layout:"vertical",label:"Service",filters:null!=t?t:[],expressionBuilder:A.VW,hide:_.zL.hideLabel,key:"adhoc_service_filter"});r._getOperators=function(){return n};const a=new i.H9({name:l.mB,label:"Filters",applyMode:"manual",layout:"vertical",getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),expressionBuilder:A.ZX,hide:_.zL.hideLabel});a._getOperators=()=>n;const o=new i.H9({name:l._P,label:"Metadata",applyMode:"manual",layout:"vertical",getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),expressionBuilder:A.E3,hide:_.zL.hideLabel});o._getOperators=()=>n;const c=new i.H9({name:l._Y,label:"Filters",applyMode:"manual",layout:"vertical",getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),expressionBuilder:A.E3,hide:_.zL.hideLabel});c._getOperators=()=>n;const d=new i.mI({name:l.EY,label:"Data source",value:e,pluginId:"loki"}),u=d.subscribeToState((e=>{const t=`${e.value}`;e.value&&(0,s.ke)(t)}));return{variablesScene:new i.Pj({variables:[d,r,a,c,o,new i.yP({name:l.uw,value:"",hide:_.zL.hideVariable}),new i.yP({name:l.WM,value:"",hide:_.zL.hideVariable}),new H.m({name:l.QE,value:l.YN,skipUrlSync:!0,hide:_.zL.hideVariable,options:[{value:l.YN,label:l.YN}]})]}),unsub:u}}(null!==(t=(0,s.QB)())&&void 0!==t?t:"grafanacloud-logs",e.initialFilters),a=[new i.K8({layout:"vertical"}),new i.N0,new i.KE({}),new i.WM({})];var o,c,d,u,p;"explore"===(0,O.FT)()&&Q.config.featureToggles.exploreLogsAggregatedMetrics&&a.push(new J({isOpen:!1})),super((u=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){we(e,t,n[t])}))}return e}({$timeRange:null!==(o=e.$timeRange)&&void 0!==o?o:new i.JZ({}),$variables:null!==(c=e.$variables)&&void 0!==c?c:n,controls:null!==(d=e.controls)&&void 0!==d?d:a,patterns:[]},e),p=null!=(p={body:new C({})})?p:{},Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(p)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(p)).forEach((function(e){Object.defineProperty(u,e,Object.getOwnPropertyDescriptor(p,e))})),u)),we(this,"_urlSync",new i.So(this,{keys:["patterns"]})),this._subs.add(r),this.addActivationHandler(this.onActivate.bind(this))}}we(Oe,"Component",(({model:e})=>{const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):a().createElement(c.LoadingPlaceholder,{text:"Loading..."})}))},558:(e,t,n)=>{n.d(t,{Of:()=>h,PT:()=>y,Qt:()=>b,XI:()=>f,oR:()=>O});var r=n(5959),a=n.n(r),i=n(7781),l=n(1119),s=n(5435),o=n(2718),c=n(3143),d=n(5218),u=n(6001),p=n(1475),g=n(7097),m=n(4750);function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class h extends i.BusEventBase{constructor(e,t,n){super(),v(this,"operator",void 0),v(this,"key",void 0),v(this,"value",void 0),this.operator=e,this.key=t,this.value=n}}function f(e,t,n){const r="="===e.operator?"include":"exclude";b(e.key,e.value,r,t,n)}function b(e,t,n,r,a){a||(a=w(e,r));const i=(0,m.bY)(S(e,a),r);let l;a===c.mB&&(l=JSON.stringify({value:t,parser:(0,g.Ri)(e,r)}));let o=i.state.filters.filter((n=>{const r=(0,m.z2)(i,n);return!(n.key===e&&r.value===t)}));const d=o.length!==i.state.filters.length;("include"===n||"exclude"===n||!d&&"toggle"===n)&&(o=[...o,{key:e,operator:"exclude"===n?u.w7.NotEqual:u.w7.Equal,value:l||t,valueLabels:[t]}]),r.publishEvent(new h(n,e,t),!0),i.setState({filters:o,hide:s.zL.hideLabel})}function y(e,t,n,r){(0,m.bY)(S(e,w(e,r)),r).setState({filters:[{key:e,operator:"exclude"===n?u.w7.NotEqual:u.w7.Equal,value:t}],hide:s.zL.hideLabel})}function S(e,t){return e===c.e4?c._Y:t}function w(e,t){var n,r;return(null===(r=(0,p.TG)(t))||void 0===r||null===(n=r.fields)||void 0===n?void 0:n.find((t=>t.name===e)))?c.MB:c.mB}v(h,"type","add-filter");class O extends l.Bs{constructor(...e){super(...e),v(this,"onClick",(e=>{const t=x(this.state.frame);if(!t)return;b(t.name,t.value,e,this,this.state.variableName);const n=(0,m.bY)(S(t.name,this.state.variableName),this);(0,o.EE)(o.NO.service_details,o.ir.service_details.add_to_filters_in_breakdown_clicked,{filterType:this.state.variableName,key:t.name,action:e,filtersLength:(null==n?void 0:n.state.filters.length)||0})})),v(this,"isSelected",(()=>{const e=x(this.state.frame);if(!e)return{isIncluded:!1,isExcluded:!1};const t=(0,m.bY)(S(e.name,this.state.variableName),this),n=t.state.filters.find((n=>{const r=(0,m.z2)(t,n);return n.key===e.name&&r.value===e.value}));return n?{isIncluded:n.operator===u.w7.Equal,isExcluded:n.operator===u.w7.NotEqual}:{isIncluded:!1,isExcluded:!1}}))}}v(O,"Component",(({model:e})=>{const{isIncluded:t,isExcluded:n}=e.isSelected();return a().createElement(d.F,{buttonFill:"outline",isIncluded:t,isExcluded:n,onInclude:()=>e.onClick("include"),onClear:()=>e.onClick("clear"),onExclude:()=>e.onClick("exclude")})}));const x=e=>{var t,n;const r=null!==(n=null===(t=e.fields[1])||void 0===t?void 0:t.labels)&&void 0!==n?n:{};if(1!==Object.keys(r).length)return;const a=Object.keys(r)[0];return{name:a,value:r[a]}}},1022:(e,t,n)=>{n.d(t,{G:()=>f,x:()=>v});var r=n(1119),a=n(5959),i=n.n(a),l=n(5631),s=n(6261),o=n(8810),c=n(4105),d=n(7781),u=n(3630),p=n(4836),g=n(2871);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class v extends d.BusEventBase{}m(v,"type","breakdown-search-reset");const h={};class f extends r.Bs{filterValues(e){if(this.parent instanceof o.O||this.parent instanceof c.J6){h[this.cacheKey]=e;const n=this.parent.state.body;var t;n instanceof u.u||n instanceof p.u?null===(t=n.state.body)||void 0===t||t.forEachChild((t=>{t instanceof l.h&&t.state.body.isActive&&t.filterByString(e)})):g.v.warn("invalid parent for search",{typeofBody:typeof n,filter:e})}}constructor(e){var t;super({filter:null!==(t=h[e])&&void 0!==t?t:""}),m(this,"cacheKey",void 0),m(this,"onValueFilterChange",(e=>{this.setState({filter:e.target.value}),this.filterValues(e.target.value)})),m(this,"clearValueFilter",(()=>{this.setState({filter:""}),this.filterValues("")})),m(this,"reset",(()=>{this.setState({filter:""}),h[this.cacheKey]=""})),this.cacheKey=e}}m(f,"Component",(({model:e})=>{const{filter:t}=e.useState();return i().createElement(s.D,{value:t,onChange:e.onValueFilterChange,onClear:e.clearValueFilter,placeholder:"Search for value"})}))},5631:(e,t,n)=>{n.d(t,{h:()=>m});var r=n(5959),a=n.n(r),i=n(7781),l=n(1119),s=n(5722),o=n(4932),c=n(4144),d=n(2007),u=n(6089),p=n(1022);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class m extends l.Bs{performRepeat(e){const t=[],n=(0,s.sortSeries)(e.series,this.sortBy,this.direction);for(let e=0;e<n.length;e++){const r=this.state.getLayoutChild(n[e],e);t.push(r)}this.sortedSeries=n,this.unfilteredChildren=t,this.getFilter()?(this.state.body.setState({children:[]}),this.filterByString(this.getFilter())):this.state.body.setState({children:t})}constructor(e){var{sortBy:t,direction:n,getFilter:r}=e;super(function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(e,["sortBy","direction","getFilter"])),g(this,"unfilteredChildren",[]),g(this,"sortBy",void 0),g(this,"direction",void 0),g(this,"sortedSeries",[]),g(this,"getFilter",void 0),g(this,"sort",((e,t)=>{const n=l.jh.getData(this);this.sortBy=e,this.direction=t,n.state.data&&this.performRepeat(n.state.data)})),g(this,"iterateFrames",(e=>{if(l.jh.getData(this).state.data)for(let t=0;t<this.sortedSeries.length;t++)e(this.sortedSeries,t)})),g(this,"filterByString",(e=>{let t=[];this.iterateFrames(((e,n)=>{const r=(0,c.ee)(e[n]);t.push(r)})),(0,o.X)(t,e,(e=>{e&&e[0]?this.filterFrames((t=>{const n=(0,c.ee)(t);return e[0].includes(n)})):this.filterFrames((()=>!0))}))})),g(this,"filterFrames",(e=>{const t=[];var n,r;this.iterateFrames(((n,r)=>{e(n[r])&&t.push(this.unfilteredChildren[r])})),0===t.length?this.state.body.setState({children:[(n=this.getFilter(),r=this.clearFilter,new l.G1({direction:"row",children:[new l.vA({body:new l.dM({reactNode:a().createElement("div",{className:v.alertContainer},a().createElement(d.Alert,{title:"",severity:"info",className:v.noResultsAlert},"No values found matching “",n,"”",a().createElement(d.Button,{className:v.clearButton,onClick:r},"Clear filter")))})})]}))]}):this.state.body.setState({children:t})})),g(this,"clearFilter",(()=>{this.publishEvent(new p.x,!0)})),this.sortBy=t,this.direction=n,this.getFilter=r,this.addActivationHandler((()=>{const e=l.jh.getData(this);this._subs.add(e.subscribeToState(((e,t)=>{var n,r,a,l;((null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done||(null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Streaming&&e.data.series.length>(null!==(l=null===(a=t.data)||void 0===a?void 0:a.series.length)&&void 0!==l?l:0))&&this.performRepeat(e.data)}))),e.state.data&&this.performRepeat(e.state.data)}))}}g(m,"Component",(({model:e})=>{const{body:t}=e.useState();return a().createElement(t.Component,{model:t})}));const v={alertContainer:(0,u.css)({flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"}),noResultsAlert:(0,u.css)({minWidth:"30vw",flexGrow:0}),clearButton:(0,u.css)({marginLeft:"1.5rem"})}},3782:(e,t,n)=>{n.d(t,{a:()=>c});var r=n(1119),a=n(4482),i=n(2007),l=n(5959),s=n.n(l),o=n(4105);class c extends r.Bs{static Component({model:e}){const{type:t}=e.useState();return s().createElement(a.R,null,s().createElement(i.Alert,{title:"",severity:"warning"},"We did not find any ",t," for the given timerange. Please"," ",s().createElement("a",{className:o.ZI.link,href:"https://forms.gle/1sYWCTPvD72T1dPH9",target:"_blank",rel:"noopener noreferrer"},"let us know")," ","if you think this is a mistake."))}}},4462:(e,t,n)=>{n.d(t,{f:()=>d,u:()=>c});var r=n(6089),a=n(5959),i=n.n(a),l=n(2007),s=n(1220);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c({options:e,value:t,onChange:n,label:r}){const s=(0,l.useStyles2)(u),[o,c]=(0,a.useState)(!1),d=e.map((e=>({label:e.label,value:e.value})));return i().createElement(l.InlineField,{label:r},i().createElement(l.Select,{options:d,value:t,onOpenMenu:()=>c(!0),onCloseMenu:()=>c(!1),onChange:e=>n(e.value),className:s.select,prefix:o?void 0:i().createElement(l.Icon,{name:"search"})}))}function d({options:e,value:t,onChange:n,label:r,selectOption:c,isLoading:d,initialFilter:p}){var g;const m=(0,l.useStyles2)(u),[v,h]=(0,a.useState)(!1),[f,b]=(0,a.useState)(p),y=e.map((e=>({label:e.label,value:e.value}))),S=f&&t&&(null===(g=f.value)||void 0===g?void 0:g.includes(t))?[f,...y]:y,w=null==S?void 0:S.find((e=>e.value===t));return i().createElement(l.InlineField,{className:m.selectWrapper,grow:!0,label:r},i().createElement(l.Select,{isLoading:d,"data-testid":s.b.exploreServiceSearch.search,placeholder:"Search values",options:S,isClearable:!0,value:t,onOpenMenu:()=>h(!0),onCloseMenu:()=>h(!1),allowCustomValue:!0,prefix:v||(null==w?void 0:w.__isNew__)?void 0:i().createElement(l.Icon,{name:"search"}),onChange:(e,t)=>{return(null==e?void 0:e.__isNew__)||(null==e?void 0:e.icon)?(b((r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}({},e),a=null!=(a={icon:"filter"})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(a)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(a,e))})),r)),n(e.value)):"clear"===t.action?n(""):void("select-option"===t.action&&e.value&&!e.__isNew__&&c(e.value));var r,a},onInputChange:(e,t)=>{const r=t;return"input-change"===r.action?n(e):"menu-close"===r.action&&r.prevInputValue?(b({value:r.prevInputValue,label:r.prevInputValue,icon:"filter",__isNew__:!0}),n(r.prevInputValue)):void 0}}))}function u(e){return{input:(0,r.css)({marginBottom:0}),select:(0,r.css)({maxWidth:e.spacing(64),minWidth:e.spacing(20)}),selectWrapper:(0,r.css)({maxWidth:e.spacing(62.5),minWidth:e.spacing(20),marginRight:e.spacing.x1,marginBottom:0})}}},4836:(e,t,n)=>{n.d(t,{u:()=>F});var r,a,i,l=n(1119),s=n(7918),o=n(227),c=n(7781),d=n(738),u=n(5183),p=n(5631),g=n(2007),m=n(7097),v=n(4144),h=n(3143),f=n(5959),b=n.n(f),y=n(4105),S=n(558),w=n(8835),O=n(892),x=n(1475),E=n(5722),C=n(4750);class F extends l.Bs{static Selector({model:e}){const{body:t}=e.useState();return t instanceof d.U?b().createElement(b().Fragment,null,t&&b().createElement(t.Selector,{model:t})):b().createElement(b().Fragment,null)}onActivate(){var e;const t=(0,C.Hj)(this),n=String(t.state.value),r=(0,C.ir)(this),a=(0,x.rD)(this),i=(0,m.Jl)(n,r,a),l=(0,s.l)(i,{legendFormat:`{{${n}}}`,refId:n});this.setState({body:this.build(l),$data:(0,u.rS)([l])}),this._subs.add(this.subscribeToEvent(S.Of,(e=>{this.setState({lastFilterEvent:e})}))),this._subs.add(null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState((e=>{this.onValuesDataQueryChange(e,l)})))}onValuesDataQueryChange(e,t){var n,r;if((null===(n=e.data)||void 0===n?void 0:n.state)===c.LoadingState.Done){var a;const n=this.state.lastFilterEvent;(null===(a=e.data)||void 0===a?void 0:a.state)===c.LoadingState.Done&&n&&("exclude"===n.operator&&e.data.series.length<1&&this.navigateToFields(),"include"===n.operator&&e.data.series.length<=1&&this.navigateToFields()),this.state.body instanceof l.dM&&this.setState({body:this.build(t)})}(null===(r=e.data)||void 0===r?void 0:r.state)===c.LoadingState.Error&&this.setErrorState(e.data.errors)}setErrorState(e){this.setState({body:new l.dM({reactNode:b().createElement(g.Alert,{title:"Something went wrong with your request",severity:"error"},null==e?void 0:e.map(((e,t)=>b().createElement("div",{key:t},e.status&&b().createElement(b().Fragment,null,b().createElement("strong",null,"Status"),": ",e.status," ",b().createElement("br",null)),e.message&&b().createElement(b().Fragment,null,b().createElement("strong",null,"Message"),": ",e.message," ",b().createElement("br",null)),e.traceId&&b().createElement(b().Fragment,null,b().createElement("strong",null,"TraceId"),": ",e.traceId)))))})})}navigateToFields(){this.setState({lastFilterEvent:void 0}),(0,w.Vt)(O.G3.fields,l.jh.getAncestor(this,x.Mn))}build(e){const t=(0,C.Hj)(this),n=String(t.state.value),{sortBy:r,direction:a}=(0,o.vs)("fields",E.DEFAULT_SORT_BY,"desc"),i=l.jh.getAncestor(this,y.J6),s=()=>{var e;return null!==(e=i.state.search.state.filter)&&void 0!==e?e:""},c=(0,m.Ri)(n,this);return new d.U({options:[{value:"single",label:"Single"},{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new l.G1({direction:"column",children:[new l.vA({minHeight:300,body:l.d0.timeseries().setTitle(n).build()})]}),new p.h({body:new l.gF({templateColumns:y.OK,autoRows:"200px",children:[new l.vA({body:new l.dM({reactNode:b().createElement(g.LoadingPlaceholder,{text:"Loading..."})})})],isLazy:!0}),getLayoutChild:(0,m.Zp)(v.ee,(null==e?void 0:e.expr.includes("count_over_time"))?g.DrawStyle.Bars:g.DrawStyle.Line,"structuredMetadata"===c?h._P:h.mB,l.jh.getAncestor(this,y.J6).state.sort),sortBy:r,direction:a,getFilter:s}),new p.h({body:new l.gF({templateColumns:"1fr",autoRows:"200px",children:[new l.vA({body:new l.dM({reactNode:b().createElement(g.LoadingPlaceholder,{text:"Loading..."})})})],isLazy:!0}),getLayoutChild:(0,m.Zp)(v.ee,(null==e?void 0:e.expr.includes("count_over_time"))?g.DrawStyle.Bars:g.DrawStyle.Line,"structuredMetadata"===c?h._P:h.mB,l.jh.getAncestor(this,y.J6).state.sort),sortBy:r,direction:a,getFilter:s})]})}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}i=({model:e})=>{const{body:t}=e.useState();return t?b().createElement(b().Fragment,null,t&&b().createElement(t.Component,{model:t})):b().createElement(g.LoadingPlaceholder,{text:"Loading..."})},(a="Component")in(r=F)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i},3102:(e,t,n)=>{n.d(t,{E:()=>O,R:()=>x});var r=n(1119),a=n(3143),i=n(7918),l=n(5183),s=n(2007),o=n(738),c=n(4105),d=n(1475),u=n(5959),p=n.n(u),g=n(8921),m=n(892),v=n(833),h=n(7781),f=n(5952),b=n(1269),y=n(7097),S=n(4750);function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class O extends r.Bs{sortChildren(e){return(t,n)=>{const r=t.state.body,a=n.state.body;var i;const l=null!==(i=e.get(r.state.title))&&void 0!==i?i:0;var s;return(null!==(s=e.get(a.state.title))&&void 0!==s?s:0)-l}}calculateCardinalityMap(e){const t=(0,d.UO)(e),n=new Map;if(null==t?void 0:t.length)for(let e=0;e<(null==t?void 0:t.length);e++){const r=t.fields[0].values[e],a=t.fields[1].values[e];n.set(r,a)}return n}onActivate(){var e;this.setState({body:this.build()});const t=r.jh.getAncestor(this,d.Mn);void 0===t.state.fieldsCount&&this.updateFieldCount(),this._subs.add(null===(e=t.state.$detectedFieldsData)||void 0===e?void 0:e.subscribeToState(this.onDetectedFieldsChange))}build(){var e;const t=(0,S.Hj)(this).state.options.map((e=>({label:e.label,value:String(e.value)})));r.jh.getAncestor(this,c.J6).state.search.reset();const n=this.buildChildren(t),a=r.jh.getAncestor(this,d.Mn),i=this.calculateCardinalityMap(null===(e=a.state.$detectedFieldsData)||void 0===e?void 0:e.state);n.sort(this.sortChildren(i));const l=n.map((e=>e.clone()));return[...n,...l].map((e=>{(0,f.qw)(e),this.subscribeToPanel(e)})),new o.U({options:[{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new r.gF({templateColumns:c.OK,autoRows:"200px",children:n,isLazy:!0}),new r.gF({templateColumns:"1fr",autoRows:"200px",children:l,isLazy:!0})]})}subscribeToPanel(e){const t=e.state.body;var n;t&&this._subs.add(null==t||null===(n=t.state.$data)||void 0===n?void 0:n.getResultsStream().subscribe((t=>{t.data.errors&&t.data.errors.length>0&&(e.setState({isHidden:!0}),this.updateFieldCount())})))}buildChildren(e){const t=[],n=(0,d.rD)(this),o=(0,S.ir)(this);for(const c of e){const{value:e}=c;if(e===a.To||!e)continue;const d=(0,y.Jl)(e,o,n),u=(0,i.l)(d,{legendFormat:(0,y.JI)(e)?e:`{{${e}}}`,refId:e}),p=(0,l.rS)([u]),v=new r.Es({$data:p,transformations:[()=>x(f.lq)]});let h=r.d0.timeseries().setTitle(e).setData(v);h=(0,y.JI)(e)?h.setHeaderActions(new g.X({labelName:String(e),hideValueDrilldown:!0,fieldType:m._J.field})):h.setHeaderActions(new g.X({labelName:String(e),fieldType:m._J.field})).setCustomFieldConfig("stacking",{mode:s.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",s.DrawStyle.Bars).setOverrides(l.jC);const b=h.build(),S=new r.xK({body:b});t.push(S)}return t}updateFieldCount(){var e,t,n,a,i;const l=null!==(i=null===(e=this.state.body)||void 0===e?void 0:e.state.layouts.find((e=>e.isActive)))&&void 0!==i?i:null===(t=this.state.body)||void 0===t?void 0:t.state.layouts[0],s=null==l?void 0:l.state.children,o=null==s?void 0:s.filter((e=>!e.state.isHidden));var d;null===(n=(a=r.jh.getAncestor(this,c.J6).state).changeFieldCount)||void 0===n||n.call(a,null!==(d=null==o?void 0:o.length)&&void 0!==d?d:0)}static Selector({model:e}){const{body:t}=e.useState();return p().createElement(p().Fragment,null,t&&p().createElement(t.Selector,{model:t}))}constructor(e){super(e),w(this,"onDetectedFieldsChange",((e,t)=>{var n;const r=(0,d.nU)(e),a=(0,d.nU)(t);if((null===(n=e.data)||void 0===n?void 0:n.state)===h.LoadingState.Done&&!(0,v.B)(null==r?void 0:r.values,null==a?void 0:a.values)){var i;const t=this.calculateCardinalityMap(e);null===(i=this.state.body)||void 0===i||i.state.layouts.forEach((e=>{const n=e,a=new Set(null==r?void 0:r.values),i=n.state.children;for(let e=0;e<i.length;e++){const t=n.state.children[e].state.body;a.has(t.state.title)?a.delete(t.state.title):(i.splice(e,1),e--)}const l=Array.from(a).map((e=>({label:e,value:e})));i.push(...this.buildChildren(l)),i.sort(this.sortChildren(t)),i.map((e=>{(0,f.qw)(e),this.subscribeToPanel(e)})),n.setState({children:i})}))}})),this.addActivationHandler(this.onActivate.bind(this))}}function x(e){return t=>t.pipe((0,b.map)((t=>t.slice(0,e))))}w(O,"Component",(({model:e})=>{const{body:t}=e.useState();return t?p().createElement(p().Fragment,null,t&&p().createElement(t.Component,{model:t})):p().createElement(s.LoadingPlaceholder,{text:"Loading..."})}))},4105:(e,t,n)=>{n.d(t,{J6:()=>$,OK:()=>D,ZI:()=>N,fx:()=>T});var r=n(6089),a=n(5959),i=n.n(a),l=n(7781),s=n(1119),o=n(2007),c=n(2718),d=n(227),u=n(3143),p=n(833),g=n(5431),m=n(8835),v=n(892),h=n(5722),f=n(4482),b=n(7311),y=n(1475),S=n(1022),w=n(5631),O=n(3102),x=n(4462),E=n(4836),C=n(738),F=n(4144),j=n(9570),P=n(6001),L=n(3782),_=n(4750);function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const T=["duration","count","total","bytes"],D="repeat(auto-fit, minmax(400px, 1fr))";class $ extends s.Bs{onActivate(){var e,t,n;const r=(0,_.Hj)(this),a=s.jh.getAncestor(this,y.Mn);this.setState({loading:(null===(t=a.state.$detectedLabelsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)!==l.LoadingState.Done}),this._subs.add(this.subscribeToEvent(S.x,(()=>{this.state.search.clearValueFilter()}))),this._subs.add(this.subscribeToEvent(F.gf,this.handleSortByChange)),this._subs.add(r.subscribeToState(this.variableChanged)),this._subs.add((0,_.cR)(this).subscribeToState(((e,t)=>{const n=(0,_.Hj)(this);let{labelName:r}=(0,v.W6)();const a=e.filters.find((e=>e.key===r)),i=t.filters.find((e=>e.key===r));n.state.value===u.To&&a!==i&&this.setState({loading:!0,body:void 0})}))),this._subs.add(null===(n=a.state.$detectedFieldsData)||void 0===n?void 0:n.subscribeToState(((e,t)=>{var n,r,a;(null===(n=e.data)||void 0===n?void 0:n.state)===l.LoadingState.Done&&(null===(r=e.data.series)||void 0===r?void 0:r[0])&&this.updateOptions(null===(a=e.data.series)||void 0===a?void 0:a[0])})));const i=(0,y.rD)(this);i&&this.updateOptions(i),(0,v.NX)(this)}updateOptions(e){if(!e||!e.length){const e=s.jh.getAncestor(this,b.P),r=this.getVariablesThatCanBeCleared(e);let a;var t,n;return r.length>1?(null===(t=(n=this.state).changeFieldCount)||void 0===t||t.call(n,0),a=this.buildClearFiltersLayout((()=>this.clearVariables(r)))):a=new L.a({type:"fields"}),void this.setState({loading:!1,body:a})}const r=s.jh.getAncestor(this,y.Mn);var a;(0,_.Hj)(this).setState({options:(0,P.rd)(e.fields[0].values.map((e=>String(e)))),loading:!1,value:null!==(a=r.state.drillDownLabel)&&void 0!==a?a:u.To}),this.setState({loading:!1})}updateBody(e){const t=(0,_.Hj)(this);if(!t.state.options||!t.state.options.length)return;const n={};if(t.state.options&&t.state.options.length<=1){const e=s.jh.getAncestor(this,b.P),t=this.getVariablesThatCanBeCleared(e);var r,a;t.length>1?(null===(r=(a=this.state).changeFieldCount)||void 0===r||r.call(a,0),n.body=this.buildClearFiltersLayout((()=>this.clearVariables(t)))):n.body=new L.a({type:"fields"})}else e.value===u.To&&this.state.body instanceof E.u?n.body=new O.E({}):e.value!==u.To&&this.state.body instanceof O.E?n.body=new E.u({}):(void 0===this.state.body||this.state.body instanceof L.a||this.state.body instanceof s.dM)&&(n.body=e.value===u.To?new O.E({}):new E.u({}));this.setState(n)}getVariablesThatCanBeCleared(e){const t=s.jh.getVariables(e);let n=[];for(const e of t.state.variables)e instanceof s.H9&&e.state.filters.length&&n.push(e),e instanceof g.m&&e.state.value&&"logsFormat"!==e.state.name&&n.push(e);return n}buildClearFiltersLayout(e){return new s.dM({reactNode:i().createElement(f.R,null,i().createElement(o.Alert,{title:"",severity:"info"},"No labels match these filters."," ",i().createElement(o.Button,{className:N.button,onClick:()=>e()},"Clear filters")," "))})}constructor(e){var t,n,r,a;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){k(e,t,n[t])}))}return e}({$variables:null!==(r=e.$variables)&&void 0!==r?r:new s.Pj({variables:[new g.m({name:u.LI,defaultToAll:!1,includeAll:!0,value:null!==(t=e.value)&&void 0!==t?t:u.To,options:null!==(n=e.options)&&void 0!==n?n:[]})]}),loading:!0,sort:new F.wd({target:"fields"}),search:new S.G("fields"),value:null!==(a=e.value)&&void 0!==a?a:u.To},e)),k(this,"_variableDependency",new s.Sh(this,{variableNames:[u.MB]})),k(this,"variableChanged",((e,t)=>{(e.value!==t.value||!(0,p.B)(e.options,t.options)||void 0===this.state.body||this.state.body instanceof L.a||this.state.body instanceof s.dM)&&this.updateBody(e)})),k(this,"handleSortByChange",(e=>{var t;"fields"===e.target&&(this.state.body instanceof E.u&&this.state.body.state.body instanceof C.U&&(null===(t=this.state.body.state.body)||void 0===t||t.state.layouts.forEach((t=>{t instanceof w.h&&t.sort(e.sortBy,e.direction)}))),(0,c.EE)(c.NO.service_details,c.ir.service_details.value_breakdown_sort_change,{target:"fields",criteria:e.sortBy,direction:e.direction}))})),k(this,"clearVariables",(e=>{s.jh.getAncestor(this,b.P).setState({patterns:[]}),e.forEach((e=>{if(e instanceof s.H9&&"adhoc_service_filter"===e.state.key){let{labelName:t}=(0,v.W6)();t===u.ky&&(t=u.OX),e.setState({filters:e.state.filters.filter((e=>e.key===t))})}else e instanceof s.H9?e.setState({filters:[]}):e instanceof g.m&&e.setState({value:"",text:""})}))})),k(this,"onFieldSelectorChange",(e=>{if(!e)return;const t=(0,_.Hj)(this),{sortBy:n,direction:r}=(0,d.vs)("fields",h.DEFAULT_SORT_BY,"desc");(0,c.EE)(c.NO.service_details,c.ir.service_details.select_field_in_breakdown_clicked,{field:e,previousField:t.getValueText(),view:"fields",sortBy:n,sortByDirection:r});const a=s.jh.getAncestor(this,y.Mn);(0,m.fg)(v._J.field,e,a)})),this.addActivationHandler(this.onActivate.bind(this))}}k($,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r,search:a,sort:l}=e.useState(),s=(0,_.Hj)(e),{options:c,value:d}=s.useState(),p=(0,o.useStyles2)(I);return i().createElement("div",{className:p.container},i().createElement(j.O,{isLoading:n,blockingMessage:r},i().createElement("div",{className:p.controls},t instanceof O.E&&i().createElement(O.E.Selector,{model:t}),t instanceof E.u&&i().createElement(E.u.Selector,{model:t}),!n&&d!==u.To&&i().createElement(i().Fragment,null,i().createElement(l.Component,{model:l}),i().createElement(a.Component,{model:a})),!n&&c.length>1&&i().createElement(x.u,{label:"Field",options:c,value:String(d),onChange:e.onFieldSelectorChange})),i().createElement("div",{className:p.content},t&&i().createElement(t.Component,{model:t}))))}));const N={link:(0,r.css)({textDecoration:"underline"}),button:(0,r.css)({marginLeft:"1.5rem"})};function I(e){return{container:(0,r.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column"}),content:(0,r.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),controls:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",justifyContent:"space-between",flexDirection:"row-reverse",gap:e.spacing(2)})}}},8810:(e,t,n)=>{n.d(t,{O:()=>A});var r=n(6089),a=n(5959),i=n.n(a),l=n(7781),s=n(1119),o=n(2007),c=n(2718),d=n(892),u=n(3143),p=n(5631),g=n(4462),m=n(9570),v=n(6001),h=n(1022),f=n(227),b=n(4144),y=n(1475),S=n(5431),w=n(8835),O=n(833),x=n(3630),E=n(738),C=n(5183),F=n(8921),j=n(5952),P=n(3102),L=n(4119),_=n(4750);function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class T extends s.Bs{onActivate(){var e;const t=(0,_.ir)(this),n=s.jh.getAncestor(this,y.Mn).state.$detectedLabelsData;this.state.body?(null==n||null===(e=n.state.data)||void 0===e?void 0:e.state)===l.LoadingState.Done&&this.update(null==n?void 0:n.state.data.series[0]):this.setState({body:this.build()}),this._subs.add(null==n?void 0:n.subscribeToState(((e,t)=>{var n;(null===(n=e.data)||void 0===n?void 0:n.state)===l.LoadingState.Done&&this.update(e.data.series[0])}))),this._subs.add(t.subscribeToState((()=>{this.updateQueriesOnFieldsVariableChange()})))}getPanelByIndex(e,t){const n=e.state.children[t].state.body;return{panel:n,title:n.state.title}}update(e){var t;const n=(0,_.P4)(this).state.options.filter((e=>e.value!==u.To)).map((e=>e.label));null===(t=this.state.body)||void 0===t||t.state.layouts.forEach((t=>{let r=[];const a=t,i=new Set(n),l=a.state.children;for(let e=0;e<l.length;e++){const{title:t}=this.getPanelByIndex(a,e);i.has(t)?i.delete(t):(l.splice(e,1),e--),r.push(t)}const s=Array.from(i).map((e=>({label:e,value:e})));l.push(...this.buildChildren(s));const o=this.calculateCardinalityMap(e);l.sort(this.sortChildren(o)),l.map((e=>{(0,j.qw)(e)})),a.setState({children:l})}))}calculateCardinalityMap(e){const t=new Map;if(null==e?void 0:e.length)for(let n=0;n<(null==e?void 0:e.fields.length);n++){const r=e.fields[n].name,a=e.fields[n].values[0];t.set(r,a)}return t}build(){var e;const t=(0,_.P4)(this);s.jh.getAncestor(this,A).state.search.reset();const n=this.buildChildren(t.state.options),r=s.jh.getAncestor(this,y.Mn).state.$detectedLabelsData;if((null==r||null===(e=r.state.data)||void 0===e?void 0:e.state)===l.LoadingState.Done){const e=this.calculateCardinalityMap(null==r?void 0:r.state.data.series[0]);n.sort(this.sortChildren(e))}const a=n.map((e=>e.clone()));return[...n,...a].map((e=>{(0,j.qw)(e)})),new E.U({options:[{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new s.gF({isLazy:!0,templateColumns:L.di,autoRows:"200px",children:n}),new s.gF({isLazy:!0,templateColumns:"1fr",autoRows:"200px",children:a})]})}buildChildren(e){const t=[];for(const n of e){const{value:e}=n,r=String(e);if(e===u.To||!e)continue;const a=(0,L.oj)(this,String(n.value),String(n.value)),i=this.getDataTransformer(a);t.push(new s.xK({body:s.d0.timeseries().setTitle(r).setData(i).setHeaderActions(new F.X({labelName:r,fieldType:d._J.label})).setCustomFieldConfig("stacking",{mode:o.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",o.DrawStyle.Bars).setOverrides(C.jC).build()}))}return t}sortChildren(e){return(t,n)=>{const r=t.state.body,a=n.state.body;if(r.state.title===u.e4)return-1;if(a.state.title===u.e4)return 1;var i;const l=null!==(i=e.get(r.state.title))&&void 0!==i?i:0;var s;return(null!==(s=e.get(a.state.title))&&void 0!==s?s:0)-l}}getDataTransformer(e){const t=(0,C.rS)([e]);return new s.Es({$data:t,transformations:[()=>(0,P.R)(j.lq)]})}static Selector({model:e}){const{body:t}=e.useState();return i().createElement(i().Fragment,null,t&&i().createElement(t.Selector,{model:t}))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){k(e,t,n[t])}))}return e}({},e)),k(this,"updateQueriesOnFieldsVariableChange",(()=>{var e;null===(e=this.state.body)||void 0===e||e.state.layouts.forEach((e=>{const t=e;for(let e=0;e<t.state.children.length;e++){const{panel:a,title:i}=this.getPanelByIndex(t,e),l=a.state.$data,o=(0,L.oj)(this,i,i);var n,r;if(l instanceof s.dt&&o.expr===(null==l||null===(r=l.state.queries)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.expr))break;a.setState({$data:this.getDataTransformer(o)})}}))})),this.addActivationHandler(this.onActivate.bind(this))}}k(T,"Component",(({model:e})=>{const{body:t}=e.useState();return t?i().createElement(i().Fragment,null,t&&i().createElement(t.Component,{model:t})):i().createElement(o.LoadingPlaceholder,{text:"Loading..."})}));var D=n(5722),$=n(3782);function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){N(e,t,n[t])}))}return e}class A extends s.Bs{onActivate(){var e,t,n,r,a;const i=s.jh.getAncestor(this,y.Mn),o=(0,_.P4)(this);this.setState({loading:(null===(t=i.state.$detectedLabelsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)!==l.LoadingState.Done,error:(null===(r=i.state.$detectedLabelsData)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.state)===l.LoadingState.Error}),this._subs.add(this.subscribeToEvent(h.x,(()=>{this.state.search.clearValueFilter()}))),this._subs.add(this.subscribeToEvent(b.gf,this.handleSortByChange)),this._subs.add(null===(a=i.state.$detectedLabelsData)||void 0===a?void 0:a.subscribeToState(this.onDetectedLabelsDataChange)),this._subs.add((0,_.cR)(this).subscribeToState(((e,t)=>{this.onLabelsVariableChange(e,t)}))),this._subs.add(o.subscribeToState(((e,t)=>{this.onGroupByVariableChange(e,t)})));const c=(0,y.TG)(this);c&&this.updateOptions(c),(0,d.NX)(this)}onGroupByVariableChange(e,t){(e.value!==t.value||!(0,O.B)(e.options,t.options)||void 0===this.state.body||this.state.body instanceof $.a)&&this.updateBody()}onLabelsVariableChange(e,t){let{labelName:n}=(0,d.W6)();n===u.ky&&(n=u.OX);const r=(0,_.P4)(this),a=e.filters.find((e=>e.key===n)),i=t.filters.find((e=>e.key===n));r.state.value===u.To&&a!==i&&this.setState({loading:!0,body:void 0,error:void 0})}updateOptions(e){if(!e||!e.length)return void this.setState({loading:!1,body:new $.a({type:"labels"})});const t=(0,_.P4)(this),n=(0,v.dD)(e.fields.map((e=>e.name)));var r;t.setState({loading:!1,options:n,value:null!==(r=this.state.value)&&void 0!==r?r:u.To})}updateBody(){const e=(0,_.P4)(this);if(!e.state.options||!e.state.options.length)return;const t={loading:!1,blockingMessage:void 0,error:!1};e.hasAllValue()&&this.state.body instanceof x.u?t.body=new T({}):!e.hasAllValue()&&this.state.body instanceof T?t.body=new x.u({}):void 0===this.state.body?e.state.options.length>0?t.body=e.hasAllValue()?new T({}):new x.u({}):t.body=new $.a({type:"labels"}):this.state.body instanceof $.a&&e.state.options.length>0&&(t.body=e.hasAllValue()?new T({}):new x.u({})),this.setState(I({},t))}constructor(e){var t,n,r,a,i;super((a=I({},e),i=null!=(i={$variables:null!==(r=e.$variables)&&void 0!==r?r:new s.Pj({variables:[new S.m({name:u.Jg,defaultToAll:!1,includeAll:!0,value:null!==(t=e.value)&&void 0!==t?t:u.To,options:null!==(n=e.options)&&void 0!==n?n:[]})]}),loading:!0,sort:new b.wd({target:"labels"}),search:new h.G("labels"),value:e.value})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(i)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))})),a)),N(this,"_variableDependency",new s.Sh(this,{variableNames:[u.MB]})),N(this,"onDetectedLabelsDataChange",((e,t)=>{var n,r,a,i,s,o,c,d,u;(null===(n=e.data)||void 0===n?void 0:n.state)===l.LoadingState.Done&&(null===(r=e.data.series)||void 0===r?void 0:r[0])&&!(0,O.B)(null===(i=e.data.series)||void 0===i||null===(a=i[0])||void 0===a?void 0:a.fields,null===(c=t.data)||void 0===c||null===(o=c.series)||void 0===o||null===(s=o[0])||void 0===s?void 0:s.fields)?this.updateOptions(null===(u=e.data.series)||void 0===u?void 0:u[0]):(null===(d=e.data)||void 0===d?void 0:d.state)===l.LoadingState.Done&&(0,_.P4)(this).setState({loading:!1})})),N(this,"handleSortByChange",(e=>{var t,n;"labels"===e.target&&(this.state.body instanceof x.u&&(null===(n=this.state.body)||void 0===n||null===(t=n.state.body)||void 0===t||t.state.layouts.forEach((t=>{t instanceof p.h&&t.sort(e.sortBy,e.direction)}))),(0,c.EE)(c.NO.service_details,c.ir.service_details.value_breakdown_sort_change,{target:"labels",criteria:e.sortBy,direction:e.direction}))})),N(this,"onChange",(e=>{if(!e)return;const t=(0,_.P4)(this);t.changeValueTo(e);const{sortBy:n,direction:r}=(0,f.vs)("labels",D.DEFAULT_SORT_BY,"desc");(0,c.EE)(c.NO.service_details,c.ir.service_details.select_field_in_breakdown_clicked,{label:e,previousLabel:t.getValueText(),view:"labels",sortBy:n,sortByDirection:r});const a=s.jh.getAncestor(this,y.Mn);(0,w.fg)(d._J.label,e,a)})),this.addActivationHandler(this.onActivate.bind(this))}}function M(e){return{container:(0,r.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column"}),content:(0,r.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),controls:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",justifyContent:"space-between",flexDirection:"row-reverse",gap:e.spacing(2)})}}N(A,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r,error:a,search:l,sort:s}=e.useState(),c=(0,_.P4)(e),{options:d,value:p}=c.useState(),v=(0,o.useStyles2)(M);return i().createElement("div",{className:v.container},i().createElement(m.O,{isLoading:n,blockingMessage:r},i().createElement("div",{className:v.controls},t instanceof x.u&&i().createElement(x.u.Selector,{model:t}),t instanceof T&&i().createElement(T.Selector,{model:t}),!n&&p!==u.To&&i().createElement(i().Fragment,null,i().createElement(s.Component,{model:s}),i().createElement(l.Component,{model:l})),!n&&d.length>0&&i().createElement(g.u,{label:"Label",options:d,value:String(p),onChange:e.onChange})),a&&i().createElement(o.Alert,{title:"",severity:"warning"},"The labels are not available at this moment. Try using a different time range or check again later."),i().createElement("div",{className:v.content},t&&i().createElement(t.Component,{model:t}))))}))},3630:(e,t,n)=>{n.d(t,{u:()=>j});var r=n(1119),a=n(738),i=n(4144),l=n(2007),s=n(5183),o=n(227),c=n(7781),d=n(5631),u=n(7097),p=n(3143),g=n(5959),m=n.n(g),v=n(8810),h=n(8835),f=n(892),b=n(1475),y=n(558),S=n(5722),w=n(4119),O=n(8531),x=n(4750);function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){E(e,t,n[t])}))}return e}function F(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class j extends r.Bs{onActivate(){var e;this.setState({$data:(0,s.rS)([(0,w.oj)(this,p.zp,String((0,x.P4)(this).state.value))]),body:this.build()});const t=(0,x.P4)(this);this._subs.add(t.subscribeToState((e=>{e.value===p.To&&this.setState({$data:void 0,body:void 0})}))),this.subscribeToEvent(y.Of,(e=>{this.setState({lastFilterEvent:e})})),this._subs.add(null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState(((e,t)=>{this.onValuesDataQueryChange(e,t)})))}onValuesDataQueryChange(e,t){var n,r,a,i,l;if((null==e||null===(n=e.data)||void 0===n?void 0:n.errors)&&(null===(r=e.data)||void 0===r?void 0:r.state)!==c.LoadingState.Done){var s;const t=this.state.errors;null==e||null===(s=e.data)||void 0===s||s.errors.forEach((e=>{const n=`${e.status}_${e.traceId}_${e.message}`;void 0===t[n]&&(t[n]=F(C({},e),{displayed:!1}))})),this.setState({errors:t}),this.showErrorToast(this.state.errors)}if((null===(a=e.data)||void 0===a?void 0:a.state)===c.LoadingState.Done||(null===(i=e.data)||void 0===i?void 0:i.state)===c.LoadingState.Streaming){const t=this.state.lastFilterEvent;t&&("exclude"===t.operator&&e.data.series.length<1&&this.navigateToLabels(),"include"===t.operator&&e.data.series.length<=1&&this.navigateToLabels())}if((null===(l=e.data)||void 0===l?void 0:l.state)===c.LoadingState.Error&&this.activeLayoutContainsNoPanels()){const t=this.getActiveLayout();if(t instanceof d.h){const n=this.getErrorStateAlert(e.data.errors);t.state.body.setState({children:[n]})}}}getActiveLayout(){const e=this.state.body,t=null==e?void 0:e.state.layouts.find((e=>e.isActive));if(t instanceof d.h||t instanceof r.G1)return t}activeLayoutContainsNoPanels(){const e=this.getActiveLayout();if(e instanceof d.h){const t=e.state.body.state.children[0];if(t instanceof r.vA||t instanceof r.dM)return!0}return!1}getErrorStateAlert(e){return new r.dM({reactNode:m().createElement(l.Alert,{title:"Something went wrong with your request",severity:"error"},null==e?void 0:e.map(((e,t)=>this.renderError(t,e))))})}navigateToLabels(){this.setState({lastFilterEvent:void 0}),(0,h.Vt)(f.G3.labels,r.jh.getAncestor(this,b.Mn))}build(){const e=(0,x.P4)(this).state,t=r.jh.getAncestor(this,v.O),n=String(null==e?void 0:e.value);let c=r.d0.timeseries();c=c.setCustomFieldConfig("stacking",{mode:l.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",l.DrawStyle.Bars).setOverrides(s.jC).setTitle(n);const g=c.build(),{sortBy:h,direction:f}=(0,o.vs)("labels",S.DEFAULT_SORT_BY,"desc"),b=()=>{var e;return null!==(e=t.state.search.state.filter)&&void 0!==e?e:""};return new a.U({options:[{value:"single",label:"Single"},{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new r.G1({direction:"column",children:[new r.vA({minHeight:300,body:g})]}),new d.h({body:new r.gF({isLazy:!0,templateColumns:w.di,autoRows:"200px",children:[new r.vA({body:new r.dM({reactNode:m().createElement(l.LoadingPlaceholder,{text:"Loading..."})})})]}),getLayoutChild:(0,u.Zp)(i.ee,l.DrawStyle.Bars,p.MB,r.jh.getAncestor(this,v.O).state.sort),sortBy:h,direction:f,getFilter:b}),new d.h({body:new r.gF({templateColumns:"1fr",autoRows:"200px",children:[new r.vA({body:new r.dM({reactNode:m().createElement(l.LoadingPlaceholder,{text:"Loading..."})})})]}),getLayoutChild:(0,u.Zp)(i.ee,l.DrawStyle.Bars,p.MB,r.jh.getAncestor(this,v.O).state.sort),sortBy:h,direction:f,getFilter:b})]})}showErrorToast(e){const t=(0,O.getAppEvents)();let n=[];for(const t in e){const r=e[t];r.displayed||(n.push(r),r.displayed=!0)}n.length&&(this.activeLayoutContainsNoPanels()||t.publish({type:c.AppEvents.alertError.name,payload:null==n?void 0:n.map(((e,t)=>this.renderError(t,e)))}),this.setState({errors:e}))}renderError(e,t){return m().createElement("div",{key:e},t.status&&m().createElement(m().Fragment,null,m().createElement("strong",null,"Status"),": ",t.status," ",m().createElement("br",null)),t.message&&m().createElement(m().Fragment,null,m().createElement("strong",null,"Message"),": ",t.message," ",m().createElement("br",null)),t.traceId&&m().createElement(m().Fragment,null,m().createElement("strong",null,"TraceId"),": ",t.traceId))}static Selector({model:e}){const{body:t}=e.useState();return m().createElement(m().Fragment,null,t&&t instanceof a.U&&m().createElement(t.Selector,{model:t}))}constructor(e){super(F(C({},e),{errors:{}})),this.addActivationHandler(this.onActivate.bind(this))}}E(j,"Component",(({model:e})=>{const{body:t}=e.useState();return t?m().createElement(m().Fragment,null,t&&m().createElement(t.Component,{model:t})):m().createElement(l.LoadingPlaceholder,{text:"Loading..."})}))},738:(e,t,n)=>{n.d(t,{U:()=>d});var r=n(5959),a=n.n(r),i=n(1119),l=n(2007),s=n(2718),o=n(892);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class d extends i.Bs{Selector({model:e}){const{active:t,options:n}=e.useState();return a().createElement(l.Field,null,a().createElement(l.RadioButtonGroup,{options:n,value:t,onChange:e.onLayoutChange}))}constructor(...e){super(...e),c(this,"onLayoutChange",(e=>{(0,s.EE)(s.NO.service_details,s.ir.service_details.layout_type_changed,{layout:e,view:(0,o.FT)()}),this.setState({active:e})}))}}c(d,"Component",(({model:e})=>{const{layouts:t,options:n,active:r}=e.useState(),i=n.findIndex((e=>e.value===r));if(-1===i)return null;const l=t[i];return a().createElement(l.Component,{model:l})}))},6261:(e,t,n)=>{n.d(t,{D:()=>o});var r=n(6089),a=n(2007),i=n(5959),l=n.n(i);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o=e=>{var{value:t,onChange:n,placeholder:r,onClear:i,suffix:o}=e,d=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(e,["value","onChange","placeholder","onClear","suffix"]);return l().createElement(a.Input,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){s(e,t,n[t])}))}return e}({value:t,onChange:n,suffix:l().createElement(l().Fragment,null,t?l().createElement(a.Icon,{onClick:i,title:"Clear search",name:"times",className:c.clearIcon}):void 0,o&&o),prefix:l().createElement(a.Icon,{name:"search"}),placeholder:r},d))},c={clearIcon:(0,r.css)({cursor:"pointer"})}},8921:(e,t,n)=>{n.d(t,{X:()=>f});var r=n(1119),a=n(1475),i=n(8835),l=n(892),s=n(2007),o=n(5959),c=n.n(o),d=n(558),u=n(5218),p=n(3143),g=n(7781),m=n(6001),v=n(4750);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class f extends r.Bs{getExistingFilter(e){let{labelName:t}=(0,l.W6)();if(this.state.labelName!==t)return null==e?void 0:e.state.filters.find((t=>{const n=(0,v.z2)(e,t);return t.key===this.state.labelName&&n.value===p.ZO}))}onActivate(){this._subs.add(r.jh.getData(this).subscribeToState((e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===g.LoadingState.Done){var n,i,l;const e=r.jh.getAncestor(this,a.Mn);(null===(i=e.state.$data)||void 0===i||null===(n=i.state.data)||void 0===n?void 0:n.state)===g.LoadingState.Done&&this.calculateSparsity(),this._subs.add(null===(l=e.state.$data)||void 0===l?void 0:l.subscribeToState((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===g.LoadingState.Done&&this.calculateSparsity()})))}})))}calculateSparsity(){var e;const t=r.jh.getAncestor(this,a.Mn),n=(0,a.tn)(null===(e=t.state.$data)||void 0===e?void 0:e.state.data),i=null==n?void 0:n.fields.find((e=>"labels"===e.name));if(!i||!n)return void this.setState({showFilterField:!1});const l=this.getVariable(),s=i.values.reduce(((e,t)=>((null==t?void 0:t[this.state.labelName])&&e++,e)),0),o=r.jh.getAncestor(this,r.Eb);if(void 0!==s&&n.length>0){const e=(s/n.length*100).toLocaleString(),t=`${this.state.labelName} exists on ${e}% of ${n.length} sampled log lines`;o.setState({description:t})}else o.setState({description:void 0});s<n.length||this.getExistingFilter(l)?this.setState({showFilterField:!0}):this.setState({showFilterField:!1})}getVariable(){return this.state.fieldType===l._J.field?(0,v.ir)(this):this.state.labelName===p.e4?(0,v.iw)(this):(0,v.cR)(this)}constructor(e){super(e),h(this,"onClickViewValues",(()=>{const e=r.jh.getAncestor(this,a.Mn);(0,i.fg)(this.state.fieldType,this.state.labelName,e)})),h(this,"onClickExcludeEmpty",(e=>{(0,d.Qt)(this.state.labelName,p.ZO,"exclude",this,e)})),h(this,"onClickIncludeEmpty",(e=>{(0,d.Qt)(this.state.labelName,p.ZO,"include",this,e)})),h(this,"clearFilter",(e=>{(0,d.Qt)(this.state.labelName,p.ZO,"clear",this,e)})),this.addActivationHandler(this.onActivate.bind(this))}}h(f,"Component",(({model:e})=>{const{hideValueDrilldown:t,labelName:n,showFilterField:r}=e.useState(),a=e.getVariable(),i=a.useState().name,l=e.getExistingFilter(a),o=(0,v.z2)(a,l),d=null==o?void 0:o.value;return c().createElement(c().Fragment,null,!0===r&&c().createElement(u.F,{isExcluded:(null==l?void 0:l.operator)===m.w7.Equal&&d===p.ZO,isIncluded:(null==l?void 0:l.operator)===m.w7.NotEqual&&d===p.ZO,onInclude:()=>e.onClickExcludeEmpty(i),onExclude:()=>e.onClickIncludeEmpty(i),onClear:()=>e.clearFilter(i),buttonFill:"text",titles:{include:`Only show logs that contain ${n}`,exclude:`Hide all logs that contain ${n}`}}),!0!==t&&c().createElement(s.Button,{title:`View breakdown of values for ${n}`,variant:"primary",fill:"outline",size:"sm",onClick:e.onClickViewValues,"aria-label":`Select ${n}`},"Select"))}))},4144:(e,t,n)=>{n.d(t,{ee:()=>f,gf:()=>g,wd:()=>m});var r=n(1119),a=n(5959),i=n.n(a),l=n(7781),s=n(1383),o=n(2007),c=n(227),d=n(1220),u=n(5722);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends l.BusEventBase{constructor(e,t,n){super(),p(this,"target",void 0),p(this,"sortBy",void 0),p(this,"direction",void 0),this.target=e,this.sortBy=t,this.direction=n}}p(g,"type","sort-criteria-changed");class m extends r.Bs{constructor(e){const{sortBy:t,direction:n}=(0,c.vs)(e.target,u.DEFAULT_SORT_BY,"desc");super({target:e.target,sortBy:t,direction:n}),p(this,"sortingOptions",[{label:"",options:[{value:"changepoint",label:"Most relevant",description:"Smart ordering of graphs based on the most significant spikes in the data"},{value:"outliers",label:"Detected outliers",description:"Order by the amount of detected outliers in the data"},{value:l.ReducerID.stdDev,label:"Widest spread",description:"Sort graphs by deviation from the average value"},{value:"alphabetical",label:"Name",description:"Alphabetical order"},{value:l.ReducerID.sum,label:"Count",description:"Sort graphs by total number of logs"},{value:l.ReducerID.max,label:"Highest spike",description:"Sort graphs by the highest values (max)"},{value:l.ReducerID.min,label:"Lowest dip",description:"Sort graphs by the smallest values (min)"}]},{label:"Percentiles",options:[...l.fieldReducers.selectOptions([],h).options]}]),p(this,"onCriteriaChange",(e=>{e.value&&(this.setState({sortBy:e.value}),(0,c.fq)(this.state.target,e.value,this.state.direction),this.publishEvent(new g(this.state.target,e.value,this.state.direction),!0))})),p(this,"onDirectionChange",(e=>{e.value&&(this.setState({direction:e.value}),(0,c.fq)(this.state.target,this.state.sortBy,e.value),this.publishEvent(new g(this.state.target,this.state.sortBy,e.value),!0))}))}}p(m,"Component",(({model:e})=>{const{sortBy:t,direction:n}=e.useState(),r=e.sortingOptions.find((e=>e.options.find((e=>e.value===t)))),a=null==r?void 0:r.options.find((e=>e.value===t));return i().createElement(i().Fragment,null,i().createElement(o.InlineField,null,i().createElement(o.Select,{"data-testid":d.b.breakdowns.common.sortByDirection,onChange:e.onDirectionChange,"aria-label":"Sort direction",placeholder:"",value:n,options:[{label:"Asc",value:"asc"},{label:"Desc",value:"desc"}]})),i().createElement(o.InlineField,{label:"Sort by",htmlFor:"sort-by-criteria",tooltip:"Calculate a derived quantity from the values in your time series and sort by this criteria. Defaults to standard deviation."},i().createElement(o.Select,{"data-testid":d.b.breakdowns.common.sortByFunction,value:a,width:20,isSearchable:!0,options:e.sortingOptions,placeholder:"Choose criteria",onChange:e.onCriteriaChange,inputId:"sort-by-criteria"})))}));const v=["p10","p25","p75","p90","p99"];function h(e){return e.id>="p1"&&e.id<="p99"&&v.includes(e.id)}function f(e){var t;return null!==(t=(0,s.H7)(e))&&void 0!==t?t:"No labels"}},9570:(e,t,n)=>{n.d(t,{O:()=>s});var r=n(6089),a=n(5959),i=n.n(a),l=n(2007);function s({blockingMessage:e,isLoading:t,children:n}){const r=(0,l.useStyles2)(o);return t&&!e&&(e="Loading..."),t?i().createElement(l.LoadingPlaceholder,{className:r.statusMessage,text:e}):e?i().createElement("div",{className:r.statusMessage},e):i().createElement(i().Fragment,null,n)}function o(e){return{statusMessage:(0,r.css)({fontStyle:"italic",marginTop:e.spacing(7),textAlign:"center"})}}},5952:(e,t,n)=>{n.d(t,{lq:()=>c,qw:()=>m});var r=n(2007),a=n(5959),i=n.n(a),l=n(7781),s=n(6089),o=n(1119);const c=20;class d extends o.Bs{onActivate(){const e=o.jh.getAncestor(this,o.Eb);this._subs.add(e.subscribeToState(((e,t)=>{var n;const r=o.jh.getData(this);var a;(null===(n=r.state.data)||void 0===n?void 0:n.state)===l.LoadingState.Done&&this.setState({currentSeriesCount:null===(a=r.state.data)||void 0===a?void 0:a.series.length})})))}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}var u,p,g;function m(e){var t;const n=e.state.body,r=null===(t=e.state.body)||void 0===t?void 0:t.state.$data;r instanceof o.Es&&(null==n||n.setState({titleItems:[new d({showAllSeries:!1,toggleShowAllSeries:e=>{r.setState({transformations:[]}),e.setState({showAllSeries:!0}),r.reprocessTransformations()}})]}))}g=({model:e})=>{const{toggleShowAllSeries:t,showAllSeries:n,currentSeriesCount:a}=e.useState(),s=o.jh.getData(e),{data:d}=s.useState(),u=(0,r.useStyles2)(v);if(!(s instanceof o.Es)||n||(null==d?void 0:d.state)!==l.LoadingState.Done||!a||d.series.length<c)return null;const p=s._prevDataFromSource,g=null==p?void 0:p.series.length;return i().createElement("div",{key:"disclaimer",className:u.timeSeriesDisclaimer},i().createElement("span",{className:u.warningMessage},i().createElement(i().Fragment,null,i().createElement(r.Icon,{title:`Showing only ${c} series`,name:"exclamation-triangle","aria-hidden":"true"}))),i().createElement(r.Tooltip,{content:"Rendering too many series in a single panel may impact performance and make data harder to read. Consider adding more filters."},i().createElement(r.Button,{variant:"secondary",size:"sm",onClick:()=>t(e)},i().createElement(i().Fragment,null,"Show all ",g))))},(p="Component")in(u=d)?Object.defineProperty(u,p,{value:g,enumerable:!0,configurable:!0,writable:!0}):u[p]=g;const v=e=>({timeSeriesDisclaimer:(0,s.css)({label:"time-series-disclaimer",display:"flex",alignItems:"center",gap:e.spacing(1)}),warningMessage:(0,s.css)({display:"flex",alignItems:"center",gap:e.spacing(.5),color:e.colors.warning.main,fontSize:e.typography.bodySmall.fontSize})})},1475:(e,t,n)=>{n.d(t,{Mn:()=>An,rD:()=>$n,UO:()=>Nn,nU:()=>In,TG:()=>Dn,tn:()=>Tn});var r=n(5959),a=n.n(r),i=n(7781),l=n(1119),s=n(2007),o=n(5183),c=n(7918),d=n(3143),u=n(6949),p=n(8835),g=n(833),m=n(9829),v=n(892),h=n(8531),f=n(1220),b=n(2718);const y=({exploration:e})=>a().createElement(s.ToolbarButton,{"data-testid":f.b.exploreServiceDetails.openExplore,variant:"canvas",icon:"compass",onClick:()=>{(0,b.EE)(b.NO.service_details,b.ir.service_details.open_in_explore_clicked);const t=(0,m.U4)(e),n=(0,m.u9)(e).replace(/\s+/g," ").trimEnd(),r=l.jh.getTimeRange(e).state.value,a=JSON.stringify({"loki-explore":{range:(0,i.toURLRange)(r.raw),queries:[{refId:"logs",expr:n,datasource:t}],datasource:t}});var s;const o=null!==(s=h.config.appSubUrl)&&void 0!==s?s:"",c=i.urlUtil.renderUrl(`${o}/explore`,{panes:a,schemaVersion:1});window.open(c,"_blank")}},"Open in Explore");var S=n(6089),w=n(3241),O=n(6261);const x=e=>{const t=(0,s.useTheme2)(),n=e.caseSensitive?t.colors.text.maxContrast:t.colors.text.disabled,r=E(t,n);return a().createElement("span",{className:r.container,title:`Case ${e.caseSensitive?"insensitive":"sensitive"} search`},a().createElement("svg",{onClick:()=>e.onCaseSensitiveToggle(e.caseSensitive?"insensitive":"sensitive"),fill:n,width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},a().createElement("text",{fontSize:"13",width:"16",height:"16",x:"50%",y:"50%",dominantBaseline:"central",textAnchor:"middle"},"Aa")))},E=(e,t)=>({container:(0,S.css)({display:"flex",justifyContent:"center",marginLeft:e.spacing.x0_5,cursor:"pointer"})});var C=n(4750);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class j extends l.Bs{updateFilter(e,t=!0){this.setState({lineFilter:e}),t?this.updateVariableDebounced(e):this.updateVariable(e)}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){F(e,t,n[t])}))}return e}({lineFilter:(null==e?void 0:e.lineFilter)||"",caseSensitive:!1},e)),F(this,"onActivate",(()=>{const e=(0,C.Rr)(this).getValue(),t=e.toString();if(!e)return;const n=t.includes("|="),r=n?t.match(/\|=.`(.+?)`/):t.match(/`\(\?i\)(.+)`/);r&&2===r.length&&this.setState({lineFilter:r[1].replace(/\\(.)/g,"$1"),caseSensitive:n})})),F(this,"handleChange",(e=>{this.updateFilter(e.target.value)})),F(this,"handleEnter",(e=>{"Enter"===e.key&&this.updateVariable(this.state.lineFilter)})),F(this,"onCaseSensitiveToggle",(e=>{this.setState({caseSensitive:"sensitive"===e}),this.updateFilter(this.state.lineFilter)})),F(this,"updateVariableDebounced",(0,w.debounce)((e=>{this.updateVariable(e)}),1e3)),F(this,"updateVariable",(e=>{const t=(0,C.Rr)(this);""===e?t.changeValueTo(""):this.state.caseSensitive?t.changeValueTo(`|= \`${(0,w.escapeRegExp)(e)}\``):t.changeValueTo(`|~ \`(?i)${(0,w.escapeRegExp)(e)}\``),(0,b.EE)(b.NO.service_details,b.ir.service_details.search_string_in_logs_changed,{searchQueryLength:e.length,containsLevel:e.toLowerCase().includes("level")})})),this.addActivationHandler(this.onActivate)}}F(j,"Component",(function({model:e}){const{lineFilter:t,caseSensitive:n}=e.useState();return a().createElement(s.Field,{className:P.field},a().createElement(O.D,{"data-testid":f.b.exploreServiceDetails.searchLogs,value:t,className:P.input,onChange:e.handleChange,suffix:a().createElement(x,{caseSensitive:n,onCaseSensitiveToggle:e.onCaseSensitiveToggle}),placeholder:"Search in log lines",onClear:()=>{e.updateFilter("",!1)},onKeyUp:e.handleEnter}))}));const P={input:(0,S.css)({width:"100%"}),field:(0,S.css)({label:"field",width:"100%",marginBottom:0})};function L(e,t,n){const r=e.getFieldByName(t);if(void 0!==r)return r.type===n?r:void 0}const _="timestamp",k="body";function T(e){const t={};return Object.entries(e).forEach((([e,n])=>{t[e]="string"==typeof n?n:JSON.stringify(n)})),t}function D(e){var t;return null!==(t=null==e?void 0:e.timeField.name)&&void 0!==t?t:_}function $(e){var t;return null!==(t=null==e?void 0:e.bodyField.name)&&void 0!==t?t:k}var N=n(2871);function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){I(e,t,n[t])}))}return e}const M=`${v.s_}.tableColumnWidths`;var B;!function(e){e.text="text",e.labels="labels",e.auto="auto"}(B||(B={}));const R=(0,r.createContext)({columnWidthMap:{},setColumnWidthMap:()=>{},columns:{},filteredColumns:{},setColumns:()=>{},setFilteredColumns:()=>{},setVisible:()=>!1,visible:!1,bodyState:"auto",setBodyState:()=>{},clearSelectedLine:()=>{}}),V=({children:e,initialColumns:t,logsFrame:n,setUrlColumns:i,clearSelectedLine:l})=>{const[s,o]=(0,r.useState)(W(t)),[c,d]=(0,r.useState)("auto"),[u,p]=(0,r.useState)(void 0),[g,m]=(0,r.useState)(!1),v=function(){let e={};const t=localStorage.getItem(M);if(t)try{e=JSON.parse(t)}catch(e){N.v.error(e,{msg:"error parsing table column widths from local storage"})}return e}(),[h,f]=(0,r.useState)(v),b=(0,r.useCallback)((e=>{if(e){const t=W(e);o(t),i((e=>{let t=[];return Object.keys(e).forEach((n=>{e[n].active&&void 0!==e[n].index&&t.push(n)})),t.sort(((t,n)=>{const r=e[t],a=e[n];return r.index-a.index})),t})(t))}}),[i]),y=(0,r.useCallback)((e=>{m(e)}),[]);return(0,r.useEffect)((()=>{t&&b(t)}),[t,b]),(0,r.useEffect)((()=>{const e=function(e,t){if(!t)return void N.v.warn("missing dataframe, cannot set url state");const n=Object.keys(e).filter((t=>{var n;return null===(n=e[t])||void 0===n?void 0:n.active})).sort(((t,n)=>{const r=e[t],a=e[n];return void 0!==r.index&&void 0!==a.index?r.index-a.index:0})),r=t.timeField,a=t.bodyField;if(r&&a||n.length){const e=[];return(null==r?void 0:r.name)&&e.push(r.name),(null==a?void 0:a.name)&&e.push(a.name),n.length?n:e}return[]}(s,n);(null==e?void 0:e.length)&&(0===Object.keys(s).filter((e=>s[e].active)).length&&function(e,t,n){const r=A({},e);r[D(n)]={index:0,active:!0,type:"TIME_FIELD",percentOfLinesWithLabel:100,cardinality:1/0},r[$(n)]={index:1,active:!0,type:"BODY_FIELD",percentOfLinesWithLabel:100,cardinality:1/0},t(r)}(s,b,n),p(void 0))}),[s,n,p,b]),a().createElement(R.Provider,{value:{setColumnWidthMap:e=>{localStorage.setItem(M,JSON.stringify(e)),f(e)},columnWidthMap:h,bodyState:c,setBodyState:d,setFilteredColumns:p,filteredColumns:u,columns:s,setColumns:b,visible:g,setVisible:y,clearSelectedLine:()=>{l()}}},e)},W=e=>{if("labelTypes"in e){const t=A({},e),{labelTypes:n}=t;return function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(t,["labelTypes"])}return e},z=()=>(0,r.useContext)(R);var H=n(3367),q=n(1269),Q=n(3321);const U=(0,r.createContext)({cellIndex:{index:null,numberOfMenuItems:3},setActiveCellIndex:e=>!1}),G=({children:e})=>{const[t,n]=(0,r.useState)({index:null}),i=(0,r.useCallback)((e=>{n(e)}),[]);return a().createElement(U.Provider,{value:{cellIndex:t,setActiveCellIndex:i}},e)},J=()=>(0,r.useContext)(U),Y=(0,r.createContext)({isHeaderMenuActive:!1,setHeaderMenuActive:e=>!1}),X=({children:e})=>{const[t,n]=(0,r.useState)(!1),i=(0,r.useCallback)((e=>{n(e)}),[]);return a().createElement(Y.Provider,{value:{isHeaderMenuActive:t,setHeaderMenuActive:i}},e)},Z=()=>(0,r.useContext)(Y);var K=n(4932);function ee({searchValue:e,setSearchValue:t}){const{columns:n,setFilteredColumns:r}=z(),i=e=>{const t=e[0];let a={},i=0;var l;t.forEach((e=>{e in n&&(a[e]=n[e],i++)})),r(a),l=i,(0,h.reportInteraction)("grafana_logs_app_table_text_search_result_count",{resultCount:l})},l=function(e){return{searchWrap:(0,S.css)({padding:`${e.spacing(.4)} 0 ${e.spacing(.4)} ${e.spacing(.4)}`})}}((0,s.useTheme2)());return a().createElement(s.Field,{className:l.searchWrap},a().createElement(s.Input,{value:e,type:"text",placeholder:"Search fields by name",onChange:e=>{var a;const l=null===(a=e.currentTarget)||void 0===a?void 0:a.value;var s;t(l),l?(s=l,(0,K.E)(Object.keys(n),s,i)):r(void 0)}}))}var te=n(5206),ne=n(5786);function re(){const e=function(e){return{empty:(0,S.css)({marginBottom:e.spacing(2),marginLeft:e.spacing(1.75),fontSize:e.typography.fontSize})}}((0,s.useTheme2)());return a().createElement("div",{className:e.empty},"No fields")}function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ie(e){var t=function(e,t){if("object"!==le(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===le(t)?t:String(t)}function le(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function se(e){const t=function(e){return{dragIcon:(0,S.css)({cursor:"drag",marginLeft:e.spacing(1),opacity:.4}),labelCount:(0,S.css)({marginLeft:e.spacing(.5),marginRight:e.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11),opacity:.6,display:"flex",flexDirection:"column",alignItems:"self-end"}),contentWrap:(0,S.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}),customWidthWrap:(0,S.css)({fontSize:e.typography.bodySmall.fontSize,cursor:"pointer"}),checkboxLabel:(0,S.css)({"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}})}}((0,s.useTheme2)());var n,r,i,l,o,c,d;return e.labels[e.label]?a().createElement(a().Fragment,null,a().createElement("div",{className:t.contentWrap},a().createElement(s.Checkbox,{className:t.checkboxLabel,label:e.label,onChange:e.onChange,checked:null!==(d=null===(n=e.labels[e.label])||void 0===n?void 0:n.active)&&void 0!==d&&d}),e.showCount&&a().createElement("div",{className:t.labelCount},a().createElement("div",null,null===(r=e.labels[e.label])||void 0===r?void 0:r.percentOfLinesWithLabel,"%"),a().createElement("div",null,null===(i=e.labels[e.label])||void 0===i?void 0:i.cardinality," ",1===(null===(l=e.labels[e.label])||void 0===l?void 0:l.cardinality)?"value":"values")),e.columnWidthMap&&e.setColumnWidthMap&&void 0!==(null===(o=e.columnWidthMap)||void 0===o?void 0:o[e.label])&&a().createElement("div",{onClick:()=>{var t;const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ae(e,t,n[t])}))}return e}({},e.columnWidthMap),r=e.label,{[r]:a}=n,i=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(n,[r].map(ie));null===(t=e.setColumnWidthMap)||void 0===t||t.call(e,i)},title:"Clear column width override",className:t.customWidthWrap},"Width: ",null===(c=e.columnWidthMap)||void 0===c?void 0:c[e.label],a().createElement(s.Icon,{name:"x"}))),e.draggable&&a().createElement(s.Icon,{"aria-label":"Drag and drop icon",title:"Drag and drop to reorder",name:"draggabledots",size:"lg",className:t.dragIcon})):null}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){oe(e,t,n[t])}))}return e}function de(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const ue=e=>{const{columnWidthMap:t,setColumnWidthMap:n}=z(),{reorderColumn:r,labels:i,valueFilter:l,toggleColumn:s}=e,o=(0,ne.$j)(),{columns:c}=z(),d=function(e){return{wrap:(0,S.css)({marginTop:e.spacing(1),marginBottom:e.spacing(1),display:"flex",background:e.colors.background.primary}),dragging:(0,S.css)({background:e.colors.background.secondary}),columnWrapper:(0,S.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)})}}(o),u=Object.keys(i).filter((e=>l(e))),p=e=>{const t=i[e];if(t)return`${e} appears in ${null==t?void 0:t.percentOfLinesWithLabel}% of log lines`};return u.length?a().createElement(te.JY,{onDragEnd:e=>{e.destination&&r(c,e.source.index,e.destination.index)}},a().createElement(te.gL,{droppableId:"order-fields",direction:"vertical"},(e=>a().createElement("div",de(ce({className:d.columnWrapper},e.droppableProps),{ref:e.innerRef}),u.sort(function(e){return(t,n)=>{const r=e[t],a=e[n];return null!=r.index&&null!=a.index?r.index-a.index:0}}(i)).map(((e,r)=>a().createElement(te.sx,{draggableId:e,key:e,index:r},((r,l)=>a().createElement("div",de(ce({className:(0,S.cx)(d.wrap,l.isDragging?d.dragging:void 0),ref:r.innerRef},r.draggableProps,r.dragHandleProps),{title:p(e)}),a().createElement(se,{setColumnWidthMap:n,columnWidthMap:t,label:e,onChange:()=>s(e),labels:i,draggable:!0})))))),e.placeholder)))):a().createElement(re,null)},pe=new Intl.Collator(void 0,{sensitivity:"base"}),ge=e=>{const{labels:t,valueFilter:n,toggleColumn:r}=e,i=function(e){return{wrap:(0,S.css)({marginTop:e.spacing(.25),marginBottom:e.spacing(.25),display:"flex",background:e.colors.background.primary,borderBottom:`1px solid ${e.colors.background.canvas}`}),dragging:(0,S.css)({background:e.colors.background.secondary}),columnWrapper:(0,S.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)})}}((0,s.useTheme2)()),l=Object.keys(t).filter((e=>n(e)));return l.length?a().createElement("div",{className:i.columnWrapper},l.sort(function(e){return(t,n)=>{const r=e[t],a=e[n];return null!=r&&null!=a?Number("TIME_FIELD"===a.type)-Number("TIME_FIELD"===r.type)||Number("BODY_FIELD"===a.type)-Number("BODY_FIELD"===r.type)||pe.compare(t,n):0}}(t)).map((e=>{var n;return a().createElement("div",{key:e,className:i.wrap,title:`${e} appears in ${null===(n=t[e])||void 0===n?void 0:n.percentOfLinesWithLabel}% of log lines`},a().createElement(se,{showCount:!0,label:e,onChange:()=>r(e),labels:t}))}))):a().createElement(re,null)},me=e=>{const t=function(e){return{sidebarWrap:(0,S.css)({overflowY:"scroll",height:"calc(100% - 50px)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"}),columnHeaderButton:(0,S.css)({appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11)}),columnHeader:(0,S.css)({display:"flex",justifyContent:"space-between",fontSize:e.typography.h6.fontSize,background:e.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:e.spacing(.75),paddingRight:e.spacing(.75),paddingBottom:e.spacing(.75),paddingLeft:e.spacing(1.5),zIndex:3,marginBottom:e.spacing(2)})}}((0,s.useTheme2)());var n,r;return a().createElement("div",{className:t.sidebarWrap},a().createElement(a().Fragment,null,a().createElement("div",{className:t.columnHeader},"Selected fields",a().createElement("button",{onClick:e.clear,className:t.columnHeaderButton},"Reset")),a().createElement(ue,{reorderColumn:e.reorderColumn,toggleColumn:e.toggleColumn,labels:null!==(n=e.filteredColumnsWithMeta)&&void 0!==n?n:e.columnsWithMeta,valueFilter:t=>{var n,r;return null!==(r=null===(n=e.columnsWithMeta[t])||void 0===n?void 0:n.active)&&void 0!==r&&r},id:"selected-fields"}),a().createElement("div",{className:t.columnHeader},"Fields"),a().createElement(ge,{toggleColumn:e.toggleColumn,labels:null!==(r=e.filteredColumnsWithMeta)&&void 0!==r?r:e.columnsWithMeta,valueFilter:t=>{var n;return!(null===(n=e.columnsWithMeta[t])||void 0===n?void 0:n.active)}})))};function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ve(e,t,n[t])}))}return e}function fe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function be(e){return(t,n,r)=>{if(n===r)return;const a=he({},t),i=Object.keys(a).filter((e=>a[e].active)).map((e=>{var t;return{fieldName:e,index:null!==(t=a[e].index)&&void 0!==t?t:0}})).sort(((e,t)=>e.index-t.index)),[l]=i.splice(n,1);i.splice(r,0,l),i.filter((e=>void 0!==e)).forEach(((e,t)=>{a[e.fieldName].index=t})),e(a)}}function ye(){const{columns:e,setColumns:t,setVisible:n,filteredColumns:i,setFilteredColumns:l}=z(),[o,c]=(0,r.useState)(""),d=be(t);return a().createElement(s.ClickOutsideWrapper,{onClick:()=>{n(!1),l(e),c("")},useCapture:!0},a().createElement(ee,{searchValue:o,setSearchValue:c}),a().createElement(me,{toggleColumn:n=>{if(!e||!(n in e))return void function(e,t){let n;try{n={columns:JSON.stringify(t),columnName:e}}catch(t){n={msg:"Table: ColumnSelectionDrawerWrap failed to encode context",columnName:e}}N.v.warn("failed to get column",n)}(n,e);const r=Object.keys(e).filter((t=>e[t].active)).length,a=!e[n].active||void 0;let s;if(s=fe(he({},e),a?{[n]:fe(he({},e[n]),{active:a,index:r})}:{[n]:fe(he({},e[n]),{active:!1,index:void 0})}),function(t){if(e){var n,r;const a=!(null===(n=e[t])||void 0===n?void 0:n.active),i=null===(r=Object.keys(e).filter((t=>{var n;return null===(n=e[t])||void 0===n?void 0:n.active})))||void 0===r?void 0:r.length,l={columnAction:a?"add":"remove",columnCount:a?i+1:i-1};(0,h.reportInteraction)("grafana_logs_app_table_column_filter_clicked",l)}}(n),t(s),i){var o;const e=!(null===(o=i[n])||void 0===o?void 0:o.active);let t;t=fe(he({},i),e?{[n]:fe(he({},i[n]),{active:e,index:r})}:{[n]:fe(he({},i[n]),{active:!1,index:void 0})}),l(t),c("")}},filteredColumnsWithMeta:i,columnsWithMeta:e,clear:()=>{const n=he({},e);let r=0;Object.keys(n).forEach((e=>{const t="BODY_FIELD"===n[e].type||"TIME_FIELD"===n[e].type;n[e].active=t,n[e].index=t?r++:void 0})),t(n),l(n),c("")},reorderColumn:d}))}const Se=e=>a().createElement(we,{onMouseOut:e.onMouseOut,onMouseIn:e.onMouseIn,onClick:e.onClick,field:e.field,rowIndex:e.rowIndex},e.children),we=e=>{var t;const n=(0,s.useTheme2)(),r=J(),i=((e,t,n)=>({active:(0,S.css)({height:"calc(100% + 36px)",zIndex:e.zIndex.tooltip,background:"transparent"}),wrap:(0,S.css)({position:"absolute",overflowX:"hidden",whiteSpace:"nowrap",width:"100%",height:"100%",left:0,top:0,margin:"auto",background:"transparent"})}))(n,0,null===(t=r.cellIndex)||void 0===t||t.numberOfMenuItems);return a().createElement("div",{onMouseLeave:e.onMouseOut,onMouseEnter:e.onMouseIn,onClick:e.onClick,className:r.cellIndex.index===e.rowIndex&&r.cellIndex.fieldName===e.field.name?(0,S.cx)(i.wrap,i.active):i.wrap},e.children)},Oe={logsFrame:null,addFilter:e=>{},timeRange:void 0,selectedLine:void 0},xe=(0,r.createContext)(Oe),Ee=({children:e,logsFrame:t,addFilter:n,selectedLine:r,timeRange:i})=>a().createElement(xe.Provider,{value:{logsFrame:t,addFilter:n,selectedLine:r,timeRange:i}},e),Ce=()=>(0,r.useContext)(xe);var Fe=n(6001);const je=e=>{const t=((e,t)=>({menu:(0,S.css)({position:"relative",paddingRight:"5px",display:"flex",minWidth:"60px",justifyContent:"flex-start"}),menuItemsWrap:(0,S.css)({boxShadow:e.shadows.z3,display:"flex",background:e.colors.background.secondary,padding:"5px 0",marginLeft:"column"===t?"5px":void 0}),menuItem:(0,S.css)({overflow:"auto",textOverflow:"ellipsis",cursor:"pointer",paddingLeft:"5px",paddingRight:"5px",display:"flex",alignItems:"center"})}))((0,s.useTheme2)(),e.pillType),{addFilter:n}=Ce();return a().createElement("span",{className:t.menu},a().createElement("span",{className:t.menuItemsWrap},"derived"!==e.fieldType&&a().createElement(a().Fragment,null,a().createElement("div",{className:t.menuItem,onClick:()=>{n({key:e.label,value:e.value,operator:Fe.w7.Equal})}},a().createElement(s.Icon,{title:"Add to search",size:"md",name:"plus-circle"})),a().createElement("div",{className:t.menuItem,onClick:()=>{n({key:e.label,value:e.value,operator:Fe.w7.NotEqual})}},a().createElement(s.Icon,{title:"Exclude from search",size:"md",name:"minus-circle"}))),e.showColumn&&a().createElement("div",{title:"Add column",onClick:e.showColumn,className:t.menuItem},a().createElement("svg",{width:"18",height:"16",viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.38725 1.33301H13.3872C13.5641 1.33301 13.7336 1.40325 13.8587 1.52827C13.9837 1.65329 14.0539 1.82286 14.0539 1.99967V2.33333C14.0539 2.70152 13.7554 3 13.3872 3H13.0542C12.87 3 12.7206 2.85062 12.7206 2.66634H8.05391V13.333H12.7206C12.7206 13.1491 12.8697 13 13.0536 13H13.3872C13.7554 13 14.0539 13.2985 14.0539 13.6667V13.9997C14.0539 14.1765 13.9837 14.3461 13.8587 14.4711C13.7336 14.5961 13.5641 14.6663 13.3872 14.6663H1.38725C1.21044 14.6663 1.04087 14.5961 0.915843 14.4711C0.790819 14.3461 0.720581 14.1765 0.720581 13.9997V1.99967C0.720581 1.82286 0.790819 1.65329 0.915843 1.52827C1.04087 1.40325 1.21044 1.33301 1.38725 1.33301ZM2.05391 13.333H6.72058V2.66634H2.05391V13.333Z",fill:"#CCCCDC",fillOpacity:"1"}),a().createElement("path",{d:"M13.8538 7.19999H16.2538C16.466 7.19999 16.6695 7.28429 16.8195 7.4343C16.9696 7.58432 17.0538 7.78783 17.0538 7.99999C17.0538 8.21214 16.9696 8.41566 16.8195 8.56567C16.6695 8.71569 16.466 8.79999 16.2538 8.79999H13.8538V11.2C13.8538 11.4121 13.7696 11.6156 13.6195 11.7657C13.4695 11.9157 13.266 12 13.0538 12C12.8416 12 12.6382 11.9157 12.4881 11.7657C12.3381 11.6156 12.2538 11.4121 12.2538 11.2V8.79999H9.85384C9.64165 8.79999 9.43819 8.71569 9.28815 8.56567C9.13811 8.41566 9.05383 8.21214 9.05383 7.99999C9.05383 7.78783 9.13811 7.58432 9.28815 7.4343C9.43819 7.28429 9.64165 7.19999 9.85384 7.19999H12.2538V4.8C12.2538 4.58784 12.3381 4.38433 12.4881 4.23431C12.6382 4.0843 12.8416 4 13.0538 4C13.266 4 13.4695 4.0843 13.6195 4.23431C13.7696 4.38433 13.8538 4.58784 13.8538 4.8V7.19999Z",fill:"#CCCCDC",fillOpacity:"1"}))),e.links&&e.links.map((e=>{var n;return a().createElement("div",{className:t.menuItem,onClick:()=>{window.open(e.href,"_blank")},key:e.href},a().createElement(s.Icon,{title:null!==(n=e.title)&&void 0!==n?n:"Link",key:e.href,size:"md",name:"link"}))}))))},Pe="detected_level",Le=e=>{const{label:t,value:n}=e,r=(0,s.useTheme2)(),{cellIndex:l}=J();let o;if(t===Pe){const e=Ke().options;"string"==typeof n&&n in e&&(o=e[n].color)}const c=l.index===e.rowIndex&&e.field.name===l.fieldName,d=((e,t)=>({activePillWrap:(0,S.css)({}),pillWrap:(0,S.css)({width:"100%"}),pill:(0,S.css)({border:`1px solid ${e.colors.border.weak}`,"&:hover":{border:`1px solid ${e.colors.border.strong}`},marginRight:"5px",marginTop:"4px",marginLeft:"5px",padding:"2px 5px",position:"relative",display:"inline-flex",flexDirection:"row-reverse",backgroundColor:"transparent",paddingLeft:t?`${e.spacing(.75)}`:"2px","&:before":{content:'""',position:"absolute",left:0,top:0,height:"100%",width:`${e.spacing(.25)}`,backgroundColor:t}}),menu:(0,S.css)({width:"100%"}),menuItem:(0,S.css)({overflow:"auto",textOverflow:"ellipsis"}),menuItemText:(0,S.css)({width:"65px",display:"inline-block"})}))(r,o);return a().createElement("div",{className:(0,S.cx)(d.pillWrap,c?d.activePillWrap:void 0)},!!n&&a().createElement(a().Fragment,null,a().createElement("span",{className:d.pill},a().createElement(a().Fragment,null,n)),c&&"string"==typeof n&&e.field.type!==i.FieldType.time&&a().createElement(je,{label:e.label,value:n,pillType:"column"})))};var _e;function ke(e){var t;const n=((e,t)=>({clipboardButton:(0,S.css)({padding:0,height:"100%",lineHeight:"1",width:"20px"}),inspectButton:(0,S.css)({display:"inline-flex",verticalAlign:"middle",margin:0,overflow:"hidden",borderRadius:"5px"}),iconWrapper:(0,S.css)({height:"35px",position:"sticky",left:0,display:"flex",background:e.colors.background.secondary,padding:`0 ${e.spacing(.5)}`,zIndex:1,boxShadow:e.shadows.z2}),inspect:(0,S.css)({padding:"5px 3px","&:hover":{color:e.colors.text.link,cursor:"pointer"}})}))((0,s.useTheme2)()),{logsFrame:i,timeRange:l}=Ce(),o=null==i||null===(t=i.idField)||void 0===t?void 0:t.values[e.rowIndex],c=null==i?void 0:i.bodyField.values[e.rowIndex],[d,u]=(0,r.useState)(!1);return a().createElement(a().Fragment,null,a().createElement("div",{className:n.iconWrapper},a().createElement("div",{className:n.inspect},a().createElement(s.IconButton,{"data-testid":f.b.table.inspectLine,className:n.inspectButton,tooltip:"View log line",variant:"secondary","aria-label":"View log line",tooltipPlacement:"top",size:"md",name:"eye",onClick:()=>u(!0),tabIndex:0})),a().createElement("div",{className:n.inspect},a().createElement(s.ClipboardButton,{className:n.clipboardButton,icon:"share-alt",variant:"secondary",fill:"text",size:"md",tooltip:"Copy link to log line",tooltipPlacement:"top",tabIndex:0,getText:()=>{const t=h.locationService.getLocation(),n=new URLSearchParams(t.search);if(n&&l){const r={row:e.rowIndex,id:o};n.set("from",l.from.toISOString()),n.set("to",l.to.toISOString()),n.set("selectedLine",JSON.stringify(r));const a=n.toString().replace(/\+/g,"%20");return window.location.origin+t.pathname+"?"+a}return""}}))),a().createElement(a().Fragment,null,d&&a().createElement(s.Modal,{onDismiss:()=>u(!1),isOpen:!0,title:"Inspect value"},a().createElement("pre",null,c),a().createElement(s.Modal.ButtonRow,null,a().createElement(s.ClipboardButton,{icon:"copy",getText:()=>e.value},"Copy to Clipboard")))))}!function(e){e.SelectedLine="selectedLine",e.From="from",e.To="to"}(_e||(_e={}));const Te=e=>{var t;let n=e.value;const r=e.field,l=r.display(n),o=((e,t)=>({flexWrap:(0,S.css)({display:"flex",alignItems:"flex-start",flexDirection:t===i.FieldType.number?"row-reverse":"row",textAlign:t===i.FieldType.number?"right":"left"}),content:(0,S.css)({position:"relative",overflow:"hidden",display:"flex",height:"100%"}),linkWrapper:(0,S.css)({color:e.colors.text.link,marginTop:"7px",marginLeft:"7px","&:hover":{textDecoration:"underline"}})}))((0,s.useTheme2)(),e.field.type),{setVisible:c}=z(),{cellIndex:d,setActiveCellIndex:u}=J(),p={index:e.rowIndex},g=Boolean(null===(t=(0,s.getCellLinks)(e.field,p))||void 0===t?void 0:t.length);return null===n?a().createElement(a().Fragment,null):(n=a().isValidElement(e.value)?e.value:"object"==typeof n?JSON.stringify(e.value):(0,i.formattedValueToString)(l),a().createElement(Se,{onClick:()=>e.rowIndex===d.index&&e.field.name===d.fieldName?u({index:null}):u({index:e.rowIndex,fieldName:e.field.name,numberOfMenuItems:3}),field:e.field,rowIndex:e.rowIndex},a().createElement("div",{className:o.content},0===e.fieldIndex&&a().createElement(ke,{value:n,rowIndex:e.rowIndex}),a().createElement("div",{className:o.flexWrap}),!g&&((t,n)=>a().createElement(Le,{field:e.field,rowIndex:e.rowIndex,showColumns:()=>c(!0),label:n,value:t}))(n,r.name),g&&r.getLinks&&a().createElement(s.DataLinksContextMenu,{links:()=>{var e;return null!==(e=(0,s.getCellLinks)(r,p))&&void 0!==e?e:[]}},(e=>e.openMenu?a().createElement("div",{className:o.linkWrapper,onClick:e.openMenu},a().createElement(a().Fragment,null,n)):a().createElement("div",{className:o.linkWrapper},a().createElement(a().Fragment,null,n)))))))};function De(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $e(e){const t=(0,s.useTheme2)();let n;if(e.label===Pe){const t=Ke().options;e.value in t&&(n=t[e.value].color)}const r=((e,t)=>({pill:(0,S.css)({flex:"0 1 auto",marginLeft:e.spacing(.5),marginRight:e.spacing(.5),padding:`${e.spacing(.25)} ${e.spacing(.25)}`,position:"relative",display:"inline-flex",flexDirection:"column",marginTop:e.spacing(.5)}),activePill:(0,S.css)({}),valueWrap:(0,S.css)({border:`1px solid ${e.colors.background.secondary}`,boxShadow:`-2px 2px 5px 0px ${e.colors.background.secondary}`,backgroundColor:"transparent",cursor:"pointer",position:"relative",paddingRight:`${e.spacing(.5)}`,paddingLeft:t?`${e.spacing(.75)}`:`${e.spacing(.5)}`,"&:before":{content:'""',position:"absolute",left:0,top:0,height:"100%",width:`${e.spacing(.25)}`,backgroundColor:t},"&:hover":{border:`1px solid ${e.colors.border.strong}`}})}))(t,n);return a().createElement("span",{className:(0,S.cx)(r.pill,e.menuActive?r.activePill:void 0),onClick:e.onClick},a().createElement("span",{className:r.valueWrap},e.label,"=",e.value),e.menuActive&&a().createElement(je,{pillType:"logPill",fieldType:e.fieldType,links:e.links,label:e.label,value:e.value,showColumn:e.onClickAdd}))}const Ne=e=>{const{label:t}=e,{cellIndex:n,setActiveCellIndex:l}=J(),{columns:o,setColumns:c}=z(),d=e.value,u=(0,h.getTemplateSrv)(),p=(0,r.useMemo)((()=>u.replace.bind(u)),[u]),g=e.field;if(!g||(null==g?void 0:g.type)===i.FieldType.other)return null;const m={index:e.rowIndex};e.originalField&&e.isDerivedField&&e.originalFrame&&(e.originalField.getLinks=(0,i.getLinksSupplier)(e.originalFrame,e.originalField,{},p));const v=e.originalField&&(0,s.getCellLinks)(e.originalField,m);return a().createElement($e,{onClick:()=>e.rowIndex===n.index&&g.name===n.fieldName&&t===n.subFieldName?l({index:null}):l({index:e.rowIndex,fieldName:g.name,subFieldName:t,numberOfMenuItems:e.isDerivedField?2:3}),menuActive:n.index===e.rowIndex&&n.fieldName===g.name&&n.subFieldName===t,fieldType:e.isDerivedField?"derived":void 0,label:t,value:d,onClickAdd:()=>(e=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){De(e,t,n[t])}))}return e}({},o),n=Object.keys(o).filter((e=>o[e].active)).length;t[e].active?(t[e].active=!1,t[e].index=void 0):(t[e].active=!0,t[e].index=n),c(t)})(t),links:v})},Ie=e=>{var t,n;null==e||null===(n=e.current)||void 0===n||n.scrollTo({left:null===(t=e.current)||void 0===t?void 0:t.scrollLeft})};function Ae({scrollerRef:e}){const t=(e=>({scroller:S.css`
    position: absolute;
    right: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 20px;
    top: 32px;
    margin-top: -24px;
    // For some reason clicking on this button causes text to be selected in the following row
    user-select: none;
  `,scrollLeft:S.css`
    cursor: pointer;
    background: ${e.colors.background.primary};

    &:hover {
      background: ${e.colors.background.secondary};
    }
  `,scrollRight:S.css`
    cursor: pointer;
    background: ${e.colors.background.primary};

    &:hover {
      background: ${e.colors.background.secondary};
    }
  `}))((0,s.useTheme2)());return a().createElement("div",{className:t.scroller},a().createElement("span",{onPointerDown:()=>{var t,n;null==(t=e)||null===(n=t.current)||void 0===n||n.scrollTo({top:0,left:0,behavior:"smooth"})},onPointerUp:()=>Ie(e),className:t.scrollLeft},a().createElement(s.Icon,{name:"arrow-left"})),a().createElement("span",{onPointerDown:()=>{var t,n;null==(t=e)||null===(n=t.current)||void 0===n||n.scrollTo({top:0,left:t.current.scrollWidth,behavior:"smooth"})},onPointerUp:()=>Ie(e),className:t.scrollRight},a().createElement(s.Icon,{name:"arrow-right"})))}function Me(e){const t=(0,s.useTheme2)(),n=Be(t);return a().createElement("div",{className:n.rawLogLine},a().createElement(a().Fragment,null,e.value))}const Be=(e,t)=>({rawLogLine:(0,S.css)({fontFamily:e.typography.fontFamilyMonospace,height:"35px",lineHeight:"35px",paddingRight:e.spacing(1.5),paddingLeft:e.spacing(1),fontSize:e.typography.bodySmall.fontSize})}),Re=e=>{let t=e.value;const n=e.field,l=n.display(t),o=(0,s.useTheme2)(),c=Ve(o),{columns:d,setVisible:u,bodyState:p}=z(),{logsFrame:g}=Ce(),[m,v]=(0,r.useState)(!1),h=(0,r.useRef)(null);t=a().isValidElement(e.value)?e.value:"object"==typeof t?JSON.stringify(e.value):(0,i.formattedValueToString)(l);const f=(t=>Object.keys(d).filter((e=>e!==$(g))).sort(((e,t)=>e===Pe?-1:t===Pe?1:"LINK_FIELD"===d[e].type?-1:"LINK_FIELD"===d[t].type?1:d[e].cardinality>d[t].cardinality?-1:1)).filter((e=>!d[e].active&&d[e].cardinality>1)).map((r=>{var l;const s=t[r],o=null==g||null===(l=g.raw)||void 0===l?void 0:l.fields.find((e=>e.name===r)),c=null==n?void 0:n.values[e.rowIndex],p=!s&&!!c;if(s)return a().createElement(Ne,{originalFrame:void 0,field:n,columns:d,rowIndex:e.rowIndex,frame:e.frame,showColumns:()=>u(!0),key:r,label:r,isDerivedField:!1,value:s});if(p&&(null==o?void 0:o.name)){const t=null==o?void 0:o.values[e.rowIndex];if((null==o?void 0:o.type)===i.FieldType.string&&t)return a().createElement(Ne,{originalFrame:null==g?void 0:g.raw,originalField:o,field:n,value:t,columns:d,rowIndex:e.rowIndex,frame:e.frame,showColumns:()=>u(!0),key:o.name,label:o.name,isDerivedField:!0})}return null})).filter((e=>e)))(e.labels),b=p===B.auto,y=f.length>0;return a().createElement(Se,{onMouseIn:()=>{v(!0)},onMouseOut:()=>{v(!1)},rowIndex:e.rowIndex,field:e.field},a().createElement(H.ScrollSyncPane,{innerRef:h,group:"horizontal"},a().createElement("div",{className:c.content},0===e.fieldIndex&&a().createElement(ke,{rowIndex:e.rowIndex,value:t}),b&&y&&a().createElement(a().Fragment,null,f),p===B.labels&&y&&a().createElement(a().Fragment,null,f),p===B.labels&&!y&&a().createElement(Me,{value:t}),b&&!y&&a().createElement(Me,{value:t}),p===B.text&&a().createElement(Me,{value:t}),m&&a().createElement(Ae,{scrollerRef:h}))))},Ve=e=>({content:S.css`
    white-space: nowrap;
    overflow-x: auto;
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
    padding-right: 30px;
    display: flex;
    align-items: flex-start;
    height: 100%;
    &::-webkit-scrollbar {
      display: none; /* Chrome, Safari and Opera */
    }

    &:after {
      pointer-events: none;
      content: '';
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0;
      top: 0;
      // Fade out text in last 10px to background color to add affordance to horiziontal scroll
      background: linear-gradient(to right, transparent calc(100% - 10px), ${e.colors.background.primary});
    }
  `}),We=e=>{const{setHeaderMenuActive:t,isHeaderMenuActive:n}=Z(),{logsFrame:i}=Ce(),l=(0,r.useRef)(null),o=((e,t,n)=>({tableHeaderMenu:(0,S.css)({label:"tableHeaderMenu",width:"100%",minWidth:"250px",height:"100%",maxHeight:"400px",backgroundColor:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`,padding:e.spacing(2),margin:e.spacing(1,0),boxShadow:e.shadows.z3,borderRadius:e.shape.radius.default}),button:(0,S.css)({appearance:"none",right:"5px",background:"none",border:"none",padding:0}),wrapper:(0,S.css)({display:"flex",marginLeft:t?"56px":"6px",width:n?"calc(100% + 6px)":"100%",borderRight:`1px solid ${e.colors.border.weak}`,marginRight:"-6px"}),defaultContentWrapper:(0,S.css)({borderLeft:t?`1px solid ${e.colors.border.weak}`:"none",marginLeft:t?"-6px":0,paddingLeft:t?"12px":0,display:"flex"})}))((0,s.useTheme2)(),0===e.fieldIndex,e.field.name===$(i));return a().createElement("span",{className:o.wrapper},a().createElement("span",{className:o.defaultContentWrapper},e.defaultContent),a().createElement("button",{className:o.button,ref:l,onClick:e=>{t(!n)}},a().createElement(s.Icon,{title:"Show menu",name:"ellipsis-v"})),l.current&&a().createElement(s.Popover,{show:n,content:a().createElement(s.ClickOutsideWrapper,{onClick:()=>t(!1),useCapture:!0},a().createElement("div",{className:o.tableHeaderMenu},e.children)),referenceElement:l.current}))};function ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function He(e){const{setHeaderMenuActive:t}=Z(),{columns:n,setColumns:i,bodyState:l,setBodyState:o}=z(),{logsFrame:c}=Ce(),d=qe(),u=(0,r.useCallback)((e=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ze(e,t,n[t])}))}return e}({},n);Object.keys(t).filter((n=>{const r=t[n].index,a=t[e.name].index;return t[n].active&&a&&r&&r>a})).map((e=>t[e])).forEach((e=>{void 0!==e.index&&e.index--})),t[e.name].active=!1,t[e.name].index=void 0,i(t)}),[n,i]),p=e.headerProps.field.name===$(c);return a().createElement(We,e.headerProps,a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{e.openColumnManagementDrawer(),t(!1)}},a().createElement(s.Icon,{className:d.icon,name:"columns",size:"md"}),"Manage columns")),a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>u(e.headerProps.field)},a().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 16",width:"17",height:"16",className:"css-q2u0ig-Icon"},a().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.73446 1.33301H12.2345C12.3892 1.33301 12.5375 1.40325 12.6469 1.52827C12.7563 1.65329 12.8178 1.82286 12.8178 1.99967V4.74967C12.8178 5.07184 12.5566 5.33301 12.2345 5.33301C11.9123 5.33301 11.6511 5.07184 11.6511 4.74967V2.66634H7.56779V13.333H11.6511V10.9163C11.6511 10.5942 11.9123 10.333 12.2345 10.333C12.5566 10.333 12.8178 10.5942 12.8178 10.9163V13.9997C12.8178 14.1765 12.7563 14.3461 12.6469 14.4711C12.5375 14.5961 12.3892 14.6663 12.2345 14.6663H1.73446C1.57975 14.6663 1.43137 14.5961 1.32198 14.4711C1.21258 14.3461 1.15112 14.1765 1.15112 13.9997V1.99967C1.15112 1.82286 1.21258 1.65329 1.32198 1.52827C1.43137 1.40325 1.57975 1.33301 1.73446 1.33301ZM2.31779 13.333H6.40112V2.66634H2.31779V13.333Z",fill:"#CCCCDC",fillOpacity:"1"}),a().createElement("path",{d:"M15.9893 10.6315C15.9498 10.7263 15.8919 10.8123 15.819 10.8846C15.7467 10.9575 15.6607 11.0154 15.5659 11.0549C15.4712 11.0943 15.3695 11.1147 15.2668 11.1147C15.1641 11.1147 15.0625 11.0943 14.9677 11.0549C14.8729 11.0154 14.7869 10.9575 14.7146 10.8846L12.9335 9.09573L11.1524 10.8846C11.0801 10.9575 10.9941 11.0154 10.8993 11.0549C10.8045 11.0943 10.7028 11.1147 10.6002 11.1147C10.4975 11.1147 10.3958 11.0943 10.301 11.0549C10.2063 11.0154 10.1202 10.9575 10.0479 10.8846C9.97504 10.8123 9.91717 10.7263 9.87769 10.6315C9.8382 10.5367 9.81787 10.4351 9.81787 10.3324C9.81787 10.2297 9.8382 10.1281 9.87769 10.0333C9.91717 9.9385 9.97504 9.85248 10.0479 9.78017L11.8368 7.99906L10.0479 6.21795C9.90148 6.07149 9.8192 5.87285 9.8192 5.66573C9.8192 5.4586 9.90148 5.25996 10.0479 5.1135C10.1944 4.96705 10.393 4.88477 10.6002 4.88477C10.8073 4.88477 11.0059 4.96705 11.1524 5.1135L12.9335 6.90239L14.7146 5.1135C14.8611 4.96705 15.0597 4.88477 15.2668 4.88477C15.4739 4.88477 15.6726 4.96705 15.819 5.1135C15.9655 5.25996 16.0478 5.4586 16.0478 5.66573C16.0478 5.87285 15.9655 6.07149 15.819 6.21795L14.0302 7.99906L15.819 9.78017C15.8919 9.85248 15.9498 9.9385 15.9893 10.0333C16.0288 10.1281 16.0491 10.2297 16.0491 10.3324C16.0491 10.4351 16.0288 10.5367 15.9893 10.6315Z",fill:"#CCCCDC",fillOpacity:"1"})),"Remove column")),e.slideLeft&&a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{var t;return null===(t=e.slideLeft)||void 0===t?void 0:t.call(e,n)}},a().createElement(s.Icon,{className:(0,S.cx)(d.icon,d.reverse),name:"arrow-from-right",size:"md"}),"Move left")),e.slideRight&&a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{var t;return null===(t=e.slideRight)||void 0===t?void 0:t.call(e,n)}},a().createElement(s.Icon,{className:d.icon,name:"arrow-from-right",size:"md"}),"Move right")),p&&a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{l===B.text?o(B.labels):o(B.text)}},l===B.text?a().createElement(s.Icon,{className:d.icon,name:"brackets-curly",size:"md"}):a().createElement(s.Icon,{className:d.icon,name:"text-fields",size:"md"}),l===B.text?"Show labels":"Show log text")),e.autoColumnWidths&&a().createElement("div",{className:d.linkWrap},a().createElement("a",{className:d.link,onClick:()=>{var t;return null===(t=e.autoColumnWidths)||void 0===t?void 0:t.call(e)}},a().createElement(s.Icon,{className:d.icon,name:"arrows-h",size:"md"}),"Reset column widths")))}const qe=()=>({reverse:(0,S.css)({transform:"scaleX(-1)"}),link:(0,S.css)({paddingTop:"5px",paddingBottom:"5px"}),icon:(0,S.css)({marginRight:"10px"}),linkWrap:(0,S.css)({})});function Qe(e,t,n,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){return void n(e)}s.done?t(o):Promise.resolve(o).then(r,a)}function Ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ue(e,t,n[t])}))}return e}function Je(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ye(e){return a().createElement(s.Table,{onColumnResize:e.onResize,initialSortBy:[{displayName:D(e.logsFrame),desc:!0}],initialRowIndex:e.selectedLine,cellHeight:Q.qM.Sm,data:e.data,height:e.height,width:e.width,footerOptions:{show:!0,reducer:["count"],countRows:!0}})}const Xe=e=>{const{height:t,timeZone:n,logsFrame:l,width:o,labels:c}=e,d=(0,s.useTheme2)(),u={section:(0,S.css)({position:"relative"}),tableWrap:(0,S.css)({".cellActions":{display:"none !important"}})},[p,g]=(0,r.useState)(void 0),{columns:m,visible:v,setVisible:b,setFilteredColumns:y,setColumns:O,clearSelectedLine:x,columnWidthMap:E,setColumnWidthMap:C}=z(),{selectedLine:F}=Ce(),[j]=(0,r.useState)(F),P=be(O),L=(0,h.getTemplateSrv)(),_=(0,r.useMemo)((()=>L.replace.bind(L)),[L]),k=(0,r.useCallback)((e=>{if(!e.length)return e;const[t]=(0,i.applyFieldOverrides)({data:[e],timeZone:n,theme:d,replaceVariables:_,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const[n,d]of t.fields.entries()){var r,s;d.type=d.type===i.FieldType.string?null!==(r=Ze(d))&&void 0!==r?r:i.FieldType.string:d.type,d.config=Je(Ge({},d.config),{custom:Ge({inspect:!0,filterable:!0,headerComponent:t=>a().createElement(X,null,a().createElement(He,{headerProps:Je(Ge({},t),{fieldIndex:n}),openColumnManagementDrawer:()=>b(!0),slideLeft:0!==n?e=>P(e,n,n-1):void 0,slideRight:n!==e.fields.length-1?e=>P(e,n,n+1):void 0,autoColumnWidths:Object.keys(E).length>0?()=>{C({})}:void 0})),width:null!==(s=E[d.name])&&void 0!==s?s:tt(d,n,m,o,t.fields.length,l),cellOptions:et(d,n,c,l)},d.config.custom),filterable:!0})}return t}),[n,d,c,o,_,b,E]);(0,r.useEffect)((()=>{const e=(t=function*(){const e=(t=l.raw).fields.filter((e=>{var n,r,a;const l="json.RawMessage"===(null===(n=e.typeInfo)||void 0===n?void 0:n.frame)&&"labels"===e.name&&(null==t||null===(r=t.meta)||void 0===r?void 0:r.type)!==i.DataFrameType.LogLines,s="labels"===e.name&&e.type===i.FieldType.other&&(null==t||null===(a=t.meta)||void 0===a?void 0:a.type)===i.DataFrameType.LogLines;return l||s})).flatMap((e=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:e.name}}]));var t;const n=function(e){let t={};for(const n in e)t[n]=!0;return Object.keys(e).length>0?{id:"organize",options:{indexByName:e,includeByName:t}}:null}(function(e){let t={};return Object.keys(e).filter((t=>e[t].active)).forEach((n=>{const r=e[n].index;void 0!==r&&(t[n]=r)})),t}(m));if(n)e.push(n);else{const t={time:l.timeField,body:l.bodyField,extraFields:l.extraFields};t&&void 0!==t.body&&void 0!==t.time&&e.push(function(e){return{id:"organize",options:{indexByName:{[e.time.name]:0,[e.body.name]:1},includeByName:{[e.body.name]:!0,[e.time.name]:!0}}}}(t))}if(e.length>0){const t=yield(0,q.lastValueFrom)((0,i.transformDataFrame)(e,[l.raw])),n=k(t[0]);g(n)}else g(k(l.raw))},n=function(){var e=this,n=arguments;return new Promise((function(r,a){var i=t.apply(e,n);function l(e){Qe(i,r,a,l,s,"next",e)}function s(e){Qe(i,r,a,l,s,"throw",e)}l(void 0)}))},function(){return n.apply(this,arguments)});var t,n;e()}),[l.raw,l.bodyField,l.timeField,l.extraFields,k,m]),(0,r.useEffect)((()=>{j&&F&&x()}),[j,x,F]);const T=l.raw.fields.find((e=>e.name===function(e){var t,n;return null!==(n=null==e||null===(t=e.idField)||void 0===t?void 0:t.name)&&void 0!==n?n:"id"}(l))),D=null==T?void 0:T.values.findIndex((e=>e===(null==j?void 0:j.id))),$=D&&-1!==D?D:void 0;return p?a().createElement("div",{"data-testid":f.b.table.wrapper,className:u.section},v&&a().createElement(s.Drawer,{size:"sm",onClose:()=>{b(!1),y(m)}},a().createElement(ye,null)),a().createElement("div",{className:u.tableWrap},a().createElement(G,null,a().createElement(H.ScrollSync,{horizontal:!0,vertical:!1,proportional:!1},a().createElement(Ye,{logsFrame:l,selectedLine:$,data:p,height:t,width:o,onResize:(0,w.debounce)(((e,t)=>{const n=Object.keys(m).filter((e=>m[e].active)).find((t=>t===e));if(n&&t>0){const e=Ge({},E);e[n]=t,C(e)}}),100)}))))):a().createElement(a().Fragment,null)};function Ze(e){if(e.name){const t=e.name.toLowerCase();if("date"===t||"time"===t)return i.FieldType.time}for(let t=0;t<e.values.length;t++){const n=e.values[t];if(null!=n)return lt(n)}}const Ke=()=>({options:{critical:{color:"#705da0",index:0},crit:{color:"#705da0",index:1},error:{color:"#e24d42",index:2},err:{color:"#e24d42",index:3},eror:{color:"#e24d42",index:4},warning:{color:"#FF9900",index:5},warn:{color:"#FF9900",index:6},info:{color:"#7eb26d",index:7},debug:{color:"#1f78c1",index:8},trace:{color:"#6ed0e0",index:9}},type:i.MappingType.ValueToText});function et(e,t,n,r){return e.name===$(r)?{cellComponent:e=>a().createElement(Re,Je(Ge({},e),{fieldIndex:t,labels:n[e.rowIndex]})),type:s.TableCellDisplayMode.Custom}:{cellComponent:e=>a().createElement(Te,Je(Ge({},e),{fieldIndex:t})),type:s.TableCellDisplayMode.Custom}}function tt(e,t,n,r,a,l){var s,o;const c=a<=2?r:Math.min(r/2),d=0===t?50:0;if(e.type===i.FieldType.time)return 200+d;const u=n[e.name];if(void 0===u)return;var p;const g=Math.max(null!==(p=u.maxLength)&&void 0!==p?p:0,e.name.length);return u.maxLength?Math.min(Math.max(6.5*g+95+d,90+d),c):e.name!==$(l)?Math.min(Math.max(6.5*(null!==(m=null===(o=e.values)||void 0===o||null===(s=o[0])||void 0===s?void 0:s.length)&&void 0!==m?m:80)+95+d,90+d),c):void 0;var m}var nt=n(5540);const rt=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,at=e=>{const{logsFrame:t}=Ce(),[n,l]=(0,r.useState)({width:0,height:0});(0,nt.w)({ref:e.panelWrap,onResize:()=>{const t=e.panelWrap.current;t&&(n.width===t.clientWidth&&n.height===t.clientHeight||l({width:t.clientWidth,height:t.clientHeight}))}});const s={section:(0,S.css)({position:"relative"})},o=(0,i.getTimeZone)(),c=(0,r.useCallback)((t=>{const n=e.urlColumns;return(null==n?void 0:n.length)&&Object.values(n).forEach(((e,n)=>{t[e]&&(t[e].active=!0,t[e].index=n)})),t}),[e.urlColumns]);if(!t||!t.raw.length)return null;var d;const u=null!==(d=t.getLogFrameLabelsAsLabels())&&void 0!==d?d:[],p=t?t.raw.length:0;let g=function(e,t){let n={};const r=new Map,a=function(e){const t=new Map;return e.forEach((e=>{Object.keys(e).forEach((n=>{if(t.has(n)){const r=t.get(n),a=null==r?void 0:r.valueSet,i=null==r?void 0:r.maxLength;a&&!(null==a?void 0:a.has(e[n]))&&(null==a||a.add(e[n]),i&&e[n].length>i&&t.set(n,{maxLength:e[n].length,valueSet:a}))}else t.set(n,{maxLength:e[n].length,valueSet:new Set([e[n]])})}))})),t}(t),i=e?e.length:0;return(null==t?void 0:t.length)&&i&&(t.forEach((e=>{Object.keys(e).forEach((e=>{var t;const n=a.get(e);var i;const l=null!==(i=null==n||null===(t=n.valueSet)||void 0===t?void 0:t.size)&&void 0!==i?i:0;if(r.has(e)){const t=r.get(e);t&&((null==t?void 0:t.active)?r.set(e,{percentOfLinesWithLabel:t.percentOfLinesWithLabel+1,active:!0,index:t.index,cardinality:l,maxLength:null==n?void 0:n.maxLength}):r.set(e,{percentOfLinesWithLabel:t.percentOfLinesWithLabel+1,active:!1,index:void 0,cardinality:l,maxLength:null==n?void 0:n.maxLength}))}else r.set(e,{percentOfLinesWithLabel:1,active:!1,index:void 0,cardinality:l,maxLength:null==n?void 0:n.maxLength})}))})),n=Object.fromEntries(r),Object.keys(n).forEach((e=>{n[e].percentOfLinesWithLabel=it(n[e].percentOfLinesWithLabel,i)}))),n}(t.raw,u);const m={time:t.timeField,body:t.bodyField,extraFields:t.extraFields};return m&&(function(e,t,n){e.forEach((e=>{var r,a;if(!e)return;const i=null===(r=t[e.name])||void 0===r?void 0:r.active,l=null===(a=t[e.name])||void 0===a?void 0:a.index;t[e.name]=i&&void 0!==l?{percentOfLinesWithLabel:it(e.values.filter((e=>null!=e)).length,n),active:!0,index:l,cardinality:n}:{percentOfLinesWithLabel:it(e.values.filter((e=>null!=e)).length,n),active:!1,index:void 0,cardinality:n}}))}([m.time,m.body,...m.extraFields],g,p),g=c(g),function(e,t,n){var r,a,i,l,s,o,c,d,u,p;0===e.length&&((null===(i=t.body)||void 0===i?void 0:i.name)&&(n[null===(s=t.body)||void 0===s?void 0:s.name].active=!0,n[null===(o=t.body)||void 0===o?void 0:o.name].index=1),(null===(l=t.time)||void 0===l?void 0:l.name)&&(n[null===(c=t.time)||void 0===c?void 0:c.name].active=!0,n[null===(d=t.time)||void 0===d?void 0:d.name].index=0));(null===(r=t.time)||void 0===r?void 0:r.name)&&(null===(a=t.body)||void 0===a?void 0:a.name)&&(n[null===(u=t.body)||void 0===u?void 0:u.name].type="BODY_FIELD",n[null===(p=t.time)||void 0===p?void 0:p.name].type="TIME_FIELD");t.extraFields.length&&t.extraFields.forEach((e=>{var t;(null===(t=e.config.links)||void 0===t?void 0:t.length)&&(n[e.name].type="LINK_FIELD")}))}(Object.keys(g).filter((e=>g[e].active)),m,g)),a().createElement("section",{className:s.section},a().createElement(V,{logsFrame:t,initialColumns:g,setUrlColumns:e.setUrlColumns,clearSelectedLine:e.clearSelectedLine},a().createElement(Xe,{logsFrame:t,timeZone:o,height:n.height-50,width:n.width-25,labels:u})))},it=(e,t)=>Math.ceil(100*e/t);function lt(e){let t=(0,i.guessFieldTypeFromValue)(e);return"string"===t&&rt.test(e)&&(t=i.FieldType.time),t}const st=({dataFrame:e,setUrlColumns:t,urlColumns:n,addFilter:r,selectedLine:l,timeRange:s,panelWrap:o,clearSelectedLine:c})=>{if(!e)return null;const d=(null===(p=(u=e).meta)||void 0===p?void 0:p.type)===i.DataFrameType.LogLines?function(e){const t=new i.FieldCache(e),n=L(t,_,i.FieldType.time),r=L(t,k,i.FieldType.string);if(void 0===n||void 0===r)return null;var a;const l=null!==(a=L(t,"severity",i.FieldType.string))&&void 0!==a?a:null;var s;const o=null!==(s=L(t,"id",i.FieldType.string))&&void 0!==s?s:null;var c;const d=null!==(c=L(t,"labels",i.FieldType.other))&&void 0!==c?c:null,u=null===d?null:d.values,p=t.fields.filter(((e,t)=>t!==n.index&&t!==r.index&&t!==(null==l?void 0:l.index)&&t!==(null==o?void 0:o.index)&&t!==(null==d?void 0:d.index)));return{raw:e,timeField:n,bodyField:r,severityField:l,idField:o,getLogFrameLabels:()=>u,timeNanosecondField:null,getLogFrameLabelsAsLabels:()=>null!==u?u.map(T):null,getLabelFieldName:()=>null!==d?d.name:null,extraFields:p}}(u):function(e){const t=new i.FieldCache(e),n=t.getFirstFieldOfType(i.FieldType.time),r=t.getFirstFieldOfType(i.FieldType.string);if(void 0===n||void 0===r)return null;var a;const l=null!==(a=t.getFieldByName("tsNs"))&&void 0!==a?a:null;var s;const o=null!==(s=t.getFieldByName("level"))&&void 0!==s?s:null;var c;const d=null!==(c=t.getFieldByName("id"))&&void 0!==c?c:null,[u,p]=function(e,t,n){const r=e.getFieldByName("labels");if(void 0!==r&&r.type===i.FieldType.other){const e=r.values.map(T);return[r,()=>e]}return[null,()=>function(e,t){const n=e.labels;if(void 0!==n){const e=new Array(t);return e.fill(n),e}return null}(t,n.length)]}(t,r,e),g=t.fields.filter(((e,t)=>t!==n.index&&t!==r.index&&t!==(null==l?void 0:l.index)&&t!==(null==o?void 0:o.index)&&t!==(null==d?void 0:d.index)&&t!==(null==u?void 0:u.index)));return{timeField:n,bodyField:r,timeNanosecondField:l,severityField:o,idField:d,getLogFrameLabels:p,getLogFrameLabelsAsLabels:p,getLabelFieldName:()=>{var e;return null!==(e=null==u?void 0:u.name)&&void 0!==e?e:null},extraFields:g,raw:e}}(u);var u,p;return d?a().createElement(Ee,{addFilter:r,selectedLine:l,timeRange:s,logsFrame:d},a().createElement(at,{setUrlColumns:t,urlColumns:n,panelWrap:o,clearSelectedLine:c})):null};function ot(e){return a().createElement("div",{className:ct.visualisationType},a().createElement(s.RadioButtonGroup,{className:ct.visualisationTypeRadio,options:[{label:"Logs",value:"logs",description:"Show results in logs visualisation"},{label:"Table",value:"table",description:"Show results in table visualisation"}],size:"sm",value:e.vizType,onChange:e.onChange}))}const ct={visualisationType:(0,S.css)({display:"flex",flex:"1",justifyContent:"space-between",marginTop:"8px"}),visualisationTypeRadio:(0,S.css)({margin:"0 0 0 8px"})};var dt,ut,pt,gt=n(558),mt=n(7097);class vt extends l.Bs{}pt=({model:e})=>{const t=ht(),n=l.jh.getAncestor(e,Ct),{data:i}=l.jh.getData(e).useState(),{selectedLine:o,urlColumns:c,visualizationType:d}=n.useState(),u=l.jh.getTimeRange(e),{value:p}=u.useState(),m=Tn(i),v=(0,r.useRef)(null);return a().createElement("div",{className:t.panelWrapper,ref:v},a().createElement(s.PanelChrome,{loadingState:null==i?void 0:i.state,title:"Logs",actions:a().createElement(ot,{vizType:d,onChange:n.setVisualizationType})},m&&a().createElement(st,{panelWrap:v,addFilter:t=>{const r=(0,mt.OE)(m,t.key,e);(0,gt.XI)(t,n,r)},timeRange:p,selectedLine:o,urlColumns:null!=c?c:[],setUrlColumns:e=>{(0,g.B)(e,n.state.urlColumns)||n.setState({urlColumns:e})},dataFrame:m,clearSelectedLine:()=>{n.state.selectedLine&&n.clearSelectedLine()}})))},(ut="Component")in(dt=vt)?Object.defineProperty(dt,ut,{value:pt,enumerable:!0,configurable:!0,writable:!0}):dt[ut]=pt;const ht=()=>({panelWrapper:(0,S.css)({height:"100%"})});var ft=n(227);function bt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class yt extends l.Bs{constructor(e){var t,n;super((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){bt(e,t,n[t])}))}return e}({},e),n=null!=(n={wrapLines:Boolean((0,ft.YM)("wrapLines"))})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t)),bt(this,"handleWrapLinesChange",(e=>{const t=e.target.checked;this.setState({wrapLines:t}),(0,ft.YK)("wrapLines",t),this.getParentScene().setLogsVizOption({wrapLogMessage:t})})),bt(this,"getParentScene",(()=>l.jh.getAncestor(this,Ct))),bt(this,"clearDisplayedFields",(()=>{this.getParentScene().clearDisplayedFields(),(0,b.EE)(b.NO.service_details,b.ir.service_details.logs_clear_displayed_fields)}))}}bt(yt,"Component",(function({model:e}){const{wrapLines:t}=e.useState(),{displayedFields:n}=e.getParentScene().useState();return a().createElement(a().Fragment,null,a().createElement(s.InlineField,{label:"Wrap lines",transparent:!0,htmlFor:"wrap-lines-switch"},a().createElement(s.InlineSwitch,{value:t,onChange:e.handleWrapLinesChange,className:St.horizontalInlineSwitch,transparent:!0,id:"wrap-lines-switch"})),n.length>0&&a().createElement(s.Tooltip,{content:`Clear displayed fields: ${n.join(", ")}`},a().createElement(s.Button,{variant:"secondary",fill:"outline",onClick:e.clearDisplayedFields},"Show original log line")))}));const St={input:(0,S.css)({width:"100%"}),field:(0,S.css)({label:"field",marginBottom:0}),horizontalInlineSwitch:(0,S.css)({padding:"0 4px 0 0"})};function wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ot extends l.Bs{onActivate(){this.state.body||this.setState({body:this.getLogsPanel()})}setLogsVizOption(e={}){this.state.body&&this.state.body.onOptionsChange(e)}getParentScene(){return l.jh.getAncestor(this,Ct)}getLogsPanel(){const e=this.getParentScene(),t=e.state.visualizationType;return l.d0.logs().setTitle("Logs").setOption("showTime",!0).setOption("onClickFilterLabel",this.handleLabelFilterClick).setOption("onClickFilterOutLabel",this.handleLabelFilterOutClick).setOption("isFilterLabelActive",this.handleIsFilterLabelActive).setOption("onClickFilterString",this.handleFilterStringClick).setOption("onClickShowField",this.onClickShowField).setOption("onClickHideField",this.onClickHideField).setOption("displayedFields",e.state.displayedFields).setOption("wrapLogMessage",Boolean((0,ft.YM)("wrapLines"))).setOption("showLogContextToggle",!0).setHeaderActions(a().createElement(ot,{vizType:t,onChange:e.setVisualizationType})).build()}handleLabelFilter(e,t,n,r){const a=(0,mt.OE)(n,e,this);(0,gt.Qt)(e,t,r,this,a),(0,b.EE)(b.NO.service_details,b.ir.service_details.logs_detail_filter_applied,{filterType:a,key:e,action:r})}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){wt(e,t,n[t])}))}return e}({},e)),wt(this,"onClickShowField",(e=>{const t=this.getParentScene();if(-1===t.state.displayedFields.indexOf(e)&&this.state.body){const n=[...t.state.displayedFields,e];this.setLogsVizOption({displayedFields:n}),t.setState({displayedFields:n}),(0,ft.ZF)(this,t.state.displayedFields),(0,b.EE)(b.NO.service_details,b.ir.service_details.logs_toggle_displayed_field)}})),wt(this,"onClickHideField",(e=>{const t=this.getParentScene();if(t.state.displayedFields.indexOf(e)>=0&&this.state.body){const n=t.state.displayedFields.filter((t=>e!==t));this.setLogsVizOption({displayedFields:n}),t.setState({displayedFields:n}),(0,ft.ZF)(this,t.state.displayedFields),(0,b.EE)(b.NO.service_details,b.ir.service_details.logs_toggle_displayed_field)}})),wt(this,"clearDisplayedFields",(()=>{this.state.body&&(this.setLogsVizOption({displayedFields:[]}),(0,ft.ZF)(this,[]))})),wt(this,"handleLabelFilterClick",((e,t,n)=>{this.handleLabelFilter(e,t,n,"toggle")})),wt(this,"handleLabelFilterOutClick",((e,t,n)=>{this.handleLabelFilter(e,t,n,"exclude")})),wt(this,"handleIsFilterLabelActive",((e,t)=>{const n=(0,C.bY)(d.MB,this),r=(0,C.bY)(d.mB,this),a=(0,C.bY)(d._Y,this),i=(0,C.bY)(d._P,this),l=n=>n&&n.state.filters.findIndex((n=>"="===n.operator&&n.key===e&&n.value===t))>=0;return l(n)||(n=>{if(n){const r=n.state.filters.find((t=>"="===t.operator&&t.key===e));if(r)return(0,C.bu)(r,e).value===t}return!1})(r)||l(a)||l(i)})),wt(this,"handleFilterStringClick",(e=>{const t=l.jh.getAncestor(this,Ct).getLineFilterScene();t&&(t.updateFilter(e,!1),(0,b.EE)(b.NO.service_details,b.ir.service_details.logs_popover_line_filter,{selectionLength:e.length}))})),this.addActivationHandler(this.onActivate.bind(this))}}function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}wt(Ot,"Component",(({model:e})=>{const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):a().createElement(s.LoadingPlaceholder,{text:"Loading..."})}));const Et="grafana.explore.logs.visualisationType";class Ct extends l.Bs{getUrlState(){var e;const t=null!==(e=this.state.urlColumns)&&void 0!==e?e:[],n=this.state.selectedLine,r=this.state.visualizationType;var a,i;const l=null!==(i=null!==(a=this.state.displayedFields)&&void 0!==a?a:(0,ft.N$)(this))&&void 0!==i?i:[];return{urlColumns:JSON.stringify(t),selectedLine:JSON.stringify(n),visualizationType:JSON.stringify(r),displayedFields:JSON.stringify(l)}}updateFromUrl(e){const t={};try{if("string"==typeof e.urlColumns){const n=JSON.parse(e.urlColumns);n!==this.state.urlColumns&&(t.urlColumns=n)}if("string"==typeof e.selectedLine){const n=JSON.parse(e.selectedLine);n!==this.state.selectedLine&&(t.selectedLine=n)}if("string"==typeof e.visualizationType){const n=JSON.parse(e.visualizationType);n!==this.state.visualizationType&&(t.visualizationType=n)}if("string"==typeof e.displayedFields){const n=JSON.parse(e.displayedFields);n&&n.length&&(t.displayedFields=n)}}catch(e){N.v.error(e,{msg:"LogsListScene: updateFromUrl unexpected error"})}Object.keys(t).length&&this.setState(t)}clearSelectedLine(){this.setState({selectedLine:void 0})}onActivate(){const e=new URLSearchParams(h.locationService.getLocation().search);this.setStateFromUrl(e),this.state.panel||this.updateLogsPanel(),this._subs.add(this.subscribeToState(((e,t)=>{e.visualizationType!==t.visualizationType&&this.updateLogsPanel()})))}getLineFilterScene(){return this.lineFilterScene}setStateFromUrl(e){const t=e.get("selectedLine"),n=e.get("urlColumns"),r=e.get("visualizationType");var a;const i=null!==(a=e.get("displayedFields"))&&void 0!==a?a:JSON.stringify((0,ft.N$)(this));this.updateFromUrl({selectedLine:t,urlColumns:n,vizType:r,displayedFields:i})}getVizPanel(){return this.lineFilterScene=new j,this.logsPanelScene=new Ot({}),new l.G1({direction:"column",children:"logs"===this.state.visualizationType?[new l.G1({children:[new l.vA({body:this.lineFilterScene,xSizing:"fill"}),new yt]}),new l.vA({height:"calc(100vh - 220px)",body:this.logsPanelScene})]:[new l.vA({body:this.lineFilterScene,xSizing:"fill"}),new l.vA({height:"calc(100vh - 220px)",body:new vt({})})]})}constructor(e){var t,n,r;super((n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){xt(e,t,n[t])}))}return e}({},e),r=null!=(r={visualizationType:null!==(t=localStorage.getItem(Et))&&void 0!==t?t:"logs",displayedFields:[]})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(r)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})),n)),xt(this,"_urlSync",new l.So(this,{keys:["urlColumns","selectedLine","visualizationType","displayedFields"]})),xt(this,"lineFilterScene",void 0),xt(this,"logsPanelScene",void 0),xt(this,"clearDisplayedFields",(()=>{this.setState({displayedFields:[]}),this.logsPanelScene&&this.logsPanelScene.clearDisplayedFields()})),xt(this,"setLogsVizOption",((e={})=>{this.logsPanelScene&&this.logsPanelScene.setLogsVizOption(e)})),xt(this,"updateLogsPanel",(()=>{this.setState({panel:this.getVizPanel()})})),xt(this,"setVisualizationType",(e=>{this.setState({visualizationType:e}),(0,b.EE)(b.NO.service_details,b.ir.service_details.logs_visualization_toggle,{visualisationType:e}),localStorage.setItem(Et,e)})),this.addActivationHandler(this.onActivate.bind(this))}}xt(Ct,"Component",(({model:e})=>{const{panel:t}=e.useState();if(t)return a().createElement("div",{className:Ft.panelWrapper},a().createElement(t.Component,{model:t}))}));const Ft={panelWrapper:(0,S.css)({".show-on-hover":{display:"none"},'section > div[class$="panel-content"]':(0,S.css)({contain:"none",overflow:"auto"})})};var jt=n(8810),Pt=n(4105),Lt=n(9570),_t=n(7311);function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Tt(e){var t,n;const{indexScene:r,pattern:a,type:i}=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){kt(e,t,n[t])}))}return e}({},e),s=l.jh.getAncestor(r,_t.P);if(!s)return void N.v.warn("logs exploration scene not found");const{patterns:o=[]}=s.state,c=o.filter((e=>e.pattern!==a));var d;const u=null!==(d=null===(t=c.filter((e=>"include"===e.type)))||void 0===t?void 0:t.length)&&void 0!==d?d:0;var p;const g=null!==(p=null===(n=c.filter((e=>"exclude"===e.type)))||void 0===n?void 0:n.length)&&void 0!==p?p:0;(0,b.EE)(b.NO.service_details,b.ir.service_details.pattern_selected,{type:i,includePatternsLength:u+("include"===i?1:0),excludePatternsLength:g+("exclude"===i?1:0)}),"undo"===i?s.setState({patterns:c}):s.setState({patterns:[...c,{pattern:a,type:i}]})}var Dt=n(5218);const $t=e=>({logsStatsRow:(0,S.css)({margin:`${e.spacing(1.15)}px 0`}),logsStatsRowActive:(0,S.css)({color:e.colors.primary.text,position:"relative"}),logsStatsRowLabel:(0,S.css)({display:"flex",marginBottom:"1px"}),logsStatsRowValue:(0,S.css)({flex:1,textOverflow:"ellipsis",overflow:"hidden"}),logsStatsRowCount:(0,S.css)({textAlign:"right",marginLeft:e.spacing(.75)}),logsStatsRowPercent:(0,S.css)({textAlign:"right",marginLeft:e.spacing(.75),width:e.spacing(4.5)}),logsStatsRowBar:(0,S.css)({height:e.spacing(.5),overflow:"hidden",background:e.colors.text.disabled}),logsStatsRowInnerBar:(0,S.css)({height:e.spacing(.5),overflow:"hidden",background:e.colors.primary.main})}),Nt=({active:e,count:t,proportion:n,value:r})=>{const i=(0,s.useStyles2)($t),l=`${Math.round(100*n)}%`,o={width:l};return a().createElement("div",{className:e?`${i.logsStatsRow} ${i.logsStatsRowActive}`:i.logsStatsRow},a().createElement("div",{className:i.logsStatsRowLabel},a().createElement("div",{className:i.logsStatsRowValue,title:r},r),a().createElement("div",{className:i.logsStatsRowCount},t),a().createElement("div",{className:i.logsStatsRowPercent},l)),a().createElement("div",{className:i.logsStatsRowBar},a().createElement("div",{className:i.logsStatsRowInnerBar,style:o})))};function It(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const At=e=>({logsStats:(0,S.css)({background:"inherit",color:e.colors.text.primary,wordBreak:"break-all",width:"fit-content",maxHeight:"40vh",overflowY:"auto",marginTop:e.spacing(1)}),logsStatsHeader:(0,S.css)({borderBottom:`1px solid ${e.colors.border.medium}`,display:"flex"}),logsStatsTitle:(0,S.css)({fontWeight:e.typography.fontWeightMedium,paddingRight:e.spacing(2),display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),logsStatsClose:(0,S.css)({cursor:"pointer"}),logsStatsBody:(0,S.css)({padding:"5px 0px"})}),Mt=e=>{const t=(0,s.useStyles2)(At),{stats:n,value:r}=e,i=n.slice(0,10);let l=i.find((e=>e.value===r)),o=n.slice(10);!l&&(l=o.find((e=>e.value===r)),o=o.filter((e=>e.value!==r)));const c=o.reduce(((e,t)=>e+t.count),0),d=i.reduce(((e,t)=>e+t.count),0)+c;let u=[...i];return c>0&&u.push({value:"Other",count:c,proportion:c/d}),u.sort(((e,t)=>t.count-e.count)),a().createElement("div",{className:t.logsStats},a().createElement("div",{className:t.logsStatsHeader},a().createElement("div",{className:t.logsStatsTitle},"From a sample of ",d," rows found")),a().createElement("div",{className:t.logsStatsBody},u.map((e=>{return a().createElement(Nt,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){It(e,t,n[t])}))}return e}({key:e.value},e),n=null!=(n={active:e.value===r})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t));var t,n}))))};function Bt(e,t,n,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){return void n(e)}s.done?t(o):Promise.resolve(o).then(r,a)}const Rt=({exploration:e,pattern:t})=>{const n=function(e){const t=[];let n=e.indexOf("<_>");for(;-1!==n;)t.push(n),n=e.indexOf("<_>",n+1);return t}(t),[o,d]=(0,r.useState)(void 0),[u,p]=(0,r.useState)(!1),g=(0,s.useStyles2)(Vt),v=(0,r.useRef)(null),h=(0,r.useRef)(null),f=(y=function*(){(0,b.EE)(b.NO.service_details,b.ir.service_details.pattern_field_clicked);const r=function(e,t,n){let r=1;const a=e.replace(/<_>/g,(()=>`<field_${r++}>`));return`{${n.state.filterExpression}} |> \`${e}\` | pattern \`${a}\` | keep ${t.map(((e,t)=>`field_${t+1}`)).join(" ,")} | line_format ""`}(t,n,(0,C.cR)(e)),a=yield(0,m.hJ)(e),s=l.jh.getTimeRange(e).state.value;o&&r===v.current&&s===h.current||(v.current=r,h.current=s,null==a||a.query({requestId:"1",interval:"",intervalMs:0,scopedVars:{},range:s,targets:[(0,c.l)(r,{maxLines:1e3})],timezone:"",app:"",startTime:0}).forEach((e=>{var t,r;e.state!==i.LoadingState.Done||(null===(t=e.errors)||void 0===t?void 0:t.length)?(e.state===i.LoadingState.Error||(null===(r=e.errors)||void 0===r?void 0:r.length))&&(d(void 0),p(!0)):(d(function(e,t){const n=new Map;e.data[0].fields[0].values.toArray().forEach((e=>{Object.keys(e).forEach((t=>{var r,a;n.has(t)||n.set(t,new Map),null===(a=n.get(t))||void 0===a||a.set(e[t],((null===(r=n.get(t))||void 0===r?void 0:r.get(e[t]))||0)+1)}))}));const r=[];for(let e=0;e<=t;e++){var a;const t=[];null===(a=n.get(`field_${e+1}`))||void 0===a||a.forEach(((e,n)=>{t.push({value:n,count:e,proportion:e/1e3})})),t.sort(((e,t)=>t.count-e.count)),r.push(t)}return r}(e,n.length)),p(!1))})))},S=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=y.apply(e,t);function i(e){Bt(a,n,r,i,l,"next",e)}function l(e){Bt(a,n,r,i,l,"throw",e)}i(void 0)}))},function(){return S.apply(this,arguments)});var y,S;const w=(0,r.useMemo)((()=>t.split("<_>")),[t]);return a().createElement("div",null,w.map(((e,t)=>a().createElement("span",{key:t},e,t!==n.length&&a().createElement(s.Toggletip,{onOpen:f,content:a().createElement(a().Fragment,null,o&&o[t].length>0&&a().createElement(Mt,{stats:o[t],value:""}),o&&0===o[t].length&&a().createElement("div",null,"No available stats for this field in the current timestamp."),!o&&u&&a().createElement("div",null,"Could not load stats for this pattern."),!o&&!u&&a().createElement("div",{style:{padding:"10px"}},a().createElement(s.Spinner,{size:"xl"})))},a().createElement("span",{className:g.pattern},"<_>"))))))};function Vt(e){return{pattern:(0,S.css)({cursor:"pointer",backgroundColor:e.colors.emphasize(e.colors.background.primary,.1),margin:"0 2px","&:hover":{backgroundColor:e.colors.emphasize(e.colors.background.primary,.2)}})}}function Wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class zt extends l.Bs{onActivate(){if(this.state.body)return;const e=(0,c.l)(d.SA);this.replacePatternsInQuery(e);const t=(0,o.rS)([e]);t.getResultsStream().subscribe((e=>{this.onQueryWithFiltersResult(e)})),this.setState({body:new l.G1({direction:"column",children:[new l.vA({body:void 0,width:"100%",height:0}),new l.vA({height:300,width:"100%",body:l.d0.logs().setHoverHeader(!0).setOption("showLogContextToggle",!0).setOption("showTime",!0).setData(t).build()})]})})}replacePatternsInQuery(e){const t={pattern:this.state.pattern,type:"include"},n=(0,c.M3)([t]);e.expr=e.expr.replace(d.sC,n)}removePatternFromFilterExclusion(){const e=l.jh.getAncestor(this,Qt);var t;const n=null!==(t=e.state.patternsNotMatchingFilters)&&void 0!==t?t:[],r=n.findIndex((e=>e===this.state.pattern));-1!==r&&(n.splice(r,1),e.setState({patternsNotMatchingFilters:n}))}setWarningMessage(e){const t=this.getNoticeFlexItem(),n=this.getVizFlexItem();return t instanceof l.vA&&t.setState({isHidden:!1,height:"auto",body:new l.dM({reactNode:e})}),n}getNoticeFlexItem(){const e=this.getFlexItemChildren();return null==e?void 0:e[0]}getVizFlexItem(){const e=this.getFlexItemChildren();return null==e?void 0:e[1]}getFlexItemChildren(){var e;return null===(e=this.state.body)||void 0===e?void 0:e.state.children}excludeThisPatternFromFiltering(){const e=l.jh.getAncestor(this,Qt);var t;const n=null!==(t=e.state.patternsNotMatchingFilters)&&void 0!==t?t:[];e.setState({patternsNotMatchingFilters:[...n,this.state.pattern]})}static Component({model:e}){const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):null}constructor(e){super(e),Wt(this,"clearFilters",(()=>{const e=(0,C.ir)(this),t=(0,C.Rr)(this),n=(0,C.iw)(this);if(e.setState({filters:[]}),n.setState({filters:[]}),t.state.value){t.changeValueTo("");const e=this.getNoticeFlexItem();null==e||e.setState({isHidden:!0}),this.removePatternFromFilterExclusion()}})),Wt(this,"onQueryError",(e=>{if(e.data.state===i.LoadingState.Done&&(0===e.data.series.length||e.data.series.every((e=>0===e.length)))||e.data.state===i.LoadingState.Error){let t;try{t={pattern:this.state.pattern,traceIds:JSON.stringify(e.data.traceIds),request:JSON.stringify(e.data.request)}}catch(e){t={pattern:this.state.pattern,msg:"Failed to encode context"}}N.v.error(new Error("Pattern sample query returns no results"),t),this.setWarningMessage(a().createElement(s.Alert,{severity:"error",title:""},"This pattern returns no logs."));const n=this.getVizFlexItem();n instanceof l.vA&&n.setState({isHidden:!0})}})),Wt(this,"onQueryWithFiltersResult",(e=>{const t=(0,c.l)(d.pT);this.replacePatternsInQuery(t);const n=(0,o.rS)([t]);if(n.getResultsStream().subscribe(this.onQueryError),e.data.state===i.LoadingState.Done&&(0===e.data.series.length||e.data.series.every((e=>0===e.length)))){const e=this.getNoticeFlexItem(),t=this.getVizFlexItem();if(e instanceof l.vA&&e.setState({isHidden:!1,height:"auto",body:new l.dM({reactNode:a().createElement(s.Alert,{severity:"warning",title:""},"The logs returned by this pattern do not match the current query filters.",a().createElement(s.Button,{className:Pt.ZI.button,onClick:()=>this.clearFilters()},"Clear filters"))})}),t instanceof l.vA){const e=t.state.body;e instanceof l.Eb&&(null==e||e.setState({$data:n}))}this.excludeThisPatternFromFiltering()}e.data.state===i.LoadingState.Error&&this.onQueryError(e)})),this.addActivationHandler(this.onActivate.bind(this))}}function Ht({tableViz:e,row:t}){const{expandedRows:n}=e.useState(),i=null==n?void 0:n.find((e=>e.state.key===t.pattern));return(0,r.useEffect)((()=>{if(!i){const a=(r=t.pattern,new zt({pattern:r,key:r}));var n;e.setState({expandedRows:[...null!==(n=e.state.expandedRows)&&void 0!==n?n:[],a]})}var r}),[t,e,i]),i?a().createElement(i.Component,{model:i}):null}const qt=[""," K"," Mil"," Bil"," Tri"," Quadr"," Quint"," Sext"," Sept"];class Qt extends l.Bs{buildColumns(e,t,n,r){const o=Yt(n),c=l.jh.getTimeRange(this).state.value,d=[{id:"volume-samples",header:"",cell:e=>{const t={timeRange:c,series:[e.cell.row.original.dataFrame],state:i.LoadingState.Done},n=new l.Zv({data:t}),r=l.d0.timeseries().setData(n).setHoverHeader(!0).setOption("tooltip",{mode:s.TooltipDisplayMode.None}).setCustomFieldConfig("hideFrom",{legend:!0,tooltip:!0}).setCustomFieldConfig("axisPlacement",s.AxisPlacement.Hidden).setDisplayMode("transparent").build();return a().createElement("div",{className:o.tableTimeSeriesWrap},a().createElement("div",{className:o.tableTimeSeries},a().createElement(r.Component,{model:r})))}},{id:"count",header:"Count",sortType:"number",cell:e=>{const t=(0,i.scaledUnits)(1e3,qt)(e.cell.row.original.sum);var n,r;return a().createElement("div",{className:o.countTextWrap},a().createElement("div",null,null!==(n=t.prefix)&&void 0!==n?n:"",t.text,null!==(r=t.suffix)&&void 0!==r?r:""))}},{id:"percent",header:"%",sortType:"number",cell:t=>a().createElement("div",{className:o.countTextWrap},a().createElement("div",null,(100*t.cell.row.original.sum/e).toFixed(0),"%"))},{id:"pattern",header:"Pattern",cell:e=>a().createElement("div",{className:(0,S.cx)(Gt(),o.tablePatternTextDefault)},a().createElement(Rt,{exploration:(0,m.Ti)(this),pattern:e.cell.row.original.pattern}))},{id:"include",header:void 0,disableGrow:!0,cell:e=>{if(null==r?void 0:r.includes(e.cell.row.original.pattern))return;const n=null==t?void 0:t.find((t=>t.pattern===e.cell.row.original.pattern)),i="include"===(null==n?void 0:n.type),l="exclude"===(null==n?void 0:n.type);return a().createElement(Dt.F,{isExcluded:l,isIncluded:i,onInclude:()=>e.cell.row.original.includeLink(),onExclude:()=>e.cell.row.original.excludeLink(),onClear:()=>e.cell.row.original.undoLink(),buttonFill:"outline"})}}];return d}buildTableData(e,t){const n=l.jh.getAncestor(this,_t.P);return e.filter((e=>!t.size||t.has(e.pattern))).map((e=>({dataFrame:e.dataFrame,pattern:e.pattern,sum:e.sum,includeLink:()=>Tt({pattern:e.pattern,type:"include",indexScene:n}),excludeLink:()=>Tt({pattern:e.pattern,type:"exclude",indexScene:n}),undoLink:()=>Tt({pattern:e.pattern,type:"undo",indexScene:n})})))}constructor(e){super(e)}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Qt,"Component",(function({model:e}){const t=l.jh.getAncestor(e,_t.P),{patterns:n}=t.useState(),r=(0,s.useTheme2)(),i=Jt(r),o=l.jh.getAncestor(e,tn),{legendSyncPatterns:c}=o.useState(),{patternFrames:d,patternsNotMatchingFilters:u}=e.useState(),p=null!=d?d:[],g=p.reduce(((e,t)=>e+t.sum),0),m=e.buildTableData(p,c),v=e.buildColumns(g,n,r,u);return a().createElement("div",{"data-testid":f.b.patterns.tableWrapper,className:i.tableWrap},a().createElement(s.InteractiveTable,{columns:v,data:m,getRowId:e=>e.pattern,renderExpandedRow:t=>a().createElement(Ht,{tableViz:e,row:t})}))}));const Ut=h.config.theme2,Gt=()=>(0,S.css)({minWidth:"200px",fontFamily:Ut.typography.fontFamilyMonospace,overflow:"hidden",overflowWrap:"break-word"}),Jt=e=>({link:(0,S.css)({textDecoration:"underline"}),tableWrap:(0,S.css)({"> div":{height:"calc(100vh - 450px)",minHeight:"470px"},th:{top:0,position:"sticky",backgroundColor:e.colors.background.canvas,zIndex:e.zIndex.navbarFixed}})}),Yt=e=>({tablePatternTextDefault:(0,S.css)({fontFamily:e.typography.fontFamilyMonospace,minWidth:"200px",maxWidth:"100%",overflow:"hidden",overflowWrap:"break-word",fontSize:e.typography.bodySmall.fontSize,wordBreak:"break-word"}),countTextWrap:(0,S.css)({textAlign:"right",fontSize:e.typography.bodySmall.fontSize}),tableTimeSeriesWrap:(0,S.css)({width:"230px",pointerEvents:"none"}),tableTimeSeries:(0,S.css)({height:"30px",overflow:"hidden"})});function Xt(e,t,n,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){return void n(e)}s.done?t(o):Promise.resolve(o).then(r,a)}function Zt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function l(e){Xt(i,r,a,l,s,"next",e)}function s(e){Xt(i,r,a,l,s,"throw",e)}l(void 0)}))}}function Kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const en=h.config.theme2.visualization.palette;class tn extends l.Bs{onActivate(){this.updateBody(),this._subs.add(l.jh.getAncestor(this,An).subscribeToState(((e,t)=>{var n,r,a,i,s,o;const c=null==e||null===(a=e.$patternsData)||void 0===a||null===(r=a.state)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.series,d=null==t||null===(o=t.$patternsData)||void 0===o||null===(s=o.state)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.series;if(!(0,g.B)(c,d)){const e=l.jh.getAncestor(this,pn);this.updatePatterns(e.state.patternFrames),e.setState({filteredPatterns:void 0})}}))),this._subs.add(l.jh.getAncestor(this,pn).subscribeToState(((e,t)=>{const n=l.jh.getAncestor(this,pn);e.filteredPatterns&&!(0,g.B)(e.filteredPatterns,t.filteredPatterns)?this.updatePatterns(n.state.filteredPatterns):n.state.patternFilter||this.updatePatterns(n.state.patternFrames)})))}updatePatterns(e=[]){var t=this;return Zt((function*(){var n;null===(n=t.state.body)||void 0===n||n.forEachChild((n=>{n instanceof l.Eb&&n.setState({$data:t.getTimeseriesDataNode(e)}),n instanceof Qt&&n.setState({patternFrames:e})}))}))()}updateBody(){var e=this;return Zt((function*(){var t,n;const r=l.jh.getAncestor(e,pn).state.patternFrames;(null===(n=l.jh.getAncestor(e,An).state.$patternsData)||void 0===n||null===(t=n.state.data)||void 0===t?void 0:t.series)&&r?e.setState({body:e.getSingleViewLayout(),legendSyncPatterns:new Set,loading:!1}):N.v.warn("Failed to update PatternsFrameScene body")}))()}extendTimeSeriesLegendBus(e,t){const n=t.onToggleSeriesVisibility;t.onToggleSeriesVisibility=(t,r)=>{var a;null==n||n(t,r);const i=null===(a=e.state.fieldConfig.overrides)||void 0===a?void 0:a[0],l=null==i?void 0:i.matcher.options.names,s=new Set;l&&l.forEach(s.add,s),this.setState({legendSyncPatterns:s})}}getSingleViewLayout(){const e=l.jh.getAncestor(this,pn).state.patternFrames;if(!e)return void N.v.warn("Failed to set getSingleViewLayout");const t=this.getTimeSeries(e);return new l.gF({templateColumns:"100%",autoRows:"200px",isLazy:!0,children:[t,new Qt({patternFrames:e})]})}getTimeSeries(e){const t=l.jh.getAncestor(this,_t.P),n=l.d0.timeseries().setData(this.getTimeseriesDataNode(e)).setOption("legend",{asTable:!0,showLegend:!0,displayMode:s.LegendDisplayMode.Table,placement:"right",width:200}).setHoverHeader(!0).setUnit("short").setLinks([{url:"#",targetBlank:!1,onClick:e=>{Tt({pattern:e.origin.labels.name,type:"include",indexScene:t})},title:"Include"},{url:"#",targetBlank:!1,onClick:e=>{Tt({pattern:e.origin.labels.name,type:"exclude",indexScene:t})},title:"Exclude"}]).build();return n.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(e,t)}),n}getTimeseriesDataNode(e){const t=l.jh.getTimeRange(this).state.value;return new l.Zv({data:{series:e.map(((e,t)=>{const n=e.dataFrame;return n.fields[1].config.color=function(e){return{mode:"fixed",fixedColor:en[e]}}(t),n.fields[1].name="",n})),state:i.LoadingState.Done,timeRange:t}})}constructor(e){var t,n;super((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Kt(e,t,n[t])}))}return e}({loading:!0},e),n=null!=(n={legendSyncPatterns:new Set})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t)),this.addActivationHandler(this.onActivate.bind(this))}}Kt(tn,"Component",(({model:e})=>{var t;const{body:n,loading:r}=e.useState(),i=l.jh.getAncestor(e,An),{$patternsData:s}=i.useState(),o=null==s||null===(t=s.state.data)||void 0===t?void 0:t.series;return a().createElement("div",{className:nn.container},!r&&o&&o.length>0&&a().createElement(a().Fragment,null,n&&a().createElement(n.Component,{model:n})))}));const nn={container:(0,S.css)({width:"100%",".show-on-hover":{display:"none"}})};function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class an extends l.Bs{onActivate(){const e=l.jh.getAncestor(this,pn);this._subs.add(e.subscribeToState(((e,t)=>{if(e.patternFilter!==t.patternFilter){const e=l.jh.getAncestor(this,pn);e.state.patternFrames&&(0,K.E)(e.state.patternFrames.map((e=>e.pattern)),e.state.patternFilter,this.onSearchResult)}}))),this._subs.add(e.subscribeToState(((e,t)=>{e.patternFilter&&!e.filteredPatterns&&e.patternFrames&&!(0,g.B)(e.filteredPatterns,t.filteredPatterns)&&(0,K.X)(e.patternFrames.map((e=>e.pattern)),e.patternFilter,this.onSearchResult)})))}setFilteredPatterns(e,t){const n=l.jh.getAncestor(this,pn),r=null!=t?t:n.state.patternFrames;if(r){const t=r.filter((t=>!(!n.state.patternFilter||!(null==r?void 0:r.length))&&e.find((e=>e===t.pattern))));n.setState({filteredPatterns:t})}}setEmptySearch(){l.jh.getAncestor(this,pn).setState({filteredPatterns:void 0})}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){rn(e,t,n[t])}))}return e}({},e)),rn(this,"clearSearch",(()=>{l.jh.getAncestor(this,pn).setState({patternFilter:""})})),rn(this,"handleSearchChange",(e=>{l.jh.getAncestor(this,pn).setState({patternFilter:e.target.value})})),rn(this,"onSearchResult",(e=>{const t=l.jh.getAncestor(this,pn);t.state.patternFilter?this.setFilteredPatterns(e[0]):t.state.filteredPatterns&&!t.state.patternFilter&&this.setEmptySearch()})),this.addActivationHandler(this.onActivate.bind(this))}}rn(an,"Component",(function({model:e}){const t=l.jh.getAncestor(e,pn),{patternFilter:n}=t.useState();return a().createElement(s.Field,{className:ln.field},a().createElement(O.D,{onChange:e.handleSearchChange,onClear:e.clearSearch,value:n,placeholder:"Search patterns"}))}));const ln={field:(0,S.css)({label:"field",marginBottom:0}),icon:(0,S.css)({cursor:"pointer"})};var sn=n(4482);function on(){return a().createElement(sn.R,null,a().createElement("div",null,a().createElement("p",null,a().createElement("strong",null,"Sorry, we could not detect any patterns.")),a().createElement("p",null,"Check back later or reach out to the team in the"," ",a().createElement(s.TextLink,{href:"https://slack.grafana.com/",external:!0},"Grafana Labs community Slack channel")),a().createElement("p",null,"Patterns let you detect similar log lines to include or exclude from your search.")))}function cn(){return a().createElement(sn.R,null,a().createElement("div",null,a().createElement("p",null,a().createElement("strong",null,"Patterns are only available for the most recent ",un," hours of data.")),a().createElement("p",null,"See the"," ",a().createElement(s.TextLink,{href:"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/patterns/",external:!0},"patterns docs")," ","for more info.")))}function dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const un=3;class pn extends l.Bs{onActivate(){var e,t,n;const r=l.jh.getAncestor(this,An);this.setBody();const a=null===(t=r.state.$patternsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.series;a&&this.updatePatternFrames(a),this._subs.add(null===(n=r.state.$patternsData)||void 0===n?void 0:n.subscribeToState(this.onDataChange))}setBody(){this.setState({body:new l.G1({direction:"column",children:[new l.vA({ySizing:"content",body:new an}),new l.vA({body:new tn})]})})}updatePatternFrames(e){if(!e)return;const t=this.dataFrameToPatternFrame(e);this.setState({patternFrames:t})}dataFrameToPatternFrame(e){const t=l.jh.getAncestor(this,An),n=l.jh.getAncestor(t,_t.P).state.patterns;return e.map((e=>{var t,r;const a=null==n?void 0:n.find((t=>t.pattern===e.name)),i=null===(r=e.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.sum;var l;return{dataFrame:e,pattern:null!==(l=e.name)&&void 0!==l?l:"",sum:i,status:null==a?void 0:a.type}}))}constructor(e){var t;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){dn(e,t,n[t])}))}return e}({$variables:null!==(t=e.$variables)&&void 0!==t?t:new l.Pj({variables:[new l.yP({name:d.Jg,defaultToAll:!0,includeAll:!0})]}),loading:!0,patternFilter:""},e)),dn(this,"onDataChange",((e,t)=>{var n,r,a,l;const s=null===(n=e.data)||void 0===n?void 0:n.series,o=null===(r=t.data)||void 0===r?void 0:r.series;(null===(a=e.data)||void 0===a?void 0:a.state)===i.LoadingState.Done?(this.setState({loading:!1}),(0,g.B)(s,o)||this.updatePatternFrames(s)):(null===(l=e.data)||void 0===l?void 0:l.state)===i.LoadingState.Loading&&this.setState({loading:!0})})),this.addActivationHandler(this.onActivate.bind(this))}}function gn(e){return{container:(0,S.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column"}),content:(0,S.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),controls:(0,S.css)({flexGrow:0,display:"flex",alignItems:"top",gap:e.spacing(2)}),controlsRight:(0,S.css)({flexGrow:0,display:"flex",justifyContent:"flex-end"}),controlsLeft:(0,S.css)({display:"flex",justifyContent:"flex-left",justifyItems:"left",width:"100%",flexDirection:"column"}),patternMissingText:(0,S.css)({padding:e.spacing(2)})}}function mn(e,t,n=!0){const r=(0,C.ir)(e);let a="";n&&t===d.e4&&(a=`| ${d.e4} != ""`);const i=r.state.filters,l=(0,mt.k$)(r);if(i.length){if("mixed"===l)return`sum(count_over_time({${d.S1}} ${a} ${d.S6} ${d.A2} ${d.sC} ${d.YN} ${d.Oc} [$__auto])) by (${t})`;if("json"===l)return`sum(count_over_time({${d.S1}} ${a} ${d.S6} ${d.A2} ${d.sC} ${d.VL} ${d.Oc} [$__auto])) by (${t})`;if("logfmt"===l)return`sum(count_over_time({${d.S1}} ${a} ${d.S6} ${d.A2} ${d.sC} ${d.mF} ${d.Oc} [$__auto])) by (${t})`}return`sum(count_over_time({${d.S1}} ${a} ${d.S6} ${d.A2} ${d.sC} ${d.Oc} [$__auto])) by (${t})`}dn(pn,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r,patternFrames:o}=e.useState(),{value:c}=l.jh.getTimeRange(e).useState(),d=(0,s.useStyles2)(gn),u=(0,i.dateTime)().diff(c.to,"hours")>=un;return a().createElement("div",{className:d.container},a().createElement(Lt.O,{isLoading:n,blockingMessage:r},!n&&!o&&a().createElement("div",{className:d.patternMissingText},a().createElement(s.Text,{textAlignment:"center",color:"primary"},a().createElement("p",null,"There are no pattern matches."),a().createElement("p",null,"Pattern matching has not been configured."),a().createElement("p",null,"Patterns let you detect similar log lines and add or exclude them from your search."),a().createElement("p",null,"To see them in action, add the following to your configuration"),a().createElement("p",null,a().createElement("code",null,"--pattern-ingester.enabled=true")))),!n&&0===(null==o?void 0:o.length)&&u&&a().createElement(cn,null),!n&&0===(null==o?void 0:o.length)&&!u&&a().createElement(on,null),!n&&o&&o.length>0&&a().createElement("div",{className:d.content},t&&a().createElement(t.Component,{model:t}))))}));var vn=n(1383);function hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class fn extends l.Bs{onActivate(){this.state.panel||this.setState({panel:this.getVizPanel()});const e=(0,C.cR)(this),t=(0,C.ir)(this);e.subscribeToState((()=>{this.setState({panel:this.getVizPanel()})})),t.subscribeToState((()=>{this.setState({panel:this.getVizPanel()})}))}getVizPanel(){var e;const t=l.d0.timeseries().setTitle("Log volume").setOption("legend",{showLegend:!0,calcs:["sum"],displayMode:s.LegendDisplayMode.List}).setUnit("short").setData((0,o.rS)([(0,c.l)(mn(this,d.e4,!1),{legendFormat:`{{${d.e4}}}`})]));(0,o.ZC)(t);const n=t.build();return n.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(t)}),this._subs.add(null===(e=n.state.$data)||void 0===e?void 0:e.subscribeToState((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done&&(0,o.Cw)(n,e.data.series,this)}))),n}constructor(e){super(e),hn(this,"extendTimeSeriesLegendBus",(e=>{const t=(0,C.iw)(this);this._subs.add(null==t?void 0:t.subscribeToState((()=>{var e,t,n,r;const a=this.state.panel;(null==a||null===(t=a.state.$data)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.series)&&(0,o.Cw)(a,null==a||null===(r=a.state.$data)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.series,this)}))),e.onToggleSeriesVisibility=(e,t)=>{if(t===s.SeriesVisibilityChangeMode.AppendToSelection)return;const n=(0,vn.PE)(e,this);(0,b.EE)(b.NO.service_details,b.ir.service_details.level_in_logs_volume_clicked,{level:e,action:n})}})),this.addActivationHandler(this.onActivate.bind(this))}}hn(fn,"Component",(({model:e})=>{const{panel:t}=e.useState();if(t)return a().createElement(t.Component,{model:t})}));var bn,yn=n(4119);!function(e){e.logs="Logs",e.labels="Labels",e.fields="Fields",e.patterns="Patterns"}(bn||(bn={}));const Sn=[{displayName:"Logs",value:v.G3.logs,getScene:()=>new l.G1({direction:"column",children:[new l.vA({minHeight:200,body:new fn({})}),new l.vA({minHeight:"470px",height:"calc(100vh - 500px)",body:new Ct({})})]}),testId:f.b.exploreServiceDetails.tabLogs},{displayName:"Labels",value:v.G3.labels,getScene:()=>new l.G1({children:[new l.vA({body:new jt.O({})})]}),testId:f.b.exploreServiceDetails.tabLabels},{displayName:"Fields",value:v.G3.fields,getScene:e=>{return t=e,new l.G1({children:[new l.vA({body:new Pt.J6({changeFieldCount:t})})]});var t},testId:f.b.exploreServiceDetails.tabFields},{displayName:"Patterns",value:v.G3.patterns,getScene:()=>new l.G1({children:[new l.vA({body:new pn({})})]}),testId:f.b.exploreServiceDetails.tabPatterns}],wn=[{displayName:"Label",value:v._J.label,getScene:e=>(0,yn.U4)(e),testId:f.b.exploreServiceDetails.tabLabels},{displayName:"Field",value:v._J.field,getScene:e=>function(e){return new l.G1({children:[new l.vA({body:new Pt.J6({value:e})})]})}(e),testId:f.b.exploreServiceDetails.tabFields}];function On(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){On(e,t,n[t])}))}return e}class En extends l.Bs{}On(En,"Component",(({model:e})=>{const t=(0,s.useStyles2)(Fn),n=(0,m.Ti)(e);let r=(0,v.FT)(),i=!1;if(!Object.values(v.G3).includes(r)){const e=(0,v.er)();i=!0,e===v._J.field&&(r=v.G3.fields),e===v._J.label&&(r=v.G3.labels)}const o=l.jh.getAncestor(e,An).useState(),{loading:c,$data:d}=o,u=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(o,["loading","$data"]),g=u.loadingStates;return a().createElement(s.Box,{paddingY:0},a().createElement("div",{className:t.actions},a().createElement(s.Stack,{gap:1},a().createElement(y,{exploration:n}))),a().createElement(s.TabsBar,null,Sn.map(((t,n)=>{return a().createElement(s.Tab,{"data-testid":t.testId,key:n,label:t.displayName,active:r===t.value,counter:g[t.displayName]?void 0:Cn(t,(o=xn({},u),c={$data:d},c=null!=c?c:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(c)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(c)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(c,e))})),o)),icon:g[t.displayName]?"spinner":void 0,onChangeTab:()=>{if(t.value&&t.value!==r||i){(0,b.EE)(b.NO.service_details,b.ir.service_details.action_view_changed,{newActionView:t.value,previousActionView:r});const n=l.jh.getAncestor(e,An);(0,p.Vt)(t.value,n)}}});var o,c}))))}));const Cn=(e,t)=>{switch(e.value){case"fields":return t.fieldsCount;case"patterns":return t.patternsCount;case"labels":return t.labelsCount;default:return}};function Fn(e){return{actions:(0,S.css)({[e.breakpoints.up(e.breakpoints.values.md)]:{position:"absolute",right:0,zIndex:2}})}}var jn=n(7608);function Pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Pn(e,t,n[t])}))}return e}function _n(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const kn="logsPanelQuery";function Tn(e){return null==e?void 0:e.series.find((e=>e.refId===kn))}function Dn(e){var t,n,r;return null===(r=l.jh.getAncestor(e,An).state.$detectedLabelsData)||void 0===r||null===(n=r.state.data)||void 0===n||null===(t=n.series)||void 0===t?void 0:t[0]}function $n(e){var t;const n=l.jh.getAncestor(e,An);return Nn(null===(t=n.state.$detectedFieldsData)||void 0===t?void 0:t.state)}const Nn=e=>{var t,n;return null==e||null===(n=e.data)||void 0===n||null===(t=n.series)||void 0===t?void 0:t[0]},In=e=>{var t,n,r,a;return null===(a=e.data)||void 0===a||null===(r=a.series)||void 0===r||null===(n=r[0])||void 0===n||null===(t=n.fields)||void 0===t?void 0:t[0]};class An extends l.Bs{setSubscribeToLabelsVariable(){const e=(0,C.cR)(this);0!==e.state.filters.length?this._subs.add(e.subscribeToState(((e,t)=>{0===e.filters.length&&this.redirectToStart();let{labelName:n,labelValue:r,breakdownLabel:a}=(0,v.W6)();n===d.ky&&(n=d.OX);const i=l.jh.getAncestor(this,_t.P),s=i.state.routeMatch;if(e.filters.some((e=>e.key===n&&"="===e.operator&&e.value===r))){if(!(0,g.B)(e.filters,t.filters)){var o,c,u;null===(o=this.state.$patternsData)||void 0===o||o.runQueries(),null===(c=this.state.$detectedLabelsData)||void 0===c||c.runQueries(),null===(u=this.state.$detectedFieldsData)||void 0===u||u.runQueries()}}else{const t=e.filters.find((e=>"="===e.operator&&e.value!==d.ZO));var m,h,f;t?(i.setState({routeMatch:_n(Ln({},s),{params:_n(Ln({},null==s?void 0:s.params),{labelName:t.key===d.OX?d.ky:t.key,labelValue:(0,jn.uu)(t.value)}),url:null!==(m=null==s?void 0:s.url)&&void 0!==m?m:"",path:null!==(h=null==s?void 0:s.path)&&void 0!==h?h:"",isExact:null===(f=null==s?void 0:s.isExact)||void 0===f||f})}),this.resetTabCount(),a?(0,p.fg)((0,v.er)(),a,this):(0,p.Vt)((0,v.FT)(),this)):this.redirectToStart()}}))):this.redirectToStart()}redirectToStart(){this.setState({$data:void 0,body:void 0,$patternsData:void 0,$detectedLabelsData:void 0,$detectedFieldsData:void 0,patternsCount:void 0,labelsCount:void 0,fieldsCount:void 0}),(0,u.JO)().setServiceSceneState(this.state),this._subs.unsubscribe(),this.clearAdHocVariables(),(0,p.Ns)()}getMetadata(){const e=(0,u.JO)().getServiceSceneState();e&&this.setState(Ln({},e))}onActivate(){this.getMetadata(),this.resetBodyAndData(),this.setBreakdownView(),this.runQueries(),this._subs.add(this.subscribeToPatternsQuery()),this._subs.add(this.subscribeToDetectedLabelsQuery()),(0,v.FT)()!==v.G3.fields&&this._subs.add(this.subscribeToDetectedFieldsQuery()),this._subs.add(this.subscribeToLogsQuery()),this.setSubscribeToLabelsVariable(),this._subs.add(this.subscribeToFieldsVariable()),this._subs.add(this.subscribeToMetadataVariable()),this._subs.add(this.subscribeToLevelsVariable()),this._subs.add(this.subscribeToDataSourceVariable()),this._subs.add(this.subscribeToPatternsVariable()),this._subs.add(this.subscribeToTimeRange())}subscribeToPatternsVariable(){return(0,C.Ku)(this).subscribeToState(((e,t)=>{var n;e.value!==t.value&&(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries())}))}subscribeToDataSourceVariable(){return(0,C.S9)(this).subscribeToState((()=>{this.redirectToStart()}))}resetTabCount(){this.setState({fieldsCount:void 0,labelsCount:void 0,patternsCount:void 0}),(0,u.JO)().setServiceSceneState(this.state)}subscribeToFieldsVariable(){return(0,C.ir)(this).subscribeToState(((e,t)=>{var n;(0,g.B)(e.filters,t.filters)||null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries()}))}subscribeToMetadataVariable(){return(0,C.oY)(this).subscribeToState(((e,t)=>{var n;(0,g.B)(e.filters,t.filters)||null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries()}))}subscribeToLevelsVariable(){return(0,C.iw)(this).subscribeToState(((e,t)=>{var n;(0,g.B)(e.filters,t.filters)||null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries()}))}runQueries(){const e=(0,v.FT)(),t=(0,v.er)();var n,r,a;e!==v.G3.patterns&&void 0!==this.state.patternsCount||null===(n=this.state.$patternsData)||void 0===n||n.runQueries(),e!==v.G3.labels&&t!==v._J.label&&void 0!==this.state.labelsCount||null===(r=this.state.$detectedLabelsData)||void 0===r||r.runQueries(),e!==v.G3.fields&&t!==v._J.field&&void 0!==this.state.fieldsCount||null===(a=this.state.$detectedFieldsData)||void 0===a||a.runQueries()}subscribeToPatternsQuery(){var e;return null===(e=this.state.$patternsData)||void 0===e?void 0:e.subscribeToState((e=>{var t;if(this.updateLoadingState(e,bn.patterns),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data.series;void 0!==(null==t?void 0:t.length)&&(this.setState({patternsCount:t.length}),(0,u.JO)().setPatternsCount(t.length))}}))}subscribeToDetectedLabelsQuery(){var e;return null===(e=this.state.$detectedLabelsData)||void 0===e?void 0:e.subscribeToState((e=>{var t;if(this.updateLoadingState(e,bn.labels),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data,n=t.series[0].fields;if(void 0!==t.series.length&&void 0!==n.length){const e=t.series[0].fields.filter((e=>d.e4!==e.name));this.setState({labelsCount:e.length+1}),(0,u.JO)().setLabelsCount(n.length)}}}))}updateLoadingState(e,t){var n;const r=this.state.loadingStates;r[t]=(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Loading;const a=Object.values(r).some((e=>e));this.setState({loading:a,loadingStates:r})}subscribeToLogsQuery(){var e;return null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState((e=>{this.updateLoadingState(e,bn.logs)}))}subscribeToDetectedFieldsQuery(){var e;return null===(e=this.state.$detectedFieldsData)||void 0===e?void 0:e.subscribeToState((e=>{var t;if(this.updateLoadingState(e,bn.fields),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data.series[0];void 0!==t&&t.length!==this.state.fieldsCount&&(this.setState({fieldsCount:t.length}),(0,u.JO)().setFieldsCount(t.length))}}))}subscribeToTimeRange(){return l.jh.getTimeRange(this).subscribeToState((()=>{var e,t,n;null===(e=this.state.$patternsData)||void 0===e||e.runQueries(),null===(t=this.state.$detectedLabelsData)||void 0===t||t.runQueries(),null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries()}))}resetBodyAndData(){let e={};this.state.$data||(e.$data=Wn()),this.state.$patternsData||(e.$patternsData=Bn()),this.state.$detectedLabelsData||(e.$detectedLabelsData=Rn()),this.state.$detectedFieldsData||(e.$detectedFieldsData=Vn()),this.state.body||(e.body=Mn()),Object.keys(e).length&&this.setState(e)}setBreakdownView(){const{body:e}=this.state,t=(0,v.FT)(),n=Sn.find((e=>e.value===t));if(!e){const e=new Error("body is not defined in setBreakdownView!");throw N.v.error(e,{msg:"ServiceScene setBreakdownView error"}),e}if(n)e.setState({children:[...e.state.children.slice(0,1),n.getScene((e=>{"fields"===n.value&&this.setState({fieldsCount:e})}))]});else{const t=(0,v.er)(),n=wn.find((e=>e.value===t));n&&this.state.drillDownLabel?e.setState({children:[...e.state.children.slice(0,1),n.getScene(this.state.drillDownLabel)]}):N.v.error(new Error("not setting breakdown view"))}}constructor(e){var t;super(Ln({loadingStates:{[bn.patterns]:!1,[bn.labels]:!1,[bn.fields]:!1,[bn.logs]:!1},loading:!0,body:null!==(t=e.body)&&void 0!==t?t:Mn(),$data:Wn(),$patternsData:Bn(),$detectedLabelsData:Rn(),$detectedFieldsData:Vn()},e)),Pn(this,"_variableDependency",new l.Sh(this,{variableNames:[d.EY,d.MB,d.mB,d.uw,d._Y]})),Pn(this,"clearAdHocVariables",(()=>{[(0,C.cR)(this),(0,C.ir)(this),(0,C.iw)(this)].forEach((e=>{e.setState({filters:[]})}))})),this.addActivationHandler(this.onActivate.bind(this))}}function Mn(){return new l.G1({direction:"column",children:[new l.vA({ySizing:"content",body:new En({})})]})}function Bn(){return(0,o.FH)([(0,c.BM)(`{${d.S1}}`,"patterns",{refId:"patterns"})])}function Rn(){return(0,o.FH)([(0,c.BM)(`{${d.S1}}`,"detected_labels",{refId:"detectedLabels"})])}function Vn(){return(0,o.FH)([(0,c.BM)(d.SA,"detected_fields",{refId:"detectedFields"})])}function Wn(){return(0,o.rS)([(0,c.l)(d.SA,{refId:kn})])}Pn(An,"Component",(({model:e})=>{const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):a().createElement(s.LoadingPlaceholder,{text:"Loading..."})}))},5431:(e,t,n)=>{n.d(t,{m:()=>l});var r=n(1269),a=n(1119);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l extends a.n8{getValueOptions(e){return(0,r.of)(this.state.options)}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({type:"custom",value:"",text:"",options:[],name:""},e))}}i(l,"Component",(({model:e})=>(0,a.yC)(e)))},2718:(e,t,n)=>{n.d(t,{EE:()=>i,NO:()=>l,ir:()=>s});var r=n(8531),a=n(2533);const i=(e,t,n)=>{(0,r.reportInteraction)(((e,t)=>`${a.id.replace(/-/g,"_")}_${e}_${t}`)(e,t),n)},l={service_selection:"service_selection",service_details:"service_details"},s={[l.service_selection]:{search_services_changed:"search_services_changed",service_selected:"service_selected",aggregated_metrics_toggled:"aggregated_metrics_toggled"},[l.service_details]:{open_in_explore_clicked:"open_in_explore_clicked",action_view_changed:"action_view_changed",add_to_filters_in_breakdown_clicked:"add_to_filters_in_breakdown_clicked",select_field_in_breakdown_clicked:"select_field_in_breakdown_clicked",level_in_logs_volume_clicked:"level_in_logs_volume_clicked",layout_type_changed:"layout_type_changed",search_string_in_logs_changed:"search_string_in_logs_changed",pattern_removed:"pattern_removed",pattern_selected:"pattern_selected",pattern_field_clicked:"pattern_field_clicked",logs_visualization_toggle:"logs_visualization_toggle",logs_detail_filter_applied:"logs_detail_filter_applied",logs_popover_line_filter:"logs_popover_line_filter",logs_toggle_displayed_field:"logs_toggle_displayed_field",logs_clear_displayed_fields:"logs_clear_displayed_fields",value_breakdown_sort_change:"value_breakdown_sort_change",wasm_not_supported:"wasm_not_supported"}}},833:(e,t,n)=>{n.d(t,{B:()=>i});var r=n(3241),a=n.n(r);const i=(e,t)=>{if(typeof e!=typeof t)return!1;const n=new Set(e),r=new Set(t);return n.size===r.size&&a().isEqual(n,r)}},2854:(e,t,n)=>{n.r(t),n.d(t,{DETECTED_FIELDS_CARDINALITY_NAME:()=>V,DETECTED_FIELDS_NAME_FIELD:()=>R,DETECTED_FIELDS_PARSER_NAME:()=>W,DETECTED_FIELDS_TYPE_NAME:()=>z,WRAPPED_LOKI_DS_UID:()=>B,WrappedLokiDatasource:()=>H,default:()=>q});var r=n(7781),a=n(8531),i=n(1119),l=n(1269),s=n(9829),o=n(892),c=n(6001),d=n(3143),u=n(2533),p=n(5745),g=n(2344),m=n(8682);function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){v(e,t,n[t])}))}return e}function f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function b(e){if(function(e){return void 0!==e.targets.find((e=>function(e){return e.trim().length>2&&!function(e,t){let n=!1;return g.K3.parse(e).iterate({enter:({type:e})=>{if(e.id===t)return n=!0,!1}}),n}(e,g.Yw)}(e.expr)))}(e))return!1;for(let n=0;n<e.targets.length;n++){var t;if(null===(t=e.targets[n].expr)||void 0===t?void 0:t.includes("avg_over_time"))return!1}return!0}const y="__stream_shard_number__",S=(e,t)=>{if(void 0===t||0===t.length)return e.map((e=>f(h({},e),{expr:e.expr.replace(`, __stream_shard__=~"${y}"}`,"}")})));let n=t.join("|");return"-1"===n||1===t.length?(n="-1"===n?"":n,e.map((e=>f(h({},e),{expr:e.expr.replace(`, __stream_shard__=~"${y}"}`,`, __stream_shard__="${n}"}`)})))):e.map((e=>f(h({},e),{expr:e.expr.replace(new RegExp(`${y}`,"g"),n)})))};var w=n(2871);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){O(e,t,n[t])}))}return e}function E(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function C(e,t,n){const a=(0,r.closestIdx)(t.values[n],e.values);return a<0?0:t.values[n]===e.values[a]&&t.nanos&&e.nanos?t.nanos[n]>e.nanos[a]?a+1:a:t.values[n]>e.values[a]?a+1:a}function F(e,t,n,r,a,i){const l=function(e,t,n,r){return e.nanos&&n.nanos?void 0!==e.values[t]&&e.values[t]===n.values[r]&&void 0!==e.nanos[t]&&e.nanos[t]===n.nanos[r]:void 0!==e.values[t]&&e.values[t]===n.values[r]}(e,n,r,i);return!!l&&(!t||!a||void 0!==t.values[n]&&t.values[n]===a.values[i])}function j(e,t,n){const a=t.filter((t=>t.name===e.name));return 1===a.length?a[0]:e.labels?a.find((t=>{var n,a;return(0,r.shallowCompare)(null!==(n=e.labels)&&void 0!==n?n:{},null!==(a=t.labels)&&void 0!==a?a:{})})):t[n]}const P="Summary: total bytes processed";function L(e,t){const n=e.find((e=>e.displayName===P)),r=t.find((e=>e.displayName===P));if(null!=r&&null!=n)return[{value:r.value+n.value,displayName:P,unit:n.unit}];const a=null!=r?r:n;return null!=a?[a]:[]}function _(e){return E(x({},e),{fields:e.fields.map((e=>E(x({},e),{values:e.values})))})}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){k(e,t,n[t])}))}return e}function D(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function $(e,t){const n=e.interpolateVariablesInQueries(t.targets,t.scopedVars).filter((e=>e.expr)).map((e=>{return D(T({},e),{expr:(t=e.expr,t.replace("}",`, __stream_shard__=~"${y}"}`))});var t}));return function(e,t,n){let a=!1,i={data:[],state:r.LoadingState.Streaming,key:(0,p.A)()},s=null,o=new Map,c=null;const d=(l,u,p,g)=>{let m=g,v=!1;if(null!=s&&(s.unsubscribe(),s=null),a)return void l.complete();const h=()=>{const e=Math.min(u+g,p.length);u<p.length&&e<=p.length?d(l,e,p,m):(i.state=r.LoadingState.Done,l.next(i),l.complete())},f=e=>{var t,n,r;if((null==e?void 0:e.errors)&&(null===(t=e.errors[0].message)||void 0===t?void 0:t.includes("maximum of series")))return w.v.info("Maximum series reached, skipping retry"),!1;if((null==e?void 0:e.errors)&&(null===(n=e.errors[0].message)||void 0===n?void 0:n.includes("parse error")))return w.v.info("Parse error, skipping retry"),a=!0,!1;if(g>1)return I(`Possible time out, new group size ${g=Math.floor(Math.sqrt(g))}`),v=!0,d(l,u,p,g),!0;const i=null!==(r=o.get(u))&&void 0!==r?r:0;return i>3?(a=!0,!1):(o.set(u,i+1),c=setTimeout((()=>{w.v.info(`Retrying ${u} (${i+1})`),d(l,u,p,g),c=null}),1500*Math.pow(2,i)),v=!0,!0)},b=function(e,t,n){return t===e.length?[-1]:e.slice(t,t+n)}(p,u,g);I(`Querying ${b.join(", ")}`);const y=D(T({},t),{targets:S(n,b)});t.requestId&&(y.requestId=`${t.requestId}_shard_${u}_${g}`),s=e.runQuery(y).subscribe({next:e=>{var t;((null!==(t=e.errors)&&void 0!==t?t:[]).length>0||null!=e.error)&&f(e)||(m=function(e,t,n){return Math.min(t,Math.max(Math.floor(.7*(n-e)),1))}(u+g,function(e,t){var n,r;if(!e.data.length)return t+1;const a=null===(r=e.data[0].meta)||void 0===r||null===(n=r.stats)||void 0===n?void 0:n.find((e=>"Summary: exec time"===e.displayName));if(a){const e=Math.round(a.value);return I(`${a.value}`),e<=1?Math.floor(1.5*t):e<6?Math.ceil(1.1*t):1===t?t:e<20?Math.ceil(.9*t):Math.floor(t/2)}return t}(e,g),p.length),m!==g&&I(`New group size ${m}`),i=function(e,t){if(!e)return E(x({},n=t),{data:n.data.map(_)});var n,a,i;t.data.forEach((t=>{const n=e.data.find((e=>function(e,t){var n,a,i,l,s,o;if(e.refId!==t.refId||e.name!==t.name)return!1;const c=null===(n=e.meta)||void 0===n?void 0:n.type;if(c!==(null===(a=t.meta)||void 0===a?void 0:a.type))return!1;if(c===r.DataFrameType.TimeSeriesMulti){const n=e.fields.find((e=>e.type===r.FieldType.number)),a=t.fields.find((e=>e.type===r.FieldType.number));return void 0!==n&&void 0!==a&&(0,r.shallowCompare)(null!==(d=n.labels)&&void 0!==d?d:{},null!==(u=a.labels)&&void 0!==u?u:{});var d,u}const p=null===(l=e.meta)||void 0===l||null===(i=l.custom)||void 0===i?void 0:i.frameType,g=null===(o=t.meta)||void 0===o||null===(s=o.custom)||void 0===s?void 0:s.frameType;return"LabeledTimeValues"===p&&"LabeledTimeValues"===g||p===g}(e,t)));n?function(e,t){var n,a;const i=e.fields.find((e=>e.type===r.FieldType.time)),l=e.fields.find((e=>e.type===r.FieldType.string&&"id"===e.name)),s=t.fields.find((e=>e.type===r.FieldType.time)),o=t.fields.find((e=>e.type===r.FieldType.string&&"id"===e.name));if(!i||!s)return void w.v.error(new Error("Time fields not found in the data frames"));var c;const d=null!==(c=null==s?void 0:s.values.slice(0))&&void 0!==c?c:[],u=Math.max(e.fields.length,t.fields.length);for(let n=0;n<d.length;n++){const a=C(i,s,n),c=F(i,l,a,s,o,n);for(let i=0;i<u;i++){if(!e.fields[i])continue;const l=j(e.fields[i],t.fields,i);if(l)if(c){if(e.fields[i].type===r.FieldType.time)continue;var p;e.fields[i].type===r.FieldType.number?e.fields[i].values[a]=(null!==(p=e.fields[i].values[a])&&void 0!==p?p:0)+l.values[n]:e.fields[i].type===r.FieldType.other?"object"==typeof l.values[n]?e.fields[i].values[a]=x({},e.fields[i].values[a],l.values[n]):l.values[n]&&(e.fields[i].values[a]=l.values[n]):e.fields[i].values[a]=l.values[n]}else if(void 0!==l.values[n]){var g,m;e.fields[i].values.splice(a,0,l.values[n]),l.nanos&&(e.fields[i].nanos=null!==(m=e.fields[i].nanos)&&void 0!==m?m:new Array(e.fields[i].values.length-1).fill(0),null===(g=e.fields[i].nanos)||void 0===g||g.splice(a,0,l.nanos[n]))}}}var v,h;e.length=e.fields[0].values.length,e.meta=E(x({},e.meta),{stats:L(null!==(v=null===(n=e.meta)||void 0===n?void 0:n.stats)&&void 0!==v?v:[],null!==(h=null===(a=t.meta)||void 0===a?void 0:a.stats)&&void 0!==h?h:[])})}(n,t):e.data.push(_(t))}));const l=[...null!==(a=e.errors)&&void 0!==a?a:[],...null!==(i=t.errors)&&void 0!==i?i:[]];var s;l.length>0&&(e.errors=l);const o=null!==(s=e.error)&&void 0!==s?s:t.error;var c,d;null!=o&&(e.error=o);const u=[...null!==(c=e.traceIds)&&void 0!==c?c:[],...null!==(d=t.traceIds)&&void 0!==d?d:[]];return u.length>0&&(e.traceIds=u),e}(i,e))},complete:()=>{v||(i.data.length&&l.next(i),h())},error:e=>{w.v.error(e,{msg:"failed to shard"}),l.next(i),f()||h()}})},u=n=>{s=e.query(t).subscribe({next:e=>{i=e},complete:()=>{n.next(i)},error:e=>{w.v.error(e,{msg:"runNonSplitRequest subscription error"}),n.error(i)}})};return new l.Observable((r=>{const i=(e=>{const t=(0,m.QH)(e,[g.MD]);return t.length>0?e.substring(t[0].from,t[0].to).replace(`, __stream_shard__=~"${y}"}`,"}"):""})(n[0].expr);return(0,m.T0)(i)?(e.languageProvider.fetchLabelValues("__stream_shard__",{timeRange:t.range,streamSelector:i||void 0}).then((e=>{const t=e.map((e=>parseInt(e,10)));t&&t.length?(t.sort(((e,t)=>t-e)),I(`Querying ${t.join(", ")} shards`),d(r,0,t,function(e){return Math.floor(Math.sqrt(e.length))}(t))):(w.v.warn("Shard splitting not supported. Issuing a regular query."),u(r))})).catch((e=>{w.v.error(e,{msg:"failed to fetch label values for __stream_shard__"}),u(r)})),()=>{a=!0,c&&clearTimeout(c),null!=s&&(s.unsubscribe(),s=null)}):(console.log(`Skipping invalid selector: ${i}`),void r.complete())}))}(e,t,n)}const N=Boolean(localStorage.getItem(`${u.id}.sharding_debug_enabled`));function I(e){N&&console.log(e)}function A(e,t,n,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){return void n(e)}s.done?t(o):Promise.resolve(o).then(r,a)}function M(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function l(e){A(i,r,a,l,s,"next",e)}function s(e){A(i,r,a,l,s,"throw",e)}l(void 0)}))}}const B="wrapped-loki-ds-uid",R="name",V="cardinality",W="parser",z="type";class H extends i.UU{query(e){return new l.Observable((t=>{var n;if(!(null===(n=e.scopedVars)||void 0===n?void 0:n.__sceneObject))throw new Error("Scene object not found in request");var r,i=this;(0,a.getDataSourceSrv)().get((0,s.U4)(e.scopedVars.__sceneObject.valueOf())).then((r=M((function*(n){var r;if(!(n instanceof a.DataSourceWithBackend))throw new Error("Invalid datasource!");e.targets=null===(r=e.targets)||void 0===r?void 0:r.map((e=>(e.datasource=n,e)));const l=new Set;if(e.targets.forEach((e=>{var t;l.add(null!==(t=e.resource)&&void 0!==t?t:"")})),1!==l.size)throw new Error("A request cannot contain queries to multiple endpoints");switch(e.targets[0].resource){case"volume":yield i.getVolume(e,n,t);break;case"patterns":yield i.getPatterns(e,n,t);break;case"detected_labels":yield i.getDetectedLabels(e,n,t);break;case"detected_fields":yield i.getDetectedFields(e,n,t);break;case"labels":yield i.getLabels(e,n,t);break;default:i.getData(e,n,t)}})),function(e){return r.apply(this,arguments)}))}))}getData(e,t,n){const r=a.config.featureToggles.exploreLogsShardSplitting;return(!1!==b(e)&&r?$(t,e):t.query(e)).subscribe(n),n}getPatterns(e,t,n){var a=this;return M((function*(){const i=e.targets.filter((e=>"patterns"===e.resource));if(1!==i.length)throw new Error("Patterns query can only have a single target!");const{interpolatedTarget:l,expression:s}=a.interpolate(t,i,e);n.next({data:[],state:r.LoadingState.Loading});try{var c;const a=t.getResource("patterns",{query:s,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(c=e.requestId)&&void 0!==c?c:"patterns",headers:{"X-Query-Tags":`Source=${o.s_}`}}),i=yield a,u=null==i?void 0:i.data;let p=-1/0,g=0;var d;const m=null!==(d=null==u?void 0:u.map((e=>{const t=[],n=[];let a=0;return e.samples.forEach((([e,r])=>{t.push(1e3*e),n.push(r),r>p&&(p=r),r<g&&(g=r),r>p&&(p=r),r<g&&(g=r),a+=r})),(0,r.createDataFrame)({refId:l.refId,name:e.pattern,fields:[{name:"time",type:r.FieldType.time,values:t,config:{}},{name:e.pattern,type:r.FieldType.number,values:n,config:{}}],meta:{preferredVisualisationType:"graph",custom:{sum:a}}})})))&&void 0!==d?d:[];m.sort(((e,t)=>{var n,r,a,i;return(null===(r=t.meta)||void 0===r||null===(n=r.custom)||void 0===n?void 0:n.sum)-(null===(i=e.meta)||void 0===i||null===(a=i.custom)||void 0===a?void 0:a.sum)})),n.next({data:m,state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n}))()}interpolate(e,t,n){const r=e.interpolateVariablesInQueries(t,n.scopedVars);if(!r.length)throw new Error("Datasource failed to interpolate query!");const a=r[0];return{interpolatedTarget:a,expression:a.expr}}getDetectedLabels(e,t,n){var a=this;return M((function*(){const i=e.targets.filter((e=>"detected_labels"===e.resource));if(1!==i.length)throw new Error("Detected labels query can only have a single target!");const{interpolatedTarget:l,expression:s}=a.interpolate(t,i,e);n.next({data:[],state:r.LoadingState.Loading});try{var d,u,p;const a=yield t.getResource("detected_labels",{query:s,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(p=e.requestId)&&void 0!==p?p:"detected_labels",headers:{"X-Query-Tags":`Source=${o.s_}`}}),{labelName:i}=(0,o.W6)(),g=null===(u=a.detectedLabels)||void 0===u||null===(d=u.filter((e=>i!==e.label&&!c.rm.includes(e.label))))||void 0===d?void 0:d.sort(((e,t)=>(0,c.p_)(e,t))),m=null==g?void 0:g.map((e=>({name:e.label,values:[e.cardinality]}))),v=(0,r.createDataFrame)({refId:l.refId,fields:null!=m?m:[]});n.next({data:[v],state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n}))()}getDetectedFields(e,t,n){var a=this;return M((function*(){const i=e.targets.filter((e=>"detected_fields"===e.resource));if(1!==i.length)throw new Error("Detected fields query can only have a single target!");n.next({data:[],state:r.LoadingState.Loading});const{interpolatedTarget:l,expression:s}=a.interpolate(t,i,e);try{var d,u;const a=yield t.getResource("detected_fields",{query:s,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(u=e.requestId)&&void 0!==u?u:"detected_fields",headers:{"X-Query-Tags":`Source=${o.s_}`}}),i={name:R,type:r.FieldType.string,values:[],config:{}},p={name:V,type:r.FieldType.number,values:[],config:{}},g={name:W,type:r.FieldType.string,values:[],config:{}},m={name:z,type:r.FieldType.string,values:[],config:{}};null===(d=a.fields)||void 0===d||d.forEach((e=>{var t;c.$R.includes(e.label)||(i.values.push(e.label),p.values.push(e.cardinality),g.values.push((null===(t=e.parsers)||void 0===t?void 0:t.length)?e.parsers.join(", "):"structuredMetadata"),m.values.push(e.type))}));const v=(0,r.createDataFrame)({refId:l.refId,fields:[i,p,g,m]});n.next({data:[v],state:r.LoadingState.Done})}catch(e){w.v.error(e,{msg:"Detected fields error"}),n.next({data:[],state:r.LoadingState.Error})}return n}))()}getVolume(e,t,n){return M((function*(){if(1!==e.targets.length)throw new Error("Volume query can only have a single target!");const a=t.interpolateVariablesInQueries(e.targets,e.scopedVars)[0].expr.replace(".*.*",".+");n.next({data:[],state:r.LoadingState.Loading});try{var i,l,s;const c=yield t.getResource("index/volume",{query:a,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString(),limit:5e3},{requestId:null!==(s=e.requestId)&&void 0!==s?s:"volume",headers:{"X-Query-Tags":`Source=${o.s_}`}});null==c||c.data.result.sort(((e,t)=>{const n=e.value[1],r=t.value[1];return Number(r)-Number(n)}));const u=(0,r.createDataFrame)({fields:[{name:d.OX,values:null==c||null===(i=c.data.result)||void 0===i?void 0:i.map((e=>{const t=Object.keys(e.metric)[0];return e.metric[t]}))},{name:"volume",values:null==c||null===(l=c.data.result)||void 0===l?void 0:l.map((e=>Number(e.value[1])))}]});n.next({data:[u]})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n.complete(),n}))()}getLabels(e,t,n){return M((function*(){if(1!==e.targets.length)throw new Error("Volume query can only have a single target!");try{var a;const i=yield t.getResource("labels",{start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(a=e.requestId)&&void 0!==a?a:"labels",headers:{"X-Query-Tags":`Source=${o.s_}`}}),l=(0,r.createDataFrame)({fields:[{name:"labels",values:null==i?void 0:i.data}]});n.next({data:[l],state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n.complete(),n}))()}testDatasource(){return Promise.resolve({status:"success",message:"Data source is working",title:"Success"})}constructor(e,t){super(e,t)}}const q=function(){i.Go.registerRuntimeDataSource({dataSource:new H("wrapped-loki-ds",B)})}},7097:(e,t,n)=>{n.d(t,{JI:()=>x,Jl:()=>E,OE:()=>w,Ri:()=>y,Zp:()=>S,k$:()=>O});var r=n(7781),a=n(2007),i=n(1119),l=n(9829),s=n(558),o=n(3143),c=n(5183),d=n(1269),u=n(1475),p=n(4105),g=n(4750),m=n(7232),v=n(2871);const h=e=>{if(e&&Object.values(r.ReducerID).includes(e))return e};function f(e){switch(e){case"json":return"json";case"logfmt":return"logfmt";case"":case"structuredMetadata":return"structuredMetadata";default:return"mixed"}}function b(e){var t;const n=new Set(null!==(t=null==e?void 0:e.map((e=>e.toString())))&&void 0!==t?t:[]);n.delete("structuredMetadata");const r=Array.from(n);return 1===r.length?f(r[0]):0===n.size?"structuredMetadata":"mixed"}function y(e,t){var n;const r=(0,u.rD)(t),a=null==r?void 0:r.fields[2],i=null==r?void 0:r.fields[0],l=null==i?void 0:i.values.indexOf(e);var s;const o=void 0!==l&&-1!==l?f(null!==(s=null==a||null===(n=a.values)||void 0===n?void 0:n[l])&&void 0!==s?s:""):void 0;return void 0===o?(v.v.warn("missing parser, using mixed format for",{fieldName:e}),"mixed"):o}function S(e,t,n,r){return(o,u)=>{const p=h(r.state.sortBy),g=i.d0.timeseries().setOption("legend",{showLegend:!1}).setCustomFieldConfig("fillOpacity",9).setTitle(e(o)).setData(new i.Es({transformations:[()=>function(e){return t=>t.pipe((0,d.map)((()=>[e])))}(o)]})).setColor({mode:"fixed",fixedColor:(0,l.Vy)(u)}).setOverrides(c.jC).setHeaderActions(new s.oR({frame:o,variableName:n}));return t===a.DrawStyle.Bars&&g.setCustomFieldConfig("stacking",{mode:a.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setOverrides(c.jC).setCustomFieldConfig("drawStyle",a.DrawStyle.Bars),p&&(g.setOption("legend",{showLegend:!0,calcs:[p]}),g.setDisplayName(" ")),new i.xK({body:g.build()})}}function w(e,t,n){const r=e?function(e,t,n=0){var r;const a=null===(r=t.fields.find((e=>"labelTypes"===e.name)))||void 0===r?void 0:r.values[n];if(!a)return null;switch(a[e]){case"I":return m.H.Indexed;case"S":return m.H.StructuredMetadata;case"P":return m.H.Parsed;default:return null}}(t,e):m.H.Parsed;if(r)return function(e,t){switch(e){case m.H.Indexed:return o.MB;case m.H.Parsed:return o.mB;case m.H.StructuredMetadata:return t===o.e4?o._Y:o._P;default:{const n=new Error(`Invalid label type for ${t}`);throw v.v.error(n,{type:e,msg:`Invalid label type for ${t}`}),n}}}(r,t);const a=y(t,n);return"structuredMetadata"===a?o._P:(v.v.warn("unable to determine label variable, falling back to parsed field",{key:t,parserForThisField:null!=a?a:""}),o.mB)}function O(e){return b(e.state.filters.map((e=>(0,g.bu)(e).parser)))}function x(e){return p.fx.includes(e)}function E(e,t,n){var r;const a=null==n?void 0:n.fields[2],i=null==n?void 0:n.fields[0],l=null==i?void 0:i.values.indexOf(e),s=void 0!==l&&-1!==l?f(null==a||null===(r=a.values)||void 0===r?void 0:r[l]):"mixed",o=t.state.filters.map((e=>{var t;const n=null==i?void 0:i.values.indexOf(e.key),r=(0,g.bu)(e);if(r.parser)return r.parser;var l;const s=void 0!==n&&-1!==n?f(null!==(l=null==a||null===(t=a.values)||void 0===t?void 0:t[n])&&void 0!==l?l:"mixed"):void 0;return null!=s?s:"mixed"}));let c="",d="";return"structuredMetadata"===s?d=`| ${e}!=""`:c=`| ${e}!=""`,function(e,t){return x(e)?`avg_over_time(${(0,g.DX)(t)} | unwrap `+("duration"===e?"duration":"bytes"===e?"bytes":"")+`(${e}) [$__auto]) by ()`:`sum by (${e}) (count_over_time(${(0,g.DX)(t)} [$__auto]))`}(e,{structuredMetadataToAdd:d,fieldExpressionToAdd:c,parser:b([...o,s])})}},4119:(e,t,n)=>{n.d(t,{U4:()=>d,di:()=>c,oj:()=>u});var r=n(1119),a=n(3143),i=n(7097),l=n(7918),s=n(8810),o=n(4750);const c="repeat(auto-fit, minmax(400px, 1fr))";function d(e){return new r.G1({children:[new r.vA({body:new s.O({value:e})})]})}function u(e,t,n){let r="",s="";const c=(0,o.ir)(e),d=(0,i.k$)(c);return n&&n!==a.e4?r=` ,${n} != ""`:n&&n===a.e4&&(s=` | ${n} != ""`),(0,l.l)(`sum(count_over_time(${(0,o.DX)({labelExpressionToAdd:r,structuredMetadataToAdd:s,parser:d})} [$__auto])) by (${t})`,{legendFormat:`{{${t}}}`,refId:"LABEL_BREAKDOWN_VALUES"})}},1383:(e,t,n)=>{n.d(t,{Ex:()=>u,H7:()=>d,PE:()=>g,de:()=>c,pC:()=>o});var r=n(2007),a=n(3143),i=n(6001),l=n(558),s=n(4750);function o(e,t,n,a){if(n===r.SeriesVisibilityChangeMode.ToggleSelection){const n=null!=t?t:[];return 1===n.length&&n.includes(e)?[]:[e]}let i=(null==t?void 0:t.length)?t:a;return i.includes(e)?i.filter((t=>t!==e)):[...i,e]}function c(e){return e.map((e=>{var t;return null!==(t=d(e))&&void 0!==t?t:"logs"}))}function d(e){var t;const n=null===(t=e.fields[1])||void 0===t?void 0:t.labels;if(!n)return null;const r=Object.keys(n);return 0===r.length?null:n[r[0]]}function u(e,t){const n=(0,s.iw)(t),r=n.state.filters.filter((e=>e.operator===i.w7.Equal)).map((e=>p(e.value))),a=n.state.filters.filter((e=>e.operator===i.w7.NotEqual)).map((e=>p(e.value)));return e.filter((e=>!a.includes(e)&&(0===r.length||r.includes(e))))}function p(e){return'""'===e?"logs":e}function g(e,t){const n=(0,s.iw)(t),r=0===n.state.filters.length,o=n.state.filters.find((t=>t.value===e&&t.operator===i.w7.Equal));let c;return"logs"===e&&(e='""'),r||!o?((0,l.PT)(a.e4,e,"include",t),c="add"):((0,l.Qt)(a.e4,e,"toggle",t),c="remove"),c}},2871:(e,t,n)=>{n.d(t,{v:()=>s});var r=n(8531);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}const l={app:n(2533).id,version:"1.0.2"},s={info:(e,t)=>{const n=i({},l,t);console.log(e,n),o(e,n)},warn:(e,t)=>{const n=i({},l,t);console.warn(e,n),c(e,n)},error:(e,t)=>{const n=i({},l,t);console.error(e,n),d(e,n)}},o=(e,t)=>{try{(0,r.logInfo)(e,t)}catch(e){console.warn("Failed to log faro event!")}},c=(e,t)=>{try{(0,r.logWarning)(e,t)}catch(n){console.warn("Failed to log faro warning!",{msg:e,context:t})}},d=(e,t)=>{let n=t;try{!function(e,t){if("object"==typeof e&&null!==e&&("object"==typeof e&&Object.keys(e).forEach((n=>{const r=e[n];"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(t[n]=r.toString())})),u(e)))if("object"==typeof e.data&&null!==e.data)try{t.data=JSON.stringify(e.data)}catch(e){}else"string"!=typeof e.data&&"boolean"!=typeof e.data&&"number"!=typeof e.data||(t.data=e.data.toString())}(e,n),e instanceof Error?(0,r.logError)(e,n):"string"==typeof e?(0,r.logError)(new Error(e),n):e&&"object"==typeof e?n.msg?(0,r.logError)(new Error(n.msg),n):(0,r.logError)(new Error("error object"),n):(0,r.logError)(new Error("unknown error"),n)}catch(t){console.error("Failed to log faro error!",{err:e,context:n})}},u=e=>"data"in e},6949:(e,t,n)=>{let r;function a(){r||(r=new i)}n.d(t,{JO:()=>l,rX:()=>a});class i{getServiceSceneState(){return this.serviceSceneState}setPatternsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.patternsCount=e}setLabelsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.labelsCount=e}setFieldsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.fieldsCount=e}setServiceSceneState(e){this.serviceSceneState={patternsCount:e.patternsCount,labelsCount:e.labelsCount,fieldsCount:e.fieldsCount,loading:e.loading}}constructor(){var e,t;t=void 0,(e="serviceSceneState")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t}}function l(){return r}},8835:(e,t,n)=>{n.d(t,{Ns:()=>y,Vt:()=>f,ad:()=>b,fg:()=>v,jY:()=>h});var r=n(7311),a=n(3143),i=n(6949),l=n(8531),s=n(892),o=n(1119),c=n(7781),d=n(7608),u=n(2871);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let g;function m(e,t){return c.urlUtil.renderUrl(e,function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){p(e,t,n[t])}))}return e}({},Object.entries(c.urlUtil.getUrlSearchParams()).reduce(((e,[t,n])=>(s.tm.includes(t)&&(e[t]=n),e)),{}),e)}(t))}function v(e,t,n){const l=o.jh.getAncestor(n,r.P);if(l){var c,p;const r=null===(c=l.state.routeMatch)||void 0===c?void 0:c.params.labelName,o=null===(p=l.state.routeMatch)||void 0===p?void 0:p.params.labelValue;if(r&&o){let l=function(e,t,n,r="service"){return e===a.To&&t===s._J.label?(0,s._F)(`${s.G3.explore}/${r}/${(0,d.uu)(n)}/${s.G3.labels}`):e===a.To&&t===s._J.field?(0,s._F)(`${s.G3.explore}/${r}/${(0,d.uu)(n)}/${s.G3.fields}`):(0,s._F)(`${s.G3.explore}/${r}/${(0,d.uu)(n)}/${t}/${(0,d.uu)(e)}`)}(t,e,o,r);const c=m(l);return n&&(0,i.JO)().setServiceSceneState(n.state),void b(c)}u.v.warn("missing url params",{urlLabelName:null!=r?r:"",urlLabelValue:null!=o?o:""})}}function h(e,t){b(m(s.bw.logs(t,e)))}function f(e,t,n){var a,l;const c=o.jh.getAncestor(t,r.P),u=null===(a=c.state.routeMatch)||void 0===a?void 0:a.params.labelValue,p=null===(l=c.state.routeMatch)||void 0===l?void 0:l.params.labelName;if(u){const r=m((0,s._F)(`${s.G3.explore}/${p}/${(0,d.uu)(u)}/${e}`),n);t&&(0,i.JO)().setServiceSceneState(t.state),b(r)}}function b(e){g=e,l.locationService.push(e)}function y(){const e=l.locationService.getLocation(),t=(0,s.qe)(s.bw.explore()),n=e.pathname+e.search,r=l.locationService.getSearch();t===n||n.includes(t)||(r.get("var-filters")?b(t):(g&&l.locationService.replace(g),l.locationService.push(t)))}},5183:(e,t,n)=>{n.d(t,{rS:()=>y,FH:()=>b,HF:()=>S,jC:()=>g,ZC:()=>m,Cw:()=>h});var r=n(7781),a=n(1119),i=n(1269),l=n(2854);class s extends a.dt{runQueries(){const e=a.jh.getTimeRange(this);this.runWithTimeRange(e)}constructor(e){super(e)}}var o=n(2007),c=n(1383);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){d(e,t,n[t])}))}return e}const p="logs";function g(e){e.matchFieldsWithName("info").overrideColor({mode:"fixed",fixedColor:"semi-dark-green"}),e.matchFieldsWithName("debug").overrideColor({mode:"fixed",fixedColor:"semi-dark-blue"}),e.matchFieldsWithName("error").overrideColor({mode:"fixed",fixedColor:"semi-dark-red"}),e.matchFieldsWithName("warn").overrideColor({mode:"fixed",fixedColor:"semi-dark-orange"}),e.matchFieldsWithName("logs").overrideColor({mode:"fixed",fixedColor:"darkgray"})}function m(e){return e.setCustomFieldConfig("stacking",{mode:o.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",o.DrawStyle.Bars).setOverrides(g)}function v(e,t){t.match({id:r.FieldMatcherID.byNames,options:{mode:"exclude",names:e,prefix:"All except:",readOnly:!0}}).overrideCustomFieldConfig("hideFrom",{legend:!1,tooltip:!1,viz:!0});const n=t.build();n[n.length-1].__systemRef="hideSeriesFrom"}function h(e,t,n){const r=(0,c.Ex)((0,c.de)(t),n);if(null==r?void 0:r.length){const t=m(a.No.timeseries()).setOverrides(v.bind(null,r));t instanceof a.OS&&e.onFieldConfigChange(t.build(),!0)}}function f(){return e=>e.pipe((0,i.map)((e=>e.map((e=>(e.fields[1].config.displayNameFromDS||(e.fields[1].config.displayNameFromDS=p),e))).sort(((e,t)=>{const n=e.fields[1].config.displayNameFromDS,r=(null==n?void 0:n.includes("error"))?4:(null==n?void 0:n.includes("warn"))?3:(null==n?void 0:n.includes("info"))?2:1,a=t.fields[1].config.displayNameFromDS;return r-((null==a?void 0:a.includes("error"))?4:(null==a?void 0:a.includes("warn"))?3:(null==a?void 0:a.includes("info"))?2:1)})))))}function b(e){return new s({datasource:{uid:l.WRAPPED_LOKI_DS_UID},queries:e})}function y(e,t){return e.find((e=>{var t;return null===(t=e.legendFormat)||void 0===t?void 0:t.toLowerCase().includes("level")}))?new a.Es({$data:S({datasource:{uid:l.WRAPPED_LOKI_DS_UID},queries:e}),transformations:[f]}):S(u({queries:e},t))}function S(e){return new a.dt(u({datasource:{uid:l.WRAPPED_LOKI_DS_UID},queries:[]},e))}},7918:(e,t,n)=>{n.d(t,{BM:()=>u,E3:()=>h,M3:()=>S,VW:()=>m,ZX:()=>v,l:()=>p});var r=n(892),a=n(3143),i=n(6001),l=n(3241),s=n(4750);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}function d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const u=(e,t,n)=>d(c(d(c({},g),{resource:t,refId:t}),n),{datasource:{uid:a.gR},expr:e}),p=(e,t)=>d(c({},g,t),{expr:e}),g={refId:"A",queryType:"range",editorMode:"code",supportingQueryType:r.s_};function m(e){const t=e.filter((e=>e.operator===i.w7.Equal)),n=e.filter((e=>e.operator===i.w7.NotEqual)),r=(0,l.groupBy)(t,(e=>e.key));let a=[];for(const e in r){const t=r[e].map((e=>e.value));a.push(1===t.length?f(r[e][0]):y(e,t))}const s=n.map((e=>f(e))).join(", ");return(0,l.trim)(`${a.join(", ")}, ${s}`," ,")}function v(e){const t=e.filter((e=>e.operator===i.w7.Equal)),n=e.filter((e=>e.operator===i.w7.NotEqual)),r=(0,l.groupBy)(t,(e=>e.key));let a="";for(const e in r)a+=" | "+r[e].map((e=>`${b(e)}`)).join(" or ");return`${a} ${n.map((e=>`| ${b(e)}`)).join(" ")}`.trim()}function h(e){const t=e.filter((e=>e.operator===i.w7.Equal)),n=e.filter((e=>e.operator===i.w7.NotEqual)),r=(0,l.groupBy)(t,(e=>e.key));let a="";for(const e in r)a+=" | "+r[e].map((e=>`${f(e)}`)).join(" or ");return`${a} ${n.map((e=>`| ${f(e)}`)).join(" ")}`.trim()}function f(e){return e.value===a.ZO?`${e.key}${e.operator}${e.value}`:`${e.key}${e.operator}\`${e.value}\``}function b(e){const t=(0,s.bu)(e).value;return t===a.ZO?`${e.key}${e.operator}${t}`:`${e.key}${e.operator}\`${t}\``}function y(e,t){return`${e}=~"${t.join("|")}"`}function S(e){const t=e.filter((e=>"exclude"===e.type)).map((e=>`!> \`${e.pattern}\``)).join(" ").trim(),n=e.filter((e=>"include"===e.type));let r="";return n.length>0&&(r=1===n.length?`|> \`${n[0].pattern}\``:`|>  ${n.map((e=>`\`${e.pattern}\``)).join(" or ")}`),`${t} ${r}`.trim()}},892:(e,t,n)=>{n.d(t,{FT:()=>O,G3:()=>g,Gy:()=>p,HU:()=>f,KL:()=>b,NX:()=>j,W6:()=>x,XJ:()=>F,Zt:()=>S,_F:()=>y,_J:()=>m,bw:()=>v,er:()=>E,mC:()=>h,qe:()=>C,s_:()=>u,tm:()=>w});var r=n(2533),a=n(7781),i=n(3143),l=n(8531),s=n(7608),o=n(4750),c=n(2871);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const u=r.id,p=`/a/${u}`;var g,m;!function(e){e.explore="explore",e.logs="logs",e.labels="labels",e.patterns="patterns",e.fields="fields"}(g||(g={})),function(e){e.field="field",e.label="label"}(m||(m={}));const v={explore:()=>y("explore"),logs:(e,t="service")=>y(`explore/${t}/${(0,s.uu)(e)}/logs`),fields:(e,t="service")=>y(`explore/${t}/${(0,s.uu)(e)}/fields`),patterns:(e,t="service")=>y(`explore/${t}/${(0,s.uu)(e)}/patterns`),labels:(e,t="service")=>y(`explore/${t}/${(0,s.uu)(e)}/labels`)},h={label:(e,t="service",n)=>y(`explore/${t}/${(0,s.uu)(e)}/label/${n}`),field:(e,t="service",n)=>y(`explore/${t}/${(0,s.uu)(e)}/field/${n}`)},f={explore:y("explore"),logs:y("explore/:labelName/:labelValue/logs"),fields:y("explore/:labelName/:labelValue/fields"),patterns:y("explore/:labelName/:labelValue/patterns"),labels:y("explore/:labelName/:labelValue/labels")},b={field:y("explore/:labelName/:labelValue/field/:breakdownLabel"),label:y("explore/:labelName/:labelValue/label/:breakdownLabel")};function y(e){return`${p}/${e}`}const S=["from","to",`var-${i.EY}`],w=["from","to","mode","urlColumns","visualizationType","selectedLine","displayedFields",i.uw,`var-${i.uw}`,`var-${i.EY}`,`var-${i.MB}`,`var-${i.mB}`,`var-${i._Y}`,`var-${i.LI}`,`var-${i.Jg}`,`var-${i.EY}`,`var-${i.WM}`,`var-${i._P}`];function O(){const e=l.locationService.getLocation();return e.pathname.slice(e.pathname.lastIndexOf("/")+1,e.pathname.length)}function x(){const e=l.locationService.getLocation(),t=e.pathname.slice(e.pathname.indexOf("/a/grafana-lokiexplore-app/explore")+34+1).split("/");let n=t[0];const r=t[1],a=t[3];return n===i.OX&&(n=i.ky),{labelName:n,labelValue:r,breakdownLabel:a}}function E(){const e=l.locationService.getLocation().pathname.split("/");return e[e.length-2]}function C(e,t){return a.urlUtil.renderUrl(e,function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){d(e,t,n[t])}))}return e}({},Object.entries(a.urlUtil.getUrlSearchParams()).reduce(((e,[t,n])=>(S.includes(t)&&(e[t]=n),e)),{}),e)}(t))}function F(e){return{labelName:e.params.labelName,labelValue:e.params.labelValue,breakdownLabel:e.params.breakdownLabel}}function j(e){const t=(0,o.cR)(e);let{labelName:n,labelValue:r}=x();if(n===i.ky&&(n=i.OX),!t.state.filters.find((e=>e.key===n))){const e=l.locationService.getLocation();c.v.info("invalid primary label name in url",{labelName:n,url:`${e.pathname}${e.search}`})}if(!t.state.filters.find((e=>(0,s.uu)(e.value)===r))){const e=l.locationService.getLocation();c.v.info("invalid primary label value in url",{labelValue:r,url:`${e.pathname}${e.search}`})}}},9829:(e,t,n)=>{n.d(t,{Ti:()=>o,U4:()=>c,Vy:()=>u,hJ:()=>p,u9:()=>d}),n(7781);var r=n(8531),a=n(1119),i=n(3143),l=(n(892),n(7311));function s(e,t,n,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){return void n(e)}s.done?t(o):Promise.resolve(o).then(r,a)}function o(e){return a.jh.getAncestor(e,l.P)}function c(e){return a.jh.interpolate(e,i.gR)}function d(e){return a.jh.interpolate(e,i.SA).replace(/\s+/g," ")}function u(e){const t=r.config.theme2.visualization;return t.getColorByName(t.palette[e%8])}function p(e){return g.apply(this,arguments)}function g(){var e;return e=function*(e){return yield(0,r.getDataSourceSrv)().get(i.gR,{__sceneObject:{value:e}})},g=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function l(e){s(i,r,a,l,o,"next",e)}function o(e){s(i,r,a,l,o,"throw",e)}l(void 0)}))},g.apply(this,arguments)}},4932:(e,t,n)=>{n.d(t,{E:()=>s,X:()=>l});var r=n(7928),a=n(3241);const i=new r.A({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function l(e,t,n){const[a,l,s]=i.search(e,t,0,1e5);let o=[],c=new Set;if(a&&s){const t=(e,t)=>{t&&c.add(e)};for(let n=0;n<s.length;n++){let a=s[n];r.A.highlight(e[l.idx[a]],l.ranges[a],t),o.push(e[l.idx[a]])}n([o,[...c]])}else t||n([])}const s=(0,a.debounce)(l,300)},5722:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_SORT_BY:()=>c,calculateDataFrameChangepoints:()=>u,calculateOutlierValue:()=>v,sortSeries:()=>d,sortSeriesByName:()=>p,wasmSupported:()=>h});var r=n(5308),a=n(7781),i=n(1383),l=n(3241),s=n(2718),o=n(2871);const c="changepoint",d=(0,l.memoize)(((e,t,n)=>{if("alphabetical"===t)return p(e,n);"outliers"===t&&g(e);const r=n=>{var r;try{if("changepoint"===t)return u(n);if("outliers"===t)return v(e,n)}catch(e){o.v.error(e,{msg:"failed to sort"}),t=a.ReducerID.stdDev}const i=a.fieldReducers.get(t);var l,s;return null!==(s=(null!==(l=null===(r=i.reduce)||void 0===r?void 0:r.call(i,n.fields[1],!0,!0))&&void 0!==l?l:(0,a.doStandardCalcs)(n.fields[1],!0,!0))[t])&&void 0!==s?s:0},i=e.map((e=>({value:r(e),dataFrame:e})));return i.sort(((e,t)=>void 0!==e.value&&void 0!==t.value?t.value-e.value:0)),"asc"===n&&i.reverse(),i.map((({dataFrame:e})=>e))}),((e,t,n)=>{const r=e.length>0?e[0].fields[0].values[0]:0,a=e.length>0?e[e.length-1].fields[0].values[e[e.length-1].fields[0].values.length-1]:0,l=e.length>0?(0,i.H7)(e[0]):"",s=e.length>0?(0,i.H7)(e[e.length-1]):"",o=e.map((e=>e.length+"_"+e.fields.map((e=>e.name+"_"+e.values[0]+"_"+e.values[e.values.length-1]))));return`${l}_${s}_${r}_${a}_${e.length}_${o}_${t}_${n}`})),u=e=>{if(!h())throw new Error("WASM not supported, fall back to stdDev");const t=e.fields.filter((e=>e.type===a.FieldType.number)),n=t[0].values.length;let i=Math.floor(n/100)||1;i>1&&(i=Math.ceil(i/2));const l=t[0].values.filter(((e,t)=>t%i==0)),s=new Float64Array(l);return r.ChangepointDetector.defaultArgpcp().detectChangepoints(s).indices.length},p=(e,t)=>{const n=[...e];return n.sort(((e,t)=>{const n=(0,i.H7)(e),r=(0,i.H7)(t);return n&&r&&null!==(a=null==n?void 0:n.localeCompare(r))&&void 0!==a?a:0;var a})),"desc"===t&&n.reverse(),n},g=e=>{if(!h())return;const t=(0,a.outerJoinDataFrames)({frames:e});if(!t)return;const n=t.fields.filter((e=>e.type===a.FieldType.number)),i=n[0].values.length,l=new Float64Array(n.flatMap((e=>e.values)));try{const e=r.OutlierDetector.dbscan({sensitivity:.4}).preprocess(l,i);m=e.detect()}catch(e){o.v.error(e,{msg:"initOutlierDetector: OutlierDetector error"})}};let m;const v=(e,t)=>{if(!h())throw new Error("WASM not supported, fall back to stdDev");if(!m)throw new Error("Initialize outlier detector first");const n=e.indexOf(t);return m.seriesResults[n].isOutlier?m.seriesResults[n].outlierIntervals.length:0},h=()=>{const e="object"==typeof WebAssembly;return e||(0,s.EE)(s.NO.service_details,s.ir.service_details.wasm_not_supported),e}},227:(e,t,n)=>{n.d(t,{Gg:()=>m,N$:()=>j,OB:()=>u,QB:()=>b,YK:()=>C,YM:()=>E,ZF:()=>P,cC:()=>p,cO:()=>g,eT:()=>d,fq:()=>O,ke:()=>y,sj:()=>v,vs:()=>w});var r=n(2533),a=n(4750),i=n(2871),l=n(3143);const s=`${r.id}.services.favorite`,o=`${r.id}.primarylabels.tabs.favorite`,c=`${r.id}.datasource`;function d(e,t){if(!e||"string"!=typeof e)return[];const n=h(e,t);let r=[];try{r=JSON.parse(localStorage.getItem(n)||"[]")}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}return Array.isArray(r)||(r=[]),r}function u(e,t,n){if(!e||"string"!=typeof e)return;const r=h(e,t);let a=[];try{a=JSON.parse(localStorage.getItem(r)||"[]")}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(a)||(a=[]);const l=a.filter((e=>e!==n));l.unshift(n),localStorage.setItem(r,JSON.stringify(l))}function p(e,t,n){if(!e||!t||!n)return;const r=h(e,t);let a=[];try{a=JSON.parse(localStorage.getItem(r)||"[]")}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(a)||(a=[]);const l=a.filter((e=>e!==n));localStorage.setItem(r,JSON.stringify(l))}function g(e,t){if(!e||!t)return;const n=f(e);let r=[];try{r=JSON.parse(localStorage.getItem(n)||"[]")}catch(e){i.v.error(e,{msg:"Error parsing saved tabs from local storage"})}if(Array.isArray(r)||(r=[]),-1===r.indexOf(t)){const e=r.filter((e=>e!==t));e.unshift(t),localStorage.setItem(n,JSON.stringify(e))}}function m(e,t){if(!e||!t)return;const n=f(e);let r=[];try{r=JSON.parse(localStorage.getItem(n)||"[]")}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(r)||(r=[]);const a=r.filter((e=>e!==t));localStorage.setItem(n,JSON.stringify(a))}function v(e){if(!e||"string"!=typeof e)return[];const t=f(e);let n=[];try{n=JSON.parse(localStorage.getItem(t)||"[]")}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}return Array.isArray(n)||(n=[]),n}function h(e,t){return t=t===l.OX?"":`_${t}`,`${s}_${e}${t}`}function f(e){return`${o}_${e}`}function b(){var e;return null!==(e=localStorage.getItem(c))&&void 0!==e?e:void 0}function y(e){localStorage.setItem(c,e)}const S=`${r.id}.values.sort`;function w(e,t,n){var r;const a=(null!==(r=localStorage.getItem(`${S}.${e}.by`))&&void 0!==r?r:"").split(".");return a[0]&&a[1]?{sortBy:a[0],direction:a[1]}:{sortBy:t,direction:n}}function O(e,t,n){t&&n&&localStorage.setItem(`${S}.${e}.by`,`${t}.${n}`)}const x=`${r.id}.logs.option`;function E(e){return localStorage.getItem(`${x}.${e}`)}function C(e,t){let n=t.toString();"boolean"!=typeof t||t||(n=""),localStorage.setItem(`${x}.${e}`,n)}function F(e){return`${(0,a.nH)(e)}.${(0,a.p_)(e)}`}function j(e){const t=F(e),n=localStorage.getItem(`${r.id}.${t}.logs.fields`);return n?JSON.parse(n):[]}function P(e,t){const n=F(e);localStorage.setItem(`${r.id}.${n}.logs.fields`,JSON.stringify(t))}},1220:(e,t,n)=>{n.d(t,{b:()=>r});const r={appConfig:{container:"data-testid ac-container",apiKey:"data-testid ac-api-key",apiUrl:"data-testid ac-api-url",submit:"data-testid ac-submit-form"},exploreServiceSearch:{search:"data-testid search-services"},header:{refreshPicker:"data-testid RefreshPicker run button"},variables:{datasource:{label:"data-testid Dashboard template variables submenu Label Data source"},serviceName:{label:"data-testid Dashboard template variables submenu Label service_name"}},breakdowns:{labels:{},fields:{},common:{sortByFunction:"data-testid SortBy function",sortByDirection:"data-testid SortBy direction"}},index:{addNewLabelTab:"data-testid Tab Add label",searchLabelValueInput:"data-testid search-services-input"},exploreServiceDetails:{searchLogs:"data-testid search-logs",openExplore:"data-testid open-explore",tabPatterns:"data-testid tab-patterns",tabLogs:"data-testid tab-logs",tabFields:"data-testid tab-fields",tabLabels:"data-testid tab-labels",buttonRemovePattern:"data-testid button-remove-pattern",buttonFilterInclude:"data-testid button-filter-include",buttonFilterExclude:"data-testid button-filter-exclude"},patterns:{tableWrapper:"data-testid table-wrapper",buttonIncludedPattern:"data-testid button-included-pattern",buttonExcludedPattern:"data-testid button-excluded-pattern"},logsPanelHeader:{header:"data-testid Panel header Logs",radio:"data-testid radio-button"},table:{wrapper:"data-testid table-wrapper",inspectLine:"data-testid inspect"}}},8315:(e,t,n)=>{n.d(t,{EJ:()=>s,Zr:()=>l});var r,a=n(2871);function i(e,t,n,r,a,i,l){try{var s=e[i](l),o=s.value}catch(e){return void n(e)}s.done?t(o):Promise.resolve(o).then(r,a)}function l(e){return e.length?(null==e?void 0:e.charAt(0).toUpperCase())+e.slice(1):(a.v.warn("invalid string argument"),e)}function s(e,t,n){return e.substring(0,t)+(n&&e.length>t?"…":"")}r=function*(e,t){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);if(document.execCommand){var n;const r=document.createElement("textarea");null===(n=t.current)||void 0===n||n.appendChild(r),r.value=e,r.focus(),r.select(),document.execCommand("copy"),r.remove()}}},4750:(e,t,n)=>{n.d(t,{BL:()=>O,DX:()=>s,El:()=>w,Hj:()=>h,Ku:()=>o,P4:()=>m,Rr:()=>g,S9:()=>f,bY:()=>b,bu:()=>E,cR:()=>c,eY:()=>y,h:()=>S,ir:()=>d,iw:()=>p,n5:()=>x,nH:()=>j,oY:()=>u,p_:()=>F,vm:()=>v,z2:()=>C});var r=n(1119),a=n(5431),i=n(3143),l=n(2871);function s(e){const{labelExpressionToAdd:t="",structuredMetadataToAdd:n="",fieldExpressionToAdd:r="",parser:a}=e;switch(a){case"structuredMetadata":return`{${i.S1}${t}} ${n} ${i.S6} ${i.qZ} ${i.sC} ${i.A2} ${r} ${i.Oc}`;case"json":return`{${i.S1}${t}} ${n} ${i.S6} ${i.qZ} ${i.sC} ${i.A2} ${i.VL} ${r} ${i.Oc}`;case"logfmt":return`{${i.S1}${t}} ${n} ${i.S6} ${i.qZ} ${i.sC} ${i.A2} ${i.mF} ${r} ${i.Oc}`;default:return`{${i.S1}${t}} ${n} ${i.S6} ${i.qZ} ${i.sC} ${i.A2} ${i.YN} ${r} ${i.Oc}`}}function o(e){const t=r.jh.lookupVariable(i.uw,e);if(!(t instanceof r.yP))throw new Error("VAR_PATTERNS not found");return t}function c(e){return b(i.MB,e)}function d(e){return b(i.mB,e)}function u(e){return b(i._P,e)}function p(e){return b(i._Y,e)}function g(e){const t=r.jh.lookupVariable(i.WM,e);if(!(t instanceof r.yP))throw new Error("VAR_LINE_FILTER not found");return t}function m(e){const t=r.jh.lookupVariable(i.Jg,e);if(!(t instanceof a.m))throw new Error("VAR_LABEL_GROUP_BY not found");return t}function v(e){const t=r.jh.lookupVariable(i.Wi,e);if(!(t instanceof a.m))throw new Error("SERVICE_LABEL_VAR not found");return t}function h(e){const t=r.jh.lookupVariable(i.LI,e);if(!(t instanceof a.m))throw new Error("VAR_FIELD_GROUP_BY not found");return t}function f(e){const t=r.jh.lookupVariable(i.EY,e);if(!(t instanceof r.mI))throw new Error("VAR_DATASOURCE not found");return t}function b(e,t){const n=r.jh.lookupVariable(e,t);if(!(n instanceof r.H9))throw new Error(`Could not get AdHocFiltersVariable ${e}. Variable not found.`);return n}function y(e){const t=r.jh.lookupVariable(i.Du,e);if(!(t instanceof a.m))throw new Error("VAR_PRIMARY_LABEL_SEARCH not found");return t}function S(e){y(e).setState({value:".+",label:""})}function w(e){const t=r.jh.lookupVariable(i.Gb,e);if(!(t instanceof r.H9))throw new Error("VAR_PRIMARY_LABEL not found");return t}function O(e,t){w(t).setState({filters:[{value:".+",operator:"=~",key:e}]})}function x(e){return`var-${e}`}function E(e,t=i.mB){try{return JSON.parse(e.value)}catch(n){if(l.v.warn(`Failed to parse ${t}`,{value:e.value}),e.value)return{value:e.value,parser:"mixed"};throw n}}function C(e,t){return e.state.name===i.mB&&t?E(t):{value:null==t?void 0:t.value}}function F(e){return function(e){const t=e.filters.filter((e=>e.key===i.OX)).map((e=>e.value));if(!t)throw new Error("Service present in filters selected");return t[0]}(c(e).state)}function j(e){return f(e).getValue()}}}]);
//# sourceMappingURL=475.js.map