{"version":3,"file":"475.js","mappings":"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","sources":["webpack://grafana-lokiexplore-app/./Components/FilterButton.tsx","webpack://grafana-lokiexplore-app/./Components/GrotError.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/PatternTag.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/PatternControls.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/GiveFeedbackButton.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/InterceptBanner.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/LayoutScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/SelectServiceButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ConfigureVolumeError.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/NoServiceSearchResults.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/ToolbarScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/TabPopoverScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ServiceSelectionTabsScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/FavoriteServiceHeaderActionScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/NoServiceVolume.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ServiceSelectionScene.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/IndexScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/AddToFiltersButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/BreakdownSearchScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/ByFrameRepeater.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/EmptyLayoutScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldSelector.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldValuesBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldsAggregatedBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldsBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelsAggregatedBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelValuesBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LayoutSwitcher.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SearchInput.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SelectLabelActionScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SortByScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/StatusWrapper.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/TimeSeriesLimitSeriesTitleItem.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/GoToExploreButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LineFilterIcon.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LineFilterScene.tsx","webpack://grafana-lokiexplore-app/./services/logsFrame.ts","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableColumnsContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableCellContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableHeaderContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsColumnSearch.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableEmptyFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableNavField.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableActiveFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableAvailableFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableMultiSelect.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/ColumnSelectionDrawerWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/DefaultCellWrapComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/QueryContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/CellContextMenu.tsx","webpack://grafana-lokiexplore-app/./Components/Table/constants.ts","webpack://grafana-lokiexplore-app/./Components/Table/DefaultPill.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LineActionIcons.tsx","webpack://grafana-lokiexplore-app/./Components/Table/DefaultCellComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogLinePill.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Scroller.tsx","webpack://grafana-lokiexplore-app/./Components/Table/RawLogLineText.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogLineCellComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsTableHeader.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsTableHeaderWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Table.tsx","webpack://grafana-lokiexplore-app/./Components/Table/TableWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/TableProvider.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsHeaderActions.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsTableScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogOptionsScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsPanelScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsListScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/FilterByPatternsButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternFieldLabelStatsRow.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternFieldLabelStats.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternNameLabel.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsLogsSampleScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsTableExpandedRow.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsViewTableScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsFrameScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsViewTextSearch.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsNotDetected.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./services/expressions.ts","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsVolumePanel.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/BreakdownViews.ts","webpack://grafana-lokiexplore-app/./Components/ServiceScene/ActionBarScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/ServiceScene.tsx","webpack://grafana-lokiexplore-app/./services/CustomConstantVariable.ts","webpack://grafana-lokiexplore-app/./services/analytics.ts","webpack://grafana-lokiexplore-app/./services/comparison.ts","webpack://grafana-lokiexplore-app/./services/logql.ts","webpack://grafana-lokiexplore-app/./services/combineResponses.ts","webpack://grafana-lokiexplore-app/./services/shardQuerySplitting.ts","webpack://grafana-lokiexplore-app/./services/datasource.ts","webpack://grafana-lokiexplore-app/./services/fields.ts","webpack://grafana-lokiexplore-app/./services/labels.ts","webpack://grafana-lokiexplore-app/./services/levels.ts","webpack://grafana-lokiexplore-app/./services/logger.ts","webpack://grafana-lokiexplore-app/./services/metadata.ts","webpack://grafana-lokiexplore-app/./services/navigate.ts","webpack://grafana-lokiexplore-app/./services/LogsSceneQueryRunner.ts","webpack://grafana-lokiexplore-app/./services/panel.ts","webpack://grafana-lokiexplore-app/./services/query.ts","webpack://grafana-lokiexplore-app/./services/routing.ts","webpack://grafana-lokiexplore-app/./services/scenes.ts","webpack://grafana-lokiexplore-app/./services/search.ts","webpack://grafana-lokiexplore-app/./services/sorting.ts","webpack://grafana-lokiexplore-app/./services/store.ts","webpack://grafana-lokiexplore-app/./services/testIds.ts","webpack://grafana-lokiexplore-app/./services/text.ts","webpack://grafana-lokiexplore-app/./services/variableGetters.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { testIds } from 'services/testIds';\n\ntype Props = {\n  onInclude: () => void;\n  onClear: () => void;\n  isIncluded: boolean;\n  onExclude: () => void;\n  isExcluded: boolean;\n  buttonFill: 'solid' | 'outline' | 'text';\n  titles?: {\n    include: string;\n    exclude: string;\n  };\n};\n\nexport const FilterButton = (props: Props) => {\n  const { isExcluded, isIncluded, onInclude, onExclude, onClear, titles, buttonFill } = props;\n  const styles = useStyles2(getStyles, isIncluded, isExcluded);\n  return (\n    <div className={styles.container}>\n      <Button\n        variant={isIncluded ? 'primary' : 'secondary'}\n        fill={buttonFill}\n        size=\"sm\"\n        aria-selected={isIncluded}\n        className={styles.includeButton}\n        onClick={isIncluded ? onClear : onInclude}\n        data-testid={testIds.exploreServiceDetails.buttonFilterInclude}\n        title={titles?.include}\n      >\n        Include\n      </Button>\n      <Button\n        variant={isExcluded ? 'primary' : 'secondary'}\n        fill={buttonFill}\n        size=\"sm\"\n        aria-selected={isExcluded}\n        className={styles.excludeButton}\n        onClick={isExcluded ? onClear : onExclude}\n        title={titles?.exclude}\n        data-testid={testIds.exploreServiceDetails.buttonFilterExclude}\n      >\n        Exclude\n      </Button>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2, isIncluded: boolean, isExcluded: boolean) => {\n  return {\n    container: css({\n      display: 'flex',\n      justifyContent: 'center',\n    }),\n    includeButton: css({\n      borderRadius: 0,\n      borderRight: isIncluded ? undefined : 'none',\n    }),\n    excludeButton: css({\n      borderRadius: `0 ${theme.shape.radius.default} ${theme.shape.radius.default} 0`,\n      borderLeft: isExcluded ? undefined : 'none',\n    }),\n  };\n};\n","import React from 'react';\n\nimport { css } from '@emotion/css';\nimport SVG from 'react-inlinesvg';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, useTheme2, Text } from '@grafana/ui';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    graphicContainer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      margin: '0 auto',\n    }),\n    graphic: css({ width: '200px', height: '120px', padding: theme.spacing(1) }),\n    text: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n    }),\n    wrap: css({\n      margin: '0 auto',\n    }),\n  };\n};\n\ntype Props = {\n  children?: React.ReactNode;\n};\n\nexport const GrotError = ({ children }: React.PropsWithChildren<Props>) => {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n  return (\n    <div className={styles.wrap}>\n      <div className={styles.graphicContainer}>\n        <SVG\n          className={styles.graphic}\n          src={\n            theme.isDark\n              ? `/public/plugins/grafana-lokiexplore-app/img/grot_err.svg`\n              : `/public/plugins/grafana-lokiexplore-app/img/grot_err_light.svg`\n          }\n        />\n      </div>\n      <div className={styles.text}>\n        <Text textAlignment=\"center\" color=\"primary\" element=\"span\">\n          {children ? children : 'An error occurred'}\n        </Text>\n      </div>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { Button, Icon, Tag, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport React, { useState } from 'react';\nimport { testIds } from 'services/testIds';\n\ninterface Props {\n  onRemove(): void;\n  pattern: string;\n  size?: PatternSize;\n}\n\ntype PatternSize = 'sm' | 'lg';\n\nexport const PatternTag = ({ onRemove, pattern, size = 'lg' }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [expanded, setExpanded] = useState(false);\n  return (\n    <div className={styles.pattern} onClick={() => setExpanded(!expanded)} onMouseLeave={() => setExpanded(false)}>\n      <Tag\n        title={pattern}\n        key={pattern}\n        name={expanded ? pattern : getPatternPreview(pattern, size)}\n        className={styles.tag}\n      />\n      <Button\n        aria-label=\"Remove pattern\"\n        data-testid={testIds.exploreServiceDetails.buttonRemovePattern}\n        variant=\"secondary\"\n        size=\"sm\"\n        className={styles.removeButton}\n        onClick={onRemove}\n      >\n        <Icon name=\"times\" />\n      </Button>\n    </div>\n  );\n};\n\nconst PREVIEW_WIDTH: Record<PatternSize, number> = {\n  sm: 50,\n  lg: Math.round(window.innerWidth / 8),\n};\n\nfunction getPatternPreview(pattern: string, size: PatternSize) {\n  const length = pattern.length;\n  if (length < PREVIEW_WIDTH[size]) {\n    return pattern;\n  }\n\n  const substringLength = Math.round(PREVIEW_WIDTH[size] * 0.4);\n\n  return `${pattern.substring(0, substringLength)}  ${pattern.substring(length - substringLength)}`;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    pattern: css({\n      display: 'flex',\n      fontFamily: 'monospace',\n      gap: theme.spacing(0.25),\n      cursor: 'pointer',\n      overflow: 'hidden',\n    }),\n    tag: css({\n      borderTopRightRadius: 0,\n      borderBottomRightRadius: 0,\n      backgroundColor: theme.colors.secondary.main,\n      border: `solid 1px ${theme.colors.secondary.border}`,\n      color: theme.colors.secondary.text,\n      boxSizing: 'border-box',\n      padding: theme.spacing(0.25, 0.75),\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n    }),\n    removeButton: css({\n      paddingLeft: 2.5,\n      paddingRight: 2.5,\n    }),\n  };\n};\n","import React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { AppliedPattern } from './IndexScene';\nimport { PatternTag } from './PatternTag';\nimport { css } from '@emotion/css';\nimport { useStyles2, Text } from '@grafana/ui';\nimport { USER_EVENTS_ACTIONS, USER_EVENTS_PAGES, reportAppInteraction } from 'services/analytics';\nimport { testIds } from 'services/testIds';\n\ntype Props = {\n  patterns: AppliedPattern[] | undefined;\n  onRemove: (patterns: AppliedPattern[]) => void;\n};\nexport const PatternControls = ({ patterns, onRemove }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  if (!patterns || patterns.length === 0) {\n    return null;\n  }\n\n  const includePatterns = patterns.filter((pattern) => pattern.type === 'include');\n  const excludePatterns = patterns.filter((pattern) => pattern.type !== 'include');\n\n  const onRemovePattern = (pattern: AppliedPattern) => {\n    onRemove(patterns.filter((pat) => pat !== pattern));\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_removed, {\n      includePatternsLength: includePatterns.length - (pattern?.type === 'include' ? 1 : 0),\n      excludePatternsLength: excludePatterns.length - (pattern?.type !== 'include' ? 1 : 0),\n      type: pattern.type,\n    });\n  };\n\n  return (\n    <div>\n      {includePatterns.length > 0 && (\n        <div className={styles.patternsContainer}>\n          <Text variant=\"bodySmall\" weight=\"bold\" data-testid={testIds.patterns.buttonIncludedPattern}>\n            Included pattern{patterns.length > 1 ? 's' : ''}\n          </Text>\n          <div className={styles.patterns}>\n            {includePatterns.map((p) => (\n              <PatternTag key={p.pattern} pattern={p.pattern} size=\"lg\" onRemove={() => onRemovePattern(p)} />\n            ))}\n          </div>\n        </div>\n      )}\n      {excludePatterns.length > 0 && (\n        <div className={styles.patternsContainer}>\n          <Text variant=\"bodySmall\" weight=\"bold\" data-testid={testIds.patterns.buttonExcludedPattern}>\n            Excluded pattern{excludePatterns.length > 1 ? 's' : ''}:\n          </Text>\n          <div className={styles.patterns}>\n            {excludePatterns.map((p) => (\n              <PatternTag\n                key={p.pattern}\n                pattern={p.pattern}\n                size={excludePatterns.length > 1 ? 'sm' : 'lg'}\n                onRemove={() => onRemovePattern(p)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    patternsContainer: css({\n      paddingBottom: theme.spacing(1),\n      overflow: 'hidden',\n    }),\n    patterns: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      alignItems: 'center',\n      flexWrap: 'wrap',\n    }),\n  };\n}\n","import React from 'react';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport const GiveFeedbackButton = () => {\n  const styles = useStyles2(getStyles);\n  return (\n    <div className={styles.wrapper}>\n      <a\n        href=\"https://forms.gle/1sYWCTPvD72T1dPH9\"\n        className={styles.feedback}\n        title=\"Share your thoughts about Logs in Grafana.\"\n        target=\"_blank\"\n        rel=\"noreferrer noopener\"\n      >\n        <Icon name=\"comment-alt-message\" /> Give feedback\n      </a>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      display: 'flex',\n      marginLeft: 'auto',\n      gap: theme.spacing(1),\n      position: 'relative',\n      top: theme.spacing(-1),\n    }),\n    feedback: css({\n      alignSelf: 'center',\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n  };\n};\n","import { Alert } from '@grafana/ui';\nimport React from 'react';\n\nexport function InterceptBanner(props: { onRemove: () => void }) {\n  return (\n    <>\n      <Alert severity={'info'} title={'Welcome to Explore Logs!'} onRemove={props.onRemove}>\n        <div>\n          Check out our{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://grafana.com/docs/grafana-cloud/visualizations/simplified-exploration/logs/\"\n            rel=\"noreferrer\"\n          >\n            Get started doc\n          </a>\n          , or see{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://github.com/grafana/explore-logs/releases\"\n            rel=\"noreferrer\"\n          >\n            recent changes\n          </a>\n          .<br />\n          Help us shape the future of the app.{' '}\n          <a className=\"external-link\" target=\"_blank\" href=\"https://forms.gle/1sYWCTPvD72T1dPH9\" rel=\"noreferrer\">\n            Send us feedback\n          </a>{' '}\n          or engage with us on{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://github.com/grafana/explore-logs/?tab=readme-ov-file#explore-logs\"\n            rel=\"noreferrer\"\n          >\n            GitHub\n          </a>\n          .\n        </div>\n      </Alert>\n    </>\n  );\n}\n","import { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, VariableValueSelectors } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { PatternControls } from './PatternControls';\nimport { AppliedPattern, IndexSceneState } from './IndexScene';\nimport { css } from '@emotion/css';\nimport { GiveFeedbackButton } from './GiveFeedbackButton';\nimport { InterceptBanner } from './InterceptBanner';\nimport { PLUGIN_ID } from '../../services/routing';\n\ninterface LayoutSceneState extends SceneObjectState {\n  interceptDismissed: boolean;\n}\n\nconst interceptBannerStorageKey = `${PLUGIN_ID}.interceptBannerStorageKey`;\n\nexport class LayoutScene extends SceneObjectBase<LayoutSceneState> {\n  constructor(state: Partial<LayoutSceneState>) {\n    super({\n      ...state,\n      interceptDismissed: !!localStorage.getItem(interceptBannerStorageKey),\n    });\n  }\n\n  public dismiss() {\n    this.setState({\n      interceptDismissed: true,\n    });\n    localStorage.setItem(interceptBannerStorageKey, 'true');\n  }\n\n  static Component = ({ model }: SceneComponentProps<LayoutScene>) => {\n    if (!model.parent) {\n      return null;\n    }\n\n    const { controls, contentScene, patterns } = model.parent.useState() as IndexSceneState;\n    const { interceptDismissed } = model.useState();\n    if (!contentScene) {\n      return null;\n    }\n\n    const styles = useStyles2(getStyles);\n    return (\n      <div className={styles.bodyContainer}>\n        {!interceptDismissed && (\n          <InterceptBanner\n            onRemove={() => {\n              model.dismiss();\n            }}\n          />\n        )}\n        <div className={styles.container}>\n          {controls && (\n            <div className={styles.controlsContainer}>\n              <div className={styles.filters}>\n                {controls.map((control) =>\n                  control instanceof VariableValueSelectors ? (\n                    <control.Component key={control.state.key} model={control} />\n                  ) : null\n                )}\n              </div>\n              <div className={styles.controlsWrapper}>\n                <GiveFeedbackButton />\n                <div className={styles.controls}>\n                  {controls.map((control) =>\n                    control instanceof VariableValueSelectors === false ? (\n                      <control.Component key={control.state.key} model={control} />\n                    ) : null\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n          <PatternControls\n            patterns={patterns}\n            onRemove={(patterns: AppliedPattern[]) => model.parent?.setState({ patterns } as IndexSceneState)}\n          />\n          <div className={styles.body}>{contentScene && <contentScene.Component model={contentScene} />}</div>\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    bodyContainer: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      gap: theme.spacing(1),\n      minHeight: '100%',\n      flexDirection: 'column',\n      padding: theme.spacing(2),\n      maxWidth: '100vw',\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n    }),\n    controlsContainer: css({\n      display: 'flex',\n      gap: theme.spacing(2),\n      justifyContent: 'space-between',\n      alignItems: 'flex-start',\n    }),\n    filters: css({\n      display: 'flex',\n      gap: theme.spacing(2),\n      width: 'calc(100% - 450)',\n      flexWrap: 'wrap',\n      alignItems: 'flex-end',\n      '& + div[data-testid=\"data-testid Dashboard template variables submenu Label Filters\"]:empty': {\n        visibility: 'hidden',\n      },\n\n      //@todo not like this\n      // The filter variables container: i.e. services, filters\n      '&:first-child': {\n        // The wrapper of each filter\n        '& > div': {\n          // The actual inputs container\n          '& > div': {\n            flexWrap: 'wrap',\n            // wrapper around all inputs\n            '& > div': {\n              maxWidth: '380px',\n\n              // Wrapper around each input: i.e. label name, binary operator, value\n              '& > div': {\n                // These inputs need to flex, otherwise the value takes all of available space and they look broken\n                flex: '1 0 auto',\n\n                // The value input needs to shrink when the parent component is at max width\n                '&:nth-child(3)': {\n                  flex: '0 1 auto',\n                },\n              },\n            },\n          },\n        },\n      },\n      // the `service_name` filter is a special case where we want to hide the operator\n      '[data-testid=\"AdHocFilter-service_name\"]': {\n        'div[class*=\"input-wrapper\"]:first-child': {\n          display: 'none',\n        },\n        'div[class*=\"input-wrapper\"]:nth-child(2)': {\n          marginLeft: 0,\n        },\n      },\n\n      ['div >[title=\"Add filter\"]']: {\n        border: 0,\n        display: 'none',\n        width: 0,\n        padding: 0,\n        margin: 0,\n      },\n    }),\n    controlsWrapper: css({\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    controls: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n    }),\n    feedback: css({\n      textAlign: 'end',\n    }),\n    rotateIcon: css({\n      svg: { transform: 'rotate(180deg)' },\n    }),\n  };\n}\n","import React from 'react';\n\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { VariableHide } from '@grafana/schema';\nimport { addToFavoriteLabelValueInStorage } from 'services/store';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { FilterOp } from 'services/filters';\nimport { navigateToInitialPageAfterServiceSelection } from '../../services/navigate';\nimport { getDataSourceVariable, getLabelsVariable } from '../../services/variableGetters';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { SERVICE_NAME, SERVICE_UI_LABEL } from '../../services/variables';\n\nexport interface SelectServiceButtonState extends SceneObjectState {\n  labelValue: string;\n  labelName: string;\n}\nexport function selectLabel(primaryLabelName: string, primaryLabelValue: string, sceneRef: SceneObject) {\n  const variable = getLabelsVariable(sceneRef);\n\n  reportAppInteraction(USER_EVENTS_PAGES.service_selection, USER_EVENTS_ACTIONS.service_selection.service_selected, {\n    value: primaryLabelValue,\n    label: primaryLabelName,\n  });\n\n  variable.setState({\n    filters: [\n      ...variable.state.filters.filter((f) => f.key !== primaryLabelName),\n      {\n        key: primaryLabelName,\n        operator: FilterOp.Equal,\n        value: primaryLabelValue,\n      },\n    ],\n    hide: VariableHide.hideLabel,\n  });\n  const ds = getDataSourceVariable(sceneRef).getValue();\n\n  if (primaryLabelName === SERVICE_NAME) {\n    primaryLabelName = SERVICE_UI_LABEL;\n  }\n\n  addToFavoriteLabelValueInStorage(ds, primaryLabelName, primaryLabelValue);\n\n  // In this case, we don't have a ServiceScene created yet, so we call a special function to navigate there for the first time\n  navigateToInitialPageAfterServiceSelection(primaryLabelName, primaryLabelValue);\n}\n\nexport class SelectServiceButton extends SceneObjectBase<SelectServiceButtonState> {\n  public onClick = () => {\n    if (!this.state.labelValue) {\n      return;\n    }\n    selectLabel(this.state.labelName, this.state.labelValue, this);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SelectServiceButton>) => {\n    const styles = useStyles2(getStyles);\n    return (\n      <Button\n        tooltip={`View breakdown for ${model.state.labelValue}`}\n        className={styles.button}\n        variant=\"secondary\"\n        size=\"sm\"\n        onClick={model.onClick}\n      >\n        Select\n      </Button>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    button: css({\n      alignSelf: 'center',\n    }),\n  };\n}\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\nimport { TextLink, Text } from '@grafana/ui';\n\nexport const ConfigureVolumeError = () => {\n  return (\n    <GrotError>\n      <p>Log volume has not been configured.</p>\n      <p>\n        <TextLink href=\"https://grafana.com/docs/loki/latest/reference/api/#query-log-volume\" external>\n          Instructions to enable volume in the Loki config:\n        </TextLink>\n      </p>\n      <Text textAlignment=\"left\">\n        <pre>\n          <code>\n            limits_config:\n            <br />\n            &nbsp;&nbsp;volume_enabled: true\n          </code>\n        </pre>\n      </Text>\n    </GrotError>\n  );\n};\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\n\nexport const NoServiceSearchResults = () => {\n  return (\n    <GrotError>\n      <p>No service matched your search.</p>\n    </GrotError>\n  );\n};\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Dropdown, Switch, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { config } from '@grafana/runtime';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { AGGREGATED_METRIC_START_DATE } from '../ServiceSelectionScene/ServiceSelectionScene';\nimport pluginJson from '../../plugin.json';\nconst AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY = `${pluginJson.id}.serviceSelection.aggregatedMetrics`;\n\nexport interface ToolbarSceneState extends SceneObjectState {\n  isOpen: boolean;\n  options: {\n    aggregatedMetrics: {\n      active: boolean;\n      userOverride: boolean;\n      disabled: boolean;\n    };\n  };\n}\nexport class ToolbarScene extends SceneObjectBase<ToolbarSceneState> {\n  constructor(state: Partial<ToolbarSceneState>) {\n    const userOverride = localStorage.getItem(AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY);\n    const active = config.featureToggles.exploreLogsAggregatedMetrics && userOverride !== 'false';\n\n    super({\n      isOpen: false,\n      options: {\n        aggregatedMetrics: {\n          active: active ?? false,\n          userOverride: userOverride === 'true' ?? false,\n          disabled: false,\n        },\n      },\n      ...state,\n    });\n  }\n\n  public toggleAggregatedMetricsOverride = () => {\n    const active = !this.state.options.aggregatedMetrics.active;\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_selection,\n      USER_EVENTS_ACTIONS.service_selection.aggregated_metrics_toggled,\n      {\n        enabled: active,\n      }\n    );\n\n    localStorage.setItem(AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY, active.toString());\n\n    this.setState({\n      options: {\n        aggregatedMetrics: {\n          active,\n          disabled: this.state.options.aggregatedMetrics.disabled,\n          userOverride: active,\n        },\n      },\n    });\n  };\n\n  public onToggleOpen = (isOpen: boolean) => {\n    this.setState({ isOpen });\n  };\n\n  static Component = ({ model }: SceneComponentProps<ToolbarScene>) => {\n    const { isOpen, options } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const renderPopover = () => {\n      return (\n        <div className={styles.popover} onClick={(evt) => evt.stopPropagation()}>\n          <div className={styles.heading}>Query options</div>\n          <div className={styles.options}>\n            <div\n              title={\n                'Aggregated metrics will return service queries results much more quickly, but with lower resolution'\n              }\n            >\n              Aggregated metrics\n            </div>\n            <span\n              title={\n                options.aggregatedMetrics.disabled\n                  ? `Aggregated metrics can only be enabled for queries starting after ${AGGREGATED_METRIC_START_DATE.toLocaleString()}`\n                  : ''\n              }\n            >\n              <Switch\n                value={options.aggregatedMetrics.active}\n                disabled={options.aggregatedMetrics.disabled}\n                onChange={model.toggleAggregatedMetricsOverride}\n              />\n            </span>\n          </div>\n        </div>\n      );\n    };\n\n    if (options.aggregatedMetrics) {\n      return (\n        <Dropdown overlay={renderPopover} placement=\"bottom\" onVisibleChange={model.onToggleOpen}>\n          <ToolbarButton icon=\"cog\" variant=\"canvas\" isOpen={isOpen} />\n        </Dropdown>\n      );\n    }\n\n    return <></>;\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    popover: css({\n      display: 'flex',\n      padding: theme.spacing(2),\n      flexDirection: 'column',\n      background: theme.colors.background.primary,\n      boxShadow: theme.shadows.z3,\n      borderRadius: theme.shape.radius.default,\n      border: `1px solid ${theme.colors.border.weak}`,\n      zIndex: 1,\n      marginRight: theme.spacing(2),\n    }),\n    heading: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      paddingBottom: theme.spacing(2),\n    }),\n    options: css({\n      display: 'grid',\n      gridTemplateColumns: '1fr 50px',\n      rowGap: theme.spacing(1),\n      columnGap: theme.spacing(2),\n      alignItems: 'center',\n    }),\n  };\n}\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Select, Stack, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { ServiceSelectionScene } from './ServiceSelectionScene';\nimport { ServiceSelectionTabsScene, TabOption } from './ServiceSelectionTabsScene';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport interface TabPopoverSceneState extends SceneObjectState {}\n\nexport class TabPopoverScene extends SceneObjectBase<TabPopoverSceneState> {\n  public static Component = ({ model }: SceneComponentProps<TabPopoverScene>) => {\n    const serviceSelectionScene = sceneGraph.getAncestor(model, ServiceSelectionScene);\n    const serviceSelectionTabsScene = sceneGraph.getAncestor(model, ServiceSelectionTabsScene);\n    const { tabOptions, showPopover } = serviceSelectionTabsScene.useState();\n    const popoverStyles = useStyles2(getPopoverStyles);\n\n    const tabOptionsWithIcon: TabOption[] = tabOptions.map((opt) => {\n      return {\n        ...opt,\n        icon: opt.saved ? 'save' : undefined,\n        label: `${opt.label} (${opt.counter})`,\n      };\n    });\n\n    return (\n      <Stack direction=\"column\" gap={0} role=\"tooltip\">\n        <div className={popoverStyles.card.body}>\n          <Select<string, { options: TabOption[] }>\n            menuShouldPortal={false}\n            width={50}\n            onBlur={() => {\n              serviceSelectionTabsScene.toggleShowPopover();\n            }}\n            autoFocus={true}\n            isOpen={showPopover}\n            placeholder={'Search labels'}\n            options={tabOptionsWithIcon}\n            isSearchable={true}\n            openMenuOnFocus={true}\n            onChange={(option) => {\n              // Add value to variable\n              if (option.value) {\n                // Hide the popover\n                serviceSelectionTabsScene.toggleShowPopover();\n                // Set new tab\n                serviceSelectionScene.setSelectedTab(option.value);\n              }\n            }}\n          />\n        </div>\n      </Stack>\n    );\n  };\n}\n\nconst getPopoverStyles = (theme: GrafanaTheme2) => ({\n  card: {\n    body: css({\n      padding: theme.spacing(1),\n    }),\n    p: css({\n      maxWidth: 300,\n    }),\n  },\n});\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState, SceneQueryRunner } from '@grafana/scenes';\nimport React, { useRef } from 'react';\nimport { Icon, Popover, PopoverController, Tab, TabsBar, Tooltip, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2, LoadingState, SelectableValue } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { SERVICE_NAME, SERVICE_UI_LABEL } from '../../services/variables';\nimport { truncateText } from '../../services/text';\nimport { rest } from 'lodash';\nimport { ServiceSelectionScene } from './ServiceSelectionScene';\nimport { getSceneQueryRunner } from '../../services/panel';\nimport { buildResourceQuery } from '../../services/query';\nimport { TabPopoverScene } from './TabPopoverScene';\nimport { getDataSourceVariable, getServiceSelectionPrimaryLabel } from '../../services/variableGetters';\nimport { getFavoriteTabsFromStorage, removeTabFromLocalStorage } from '../../services/store';\n\nexport interface TabOption extends SelectableValue<string> {\n  label: string;\n  value: string;\n  active?: boolean;\n  counter?: number;\n  saved?: boolean;\n  savedIndex?: number;\n}\n\nexport interface ServiceSelectionTabsSceneState extends SceneObjectState {\n  tabOptions: TabOption[];\n  showPopover: boolean;\n  $labelsData: SceneQueryRunner;\n  popover?: TabPopoverScene;\n}\n\ninterface LabelOptions {\n  label: string;\n  cardinality: number;\n}\n\nexport class ServiceSelectionTabsScene extends SceneObjectBase<ServiceSelectionTabsSceneState> {\n  constructor(state: Partial<ServiceSelectionTabsSceneState>) {\n    super({\n      showPopover: false,\n      $labelsData: getSceneQueryRunner({\n        queries: [buildResourceQuery('', 'detected_labels')],\n        runQueriesMode: 'manual',\n      }),\n      tabOptions: [\n        {\n          label: SERVICE_UI_LABEL,\n          value: SERVICE_NAME,\n          saved: true,\n        },\n      ],\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Component = ({ model }: SceneComponentProps<ServiceSelectionTabsScene>) => {\n    // Scene vars\n    const { tabOptions, showPopover, popover, $labelsData } = model.useState();\n    const { data } = $labelsData.useState();\n    const serviceSelectionScene = sceneGraph.getAncestor(model, ServiceSelectionScene);\n    const primaryLabel = getServiceSelectionPrimaryLabel(model);\n    // Re-render when active tab changes, which is stored in the primary label variable\n    primaryLabel.useState();\n\n    // Constants\n    const styles = useStyles2(getTabsStyles);\n    const popoverRef = useRef<HTMLElement>(null);\n    const maxLabelLength = 15;\n\n    return (\n      <TabsBar>\n        {tabOptions\n          .filter((tabLabel) => tabLabel.saved || tabLabel.active || tabLabel.value === SERVICE_NAME)\n          .sort((a, b) => {\n            // Service name goes first\n            if (a.value === SERVICE_NAME || b.value === SERVICE_NAME) {\n              return a.value === SERVICE_NAME ? -1 : 1;\n            }\n\n            // Then sort by the order added to local storage\n            return (a.savedIndex ?? 0) - (b.savedIndex ?? 0);\n          })\n          .map((tabLabel) => {\n            const tab = (\n              <Tab\n                key={tabLabel.value}\n                onChangeTab={() => {\n                  // Set the new active tab\n                  serviceSelectionScene.setSelectedTab(tabLabel.value);\n                }}\n                label={truncateText(tabLabel.label, maxLabelLength, true)}\n                active={tabLabel.active}\n                counter={tabLabel.counter}\n                suffix={\n                  tabLabel.value !== SERVICE_NAME\n                    ? (props) => {\n                        return (\n                          <>\n                            <Tooltip content={'Remove tab'}>\n                              <Icon\n                                onKeyDownCapture={(e) => {\n                                  if (e.key === 'Enter') {\n                                    model.removeSavedTab(tabLabel.value);\n                                  }\n                                }}\n                                onClick={(e) => {\n                                  // Don't bubble up to the tab component, we don't want to select the tab we're removing\n                                  e.stopPropagation();\n                                  model.removeSavedTab(tabLabel.value);\n                                }}\n                                name={'times'}\n                                className={cx(props.className)}\n                              />\n                            </Tooltip>\n                          </>\n                        );\n                      }\n                    : undefined\n                }\n              />\n            );\n\n            if (tabLabel.label.length > maxLabelLength) {\n              return (\n                <Tooltip key={tabLabel.value} content={tabLabel.label}>\n                  {tab}\n                </Tooltip>\n              );\n            } else {\n              return tab;\n            }\n          })}\n        {data?.state === LoadingState.Loading && <Tab label={'Loading tabs'} icon={'spinner'} />}\n\n        {/* Add more tabs tab */}\n        {data?.state === LoadingState.Done && (\n          <Tab onChangeTab={model.toggleShowPopover} label={'Add label'} ref={popoverRef} icon={'plus-circle'} />\n        )}\n\n        {popover && (\n          <PopoverController content={<popover.Component model={popover} />}>\n            {(showPopper, hidePopper, popperProps) => {\n              const blurFocusProps = {\n                onBlur: hidePopper,\n                onFocus: showPopper,\n              };\n\n              return (\n                <>\n                  {popoverRef.current && (\n                    <>\n                      {/* @ts-expect-error @todo upgrade typescript */}\n                      <Popover\n                        {...popperProps}\n                        {...rest}\n                        show={showPopover}\n                        wrapperClassName={styles.popover}\n                        referenceElement={popoverRef.current}\n                        renderArrow={true}\n                        {...blurFocusProps}\n                      />\n                    </>\n                  )}\n                </>\n              );\n            }}\n          </PopoverController>\n        )}\n      </TabsBar>\n    );\n  };\n\n  removeSavedTab = (labelName: string) => {\n    removeTabFromLocalStorage(getDataSourceVariable(this).getValue().toString(), labelName);\n\n    const labels = this.getLabelsFromQueryRunnerState();\n    if (labels) {\n      this.populatePrimaryLabelsVariableOptions(labels);\n    }\n\n    // If the user is closing the active tab, select the default tab\n    const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n    if (serviceSelectionScene.getSelectedTab() === labelName) {\n      serviceSelectionScene.selectDefaultLabelTab();\n    }\n  };\n\n  toggleShowPopover = () => {\n    this.setState({\n      showPopover: !this.state.showPopover,\n    });\n  };\n\n  getLabelsFromQueryRunnerState(state = this.state.$labelsData?.state): LabelOptions[] | undefined {\n    return state.data?.series[0].fields.map((f) => {\n      return {\n        label: f.name,\n        cardinality: f.values[0],\n      };\n    });\n  }\n\n  public populatePrimaryLabelsVariableOptions(labels: LabelOptions[]) {\n    const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n    const selectedTab = serviceSelectionScene.getSelectedTab();\n    const savedTabs = getFavoriteTabsFromStorage(getDataSourceVariable(this).getValue().toString());\n\n    const tabOptions: TabOption[] = labels\n      .map((l) => {\n        const savedIndex = savedTabs.indexOf(l.label);\n        const option: TabOption = {\n          label: l.label === SERVICE_NAME ? SERVICE_UI_LABEL : l.label,\n          value: l.label,\n          active: selectedTab === l.label,\n          counter: l.cardinality,\n          saved: savedIndex !== -1,\n          savedIndex,\n        };\n        return option;\n      })\n      .sort((a, b) => {\n        // Sort service first\n        if (a.value === SERVICE_NAME || b.value === SERVICE_NAME) {\n          return a.value === SERVICE_NAME ? -1 : 1;\n        }\n\n        // Then sort alphabetically\n        return a.label < b.label ? -1 : a.label > b.label ? 1 : 0;\n      });\n    this.setState({\n      tabOptions,\n    });\n  }\n\n  private onActivate() {\n    // Get labels\n    this.state.$labelsData.runQueries();\n\n    this.setState({\n      popover: new TabPopoverScene({}),\n    });\n\n    // Update labels (tabs) when datasource is changed\n    this._subs.add(\n      getDataSourceVariable(this).subscribeToState(() => {\n        this.state.$labelsData.runQueries();\n      })\n    );\n\n    this._subs.add(\n      getServiceSelectionPrimaryLabel(this).subscribeToState(() => {\n        const labels = this.getLabelsFromQueryRunnerState(this.state.$labelsData?.state);\n        if (labels) {\n          this.populatePrimaryLabelsVariableOptions(labels);\n        }\n      })\n    );\n\n    // Update labels/tabs on time range change\n    this._subs.add(\n      sceneGraph.getTimeRange(this).subscribeToState(() => {\n        this.state.$labelsData.runQueries();\n      })\n    );\n\n    this._subs.add(\n      this.state.$labelsData.subscribeToState((newState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          const labels = this.getLabelsFromQueryRunnerState(newState);\n          const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n\n          if (labels) {\n            this.populatePrimaryLabelsVariableOptions(labels);\n          }\n\n          const selectedTab = serviceSelectionScene.getSelectedTab();\n          // If the tab is no longer available, either because the user changed the datasource, or time range, select the default tab\n          if (!labels?.some((label) => label.label === selectedTab)) {\n            serviceSelectionScene.selectDefaultLabelTab();\n          }\n        }\n      })\n    );\n  }\n}\n\nconst getTabsStyles = (theme: GrafanaTheme2) => ({\n  popover: css({\n    borderRadius: theme.shape.radius.default,\n    boxShadow: theme.shadows.z3,\n    background: theme.colors.background.primary,\n    border: `1px solid ${theme.colors.border.weak}`,\n  }),\n});\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\nimport { Icon, IconType, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport {\n  addToFavoriteLabelValueInStorage,\n  getFavoriteLabelValuesFromStorage,\n  removeFromFavoritesInStorage,\n} from '../../services/store';\n\nexport interface FavoriteServiceHeaderActionSceneState extends SceneObjectState {\n  labelValue: string;\n  labelName: string;\n  ds: string;\n  hover?: boolean;\n}\n\nexport class FavoriteServiceHeaderActionScene extends SceneObjectBase<FavoriteServiceHeaderActionSceneState> {\n  public static Component = ({ model }: SceneComponentProps<FavoriteServiceHeaderActionScene>) => {\n    const { ds, labelValue, labelName, hover } = model.useState();\n    const isFavorite = getFavoriteLabelValuesFromStorage(ds, labelName).includes(labelValue);\n    const styles = useStyles2((theme) => getStyles(theme, isFavorite, hover));\n    const tooltipCopy = isFavorite ? `Remove  ${labelValue} from favorites` : `Add ${labelValue} to favorites`;\n\n    return (\n      <span className={styles.wrapper}>\n        <ToolbarButton\n          onMouseOver={() => {\n            model.setHover(true);\n          }}\n          onMouseOut={() => {\n            model.setHover(false);\n          }}\n          icon={<Icon name={isFavorite ? 'favorite' : 'star'} size=\"lg\" type={isFavorite ? 'mono' : 'default'} />}\n          color={isFavorite ? 'rgb(235, 123, 24)' : '#ccc'}\n          onClick={() => model.onClick(isFavorite)}\n          name={'star'}\n          aria-label={tooltipCopy}\n          tooltip={tooltipCopy}\n        />\n      </span>\n    );\n  };\n\n  public setHover(hover: boolean) {\n    this.setState({\n      hover,\n    });\n  }\n\n  public getIconType(isFavorite: boolean): IconType {\n    if (isFavorite) {\n      return this.state.hover ? 'default' : 'solid';\n    }\n    return this.state.hover ? 'solid' : 'default';\n  }\n\n  public onClick(isFavorite: boolean) {\n    if (isFavorite) {\n      // Remove from favorites\n      removeFromFavoritesInStorage(this.state.ds, this.state.labelName, this.state.labelValue);\n    } else {\n      // add to favorites\n      addToFavoriteLabelValueInStorage(this.state.ds, this.state.labelName, this.state.labelValue);\n    }\n    // Local storage changes won't trigger re-render, so we need to force the render so the new styles are calculated\n    this.forceRender();\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2, isFavorite: boolean, hover = false) {\n  return {\n    wrapper: css({\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      alignSelf: 'center',\n    }),\n  };\n}\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\n\nexport const NoServiceVolume = (props: { labelName: string }) => {\n  return (\n    <GrotError>\n      <p>\n        No logs found in <strong>{props.labelName}</strong>.<br />\n        Please adjust time range or select another label.\n      </p>\n    </GrotError>\n  );\n};\n","import { css } from '@emotion/css';\nimport { debounce } from 'lodash';\nimport React from 'react';\nimport {\n  AdHocVariableFilter,\n  DashboardCursorSync,\n  DataFrame,\n  dateTime,\n  GrafanaTheme2,\n  LoadingState,\n  TimeRange,\n} from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  behaviors,\n  DataSourceVariable,\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneQueryRunner,\n  SceneVariableSet,\n  VizPanel,\n} from '@grafana/scenes';\nimport {\n  DrawStyle,\n  Field,\n  IconButton,\n  LegendDisplayMode,\n  PanelContext,\n  SeriesVisibilityChangeMode,\n  StackingMode,\n  useStyles2,\n} from '@grafana/ui';\nimport { addTabToLocalStorage, getFavoriteLabelValuesFromStorage } from 'services/store';\nimport {\n  LEVEL_VARIABLE_VALUE,\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  VAR_AGGREGATED_METRICS,\n  VAR_PRIMARY_LABEL,\n  VAR_PRIMARY_LABEL_EXPR,\n  VAR_PRIMARY_LABEL_SEARCH,\n} from 'services/variables';\nimport { selectLabel, SelectServiceButton } from './SelectServiceButton';\nimport { buildDataQuery, buildResourceQuery } from 'services/query';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getQueryRunner, getSceneQueryRunner, setLevelColorOverrides } from 'services/panel';\nimport { ConfigureVolumeError } from './ConfigureVolumeError';\nimport { NoServiceSearchResults } from './NoServiceSearchResults';\nimport { getLabelsFromSeries, toggleLevelVisibility } from 'services/levels';\nimport { ServiceFieldSelector } from '../ServiceScene/Breakdowns/FieldSelector';\nimport { CustomConstantVariable } from '../../services/CustomConstantVariable';\nimport { areArraysEqual } from '../../services/comparison';\nimport {\n  clearServiceSelectionSearchVariable,\n  getAggregatedMetricsVariable,\n  getDataSourceVariable,\n  getLabelsVariable,\n  getServiceSelectionPrimaryLabel,\n  getServiceSelectionSearchVariable,\n  setServiceSelectionPrimaryLabelKey,\n} from '../../services/variableGetters';\nimport { config, locationService } from '@grafana/runtime';\nimport { VariableHide } from '@grafana/schema';\nimport { ToolbarScene } from '../IndexScene/ToolbarScene';\nimport { IndexScene } from '../IndexScene/IndexScene';\nimport { ServiceSelectionTabsScene } from './ServiceSelectionTabsScene';\nimport { FavoriteServiceHeaderActionScene } from './FavoriteServiceHeaderActionScene';\nimport { pushUrlHandler } from '../../services/navigate';\nimport { NoServiceVolume } from './NoServiceVolume';\n\nconst aggregatedMetricsEnabled: boolean | undefined = config.featureToggles.exploreLogsAggregatedMetrics;\n// Don't export AGGREGATED_SERVICE_NAME, we want to rename things so the rest of the application is agnostic to how we got the services\nconst AGGREGATED_SERVICE_NAME = '__aggregated_metric__';\n\n//@todo make start date user configurable, currently hardcoded for experimental cloud release\nexport const AGGREGATED_METRIC_START_DATE = dateTime('2024-08-30', 'YYYY-MM-DD');\nexport const SERVICES_LIMIT = 20;\n\ninterface ServiceSelectionSceneState extends SceneObjectState {\n  // The body of the component\n  body: SceneCSSGridLayout;\n  // Show logs of a certain level for a given service\n  serviceLevel: Map<string, string[]>;\n  // Logs volume API response as dataframe with SceneQueryRunner\n  $data: SceneQueryRunner;\n  tabs?: ServiceSelectionTabsScene;\n  showPopover: boolean;\n  tabOptions: Array<{\n    label: string;\n    value: string;\n  }>;\n}\n\nfunction renderPrimaryLabelFilters(filters: AdHocVariableFilter[]): string {\n  if (filters.length) {\n    const filter = filters[0];\n    return `${filter.key}${filter.operator}\\`${filter.value}\\``;\n  }\n\n  return '';\n}\n\nconst primaryLabelUrlKey = 'var-primary_label';\nconst datasourceUrlKey = 'var-ds';\n\nexport class ServiceSelectionScene extends SceneObjectBase<ServiceSelectionSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: [primaryLabelUrlKey],\n  });\n\n  constructor(state: Partial<ServiceSelectionSceneState>) {\n    super({\n      body: new SceneCSSGridLayout({ children: [] }),\n      $variables: new SceneVariableSet({\n        variables: [\n          // Service search variable\n          new CustomConstantVariable({\n            name: VAR_PRIMARY_LABEL_SEARCH,\n            label: 'Service',\n            hide: VariableHide.hideVariable,\n            skipUrlSync: true,\n            value: '.+',\n          }),\n          // variable that stores if aggregated metrics are supported for the query\n          new CustomConstantVariable({\n            name: VAR_AGGREGATED_METRICS,\n            label: '',\n            hide: VariableHide.hideLabel,\n            value: SERVICE_NAME,\n            skipUrlSync: true,\n            options: [\n              {\n                value: SERVICE_NAME,\n                label: SERVICE_NAME,\n              },\n              {\n                value: AGGREGATED_SERVICE_NAME,\n                label: AGGREGATED_SERVICE_NAME,\n              },\n            ],\n          }),\n          // The active tab expression, hidden variable\n          new AdHocFiltersVariable({\n            name: VAR_PRIMARY_LABEL,\n            hide: VariableHide.hideLabel,\n            expressionBuilder: (filters) => {\n              return renderPrimaryLabelFilters(filters);\n            },\n            filters: [\n              {\n                key: getSelectedTabFromUrl().key ?? SERVICE_NAME,\n                value: '.+',\n                operator: '=~',\n              },\n            ],\n          }),\n        ],\n      }),\n      $data: getSceneQueryRunner({\n        queries: [buildResourceQuery(`{${VAR_PRIMARY_LABEL_EXPR}}`, 'volume')],\n        runQueriesMode: 'manual',\n      }),\n      serviceLevel: new Map<string, string[]>(),\n\n      showPopover: false,\n      tabOptions: [\n        {\n          label: SERVICE_UI_LABEL,\n          value: SERVICE_NAME,\n        },\n      ],\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  /**\n   * Set changes from the URL to the state of the primary label variable\n   */\n  getUrlState() {\n    const { key } = getSelectedTabFromUrl();\n    const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n    const filter = primaryLabelVar.state.filters[0];\n\n    if (filter.key && filter.key !== key) {\n      getServiceSelectionPrimaryLabel(this).setState({\n        filters: [\n          {\n            ...filter,\n            key: key ?? filter.key,\n          },\n        ],\n      });\n    }\n\n    return {};\n  }\n\n  /**\n   * Unused, but required\n   * @param values\n   */\n  updateFromUrl(values: SceneObjectUrlValues) {\n    console.log('updateFromUrl', values);\n  }\n\n  addDatasourceChangeToBrowserHistory(newDs: string) {\n    const location = locationService.getLocation();\n    const search = new URLSearchParams(location.search);\n    const dsUrl = search.get(datasourceUrlKey);\n    if (dsUrl && newDs !== dsUrl) {\n      const currentUrl = location.pathname + location.search;\n      search.set(datasourceUrlKey, newDs);\n      const newUrl = location.pathname + '?' + search.toString();\n      if (currentUrl !== newUrl) {\n        pushUrlHandler(newUrl);\n      }\n    }\n  }\n\n  /**\n   * Attempting to add any change to the primary label variable (i.e. the selected tab) as a browser history event\n   * @param newKey\n   * @param replace\n   */\n  addLabelChangeToBrowserHistory(newKey: string, replace = false) {\n    const { key: primaryLabelRaw, search, location } = getSelectedTabFromUrl();\n    if (primaryLabelRaw) {\n      const primaryLabelSplit = primaryLabelRaw?.split('|');\n      const keyInUrl = primaryLabelSplit?.[0];\n\n      if (keyInUrl !== newKey) {\n        primaryLabelSplit[0] = newKey;\n        search.set(primaryLabelUrlKey, primaryLabelSplit.join('|'));\n        const currentUrl = location.pathname + location.search;\n        const newUrl = location.pathname + '?' + search.toString();\n        if (currentUrl !== newUrl) {\n          if (replace) {\n            locationService.replace(newUrl);\n          } else {\n            pushUrlHandler(newUrl);\n          }\n        }\n      }\n    }\n  }\n\n  public static Component = ({ model }: SceneComponentProps<ServiceSelectionScene>) => {\n    const styles = useStyles2(getStyles);\n    const { body, $data, tabs } = model.useState();\n    const { data } = $data.useState();\n    const selectedTab = model.getSelectedTab();\n\n    const serviceStringVariable = getServiceSelectionSearchVariable(model);\n    const { label, value: searchValue } = serviceStringVariable.useState();\n    const hasSearch = searchValue && searchValue !== '.+';\n\n    const { labelsByVolume, labelsToQuery } = model.getLabels(data?.series);\n    const isLogVolumeLoading =\n      data?.state === LoadingState.Loading || data?.state === LoadingState.Streaming || data === undefined;\n    const volumeApiError = $data.state.data?.state === LoadingState.Error;\n\n    const onSearchChange = (serviceName?: string) => {\n      model.onSearchServicesChange(serviceName);\n    };\n    const totalServices = labelsToQuery?.length ?? 0;\n    // To get the count of services that are currently displayed, divide the number of panels by 2, as there are 2 panels per service (logs and time series)\n    const renderedServices = body.state.children.length / 2;\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.bodyWrapper}>\n          {tabs && <tabs.Component model={tabs} />}\n          <Field className={styles.searchField}>\n            <div className={styles.searchWrapper}>\n              <ServiceFieldSelector\n                initialFilter={{\n                  label: model.unwrapWildcardSearch(serviceStringVariable.getValue().toString()),\n                  value: serviceStringVariable.getValue().toString(),\n                  icon: 'filter',\n                }}\n                isLoading={isLogVolumeLoading}\n                value={label}\n                onChange={(serviceName) => onSearchChange(serviceName)}\n                selectOption={(value: string) => {\n                  selectLabel(selectedTab, value, model);\n                }}\n                label={model.formatPrimaryLabelForUI()}\n                options={\n                  labelsToQuery?.map((serviceName) => ({\n                    value: serviceName,\n                    label: serviceName,\n                  })) ?? []\n                }\n              />\n              {!isLogVolumeLoading && (\n                <span className={styles.searchFieldPlaceholderText}>\n                  Showing {renderedServices} of {totalServices}{' '}\n                  <IconButton\n                    className={styles.icon}\n                    aria-label=\"Count info\"\n                    name={'info-circle'}\n                    tooltip={`${totalServices} labels have values for the selected time range. Total label count may differ`}\n                  />\n                </span>\n              )}\n            </div>\n          </Field>\n          {/** If we don't have any servicesByVolume, volume endpoint is probably not enabled */}\n          {!isLogVolumeLoading && volumeApiError && <ConfigureVolumeError />}\n          {!isLogVolumeLoading && !volumeApiError && hasSearch && !labelsByVolume?.length && <NoServiceSearchResults />}\n          {!isLogVolumeLoading && !volumeApiError && !hasSearch && !labelsByVolume?.length && (\n            <NoServiceVolume labelName={selectedTab} />\n          )}\n          {labelsToQuery && labelsToQuery.length > 0 && (\n            <div className={styles.body}>\n              <body.Component model={body} />\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  // We could also run model.setState in component, but it is recommended to implement the state-modifying methods in the scene object\n  onSearchServicesChange = debounce((primaryLabelSearch?: string) => {\n    // Set search variable\n    const searchVar = getServiceSelectionSearchVariable(this);\n\n    const newSearchString = primaryLabelSearch ? this.wrapWildcardSearch(primaryLabelSearch) : '.+';\n    if (newSearchString !== searchVar.state.value) {\n      searchVar.setState({\n        value: primaryLabelSearch ? this.wrapWildcardSearch(primaryLabelSearch) : '.+',\n        label: primaryLabelSearch ?? '',\n      });\n    }\n\n    const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n    const filter = primaryLabelVar.state.filters[0];\n\n    // Update primary label with search string\n    if (this.wrapWildcardSearch(searchVar.state.value.toString()) !== filter.value) {\n      primaryLabelVar.setState({\n        filters: [\n          {\n            ...filter,\n            value: this.wrapWildcardSearch(searchVar.state.value.toString()),\n          },\n        ],\n      });\n    }\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_selection,\n      USER_EVENTS_ACTIONS.service_selection.search_services_changed,\n      {\n        searchQuery: primaryLabelSearch,\n      }\n    );\n  }, 500);\n\n  getSelectedTab() {\n    return getServiceSelectionPrimaryLabel(this).state.filters[0]?.key;\n  }\n\n  getSelectedTabLabel() {\n    return getServiceSelectionPrimaryLabel(this).state.filters[0].key;\n  }\n\n  selectDefaultLabelTab() {\n    // Need to update the history before the state with replace instead of push, or we'll get invalid services saved to url state after changing datasource\n    this.addLabelChangeToBrowserHistory(SERVICE_NAME, true);\n    this.setSelectedTab(SERVICE_NAME);\n  }\n\n  setSelectedTab(labelName: string) {\n    addTabToLocalStorage(getDataSourceVariable(this).getValue().toString(), labelName);\n\n    // clear active search\n    clearServiceSelectionSearchVariable(this);\n\n    // Update the primary label variable\n    setServiceSelectionPrimaryLabelKey(labelName, this);\n  }\n\n  // Creates a layout with timeseries panel\n  buildServiceLayout(\n    primaryLabelName: string,\n    primaryLabelValue: string,\n    timeRange: TimeRange,\n    serviceLabelVar: CustomConstantVariable,\n    primaryLabelVar: AdHocFiltersVariable,\n    datasourceVar: DataSourceVariable\n  ) {\n    let splitDuration;\n    if (timeRange.to.diff(timeRange.from, 'hours') >= 4 && timeRange.to.diff(timeRange.from, 'hours') <= 26) {\n      splitDuration = '2h';\n    }\n    const panel = PanelBuilders.timeseries()\n      // If service was previously selected, we show it in the title\n      .setTitle(primaryLabelValue)\n      .setData(\n        getQueryRunner([\n          buildDataQuery(this.getMetricExpression(primaryLabelValue, serviceLabelVar, primaryLabelVar), {\n            legendFormat: `{{${LEVEL_VARIABLE_VALUE}}}`,\n            splitDuration,\n            refId: `ts-${primaryLabelValue}`,\n          }),\n        ])\n      )\n      .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n      .setCustomFieldConfig('fillOpacity', 100)\n      .setCustomFieldConfig('lineWidth', 0)\n      .setCustomFieldConfig('pointSize', 0)\n      .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n      .setUnit('short')\n      .setOverrides(setLevelColorOverrides)\n      .setOption('legend', {\n        showLegend: true,\n        calcs: ['sum'],\n        placement: 'right',\n        displayMode: LegendDisplayMode.Table,\n      })\n      .setHeaderActions([\n        new FavoriteServiceHeaderActionScene({\n          ds: datasourceVar.getValue()?.toString(),\n          labelName: primaryLabelName,\n          labelValue: primaryLabelValue,\n        }),\n        new SelectServiceButton({ labelValue: primaryLabelValue, labelName: primaryLabelName }),\n      ])\n      .build();\n\n    panel.setState({\n      extendPanelContext: (_, context) =>\n        this.extendTimeSeriesLegendBus(primaryLabelName, primaryLabelValue, context, panel),\n    });\n\n    return new SceneCSSGridItem({\n      $behaviors: [new behaviors.CursorSync({ key: 'serviceCrosshairSync', sync: DashboardCursorSync.Crosshair })],\n      body: panel,\n    });\n  }\n\n  isAggregatedMetricsActive() {\n    const toolbar = this.getQueryOptionsToolbar();\n    return !toolbar?.state.options.aggregatedMetrics.disabled && toolbar?.state.options.aggregatedMetrics.active;\n  }\n\n  getLevelFilterForService = (service: string) => {\n    let serviceLevels = this.state.serviceLevel.get(service) || [];\n    if (serviceLevels.length === 0) {\n      return '';\n    }\n    const filters = serviceLevels.map((level) => {\n      if (level === 'logs') {\n        level = '';\n      }\n      return `${LEVEL_VARIABLE_VALUE}=\\`${level}\\``;\n    });\n    return ` | ${filters.join(' or ')} `;\n  };\n\n  // Creates a layout with logs panel\n  buildServiceLogsLayout = (labelName: string, labelValue: string) => {\n    const levelFilter = this.getLevelFilterForService(labelValue);\n    return new SceneCSSGridItem({\n      $behaviors: [new behaviors.CursorSync({ sync: DashboardCursorSync.Off })],\n      body: PanelBuilders.logs()\n        // Hover header set to true removes unused header padding, displaying more logs\n        .setHoverHeader(true)\n        .setData(\n          getQueryRunner([\n            buildDataQuery(this.getLogExpression(labelName, labelValue, levelFilter), {\n              maxLines: 100,\n              refId: `logs-${labelValue}`,\n            }),\n          ])\n        )\n        .setTitle(labelValue)\n        .setOption('showTime', true)\n        .setOption('enableLogDetails', false)\n        .build(),\n    });\n  };\n\n  formatPrimaryLabelForUI() {\n    const selectedTab = this.getSelectedTab();\n    return selectedTab === SERVICE_NAME ? SERVICE_UI_LABEL : selectedTab;\n  }\n\n  private onActivate() {\n    this.fixRequiredUrlParams();\n    // Clear existing volume data on activate or we'll show stale cached data, potentially from a different datasource\n    this.setState({\n      $data: getSceneQueryRunner({\n        queries: [buildResourceQuery(`{${VAR_PRIMARY_LABEL_EXPR}}`, 'volume')],\n        runQueriesMode: 'manual',\n      }),\n    });\n\n    // Clear all adhoc filters when the scene is activated, if there are any\n    const variable = getLabelsVariable(this);\n    if (variable.state.filters.length > 0) {\n      variable.setState({\n        filters: [],\n      });\n    }\n\n    const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n    this._subs.add(\n      primaryLabelVar.subscribeToState((newState, prevState) => {\n        if (newState.filterExpression !== prevState.filterExpression) {\n          const newKey = newState.filters[0].key;\n          this.addLabelChangeToBrowserHistory(newKey);\n          this.runVolumeQuery();\n        }\n      })\n    );\n\n    this._subs.add(\n      this.state.$data.subscribeToState((newState, prevState) => {\n        // update body if the data is done loading, and the dataframes have changed\n        if (\n          newState.data?.state === LoadingState.Done &&\n          !areArraysEqual(prevState?.data?.series, newState?.data?.series)\n        ) {\n          this.updateBody();\n        }\n      })\n    );\n\n    if (this.isTimeRangeTooEarlyForAggMetrics()) {\n      this.onUnsupportedAggregatedMetricTimeRange();\n      if (this.state.$data.state.data?.state !== LoadingState.Done) {\n        this.runVolumeQuery();\n      }\n    } else {\n      this.onSupportedAggregatedMetricTimeRange();\n      if (this.state.$data.state.data?.state !== LoadingState.Done) {\n        this.runVolumeQuery();\n      }\n    }\n\n    // Update labels on time range change\n    this._subs.add(\n      sceneGraph.getTimeRange(this).subscribeToState(() => {\n        if (this.isTimeRangeTooEarlyForAggMetrics()) {\n          this.onUnsupportedAggregatedMetricTimeRange();\n        } else {\n          this.onSupportedAggregatedMetricTimeRange();\n        }\n        this.runVolumeQuery();\n      })\n    );\n\n    // Update labels on datasource change\n    this._subs.add(\n      getDataSourceVariable(this).subscribeToState((newState) => {\n        this.addDatasourceChangeToBrowserHistory(newState.value.toString());\n        this.runVolumeQuery();\n      })\n    );\n\n    this._subs.add(\n      this.getQueryOptionsToolbar()?.subscribeToState((newState, prevState) => {\n        if (newState.options.aggregatedMetrics.userOverride !== prevState.options.aggregatedMetrics.userOverride) {\n          this.runVolumeQuery();\n        }\n      })\n    );\n\n    // agg metrics need parser and unwrap, have to tear down and rebuild panels when the variable changes\n    this._subs.add(\n      getAggregatedMetricsVariable(this).subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          // Clear the body panels\n          this.setState({\n            body: new SceneCSSGridLayout({ children: [] }),\n          });\n          // And re-init with the new query\n          this.updateBody();\n        }\n      })\n    );\n  }\n\n  /**\n   * If the user copies a partial URL we want to prevent throwing runtime errors or running invalid queries, so we set the default tab which will trigger updates to the primary_label\n   * @private\n   */\n  private fixRequiredUrlParams() {\n    // If the selected tab is not in the URL, set the default\n    const { key } = getSelectedTabFromUrl();\n    if (!key) {\n      this.selectDefaultLabelTab();\n    }\n  }\n\n  private isTimeRangeTooEarlyForAggMetrics(): boolean {\n    const timeRange = sceneGraph.getTimeRange(this);\n    return timeRange.state.value.from.isBefore(dateTime(AGGREGATED_METRIC_START_DATE));\n  }\n\n  private onUnsupportedAggregatedMetricTimeRange() {\n    const toolbar = this.getQueryOptionsToolbar();\n    toolbar?.setState({\n      options: {\n        aggregatedMetrics: {\n          ...toolbar?.state.options.aggregatedMetrics,\n          disabled: true,\n        },\n      },\n    });\n  }\n\n  private getQueryOptionsToolbar() {\n    const indexScene = sceneGraph.getAncestor(this, IndexScene);\n    return indexScene.state.controls.find((control) => control instanceof ToolbarScene) as ToolbarScene | undefined;\n  }\n\n  private onSupportedAggregatedMetricTimeRange() {\n    const toolbar = this.getQueryOptionsToolbar();\n    toolbar?.setState({\n      options: {\n        aggregatedMetrics: {\n          ...toolbar?.state.options.aggregatedMetrics,\n          disabled: false,\n        },\n      },\n    });\n  }\n\n  private wrapWildcardSearch(input: string) {\n    if (input !== '.+' && input.substring(0, 2) !== '.*') {\n      return `.*${input}.*`;\n    }\n\n    return input;\n  }\n\n  public unwrapWildcardSearch(input: string) {\n    if (input.substring(0, 2) === '.*' && input.slice(-2) === '.*') {\n      return input.slice(2).slice(0, -2);\n    }\n    return input;\n  }\n\n  private runVolumeQuery() {\n    this.updateAggregatedMetricVariable();\n    this.state.$data.runQueries();\n  }\n\n  private updateAggregatedMetricVariable() {\n    const serviceLabelVar = getAggregatedMetricsVariable(this);\n    if ((!this.isTimeRangeTooEarlyForAggMetrics() || !aggregatedMetricsEnabled) && this.isAggregatedMetricsActive()) {\n      serviceLabelVar.changeValueTo(AGGREGATED_SERVICE_NAME);\n    } else {\n      serviceLabelVar.changeValueTo(SERVICE_NAME);\n    }\n  }\n\n  private updateTabs() {\n    if (!this.state.tabs) {\n      const tabs = new ServiceSelectionTabsScene({});\n      this.setState({\n        tabs,\n      });\n    }\n  }\n\n  private updateBody() {\n    const { labelsToQuery } = this.getLabels(this.state.$data.state.data?.series);\n    this.updateTabs();\n    // If no services are to be queried, clear the body\n    if (!labelsToQuery || labelsToQuery.length === 0) {\n      this.state.body.setState({ children: [] });\n    } else {\n      // If we have services to query, build the layout with the services. Children is an array of layouts for each service (1 row with 2 columns - timeseries and logs panel)\n      const newChildren: SceneCSSGridItem[] = [];\n      const existingChildren: SceneCSSGridItem[] = this.state.body.state.children as SceneCSSGridItem[];\n      const timeRange = sceneGraph.getTimeRange(this).state.value;\n      const aggregatedMetricsVariable = getAggregatedMetricsVariable(this);\n      const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n      const selectedTab = this.getSelectedTab();\n      const datasourceVariable = getDataSourceVariable(this);\n\n      for (const primaryLabelValue of labelsToQuery.slice(0, SERVICES_LIMIT)) {\n        const existing = existingChildren.filter((child) => {\n          const vizPanel = child.state.body as VizPanel | undefined;\n          return vizPanel?.state.title === primaryLabelValue;\n        });\n\n        if (existing.length === 2) {\n          // If we already have grid items for this service, move them over to the new array of children, this will preserve their queryRunners, preventing duplicate queries from getting run\n          newChildren.push(existing[0], existing[1]);\n        } else {\n          // for each service, we create a layout with timeseries and logs panel\n          newChildren.push(\n            this.buildServiceLayout(\n              selectedTab,\n              primaryLabelValue,\n              timeRange,\n              aggregatedMetricsVariable,\n              primaryLabelVar,\n              datasourceVariable\n            ),\n            this.buildServiceLogsLayout(selectedTab, primaryLabelValue)\n          );\n        }\n      }\n\n      this.state.body.setState({\n        children: newChildren,\n        isLazy: true,\n        templateColumns: 'repeat(auto-fit, minmax(500px, 1fr) minmax(300px, 70vw))',\n        autoRows: '200px',\n        md: {\n          templateColumns: '1fr',\n          rowGap: 1,\n          columnGap: 1,\n        },\n      });\n    }\n  }\n\n  /**\n   * Redraws service logs after toggling level visibility.\n   */\n  private updateServiceLogs(labelName: string, labelValue: string) {\n    if (!this.state.body) {\n      this.updateBody();\n      return;\n    }\n    const { labelsToQuery } = this.getLabels(this.state.$data.state.data?.series);\n    const serviceIndex = labelsToQuery?.indexOf(labelValue);\n    if (serviceIndex === undefined || serviceIndex < 0) {\n      return;\n    }\n    if (this.state.body) {\n      let newChildren = [...this.state.body.state.children];\n      newChildren.splice(serviceIndex * 2 + 1, 1, this.buildServiceLogsLayout(labelName, labelValue));\n      this.state.body.setState({ children: newChildren });\n    }\n  }\n\n  private getLogExpression(labelName: string, labelValue: string, levelFilter: string) {\n    return `{${labelName}=\\`${labelValue}\\`}${levelFilter}`;\n  }\n\n  private getMetricExpression(\n    labelValue: string,\n    serviceLabelVar: CustomConstantVariable,\n    primaryLabelVar: AdHocFiltersVariable\n  ) {\n    const filter = primaryLabelVar.state.filters[0];\n    if (serviceLabelVar.state.value === AGGREGATED_SERVICE_NAME) {\n      if (filter.key === SERVICE_NAME) {\n        return `sum by (${LEVEL_VARIABLE_VALUE}) (sum_over_time({${AGGREGATED_SERVICE_NAME}=\\`${labelValue}\\`} | logfmt | unwrap count [$__auto]))`;\n      } else {\n        return `sum by (${LEVEL_VARIABLE_VALUE}) (sum_over_time({${AGGREGATED_SERVICE_NAME}=~\\`.+\\` } | logfmt | ${filter.key}=\\`${labelValue}\\` | unwrap count [$__auto]))`;\n      }\n    }\n    return `sum by (${LEVEL_VARIABLE_VALUE}) (count_over_time({ ${filter.key}=\\`${labelValue}\\` } [$__auto]))`;\n  }\n\n  private extendTimeSeriesLegendBus = (\n    labelName: string,\n    labelValue: string,\n    context: PanelContext,\n    panel: VizPanel\n  ) => {\n    const originalOnToggleSeriesVisibility = context.onToggleSeriesVisibility;\n\n    context.onToggleSeriesVisibility = (level: string, mode: SeriesVisibilityChangeMode) => {\n      originalOnToggleSeriesVisibility?.(level, mode);\n\n      const allLevels = getLabelsFromSeries(panel.state.$data?.state.data?.series ?? []);\n      const levels = toggleLevelVisibility(level, this.state.serviceLevel.get(labelValue), mode, allLevels);\n      this.state.serviceLevel.set(labelValue, levels);\n\n      this.updateServiceLogs(labelName, labelValue);\n    };\n  };\n\n  private getLabels(series?: DataFrame[]) {\n    const labelsByVolume: string[] = series?.[0]?.fields[0].values ?? [];\n    const dsString = getDataSourceVariable(this).getValue()?.toString();\n    const searchString = getServiceSelectionSearchVariable(this).getValue();\n    const selectedTab = this.getSelectedTab();\n    const labelsToQuery = createListOfLabelsToQuery(labelsByVolume, dsString, String(searchString), selectedTab);\n    return { labelsByVolume, labelsToQuery: labelsToQuery };\n  }\n}\n\n// Create a list of services to query:\n// 1. Filters provided services by searchString\n// 2. Gets favoriteServicesToQuery from localStorage and filters them by searchString\n// 3. Orders them correctly\nfunction createListOfLabelsToQuery(services: string[], ds: string, searchString: string, labelName: string) {\n  if (!services?.length) {\n    return [];\n  }\n\n  if (searchString === '.+') {\n    searchString = '';\n  }\n\n  const favoriteServicesToQuery = getFavoriteLabelValuesFromStorage(ds, labelName).filter(\n    (service) => service.toLowerCase().includes(searchString.toLowerCase()) && services.includes(service)\n  );\n\n  // Deduplicate\n  return Array.from(new Set([...favoriteServicesToQuery, ...services]));\n}\n\nfunction getSelectedTabFromUrl() {\n  const location = locationService.getLocation();\n  const search = new URLSearchParams(location.search);\n  const primaryLabelRaw = search.get(primaryLabelUrlKey);\n  const primaryLabelSplit = primaryLabelRaw?.split('|');\n  const key = primaryLabelSplit?.[0];\n  return { key, search, location };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      flexGrow: 1,\n      position: 'relative',\n    }),\n    headingWrapper: css({\n      marginTop: theme.spacing(1),\n    }),\n    loadingText: css({\n      margin: 0,\n    }),\n    header: css({\n      position: 'absolute',\n      right: 0,\n      top: '4px',\n      zIndex: 2,\n    }),\n    bodyWrapper: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    icon: css({\n      color: theme.colors.text.disabled,\n      marginLeft: theme.spacing.x1,\n    }),\n    searchFieldPlaceholderText: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      color: theme.colors.text.disabled,\n      alignItems: 'center',\n      display: 'flex',\n    }),\n    searchWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      flexWrap: 'wrap',\n    }),\n    searchField: css({\n      marginTop: theme.spacing(1),\n      position: 'relative',\n    }),\n  };\n}\n","import React from 'react';\n\nimport { AdHocVariableFilter, SelectableValue } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  CustomVariable,\n  DataSourceVariable,\n  SceneComponentProps,\n  SceneControlsSpacer,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneVariableSet,\n  VariableValueSelectors,\n} from '@grafana/scenes';\nimport {\n  EXPLORATION_DS,\n  MIXED_FORMAT_EXPR,\n  VAR_DATASOURCE,\n  VAR_FIELDS,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_LINE_FILTER,\n  VAR_LOGS_FORMAT,\n  VAR_METADATA,\n  VAR_PATTERNS,\n} from 'services/variables';\n\nimport { addLastUsedDataSourceToStorage, getLastUsedDataSourceFromStorage } from 'services/store';\nimport { ServiceScene } from '../ServiceScene/ServiceScene';\nimport { LayoutScene } from './LayoutScene';\nimport { FilterOp } from 'services/filters';\nimport { getDrilldownSlug, PageSlugs } from '../../services/routing';\nimport { ServiceSelectionScene } from '../ServiceSelectionScene/ServiceSelectionScene';\nimport { LoadingPlaceholder } from '@grafana/ui';\nimport { config, locationService } from '@grafana/runtime';\nimport {\n  renderLogQLFieldFilters,\n  renderLogQLLabelFilters,\n  renderLogQLMetadataFilters,\n  renderPatternFilters,\n} from 'services/query';\nimport { VariableHide } from '@grafana/schema';\nimport { CustomConstantVariable } from '../../services/CustomConstantVariable';\nimport {\n  getFieldsVariable,\n  getLevelsVariable,\n  getPatternsVariable,\n  getUrlParamNameForVariable,\n} from '../../services/variableGetters';\nimport { ToolbarScene } from './ToolbarScene';\nimport { OptionalRouteMatch } from '../Pages';\n\nexport interface AppliedPattern {\n  pattern: string;\n  type: 'include' | 'exclude';\n}\n\nexport interface IndexSceneState extends SceneObjectState {\n  // contentScene is the scene that is displayed in the main body of the index scene - it can be either the service selection or service scene\n  contentScene?: SceneObject;\n  controls: SceneObject[];\n  body?: LayoutScene;\n  initialFilters?: AdHocVariableFilter[];\n  patterns?: AppliedPattern[];\n  routeMatch?: OptionalRouteMatch;\n}\n\nexport class IndexScene extends SceneObjectBase<IndexSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['patterns'] });\n\n  public constructor(state: Partial<IndexSceneState>) {\n    const { variablesScene, unsub } = getVariableSet(\n      getLastUsedDataSourceFromStorage() ?? 'grafanacloud-logs',\n      state.initialFilters\n    );\n\n    const controls: SceneObject[] = [\n      new VariableValueSelectors({ layout: 'vertical' }),\n      new SceneControlsSpacer(),\n      new SceneTimePicker({}),\n      new SceneRefreshPicker({}),\n    ];\n\n    if (getDrilldownSlug() === 'explore' && config.featureToggles.exploreLogsAggregatedMetrics) {\n      controls.push(\n        new ToolbarScene({\n          isOpen: false,\n        })\n      );\n    }\n\n    super({\n      $timeRange: state.$timeRange ?? new SceneTimeRange({}),\n      $variables: state.$variables ?? variablesScene,\n      controls: state.controls ?? controls,\n      // Need to clear patterns state when the class in constructed\n      patterns: [],\n      ...state,\n      body: new LayoutScene({}),\n    });\n\n    this._subs.add(unsub);\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  static Component = ({ model }: SceneComponentProps<IndexScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n\n  public onActivate() {\n    const stateUpdate: Partial<IndexSceneState> = {};\n\n    if (!this.state.contentScene) {\n      stateUpdate.contentScene = getContentScene(this.state.routeMatch?.params.breakdownLabel);\n    }\n\n    this.setState(stateUpdate);\n\n    this.updatePatterns(this.state, getPatternsVariable(this));\n    this.resetVariablesIfNotInUrl(getFieldsVariable(this), getUrlParamNameForVariable(VAR_FIELDS));\n    this.resetVariablesIfNotInUrl(getLevelsVariable(this), getUrlParamNameForVariable(VAR_LEVELS));\n\n    this._subs.add(\n      this.subscribeToState((newState) => {\n        this.updatePatterns(newState, getPatternsVariable(this));\n      })\n    );\n  }\n\n  /**\n   * @todo why do we need to manually sync fields and levels, but not other ad hoc variables?\n   * @param variable\n   * @param urlParamName\n   * @private\n   */\n  private resetVariablesIfNotInUrl(variable: AdHocFiltersVariable, urlParamName: string) {\n    const location = locationService.getLocation();\n    const search = new URLSearchParams(location.search);\n    const filtersFromUrl = search.get(urlParamName);\n\n    // If the filters aren't in the URL, then they're coming from the cache, set the state to sync with url\n    if (filtersFromUrl === null) {\n      variable.setState({ filters: [] });\n    }\n  }\n\n  private updatePatterns(newState: IndexSceneState, patternsVariable: CustomVariable) {\n    const patternsLine = renderPatternFilters(newState.patterns ?? []);\n    patternsVariable.changeValueTo(patternsLine);\n  }\n\n  getUrlState() {\n    return {\n      patterns: JSON.stringify(this.state.patterns),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<IndexSceneState> = {};\n\n    if (values.patterns && typeof values.patterns === 'string') {\n      stateUpdate.patterns = JSON.parse(values.patterns) as AppliedPattern[];\n    }\n\n    this.setState(stateUpdate);\n  }\n}\n\nfunction getContentScene(drillDownLabel?: string) {\n  const slug = getDrilldownSlug();\n  if (slug === PageSlugs.explore) {\n    return new ServiceSelectionScene({});\n  }\n\n  return new ServiceScene({\n    drillDownLabel,\n  });\n}\n\nfunction getVariableSet(initialDatasourceUid: string, initialFilters?: AdHocVariableFilter[]) {\n  const operators = [FilterOp.Equal, FilterOp.NotEqual].map<SelectableValue<string>>((value) => ({\n    label: value,\n    value,\n  }));\n\n  const labelVariable = new AdHocFiltersVariable({\n    name: VAR_LABELS,\n    datasource: EXPLORATION_DS,\n    layout: 'vertical',\n    label: 'Service',\n    filters: initialFilters ?? [],\n    expressionBuilder: renderLogQLLabelFilters,\n    hide: VariableHide.hideLabel,\n    key: 'adhoc_service_filter',\n  });\n\n  labelVariable._getOperators = function () {\n    return operators;\n  };\n\n  const fieldsVariable = new AdHocFiltersVariable({\n    name: VAR_FIELDS,\n    label: 'Filters',\n    applyMode: 'manual',\n    layout: 'vertical',\n    getTagKeysProvider: () => Promise.resolve({ replace: true, values: [] }),\n    getTagValuesProvider: () => Promise.resolve({ replace: true, values: [] }),\n    expressionBuilder: renderLogQLFieldFilters,\n    hide: VariableHide.hideLabel,\n  });\n\n  fieldsVariable._getOperators = () => {\n    return operators;\n  };\n\n  const metadataVariable = new AdHocFiltersVariable({\n    name: VAR_METADATA,\n    label: 'Metadata',\n    applyMode: 'manual',\n    layout: 'vertical',\n    getTagKeysProvider: () => Promise.resolve({ replace: true, values: [] }),\n    getTagValuesProvider: () => Promise.resolve({ replace: true, values: [] }),\n    expressionBuilder: renderLogQLMetadataFilters,\n    hide: VariableHide.hideLabel,\n  });\n\n  metadataVariable._getOperators = () => {\n    return operators;\n  };\n\n  const levelsVariable = new AdHocFiltersVariable({\n    name: VAR_LEVELS,\n    label: 'Filters',\n    applyMode: 'manual',\n    layout: 'vertical',\n    getTagKeysProvider: () => Promise.resolve({ replace: true, values: [] }),\n    getTagValuesProvider: () => Promise.resolve({ replace: true, values: [] }),\n    expressionBuilder: renderLogQLMetadataFilters,\n    hide: VariableHide.hideLabel,\n  });\n\n  levelsVariable._getOperators = () => {\n    return operators;\n  };\n\n  const dsVariable = new DataSourceVariable({\n    name: VAR_DATASOURCE,\n    label: 'Data source',\n    value: initialDatasourceUid,\n    pluginId: 'loki',\n  });\n\n  const unsub = dsVariable.subscribeToState((newState) => {\n    const dsValue = `${newState.value}`;\n    newState.value && addLastUsedDataSourceToStorage(dsValue);\n  });\n\n  return {\n    variablesScene: new SceneVariableSet({\n      variables: [\n        dsVariable,\n        labelVariable,\n        fieldsVariable,\n        levelsVariable,\n        metadataVariable,\n        new CustomVariable({\n          name: VAR_PATTERNS,\n          value: '',\n          hide: VariableHide.hideVariable,\n        }),\n        new CustomVariable({ name: VAR_LINE_FILTER, value: '', hide: VariableHide.hideVariable }),\n\n        // This variable is a hack to get logs context working, this variable should never be used or updated\n        new CustomConstantVariable({\n          name: VAR_LOGS_FORMAT,\n          value: MIXED_FORMAT_EXPR,\n          skipUrlSync: true,\n          hide: VariableHide.hideVariable,\n          options: [{ value: MIXED_FORMAT_EXPR, label: MIXED_FORMAT_EXPR }],\n        }),\n      ],\n    }),\n    unsub,\n  };\n}\n","import React from 'react';\n\nimport { AdHocVariableFilter, BusEventBase, DataFrame } from '@grafana/data';\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { VariableHide } from '@grafana/schema';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { LEVEL_VARIABLE_VALUE, VAR_FIELDS, VAR_LABELS, VAR_LEVELS, VAR_METADATA } from 'services/variables';\nimport { FilterButton } from 'Components/FilterButton';\nimport { FilterOp } from 'services/filters';\nimport { getDetectedLabelsFrame } from '../ServiceScene';\nimport { getParserForField } from '../../../services/fields';\nimport { getAdHocFiltersVariable, getValueFromAdHocVariableFilter } from '../../../services/variableGetters';\n\nexport interface AddToFiltersButtonState extends SceneObjectState {\n  frame: DataFrame;\n  variableName: VariableFilterType;\n}\n\nexport class AddFilterEvent extends BusEventBase {\n  constructor(public operator: FilterType, public key: string, public value: string) {\n    super();\n  }\n  public static type = 'add-filter';\n}\n\n/**\n * Filter types:\n * - include/exclude: add a negative or positive filter\n * - clear: remove filter if exists\n * - toggle: if the filter does not exist, add as include; if exists, remove\n */\nexport type FilterType = 'include' | 'clear' | 'exclude' | 'toggle';\n\nexport function addAdHocFilter(filter: AdHocVariableFilter, scene: SceneObject, variableType?: VariableFilterType) {\n  const type: FilterType = filter.operator === '=' ? 'include' : 'exclude';\n  addToFilters(filter.key, filter.value, type, scene, variableType);\n}\n\nexport type VariableFilterType = typeof VAR_LABELS | typeof VAR_FIELDS | typeof VAR_LEVELS | typeof VAR_METADATA;\n\nexport function addToFilters(\n  key: string,\n  value: string,\n  operator: FilterType,\n  scene: SceneObject,\n  variableType?: VariableFilterType\n) {\n  if (!variableType) {\n    variableType = resolveVariableTypeForField(key, scene);\n  }\n\n  const variable = getAdHocFiltersVariable(validateVariableNameForField(key, variableType), scene);\n\n  let valueObject: string | undefined = undefined;\n  if (variableType === VAR_FIELDS) {\n    valueObject = JSON.stringify({\n      value,\n      parser: getParserForField(key, scene),\n    });\n  }\n\n  // If the filter exists, filter it\n  let filters = variable.state.filters.filter((filter) => {\n    const fieldValue = getValueFromAdHocVariableFilter(variable, filter);\n    return !(filter.key === key && fieldValue.value === value);\n  });\n\n  const filterExists = filters.length !== variable.state.filters.length;\n\n  if (operator === 'include' || operator === 'exclude' || (!filterExists && operator === 'toggle')) {\n    filters = [\n      ...filters,\n      {\n        key,\n        operator: operator === 'exclude' ? FilterOp.NotEqual : FilterOp.Equal,\n        value: valueObject ? valueObject : value,\n        valueLabels: [value],\n      },\n    ];\n  }\n\n  scene.publishEvent(new AddFilterEvent(operator, key, value), true);\n\n  variable.setState({\n    filters,\n    hide: VariableHide.hideLabel,\n  });\n}\n\nexport function replaceFilter(\n  key: string,\n  value: string,\n  operator: Extract<FilterType, 'include' | 'exclude'>,\n  scene: SceneObject\n) {\n  const variable = getAdHocFiltersVariable(\n    validateVariableNameForField(key, resolveVariableTypeForField(key, scene)),\n    scene\n  );\n\n  variable.setState({\n    filters: [\n      {\n        key,\n        operator: operator === 'exclude' ? FilterOp.NotEqual : FilterOp.Equal,\n        value,\n      },\n    ],\n    hide: VariableHide.hideLabel,\n  });\n}\n\nfunction validateVariableNameForField(field: string, variableName: string) {\n  // Special case: If the key is LEVEL_VARIABLE_VALUE, we need to use the VAR_FIELDS.\n  if (field === LEVEL_VARIABLE_VALUE) {\n    return VAR_LEVELS;\n  }\n  return variableName;\n}\n\nfunction resolveVariableTypeForField(field: string, scene: SceneObject): VariableFilterType {\n  const indexedLabel = getDetectedLabelsFrame(scene)?.fields?.find((label) => label.name === field);\n  return indexedLabel ? VAR_LABELS : VAR_FIELDS;\n}\n\nexport class AddToFiltersButton extends SceneObjectBase<AddToFiltersButtonState> {\n  public onClick = (type: FilterType) => {\n    const filter = getFilter(this.state.frame);\n    if (!filter) {\n      return;\n    }\n\n    addToFilters(filter.name, filter.value, type, this, this.state.variableName);\n\n    const variable = getAdHocFiltersVariable(validateVariableNameForField(filter.name, this.state.variableName), this);\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.add_to_filters_in_breakdown_clicked,\n      {\n        filterType: this.state.variableName,\n        key: filter.name,\n        action: type,\n        filtersLength: variable?.state.filters.length || 0,\n      }\n    );\n  };\n\n  isSelected = () => {\n    const filter = getFilter(this.state.frame);\n    if (!filter) {\n      return { isIncluded: false, isExcluded: false };\n    }\n\n    const variable = getAdHocFiltersVariable(validateVariableNameForField(filter.name, this.state.variableName), this);\n\n    // Check if the filter is already there\n    const filterInSelectedFilters = variable.state.filters.find((f) => {\n      const value = getValueFromAdHocVariableFilter(variable, f);\n      return f.key === filter.name && value.value === filter.value;\n    });\n\n    if (!filterInSelectedFilters) {\n      return { isIncluded: false, isExcluded: false };\n    }\n\n    return {\n      isIncluded: filterInSelectedFilters.operator === FilterOp.Equal,\n      isExcluded: filterInSelectedFilters.operator === FilterOp.NotEqual,\n    };\n  };\n\n  public static Component = ({ model }: SceneComponentProps<AddToFiltersButton>) => {\n    const { isIncluded, isExcluded } = model.isSelected();\n    return (\n      <FilterButton\n        buttonFill={'outline'}\n        isIncluded={isIncluded}\n        isExcluded={isExcluded}\n        onInclude={() => model.onClick('include')}\n        onClear={() => model.onClick('clear')}\n        onExclude={() => model.onClick('exclude')}\n      />\n    );\n  };\n}\n\nconst getFilter = (frame: DataFrame) => {\n  // current filter name and value is format {name: value}\n  const filterNameAndValueObj = frame.fields[1]?.labels ?? {};\n  // Sanity check - filter should have only one key-value pair\n  if (Object.keys(filterNameAndValueObj).length !== 1) {\n    return;\n  }\n  const name = Object.keys(filterNameAndValueObj)[0];\n  const value = filterNameAndValueObj[name];\n  return { name, value };\n};\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React, { ChangeEvent } from 'react';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { SearchInput } from './SearchInput';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport { BusEventBase } from '@grafana/data';\nimport { LabelValuesBreakdownScene } from './LabelValuesBreakdownScene';\nimport { FieldValuesBreakdownScene } from './FieldValuesBreakdownScene';\nimport { logger } from '../../../services/logger';\n\nexport class BreakdownSearchReset extends BusEventBase {\n  public static type = 'breakdown-search-reset';\n}\n\nexport interface BreakdownSearchSceneState extends SceneObjectState {\n  filter?: string;\n}\n\nconst recentFilters: Record<string, string> = {};\n\nexport class BreakdownSearchScene extends SceneObjectBase<BreakdownSearchSceneState> {\n  private cacheKey: string;\n  constructor(cacheKey: string) {\n    super({\n      filter: recentFilters[cacheKey] ?? '',\n    });\n    this.cacheKey = cacheKey;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<BreakdownSearchScene>) => {\n    const { filter } = model.useState();\n    return (\n      <SearchInput\n        value={filter}\n        onChange={model.onValueFilterChange}\n        onClear={model.clearValueFilter}\n        placeholder=\"Search for value\"\n      />\n    );\n  };\n\n  public onValueFilterChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ filter: event.target.value });\n    this.filterValues(event.target.value);\n  };\n\n  public clearValueFilter = () => {\n    this.setState({ filter: '' });\n    this.filterValues('');\n  };\n\n  public reset = () => {\n    this.setState({ filter: '' });\n    recentFilters[this.cacheKey] = '';\n  };\n\n  private filterValues(filter: string) {\n    if (this.parent instanceof LabelBreakdownScene || this.parent instanceof FieldsBreakdownScene) {\n      recentFilters[this.cacheKey] = filter;\n      const body = this.parent.state.body;\n      if (body instanceof LabelValuesBreakdownScene || body instanceof FieldValuesBreakdownScene) {\n        body.state.body?.forEachChild((child) => {\n          if (child instanceof ByFrameRepeater && child.state.body.isActive) {\n            child.filterByString(filter);\n          }\n        });\n      } else {\n        logger.warn('invalid parent for search', {\n          typeofBody: typeof body,\n          filter,\n        });\n      }\n    }\n  }\n}\n","import React from 'react';\n\nimport { DataFrame, LoadingState, PanelData } from '@grafana/data';\nimport {\n  SceneByFrameRepeater,\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneLayout,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n} from '@grafana/scenes';\nimport { sortSeries } from 'services/sorting';\nimport { fuzzySearch } from '../../../services/search';\nimport { getLabelValue } from './SortByScene';\nimport { Alert, Button } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { BreakdownSearchReset } from './BreakdownSearchScene';\n\ninterface ByFrameRepeaterState extends SceneObjectState {\n  body: SceneLayout;\n  getLayoutChild(frame: DataFrame, frameIndex: number): SceneFlexItem;\n}\n\ntype FrameFilterCallback = (frame: DataFrame) => boolean;\ntype FrameIterateCallback = (frames: DataFrame[], seriesIndex: number) => void;\n\nexport class ByFrameRepeater extends SceneObjectBase<ByFrameRepeaterState> {\n  private unfilteredChildren: SceneFlexItem[] = [];\n  private sortBy: string;\n  private direction: string;\n  private sortedSeries: DataFrame[] = [];\n  private getFilter: () => string;\n  public constructor({\n    sortBy,\n    direction,\n    getFilter,\n    ...state\n  }: ByFrameRepeaterState & { sortBy: string; direction: string; getFilter: () => string }) {\n    super(state);\n\n    this.sortBy = sortBy;\n    this.direction = direction;\n    this.getFilter = getFilter;\n\n    this.addActivationHandler(() => {\n      const data = sceneGraph.getData(this);\n\n      this._subs.add(\n        data.subscribeToState((data, prevData) => {\n          if (\n            data.data?.state === LoadingState.Done ||\n            (data.data?.state === LoadingState.Streaming &&\n              data.data.series.length > (prevData.data?.series.length ?? 0))\n          ) {\n            this.performRepeat(data.data);\n          }\n        })\n      );\n\n      if (data.state.data) {\n        this.performRepeat(data.state.data);\n      }\n    });\n  }\n\n  public sort = (sortBy: string, direction: string) => {\n    const data = sceneGraph.getData(this);\n    this.sortBy = sortBy;\n    this.direction = direction;\n    if (data.state.data) {\n      this.performRepeat(data.state.data);\n    }\n  };\n\n  private performRepeat(data: PanelData) {\n    const newChildren: SceneFlexItem[] = [];\n    const sortedSeries = sortSeries(data.series, this.sortBy, this.direction);\n\n    for (let seriesIndex = 0; seriesIndex < sortedSeries.length; seriesIndex++) {\n      const layoutChild = this.state.getLayoutChild(sortedSeries[seriesIndex], seriesIndex);\n      newChildren.push(layoutChild);\n    }\n\n    this.sortedSeries = sortedSeries;\n    this.unfilteredChildren = newChildren;\n\n    if (this.getFilter()) {\n      this.state.body.setState({ children: [] });\n      this.filterByString(this.getFilter());\n    } else {\n      this.state.body.setState({ children: newChildren });\n    }\n  }\n\n  public iterateFrames = (callback: FrameIterateCallback) => {\n    const data = sceneGraph.getData(this).state.data;\n    if (!data) {\n      return;\n    }\n    for (let seriesIndex = 0; seriesIndex < this.sortedSeries.length; seriesIndex++) {\n      callback(this.sortedSeries, seriesIndex);\n    }\n  };\n\n  filterByString = (filter: string) => {\n    let haystack: string[] = [];\n\n    this.iterateFrames((frames, seriesIndex) => {\n      const labelValue = getLabelValue(frames[seriesIndex]);\n      haystack.push(labelValue);\n    });\n    fuzzySearch(haystack, filter, (data) => {\n      if (data && data[0]) {\n        // We got search results\n        this.filterFrames((frame: DataFrame) => {\n          const label = getLabelValue(frame);\n          return data[0].includes(label);\n        });\n      } else {\n        // reset search\n        this.filterFrames(() => true);\n      }\n    });\n  };\n\n  public filterFrames = (filterFn: FrameFilterCallback) => {\n    const newChildren: SceneFlexItem[] = [];\n    this.iterateFrames((frames, seriesIndex) => {\n      if (filterFn(frames[seriesIndex])) {\n        newChildren.push(this.unfilteredChildren[seriesIndex]);\n      }\n    });\n\n    if (newChildren.length === 0) {\n      this.state.body.setState({ children: [buildNoResultsScene(this.getFilter(), this.clearFilter)] });\n    } else {\n      this.state.body.setState({ children: newChildren });\n    }\n  };\n\n  public clearFilter = () => {\n    this.publishEvent(new BreakdownSearchReset(), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SceneByFrameRepeater>) => {\n    const { body } = model.useState();\n    return <body.Component model={body} />;\n  };\n}\n\nfunction buildNoResultsScene(filter: string, clearFilter: () => void) {\n  return new SceneFlexLayout({\n    direction: 'row',\n    children: [\n      new SceneFlexItem({\n        body: new SceneReactObject({\n          reactNode: (\n            <div className={styles.alertContainer}>\n              <Alert title=\"\" severity=\"info\" className={styles.noResultsAlert}>\n                No values found matching &ldquo;{filter}&rdquo;\n                <Button className={styles.clearButton} onClick={clearFilter}>\n                  Clear filter\n                </Button>\n              </Alert>\n            </div>\n          ),\n        }),\n      }),\n    ],\n  });\n}\n\nconst styles = {\n  alertContainer: css({\n    flexGrow: 1,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n  }),\n  noResultsAlert: css({\n    minWidth: '30vw',\n    flexGrow: 0,\n  }),\n  clearButton: css({\n    marginLeft: '1.5rem',\n  }),\n};\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { GrotError } from '../../GrotError';\nimport { Alert } from '@grafana/ui';\nimport React from 'react';\nimport { emptyStateStyles } from './FieldsBreakdownScene';\n\nexport interface EmptyLayoutSceneState extends SceneObjectState {\n  type: 'fields' | 'labels';\n}\n\nexport class EmptyLayoutScene extends SceneObjectBase<EmptyLayoutSceneState> {\n  public static Component({ model }: SceneComponentProps<EmptyLayoutScene>) {\n    const { type } = model.useState();\n    return (\n      <GrotError>\n        <Alert title=\"\" severity=\"warning\">\n          We did not find any {type} for the given timerange. Please{' '}\n          <a\n            className={emptyStateStyles.link}\n            href=\"https://forms.gle/1sYWCTPvD72T1dPH9\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            let us know\n          </a>{' '}\n          if you think this is a mistake.\n        </Alert>\n      </GrotError>\n    );\n  }\n}\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Select, useStyles2, InlineField, Icon, ActionMeta, InputActionMeta } from '@grafana/ui';\nimport { testIds } from '../../../services/testIds';\nimport { VariableValueOption } from '@grafana/scenes';\n\ntype Props<T> = {\n  options: VariableValueOption[];\n  value?: T;\n  onChange: (label: T | undefined) => void;\n  label: string;\n};\n\nexport type AsyncFieldSelectorProps = {\n  selectOption: (value: string) => void;\n  isLoading: boolean;\n  initialFilter: SelectableValue<string>;\n} & Props<string>;\n\nexport function FieldSelector<T>({ options, value, onChange, label }: Props<T>) {\n  const styles = useStyles2(getStyles);\n  const [selected, setSelected] = useState(false);\n\n  const selectableOptions: SelectableValue[] = options.map((option) => {\n    return {\n      label: option.label,\n      value: option.value,\n    };\n  });\n  return (\n    <InlineField label={label}>\n      <Select\n        {...{ options: selectableOptions, value }}\n        onOpenMenu={() => setSelected(true)}\n        onCloseMenu={() => setSelected(false)}\n        onChange={(selected: SelectableValue<T>) => onChange(selected.value)}\n        className={styles.select}\n        prefix={selected ? undefined : <Icon name={'search'} />}\n      />\n    </InlineField>\n  );\n}\n\nexport function ServiceFieldSelector({\n  options,\n  value,\n  onChange,\n  label,\n  selectOption,\n  isLoading,\n  initialFilter,\n}: AsyncFieldSelectorProps) {\n  const styles = useStyles2(getStyles);\n  const [selected, setSelected] = useState(false);\n  const [customOption, setCustomOption] = useState<SelectableValue<string>>(initialFilter);\n\n  const selectableOptions: SelectableValue[] = options.map((option) => {\n    return {\n      label: option.label,\n      value: option.value,\n    };\n  });\n  const allOptions =\n    customOption && value && customOption.value?.includes(value)\n      ? [customOption, ...selectableOptions]\n      : selectableOptions;\n  const selectedOption = allOptions?.find((opt) => opt.value === value);\n\n  return (\n    <InlineField className={styles.selectWrapper} grow={true} label={label}>\n      <Select\n        isLoading={isLoading}\n        data-testid={testIds.exploreServiceSearch.search}\n        placeholder={`Search values`}\n        options={allOptions}\n        isClearable={true}\n        value={value}\n        onOpenMenu={() => setSelected(true)}\n        onCloseMenu={() => setSelected(false)}\n        allowCustomValue={true}\n        prefix={selected || selectedOption?.__isNew__ ? undefined : <Icon name={'search'} />}\n        onChange={(value: SelectableValue<string>, actionMeta: ActionMeta) => {\n          // Custom added value\n          if (value?.__isNew__ || value?.icon) {\n            setCustomOption({ ...value, icon: 'filter' });\n            return onChange(value.value);\n          }\n\n          // If the user clears the search\n          if (actionMeta.action === 'clear') {\n            return onChange('');\n          }\n\n          // Select the service is the value is not a custom filter\n          if (actionMeta.action === 'select-option' && value.value && !value.__isNew__) {\n            selectOption(value.value);\n          }\n        }}\n        onInputChange={(value: string | undefined, actionMeta: InputActionMeta) => {\n          // Grafana/grafana doesn't have types from react-select, but we need the prevInput to add custom value when user clicks off with active search string\n          const meta = actionMeta as InputActionMeta & { prevInputValue: string };\n\n          // The user is typing\n          if (meta.action === 'input-change') {\n            return onChange(value);\n          }\n\n          // the user closed the menu, with text in search box\n          if (meta.action === 'menu-close' && meta.prevInputValue) {\n            setCustomOption({\n              value: meta.prevInputValue,\n              label: meta.prevInputValue,\n              icon: 'filter',\n              __isNew__: true,\n            });\n            return onChange(meta.prevInputValue);\n          }\n        }}\n      />\n    </InlineField>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    input: css({\n      marginBottom: 0,\n    }),\n    select: css({\n      maxWidth: theme.spacing(64),\n      minWidth: theme.spacing(20),\n    }),\n    selectWrapper: css({\n      maxWidth: theme.spacing(62.5),\n      minWidth: theme.spacing(20),\n      marginRight: theme.spacing.x1,\n      marginBottom: 0,\n    }),\n  };\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n} from '@grafana/scenes';\nimport { buildDataQuery } from '../../../services/query';\nimport { getSortByPreference } from '../../../services/store';\nimport { DataQueryError, LoadingState } from '@grafana/data';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { getQueryRunner } from '../../../services/panel';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { Alert, DrawStyle, LoadingPlaceholder } from '@grafana/ui';\nimport { buildFieldsQueryString, getFilterBreakdownValueScene, getParserForField } from '../../../services/fields';\nimport { getLabelValue } from './SortByScene';\nimport { VAR_FIELDS, VAR_METADATA } from '../../../services/variables';\nimport React from 'react';\nimport { FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS, FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport { AddFilterEvent } from './AddToFiltersButton';\nimport { navigateToDrilldownPage } from '../../../services/navigate';\nimport { PageSlugs } from '../../../services/routing';\nimport { getDetectedFieldsFrame, ServiceScene } from '../ServiceScene';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { getFieldGroupByVariable, getFieldsVariable } from '../../../services/variableGetters';\nimport { LokiQuery } from '../../../services/lokiQuery';\n\nexport interface FieldValuesBreakdownSceneState extends SceneObjectState {\n  body?: (LayoutSwitcher & SceneObject) | (SceneReactObject & SceneObject);\n  $data?: SceneDataProvider;\n  lastFilterEvent?: AddFilterEvent;\n}\n\nexport class FieldValuesBreakdownScene extends SceneObjectBase<FieldValuesBreakdownSceneState> {\n  constructor(state: Partial<FieldValuesBreakdownSceneState>) {\n    super(state);\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Selector({ model }: SceneComponentProps<FieldValuesBreakdownScene>) {\n    const { body } = model.useState();\n    if (body instanceof LayoutSwitcher) {\n      return <>{body && <body.Selector model={body} />}</>;\n    }\n\n    return <></>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<FieldValuesBreakdownScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <>{body && <body.Component model={body} />}</>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n\n  onActivate() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const tagKey = String(groupByVariable.state.value);\n\n    const fieldsVariable = getFieldsVariable(this);\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    const queryString = buildFieldsQueryString(tagKey, fieldsVariable, detectedFieldsFrame);\n    const query = buildDataQuery(queryString, { legendFormat: `{{${tagKey}}}`, refId: tagKey });\n\n    this.setState({\n      body: this.build(query),\n      $data: getQueryRunner([query]),\n    });\n\n    this._subs.add(\n      this.subscribeToEvent(AddFilterEvent, (event) => {\n        this.setState({\n          lastFilterEvent: event,\n        });\n      })\n    );\n\n    this._subs.add(\n      this.state.$data?.subscribeToState((newState) => {\n        this.onValuesDataQueryChange(newState, query);\n      })\n    );\n  }\n\n  private onValuesDataQueryChange(newState: SceneDataState, query: LokiQuery) {\n    if (newState.data?.state === LoadingState.Done) {\n      // No panels for the user to select, presumably because everything has been excluded\n      const event = this.state.lastFilterEvent;\n\n      // @todo discuss: Do we want to let users exclude all fields? Or should we redirect when excluding the penultimate panel?\n      if (newState.data?.state === LoadingState.Done && event) {\n        if (event.operator === 'exclude' && newState.data.series.length < 1) {\n          this.navigateToFields();\n        }\n\n        // @todo discuss: wouldn't include always return in 1 result? Do we need to wait for the query to run or should we navigate on receiving the include event and cancel the ongoing query?\n        if (event.operator === 'include' && newState.data.series.length <= 1) {\n          this.navigateToFields();\n        }\n      }\n\n      if (this.state.body instanceof SceneReactObject) {\n        this.setState({\n          body: this.build(query),\n        });\n      }\n    }\n    if (newState.data?.state === LoadingState.Error) {\n      this.setErrorState(newState.data.errors);\n    }\n  }\n\n  private setErrorState(errors: DataQueryError[] | undefined) {\n    this.setState({\n      body: new SceneReactObject({\n        reactNode: (\n          <Alert title={'Something went wrong with your request'} severity={'error'}>\n            {errors?.map((err, key) => (\n              <div key={key}>\n                {err.status && (\n                  <>\n                    <strong>Status</strong>: {err.status} <br />\n                  </>\n                )}\n                {err.message && (\n                  <>\n                    <strong>Message</strong>: {err.message} <br />\n                  </>\n                )}\n                {err.traceId && (\n                  <>\n                    <strong>TraceId</strong>: {err.traceId}\n                  </>\n                )}\n              </div>\n            ))}\n          </Alert>\n        ),\n      }),\n    });\n  }\n\n  private navigateToFields() {\n    this.setState({\n      lastFilterEvent: undefined,\n    });\n    navigateToDrilldownPage(PageSlugs.fields, sceneGraph.getAncestor(this, ServiceScene));\n  }\n\n  private build(query: LokiQuery) {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const optionValue = String(groupByVariable.state.value);\n\n    const { sortBy, direction } = getSortByPreference('fields', DEFAULT_SORT_BY, 'desc');\n\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    const getFilter = () => fieldsBreakdownScene.state.search.state.filter ?? '';\n\n    const parserForThisField = getParserForField(optionValue, this);\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'single', label: 'Single' },\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneFlexItem({\n              minHeight: 300,\n              body: PanelBuilders.timeseries().setTitle(optionValue).build(),\n            }),\n          ],\n        }),\n        new ByFrameRepeater({\n          body: new SceneCSSGridLayout({\n            templateColumns: FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n            autoRows: '200px',\n            children: [\n              new SceneFlexItem({\n                body: new SceneReactObject({\n                  reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                }),\n              }),\n            ],\n            isLazy: true,\n          }),\n          getLayoutChild: getFilterBreakdownValueScene(\n            getLabelValue,\n            query?.expr.includes('count_over_time') ? DrawStyle.Bars : DrawStyle.Line,\n            parserForThisField === 'structuredMetadata' ? VAR_METADATA : VAR_FIELDS,\n            sceneGraph.getAncestor(this, FieldsBreakdownScene).state.sort\n          ),\n          sortBy,\n          direction,\n          getFilter,\n        }),\n        new ByFrameRepeater({\n          body: new SceneCSSGridLayout({\n            templateColumns: '1fr',\n            autoRows: '200px',\n            children: [\n              new SceneFlexItem({\n                body: new SceneReactObject({\n                  reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                }),\n              }),\n            ],\n            isLazy: true,\n          }),\n          getLayoutChild: getFilterBreakdownValueScene(\n            getLabelValue,\n            query?.expr.includes('count_over_time') ? DrawStyle.Bars : DrawStyle.Line,\n            parserForThisField === 'structuredMetadata' ? VAR_METADATA : VAR_FIELDS,\n            sceneGraph.getAncestor(this, FieldsBreakdownScene).state.sort\n          ),\n          sortBy,\n          direction,\n          getFilter,\n        }),\n      ],\n    });\n  }\n}\n","import {\n  PanelBuilders,\n  QueryRunnerState,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { ALL_VARIABLE_VALUE } from '../../../services/variables';\nimport { buildDataQuery } from '../../../services/query';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { DrawStyle, LoadingPlaceholder, StackingMode } from '@grafana/ui';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS, FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport {\n  getDetectedFieldsFrame,\n  getDetectedFieldsFrameFromQueryRunnerState,\n  getDetectedFieldsNamesFromQueryRunnerState,\n  ServiceScene,\n} from '../ServiceScene';\nimport React from 'react';\nimport { SelectLabelActionScene } from './SelectLabelActionScene';\nimport { ValueSlugs } from '../../../services/routing';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { DataFrame, LoadingState } from '@grafana/data';\nimport { limitMaxNumberOfSeriesForPanel, MAX_NUMBER_OF_TIME_SERIES } from './TimeSeriesLimitSeriesTitleItem';\nimport { map, Observable } from 'rxjs';\nimport { buildFieldsQueryString, isAvgField } from '../../../services/fields';\nimport { getFieldGroupByVariable, getFieldsVariable } from '../../../services/variableGetters';\n\nexport interface FieldsAggregatedBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher;\n}\n\nexport class FieldsAggregatedBreakdownScene extends SceneObjectBase<FieldsAggregatedBreakdownSceneState> {\n  constructor(state: Partial<FieldsAggregatedBreakdownSceneState>) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onDetectedFieldsChange = (newState: QueryRunnerState, prevState: QueryRunnerState) => {\n    const newNamesField = getDetectedFieldsNamesFromQueryRunnerState(newState);\n    const prevNamesField = getDetectedFieldsNamesFromQueryRunnerState(prevState);\n\n    if (newState.data?.state === LoadingState.Done && !areArraysEqual(newNamesField?.values, prevNamesField?.values)) {\n      //@todo cardinality looks wrong in API response\n      const cardinalityMap = this.calculateCardinalityMap(newState);\n\n      // Iterate through all the layouts\n      this.state.body?.state.layouts.forEach((layoutObj) => {\n        const layout = layoutObj as SceneCSSGridLayout;\n        // populate set of new list of fields\n        const newFieldsSet = new Set<string>(newNamesField?.values);\n        const updatedChildren = layout.state.children as SceneCSSGridItem[];\n\n        // Iterate through all the existing panels\n        for (let i = 0; i < updatedChildren.length; i++) {\n          const gridItem = layout.state.children[i] as SceneCSSGridItem;\n          const panel = gridItem.state.body as VizPanel;\n\n          if (newFieldsSet.has(panel.state.title)) {\n            // If the new response has this field, delete it from the set, but leave it in the layout\n            newFieldsSet.delete(panel.state.title);\n          } else {\n            // Otherwise if the panel doesn't exist in the response, delete it from the layout\n            updatedChildren.splice(i, 1);\n            // And make sure to update the index, or we'll skip the next one\n            i--;\n          }\n        }\n\n        const fieldsToAdd = Array.from(newFieldsSet);\n        const options = fieldsToAdd.map((fieldName) => {\n          return {\n            label: fieldName,\n            value: fieldName,\n          };\n        });\n\n        updatedChildren.push(...this.buildChildren(options));\n        updatedChildren.sort(this.sortChildren(cardinalityMap));\n\n        updatedChildren.map((child) => {\n          limitMaxNumberOfSeriesForPanel(child);\n          this.subscribeToPanel(child);\n        });\n\n        layout.setState({\n          children: updatedChildren,\n        });\n      });\n    }\n  };\n\n  private sortChildren(cardinalityMap: Map<string, number>) {\n    return (a: SceneCSSGridItem, b: SceneCSSGridItem) => {\n      const aPanel = a.state.body as VizPanel;\n      const bPanel = b.state.body as VizPanel;\n      const aCardinality = cardinalityMap.get(aPanel.state.title) ?? 0;\n      const bCardinality = cardinalityMap.get(bPanel.state.title) ?? 0;\n      return bCardinality - aCardinality;\n    };\n  }\n\n  private calculateCardinalityMap(newState?: QueryRunnerState) {\n    const detectedFieldsFrame = getDetectedFieldsFrameFromQueryRunnerState(newState);\n    const cardinalityMap = new Map<string, number>();\n    if (detectedFieldsFrame?.length) {\n      for (let i = 0; i < detectedFieldsFrame?.length; i++) {\n        const name: string = detectedFieldsFrame.fields[0].values[i];\n        const cardinality: number = detectedFieldsFrame.fields[1].values[i];\n        cardinalityMap.set(name, cardinality);\n      }\n    }\n    return cardinalityMap;\n  }\n\n  onActivate() {\n    this.setState({\n      body: this.build(),\n    });\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    if (serviceScene.state.fieldsCount === undefined) {\n      this.updateFieldCount();\n    }\n\n    this._subs.add(serviceScene.state.$detectedFieldsData?.subscribeToState(this.onDetectedFieldsChange));\n  }\n  private build() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const options = groupByVariable.state.options.map((opt) => ({ label: opt.label, value: String(opt.value) }));\n\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    fieldsBreakdownScene.state.search.reset();\n\n    const children = this.buildChildren(options);\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const cardinalityMap = this.calculateCardinalityMap(serviceScene.state.$detectedFieldsData?.state);\n    children.sort(this.sortChildren(cardinalityMap));\n    const childrenClones = children.map((child) => child.clone());\n\n    // We must subscribe to the data providers for all children after the clone, or we'll see bugs in the row layout\n    [...children, ...childrenClones].map((child) => {\n      limitMaxNumberOfSeriesForPanel(child);\n      this.subscribeToPanel(child);\n    });\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneCSSGridLayout({\n          templateColumns: FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n          autoRows: '200px',\n          children: children,\n          isLazy: true,\n        }),\n        new SceneCSSGridLayout({\n          templateColumns: '1fr',\n          autoRows: '200px',\n          children: childrenClones,\n          isLazy: true,\n        }),\n      ],\n    });\n  }\n\n  private subscribeToPanel(child: SceneCSSGridItem) {\n    const panel = child.state.body as VizPanel | undefined;\n    if (panel) {\n      this._subs.add(\n        panel?.state.$data?.getResultsStream().subscribe((result) => {\n          if (result.data.errors && result.data.errors.length > 0) {\n            child.setState({ isHidden: true });\n            this.updateFieldCount();\n          }\n        })\n      );\n    }\n  }\n\n  private buildChildren(options: Array<{ label: string; value: string }>): SceneCSSGridItem[] {\n    const children: SceneCSSGridItem[] = [];\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    const fieldsVariable = getFieldsVariable(this);\n\n    for (const option of options) {\n      const { value: optionValue } = option;\n      if (optionValue === ALL_VARIABLE_VALUE || !optionValue) {\n        continue;\n      }\n\n      const queryString = buildFieldsQueryString(optionValue, fieldsVariable, detectedFieldsFrame);\n      const query = buildDataQuery(queryString, {\n        legendFormat: isAvgField(optionValue) ? optionValue : `{{${optionValue}}}`,\n        refId: optionValue,\n      });\n\n      const queryRunner = getQueryRunner([query]);\n\n      const dataTransformer = new SceneDataTransformer({\n        $data: queryRunner,\n        transformations: [() => limitFramesTransformation(MAX_NUMBER_OF_TIME_SERIES)],\n      });\n      let body = PanelBuilders.timeseries().setTitle(optionValue).setData(dataTransformer);\n\n      if (!isAvgField(optionValue)) {\n        body = body\n          .setHeaderActions(new SelectLabelActionScene({ labelName: String(optionValue), fieldType: ValueSlugs.field }))\n          .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n          .setCustomFieldConfig('fillOpacity', 100)\n          .setCustomFieldConfig('lineWidth', 0)\n          .setCustomFieldConfig('pointSize', 0)\n          .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n          .setOverrides(setLevelColorOverrides);\n      } else {\n        body = body.setHeaderActions(\n          new SelectLabelActionScene({\n            labelName: String(optionValue),\n            hideValueDrilldown: true,\n            fieldType: ValueSlugs.field,\n          })\n        );\n      }\n\n      const viz = body.build();\n      const gridItem = new SceneCSSGridItem({\n        body: viz,\n      });\n\n      children.push(gridItem);\n    }\n    return children;\n  }\n\n  private updateFieldCount() {\n    const activeLayout = (this.state.body?.state.layouts.find((l) => l.isActive) ??\n      this.state.body?.state.layouts[0]) as SceneCSSGridLayout | undefined;\n    const activeLayoutChildren = activeLayout?.state.children as SceneCSSGridItem[] | undefined;\n    const activePanels = activeLayoutChildren?.filter((child) => !child.state.isHidden);\n\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    fieldsBreakdownScene.state.changeFieldCount?.(activePanels?.length ?? 0);\n  }\n\n  public static Selector({ model }: SceneComponentProps<FieldsAggregatedBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && <body.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<FieldsAggregatedBreakdownScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <>{body && <body.Component model={body} />}</>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n\nexport function limitFramesTransformation(limit: number) {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map((frames) => {\n        return frames.slice(0, limit);\n      })\n    );\n  };\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { DataFrame, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  QueryRunnerState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n  SceneVariable,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  VariableValueOption,\n} from '@grafana/scenes';\nimport { Alert, Button, useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getSortByPreference } from 'services/store';\nimport { ALL_VARIABLE_VALUE, SERVICE_NAME, SERVICE_UI_LABEL, VAR_FIELD_GROUP_BY, VAR_LABELS } from 'services/variables';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { CustomConstantVariable, CustomConstantVariableState } from '../../../services/CustomConstantVariable';\nimport { navigateToValueBreakdown } from '../../../services/navigate';\nimport { checkPrimaryLabel, getPrimaryLabelFromUrl, ValueSlugs } from '../../../services/routing';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { GrotError } from '../../GrotError';\nimport { IndexScene } from '../../IndexScene/IndexScene';\nimport { getDetectedFieldsFrame, ServiceScene } from '../ServiceScene';\nimport { BreakdownSearchReset, BreakdownSearchScene } from './BreakdownSearchScene';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { FieldsAggregatedBreakdownScene } from './FieldsAggregatedBreakdownScene';\nimport { FieldSelector } from './FieldSelector';\nimport { FieldValuesBreakdownScene } from './FieldValuesBreakdownScene';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { SortByScene, SortCriteriaChanged } from './SortByScene';\nimport { StatusWrapper } from './StatusWrapper';\nimport { getFieldOptions } from 'services/filters';\nimport { EmptyLayoutScene } from './EmptyLayoutScene';\nimport { getFieldGroupByVariable, getLabelsVariable } from '../../../services/variableGetters';\n\nexport const averageFields = ['duration', 'count', 'total', 'bytes'];\nexport const FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\n\nexport interface FieldsBreakdownSceneState extends SceneObjectState {\n  body?:\n    | (SceneReactObject & SceneObject)\n    | (FieldsAggregatedBreakdownScene & SceneObject)\n    | (FieldValuesBreakdownScene & SceneObject)\n    | (EmptyLayoutScene & SceneObject);\n  search: BreakdownSearchScene;\n  sort: SortByScene;\n  value?: string;\n  loading?: boolean;\n  error?: string;\n  blockingMessage?: string;\n  changeFieldCount?: (n: number) => void;\n}\n\nexport class FieldsBreakdownScene extends SceneObjectBase<FieldsBreakdownSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LABELS],\n  });\n\n  constructor(state: Partial<FieldsBreakdownSceneState> & { options?: VariableValueOption[]; value?: string }) {\n    super({\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [\n            new CustomConstantVariable({\n              name: VAR_FIELD_GROUP_BY,\n              defaultToAll: false,\n              includeAll: true,\n              value: state.value ?? ALL_VARIABLE_VALUE,\n              options: state.options ?? [],\n            }),\n          ],\n        }),\n      loading: true,\n      sort: new SortByScene({ target: 'fields' }),\n      search: new BreakdownSearchScene('fields'),\n      value: state.value ?? ALL_VARIABLE_VALUE,\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n\n    this.setState({\n      loading: serviceScene.state.$detectedLabelsData?.state.data?.state !== LoadingState.Done,\n    });\n\n    // Subscriptions\n    this._subs.add(\n      this.subscribeToEvent(BreakdownSearchReset, () => {\n        this.state.search.clearValueFilter();\n      })\n    );\n    this._subs.add(this.subscribeToEvent(SortCriteriaChanged, this.handleSortByChange));\n    this._subs.add(groupByVariable.subscribeToState(this.variableChanged));\n\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState((newState, prevState) => {\n        const variable = getFieldGroupByVariable(this);\n        let { labelName } = getPrimaryLabelFromUrl();\n\n        const newService = newState.filters.find((filter) => filter.key === labelName);\n        const prevService = prevState.filters.find((filter) => filter.key === labelName);\n\n        // If the user changes the primary label\n        if (variable.state.value === ALL_VARIABLE_VALUE && newService !== prevService) {\n          this.setState({\n            loading: true,\n            body: undefined,\n          });\n        }\n      })\n    );\n\n    this._subs.add(\n      serviceScene.state.$detectedFieldsData?.subscribeToState(\n        (newState: QueryRunnerState, oldState: QueryRunnerState) => {\n          if (newState.data?.state === LoadingState.Done) {\n            if (newState.data.series?.[0]) {\n              this.updateOptions(newState.data.series?.[0]);\n            }\n          }\n        }\n      )\n    );\n\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    // Need to update labels with current state\n    if (detectedFieldsFrame) {\n      this.updateOptions(detectedFieldsFrame);\n    }\n\n    checkPrimaryLabel(this);\n  }\n\n  private variableChanged = (newState: CustomConstantVariableState, oldState: CustomConstantVariableState) => {\n    if (\n      newState.value !== oldState.value ||\n      !areArraysEqual(newState.options, oldState.options) ||\n      this.state.body === undefined ||\n      this.state.body instanceof EmptyLayoutScene ||\n      this.state.body instanceof SceneReactObject\n    ) {\n      this.updateBody(newState);\n    }\n  };\n\n  private updateOptions(dataFrame: DataFrame) {\n    if (!dataFrame || !dataFrame.length) {\n      const indexScene = sceneGraph.getAncestor(this, IndexScene);\n      const variablesToClear = this.getVariablesThatCanBeCleared(indexScene);\n\n      let body;\n      if (variablesToClear.length > 1) {\n        this.state.changeFieldCount?.(0);\n        body = this.buildClearFiltersLayout(() => this.clearVariables(variablesToClear));\n      } else {\n        body = new EmptyLayoutScene({ type: 'fields' });\n      }\n      this.setState({\n        loading: false,\n        body,\n      });\n      return;\n    }\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const variable = getFieldGroupByVariable(this);\n    variable.setState({\n      options: getFieldOptions(dataFrame.fields[0].values.map((v) => String(v))),\n      loading: false,\n      value: serviceScene.state.drillDownLabel ?? ALL_VARIABLE_VALUE,\n    });\n    this.setState({\n      loading: false,\n    });\n  }\n\n  private handleSortByChange = (event: SortCriteriaChanged) => {\n    if (event.target !== 'fields') {\n      return;\n    }\n    if (this.state.body instanceof FieldValuesBreakdownScene && this.state.body.state.body instanceof LayoutSwitcher) {\n      this.state.body.state.body?.state.layouts.forEach((layout) => {\n        if (layout instanceof ByFrameRepeater) {\n          layout.sort(event.sortBy, event.direction);\n        }\n      });\n    }\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.value_breakdown_sort_change,\n      {\n        target: 'fields',\n        criteria: event.sortBy,\n        direction: event.direction,\n      }\n    );\n  };\n\n  private updateBody(newState: CustomConstantVariableState) {\n    const fieldsVariable = getFieldGroupByVariable(this);\n\n    // We get the labels from the service scene, if we don't have them yet, assume we're loading\n    if (!fieldsVariable.state.options || !fieldsVariable.state.options.length) {\n      return;\n    }\n\n    const stateUpdate: Partial<FieldsBreakdownSceneState> = {};\n\n    if (fieldsVariable.state.options && fieldsVariable.state.options.length <= 1) {\n      // If there's 1 or fewer fields build the empty or clear layout UI\n      const indexScene = sceneGraph.getAncestor(this, IndexScene);\n      const variablesToClear = this.getVariablesThatCanBeCleared(indexScene);\n\n      if (variablesToClear.length > 1) {\n        this.state.changeFieldCount?.(0);\n        stateUpdate.body = this.buildClearFiltersLayout(() => this.clearVariables(variablesToClear));\n      } else {\n        stateUpdate.body = new EmptyLayoutScene({ type: 'fields' });\n      }\n    } else {\n      // Otherwise update the body, but don't re-instantiate if it's already the right class\n      if (newState.value === ALL_VARIABLE_VALUE && this.state.body instanceof FieldValuesBreakdownScene) {\n        stateUpdate.body = new FieldsAggregatedBreakdownScene({});\n      } else if (newState.value !== ALL_VARIABLE_VALUE && this.state.body instanceof FieldsAggregatedBreakdownScene) {\n        stateUpdate.body = new FieldValuesBreakdownScene({});\n      } else if (\n        // If the body hasn't been created, or the no-data views are active, we want to replace and render the correct scene\n        this.state.body === undefined ||\n        this.state.body instanceof EmptyLayoutScene ||\n        this.state.body instanceof SceneReactObject\n      ) {\n        stateUpdate.body =\n          newState.value === ALL_VARIABLE_VALUE\n            ? new FieldsAggregatedBreakdownScene({})\n            : new FieldValuesBreakdownScene({});\n      }\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  private getVariablesThatCanBeCleared(indexScene: IndexScene) {\n    const variables = sceneGraph.getVariables(indexScene);\n    let variablesToClear: SceneVariable[] = [];\n\n    for (const variable of variables.state.variables) {\n      if (variable instanceof AdHocFiltersVariable && variable.state.filters.length) {\n        variablesToClear.push(variable);\n      }\n      if (variable instanceof CustomConstantVariable && variable.state.value && variable.state.name !== 'logsFormat') {\n        variablesToClear.push(variable);\n      }\n    }\n    return variablesToClear;\n  }\n\n  private clearVariables = (variablesToClear: SceneVariable[]) => {\n    // clear patterns: needs to happen first, or it won't work as patterns is split into a variable and a state, and updating the variable triggers a state update\n    const indexScene = sceneGraph.getAncestor(this, IndexScene);\n    indexScene.setState({\n      patterns: [],\n    });\n\n    variablesToClear.forEach((variable) => {\n      if (variable instanceof AdHocFiltersVariable && variable.state.key === 'adhoc_service_filter') {\n        let { labelName } = getPrimaryLabelFromUrl();\n        // getPrimaryLabelFromUrl returns the label name that exists in the URL, which is \"service\" not \"service_name\"\n        if (labelName === SERVICE_UI_LABEL) {\n          labelName = SERVICE_NAME;\n        }\n        variable.setState({\n          filters: variable.state.filters.filter((filter) => filter.key === labelName),\n        });\n      } else if (variable instanceof AdHocFiltersVariable) {\n        variable.setState({\n          filters: [],\n        });\n      } else if (variable instanceof CustomConstantVariable) {\n        variable.setState({\n          value: '',\n          text: '',\n        });\n      }\n    });\n  };\n\n  private buildClearFiltersLayout(clearCallback: () => void) {\n    return new SceneReactObject({\n      reactNode: (\n        <GrotError>\n          <Alert title=\"\" severity=\"info\">\n            No labels match these filters.{' '}\n            <Button className={emptyStateStyles.button} onClick={() => clearCallback()}>\n              Clear filters\n            </Button>{' '}\n          </Alert>\n        </GrotError>\n      ),\n    });\n  }\n\n  public onFieldSelectorChange = (value?: string) => {\n    if (!value) {\n      return;\n    }\n\n    const variable = getFieldGroupByVariable(this);\n    const { sortBy, direction } = getSortByPreference('fields', DEFAULT_SORT_BY, 'desc');\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.select_field_in_breakdown_clicked,\n      {\n        field: value,\n        previousField: variable.getValueText(),\n        view: 'fields',\n        sortBy,\n        sortByDirection: direction,\n      }\n    );\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    navigateToValueBreakdown(ValueSlugs.field, value, serviceScene);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<FieldsBreakdownScene>) => {\n    const { body, loading, blockingMessage, search, sort } = model.useState();\n    const variable = getFieldGroupByVariable(model);\n    const { options, value } = variable.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          <div className={styles.controls}>\n            {body instanceof FieldsAggregatedBreakdownScene && <FieldsAggregatedBreakdownScene.Selector model={body} />}\n            {body instanceof FieldValuesBreakdownScene && <FieldValuesBreakdownScene.Selector model={body} />}\n            {!loading && value !== ALL_VARIABLE_VALUE && (\n              <>\n                <sort.Component model={sort} />\n                <search.Component model={search} />\n              </>\n            )}\n            {!loading && options.length > 1 && (\n              <FieldSelector\n                label=\"Field\"\n                options={options}\n                value={String(value)}\n                onChange={model.onFieldSelectorChange}\n              />\n            )}\n          </div>\n\n          <div className={styles.content}>{body && <body.Component model={body} />}</div>\n        </StatusWrapper>\n      </div>\n    );\n  };\n}\n\nexport const emptyStateStyles = {\n  link: css({\n    textDecoration: 'underline',\n  }),\n  button: css({\n    marginLeft: '1.5rem',\n  }),\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      justifyContent: 'space-between',\n      flexDirection: 'row-reverse',\n      gap: theme.spacing(2),\n    }),\n  };\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VariableValueOption,\n  VizPanel,\n} from '@grafana/scenes';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { DrawStyle, LoadingPlaceholder, StackingMode } from '@grafana/ui';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { ALL_VARIABLE_VALUE, LEVEL_VARIABLE_VALUE } from '../../../services/variables';\nimport React from 'react';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { SelectLabelActionScene } from './SelectLabelActionScene';\nimport { ValueSlugs } from '../../../services/routing';\nimport { limitMaxNumberOfSeriesForPanel, MAX_NUMBER_OF_TIME_SERIES } from './TimeSeriesLimitSeriesTitleItem';\nimport { limitFramesTransformation } from './FieldsAggregatedBreakdownScene';\nimport { buildLabelsQuery, LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS } from '../../../services/labels';\nimport { getFieldsVariable, getLabelGroupByVariable } from '../../../services/variableGetters';\nimport { LokiQuery } from '../../../services/lokiQuery';\nimport { ServiceScene } from '../ServiceScene';\nimport { DataFrame, LoadingState } from '@grafana/data';\n\nexport interface LabelsAggregatedBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher;\n}\n\nexport class LabelsAggregatedBreakdownScene extends SceneObjectBase<LabelsAggregatedBreakdownSceneState> {\n  constructor(state: Partial<LabelsAggregatedBreakdownSceneState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const fields = getFieldsVariable(this);\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const $detectedLabels = serviceScene.state.$detectedLabelsData;\n\n    // If the body hasn't been built yet, build it\n    if (!this.state.body) {\n      this.setState({\n        body: this.build(),\n      });\n    }\n    // Otherwise if we have the detected labels done loading, update the body\n    else if ($detectedLabels?.state.data?.state === LoadingState.Done) {\n      this.update($detectedLabels?.state.data.series[0]);\n    }\n\n    this._subs.add(\n      $detectedLabels?.subscribeToState((newState, prevState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          this.update(newState.data.series[0]);\n        }\n      })\n    );\n\n    this._subs.add(\n      fields.subscribeToState(() => {\n        this.updateQueriesOnFieldsVariableChange();\n      })\n    );\n  }\n\n  private updateQueriesOnFieldsVariableChange = () => {\n    this.state.body?.state.layouts.forEach((layoutObj) => {\n      const layout = layoutObj as SceneCSSGridLayout;\n      // Iterate through the existing panels\n      for (let i = 0; i < layout.state.children.length; i++) {\n        const { panel, title } = this.getPanelByIndex(layout, i);\n        const queryRunner: SceneDataProvider | SceneQueryRunner | undefined = panel.state.$data;\n        const query = buildLabelsQuery(this, title, title);\n\n        // Don't update if query didn't change\n        if (queryRunner instanceof SceneQueryRunner) {\n          if (query.expr === queryRunner?.state.queries?.[0]?.expr) {\n            break;\n          }\n        }\n\n        panel.setState({\n          $data: this.getDataTransformer(query),\n        });\n      }\n    });\n  };\n\n  private getPanelByIndex(layout: SceneCSSGridLayout, i: number) {\n    const gridItem = layout.state.children[i] as SceneCSSGridItem;\n    const panel = gridItem.state.body as VizPanel;\n\n    const title = panel.state.title;\n    return { panel, title };\n  }\n\n  private update(detectedLabelsFrame: DataFrame) {\n    const variable = getLabelGroupByVariable(this);\n    const newLabels = variable.state.options.filter((opt) => opt.value !== ALL_VARIABLE_VALUE).map((opt) => opt.label);\n\n    this.state.body?.state.layouts.forEach((layoutObj) => {\n      let existingLabels = [];\n      const layout = layoutObj as SceneCSSGridLayout;\n      const newLabelsSet = new Set<string>(newLabels);\n      const updatedChildren = layout.state.children as SceneCSSGridItem[];\n\n      for (let i = 0; i < updatedChildren.length; i++) {\n        const { title } = this.getPanelByIndex(layout, i);\n\n        if (newLabelsSet.has(title)) {\n          // If the new response has this field, delete it from the set, but leave it in the layout\n          newLabelsSet.delete(title);\n        } else {\n          // Otherwise if the panel doesn't exist in the response, delete it from the layout\n          updatedChildren.splice(i, 1);\n          // And make sure to update the index, or we'll skip the next one\n          i--;\n        }\n        existingLabels.push(title);\n      }\n\n      const labelsToAdd = Array.from(newLabelsSet);\n\n      const options = labelsToAdd.map((fieldName) => {\n        return {\n          label: fieldName,\n          value: fieldName,\n        };\n      });\n\n      updatedChildren.push(...this.buildChildren(options));\n\n      const cardinalityMap = this.calculateCardinalityMap(detectedLabelsFrame);\n      updatedChildren.sort(this.sortChildren(cardinalityMap));\n      updatedChildren.map((child) => {\n        limitMaxNumberOfSeriesForPanel(child);\n      });\n\n      layout.setState({\n        children: updatedChildren,\n      });\n    });\n  }\n\n  private calculateCardinalityMap(detectedLabels?: DataFrame) {\n    const cardinalityMap = new Map<string, number>();\n    if (detectedLabels?.length) {\n      for (let i = 0; i < detectedLabels?.fields.length; i++) {\n        const name: string = detectedLabels.fields[i].name;\n        const cardinality: number = detectedLabels.fields[i].values[0];\n        cardinalityMap.set(name, cardinality);\n      }\n    }\n    return cardinalityMap;\n  }\n\n  private build(): LayoutSwitcher {\n    const variable = getLabelGroupByVariable(this);\n    const labelBreakdownScene = sceneGraph.getAncestor(this, LabelBreakdownScene);\n    labelBreakdownScene.state.search.reset();\n\n    const children = this.buildChildren(variable.state.options);\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const $detectedLabels = serviceScene.state.$detectedLabelsData;\n    if ($detectedLabels?.state.data?.state === LoadingState.Done) {\n      const cardinalityMap = this.calculateCardinalityMap($detectedLabels?.state.data.series[0]);\n      children.sort(this.sortChildren(cardinalityMap));\n    }\n\n    const childrenClones = children.map((child) => child.clone());\n\n    // We must subscribe to the data providers for all children after the clone or we'll see bugs in the row layout\n    [...children, ...childrenClones].map((child) => {\n      limitMaxNumberOfSeriesForPanel(child);\n    });\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneCSSGridLayout({\n          isLazy: true,\n          templateColumns: LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n          autoRows: '200px',\n          children: children,\n        }),\n        new SceneCSSGridLayout({\n          isLazy: true,\n          templateColumns: '1fr',\n          autoRows: '200px',\n          children: childrenClones,\n        }),\n      ],\n    });\n  }\n\n  private buildChildren(options: VariableValueOption[]) {\n    const children: SceneCSSGridItem[] = [];\n    for (const option of options) {\n      const { value } = option;\n      const optionValue = String(value);\n      if (value === ALL_VARIABLE_VALUE || !value) {\n        continue;\n      }\n      const query = buildLabelsQuery(this, String(option.value), String(option.value));\n      const dataTransformer = this.getDataTransformer(query);\n\n      children.push(\n        new SceneCSSGridItem({\n          body: PanelBuilders.timeseries()\n            .setTitle(optionValue)\n            .setData(dataTransformer)\n            .setHeaderActions(new SelectLabelActionScene({ labelName: optionValue, fieldType: ValueSlugs.label }))\n            .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n            .setCustomFieldConfig('fillOpacity', 100)\n            .setCustomFieldConfig('lineWidth', 0)\n            .setCustomFieldConfig('pointSize', 0)\n            .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n            .setOverrides(setLevelColorOverrides)\n            .build(),\n        })\n      );\n    }\n    return children;\n  }\n\n  private sortChildren(cardinalityMap: Map<string, number>) {\n    return (a: SceneCSSGridItem, b: SceneCSSGridItem) => {\n      const aPanel = a.state.body as VizPanel;\n      const bPanel = b.state.body as VizPanel;\n      if (aPanel.state.title === LEVEL_VARIABLE_VALUE) {\n        return -1;\n      }\n      if (bPanel.state.title === LEVEL_VARIABLE_VALUE) {\n        return 1;\n      }\n      const aCardinality = cardinalityMap.get(aPanel.state.title) ?? 0;\n      const bCardinality = cardinalityMap.get(bPanel.state.title) ?? 0;\n      return bCardinality - aCardinality;\n    };\n  }\n\n  private getDataTransformer(query: LokiQuery) {\n    const queryRunner = getQueryRunner([query]);\n    return new SceneDataTransformer({\n      $data: queryRunner,\n      transformations: [() => limitFramesTransformation(MAX_NUMBER_OF_TIME_SERIES)],\n    });\n  }\n\n  public static Selector({ model }: SceneComponentProps<LabelsAggregatedBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && <body.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LabelsAggregatedBreakdownScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <>{body && <body.Component model={body} />}</>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { AdHocVariableFilter, DataFrame, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  QueryRunnerState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneVariableSet,\n  SceneVariableState,\n  VariableDependencyConfig,\n  VariableValueOption,\n} from '@grafana/scenes';\nimport { Alert, useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { checkPrimaryLabel, getPrimaryLabelFromUrl, ValueSlugs } from 'services/routing';\nimport { ALL_VARIABLE_VALUE, SERVICE_NAME, SERVICE_UI_LABEL, VAR_LABEL_GROUP_BY, VAR_LABELS } from 'services/variables';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { FieldSelector } from './FieldSelector';\nimport { StatusWrapper } from './StatusWrapper';\nimport { getLabelOptions } from 'services/filters';\nimport { BreakdownSearchReset, BreakdownSearchScene } from './BreakdownSearchScene';\nimport { getSortByPreference } from 'services/store';\nimport { SortByScene, SortCriteriaChanged } from './SortByScene';\nimport { getDetectedLabelsFrame, ServiceScene } from '../ServiceScene';\nimport { CustomConstantVariable, CustomConstantVariableState } from '../../../services/CustomConstantVariable';\nimport { navigateToValueBreakdown } from '../../../services/navigate';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { LabelValuesBreakdownScene } from './LabelValuesBreakdownScene';\nimport { LabelsAggregatedBreakdownScene } from './LabelsAggregatedBreakdownScene';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { EmptyLayoutScene } from './EmptyLayoutScene';\nimport { getLabelGroupByVariable, getLabelsVariable } from '../../../services/variableGetters';\n\nexport interface LabelBreakdownSceneState extends SceneObjectState {\n  body?: SceneObject;\n  search: BreakdownSearchScene;\n  sort: SortByScene;\n  loading?: boolean;\n  error?: boolean;\n  blockingMessage?: string;\n  // We have to store the value in state because scenes doesn't allow variables that don't have options. We need to hold on to this until the API call getting values is done, and then reset the state\n  value?: string;\n}\n\nexport class LabelBreakdownScene extends SceneObjectBase<LabelBreakdownSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LABELS],\n  });\n\n  // Labels/options can be passed in when instantiated, but should ONLY exist on the state of the variable\n  constructor(state: Partial<LabelBreakdownSceneState> & { options?: VariableValueOption[]; value?: string }) {\n    super({\n      ...state,\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [\n            new CustomConstantVariable({\n              name: VAR_LABEL_GROUP_BY,\n              defaultToAll: false,\n              includeAll: true,\n\n              value: state.value ?? ALL_VARIABLE_VALUE,\n              options: state.options ?? [],\n            }),\n          ],\n        }),\n      loading: true,\n      sort: new SortByScene({ target: 'labels' }),\n      search: new BreakdownSearchScene('labels'),\n      value: state.value,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const groupByVariable = getLabelGroupByVariable(this);\n\n    this.setState({\n      loading: serviceScene.state.$detectedLabelsData?.state.data?.state !== LoadingState.Done,\n      error: serviceScene.state.$detectedLabelsData?.state.data?.state === LoadingState.Error,\n    });\n\n    this._subs.add(\n      this.subscribeToEvent(BreakdownSearchReset, () => {\n        this.state.search.clearValueFilter();\n      })\n    );\n    this._subs.add(this.subscribeToEvent(SortCriteriaChanged, this.handleSortByChange));\n\n    this._subs.add(serviceScene.state.$detectedLabelsData?.subscribeToState(this.onDetectedLabelsDataChange));\n\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState((newState, prevState) => {\n        this.onLabelsVariableChange(newState, prevState);\n      })\n    );\n\n    this._subs.add(\n      groupByVariable.subscribeToState((newState, prevState) => {\n        this.onGroupByVariableChange(newState, prevState);\n      })\n    );\n\n    const detectedLabelsFrame = getDetectedLabelsFrame(this);\n    // Need to update labels with current state\n    if (detectedLabelsFrame) {\n      this.updateOptions(detectedLabelsFrame);\n    }\n\n    checkPrimaryLabel(this);\n  }\n\n  private onGroupByVariableChange(newState: CustomConstantVariableState, prevState: CustomConstantVariableState) {\n    // If the aggregation value changed, or the body is not yet defined\n    if (\n      newState.value !== prevState.value ||\n      !areArraysEqual(newState.options, prevState.options) ||\n      this.state.body === undefined ||\n      this.state.body instanceof EmptyLayoutScene\n    ) {\n      this.updateBody();\n    }\n  }\n\n  private onLabelsVariableChange(\n    newState: SceneVariableState & { filters: AdHocVariableFilter[] },\n    prevState: SceneVariableState & { filters: AdHocVariableFilter[] }\n  ) {\n    let { labelName } = getPrimaryLabelFromUrl();\n    if (labelName === SERVICE_UI_LABEL) {\n      labelName = SERVICE_NAME;\n    }\n    const variable = getLabelGroupByVariable(this);\n    const newPrimaryLabel = newState.filters.find((filter) => filter.key === labelName);\n    const prevPrimaryLabel = prevState.filters.find((filter) => filter.key === labelName);\n\n    // If the user changes the service\n    if (variable.state.value === ALL_VARIABLE_VALUE && newPrimaryLabel !== prevPrimaryLabel) {\n      this.setState({\n        loading: true,\n        body: undefined,\n        error: undefined,\n      });\n    }\n  }\n\n  /**\n   * Pull the detected_labels from our service scene, update the variable when they change\n   * @param newState\n   * @param prevState\n   */\n  private onDetectedLabelsDataChange = (newState: QueryRunnerState, prevState: QueryRunnerState) => {\n    if (\n      newState.data?.state === LoadingState.Done &&\n      newState.data.series?.[0] &&\n      !areArraysEqual(newState.data.series?.[0]?.fields, prevState.data?.series?.[0]?.fields)\n    ) {\n      this.updateOptions(newState.data.series?.[0]);\n    } else if (newState.data?.state === LoadingState.Done) {\n      // we got a new response, but nothing changed, just need to clear loading\n      const variable = getLabelGroupByVariable(this);\n      variable.setState({\n        loading: false,\n      });\n    }\n  };\n\n  private handleSortByChange = (event: SortCriteriaChanged) => {\n    if (event.target !== 'labels') {\n      return;\n    }\n    if (this.state.body instanceof LabelValuesBreakdownScene) {\n      this.state.body?.state.body?.state.layouts.forEach((layout) => {\n        if (layout instanceof ByFrameRepeater) {\n          layout.sort(event.sortBy, event.direction);\n        }\n      });\n    }\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.value_breakdown_sort_change,\n      {\n        target: 'labels',\n        criteria: event.sortBy,\n        direction: event.direction,\n      }\n    );\n  };\n\n  private updateOptions(detectedLabels: DataFrame | undefined) {\n    if (!detectedLabels || !detectedLabels.length) {\n      this.setState({\n        loading: false,\n        body: new EmptyLayoutScene({ type: 'labels' }),\n      });\n      return;\n    }\n    const variable = getLabelGroupByVariable(this);\n    const options = getLabelOptions(detectedLabels.fields.map((label) => label.name));\n\n    variable.setState({\n      loading: false,\n      options,\n      value: this.state.value ?? ALL_VARIABLE_VALUE,\n    });\n  }\n\n  private updateBody() {\n    const variable = getLabelGroupByVariable(this);\n    // We get the labels from the service scene, if we don't have them yet, assume we're loading\n    if (!variable.state.options || !variable.state.options.length) {\n      return;\n    }\n\n    const stateUpdate: Partial<LabelBreakdownSceneState> = {\n      loading: false,\n      blockingMessage: undefined,\n      error: false,\n    };\n\n    if (variable.hasAllValue() && this.state.body instanceof LabelValuesBreakdownScene) {\n      stateUpdate.body = new LabelsAggregatedBreakdownScene({});\n    } else if (!variable.hasAllValue() && this.state.body instanceof LabelsAggregatedBreakdownScene) {\n      stateUpdate.body = new LabelValuesBreakdownScene({});\n    } else if (this.state.body === undefined) {\n      if (variable.state.options.length > 0) {\n        stateUpdate.body = variable.hasAllValue()\n          ? new LabelsAggregatedBreakdownScene({})\n          : new LabelValuesBreakdownScene({});\n      } else {\n        stateUpdate.body = new EmptyLayoutScene({ type: 'labels' });\n      }\n    } else if (this.state.body instanceof EmptyLayoutScene) {\n      if (variable.state.options.length > 0) {\n        stateUpdate.body = variable.hasAllValue()\n          ? new LabelsAggregatedBreakdownScene({})\n          : new LabelValuesBreakdownScene({});\n      }\n    }\n\n    this.setState({ ...stateUpdate });\n  }\n\n  public onChange = (value?: string) => {\n    if (!value) {\n      return;\n    }\n\n    const variable = getLabelGroupByVariable(this);\n    variable.changeValueTo(value);\n\n    const { sortBy, direction } = getSortByPreference('labels', DEFAULT_SORT_BY, 'desc');\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.select_field_in_breakdown_clicked,\n      {\n        label: value,\n        previousLabel: variable.getValueText(),\n        view: 'labels',\n        sortBy,\n        sortByDirection: direction,\n      }\n    );\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    navigateToValueBreakdown(ValueSlugs.label, value, serviceScene);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LabelBreakdownScene>) => {\n    const { body, loading, blockingMessage, error, search, sort } = model.useState();\n    const variable = getLabelGroupByVariable(model);\n    const { options, value } = variable.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          <div className={styles.controls}>\n            {body instanceof LabelValuesBreakdownScene && <LabelValuesBreakdownScene.Selector model={body} />}\n            {body instanceof LabelsAggregatedBreakdownScene && <LabelsAggregatedBreakdownScene.Selector model={body} />}\n            {!loading && value !== ALL_VARIABLE_VALUE && (\n              <>\n                <sort.Component model={sort} />\n                <search.Component model={search} />\n              </>\n            )}\n            {!loading && options.length > 0 && (\n              <FieldSelector label=\"Label\" options={options} value={String(value)} onChange={model.onChange} />\n            )}\n          </div>\n          {error && (\n            <Alert title=\"\" severity=\"warning\">\n              The labels are not available at this moment. Try using a different time range or check again later.\n            </Alert>\n          )}\n\n          <div className={styles.content}>{body && <body.Component model={body} />}</div>\n        </StatusWrapper>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      justifyContent: 'space-between',\n      flexDirection: 'row-reverse',\n      gap: theme.spacing(2),\n    }),\n  };\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n} from '@grafana/scenes';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { getLabelValue } from './SortByScene';\nimport { Alert, DrawStyle, LoadingPlaceholder, StackingMode } from '@grafana/ui';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { getSortByPreference } from '../../../services/store';\nimport { AppEvents, DataQueryError, LoadingState } from '@grafana/data';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { getFilterBreakdownValueScene } from '../../../services/fields';\nimport { ALL_VARIABLE_VALUE, VAR_LABEL_GROUP_BY_EXPR, VAR_LABELS } from '../../../services/variables';\nimport React from 'react';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { navigateToDrilldownPage } from '../../../services/navigate';\nimport { PageSlugs } from '../../../services/routing';\nimport { ServiceScene } from '../ServiceScene';\nimport { AddFilterEvent } from './AddToFiltersButton';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { buildLabelsQuery, LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS } from '../../../services/labels';\nimport { getAppEvents } from '@grafana/runtime';\nimport { getLabelGroupByVariable } from '../../../services/variableGetters';\n\ntype DisplayError = DataQueryError & { displayed: boolean };\ntype DisplayErrors = Record<string, DisplayError>;\n\nexport interface LabelValueBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher & SceneObject;\n  $data?: SceneDataProvider;\n  lastFilterEvent?: AddFilterEvent;\n  errors: DisplayErrors;\n}\n\nexport class LabelValuesBreakdownScene extends SceneObjectBase<LabelValueBreakdownSceneState> {\n  constructor(state: Partial<LabelValueBreakdownSceneState>) {\n    super({\n      ...state,\n      errors: {},\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({\n      $data: getQueryRunner([\n        buildLabelsQuery(this, VAR_LABEL_GROUP_BY_EXPR, String(getLabelGroupByVariable(this).state.value)),\n      ]),\n      body: this.build(),\n    });\n    const groupByVariable = getLabelGroupByVariable(this);\n    this._subs.add(\n      groupByVariable.subscribeToState((newState) => {\n        if (newState.value === ALL_VARIABLE_VALUE) {\n          this.setState({\n            $data: undefined,\n            body: undefined,\n          });\n        }\n      })\n    );\n\n    this.subscribeToEvent(AddFilterEvent, (event) => {\n      this.setState({\n        lastFilterEvent: event,\n      });\n    });\n\n    this._subs.add(\n      this.state.$data?.subscribeToState((newState, prevState) => {\n        this.onValuesDataQueryChange(newState, prevState);\n      })\n    );\n  }\n\n  private onValuesDataQueryChange(newState: SceneDataState, prevState: SceneDataState) {\n    if (newState?.data?.errors && newState.data?.state !== LoadingState.Done) {\n      const errors: DisplayErrors = this.state.errors;\n      newState?.data?.errors.forEach((err) => {\n        const errorIndex = `${err.status}_${err.traceId}_${err.message}`;\n        if (errors[errorIndex] === undefined) {\n          errors[errorIndex] = { ...err, displayed: false };\n        }\n      });\n      this.setState({\n        errors,\n      });\n\n      this.showErrorToast(this.state.errors);\n    }\n\n    if (newState.data?.state === LoadingState.Done || newState.data?.state === LoadingState.Streaming) {\n      // No panels for the user to select, presumably because everything has been excluded\n      const event = this.state.lastFilterEvent;\n\n      // @todo discuss: Do we want to let users exclude all labels? Or should we redirect when excluding the penultimate panel?\n      if (event) {\n        if (event.operator === 'exclude' && newState.data.series.length < 1) {\n          this.navigateToLabels();\n        }\n\n        // @todo discuss: wouldn't include always return in 1 result? Do we need to wait for the query to run or should we navigate on receiving the include event and cancel the ongoing query?\n        if (event.operator === 'include' && newState.data.series.length <= 1) {\n          this.navigateToLabels();\n        }\n      }\n    }\n\n    // If we're in an error state\n    if (newState.data?.state === LoadingState.Error && this.activeLayoutContainsNoPanels()) {\n      const activeLayout = this.getActiveLayout();\n      // And the active layout is grid or rows, and doesn't have any panels\n      if (activeLayout instanceof ByFrameRepeater) {\n        const errorState = this.getErrorStateAlert(newState.data.errors);\n        // Replace the loading or error state with new error\n        activeLayout.state.body.setState({\n          children: [errorState],\n        });\n      }\n    }\n  }\n\n  private getActiveLayout(): ByFrameRepeater | SceneFlexLayout | undefined {\n    const layoutSwitcher = this.state.body;\n    const activeLayout = layoutSwitcher?.state.layouts.find((layout) => layout.isActive);\n    if (activeLayout instanceof ByFrameRepeater || activeLayout instanceof SceneFlexLayout) {\n      return activeLayout;\n    }\n    return undefined;\n  }\n\n  private activeLayoutContainsNoPanels(): boolean {\n    const activeLayout = this.getActiveLayout();\n\n    if (activeLayout instanceof ByFrameRepeater) {\n      const child = activeLayout.state.body.state.children[0];\n      if (child instanceof SceneFlexItem || child instanceof SceneReactObject) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  private getErrorStateAlert(errors: DataQueryError[] | undefined) {\n    return new SceneReactObject({\n      reactNode: (\n        <Alert title={'Something went wrong with your request'} severity={'error'}>\n          {errors?.map((err, key) => this.renderError(key, err))}\n        </Alert>\n      ),\n    });\n  }\n\n  private navigateToLabels() {\n    this.setState({\n      lastFilterEvent: undefined,\n    });\n    navigateToDrilldownPage(PageSlugs.labels, sceneGraph.getAncestor(this, ServiceScene));\n  }\n\n  private build(): LayoutSwitcher {\n    const variable = getLabelGroupByVariable(this);\n    const variableState = variable.state;\n    const labelBreakdownScene = sceneGraph.getAncestor(this, LabelBreakdownScene);\n    const tagKey = String(variableState?.value);\n\n    let bodyOpts = PanelBuilders.timeseries();\n    bodyOpts = bodyOpts\n      .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n      .setCustomFieldConfig('fillOpacity', 100)\n      .setCustomFieldConfig('lineWidth', 0)\n      .setCustomFieldConfig('pointSize', 0)\n      .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n      .setOverrides(setLevelColorOverrides)\n      .setTitle(tagKey);\n\n    const body = bodyOpts.build();\n    const { sortBy, direction } = getSortByPreference('labels', DEFAULT_SORT_BY, 'desc');\n\n    const getFilter = () => labelBreakdownScene.state.search.state.filter ?? '';\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'single', label: 'Single' },\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneFlexItem({\n              minHeight: 300,\n              body,\n            }),\n          ],\n        }),\n        new ByFrameRepeater({\n          body: new SceneCSSGridLayout({\n            isLazy: true,\n            templateColumns: LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n            autoRows: '200px',\n            children: [\n              new SceneFlexItem({\n                body: new SceneReactObject({\n                  reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                }),\n              }),\n            ],\n          }),\n          getLayoutChild: getFilterBreakdownValueScene(\n            getLabelValue,\n            DrawStyle.Bars,\n            VAR_LABELS,\n            sceneGraph.getAncestor(this, LabelBreakdownScene).state.sort\n          ),\n          sortBy,\n          direction,\n          getFilter,\n        }),\n        new ByFrameRepeater({\n          body: new SceneCSSGridLayout({\n            templateColumns: '1fr',\n            autoRows: '200px',\n            children: [\n              new SceneFlexItem({\n                body: new SceneReactObject({\n                  reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                }),\n              }),\n            ],\n          }),\n          getLayoutChild: getFilterBreakdownValueScene(\n            getLabelValue,\n            DrawStyle.Bars,\n            VAR_LABELS,\n            sceneGraph.getAncestor(this, LabelBreakdownScene).state.sort\n          ),\n          sortBy,\n          direction,\n          getFilter,\n        }),\n      ],\n    });\n  }\n\n  private showErrorToast(errors: DisplayErrors) {\n    const appEvents = getAppEvents();\n\n    // Make sure we only display each error once\n    let errorArray: DisplayError[] = [];\n    for (const err in errors) {\n      const displayError = errors[err];\n      if (!displayError.displayed) {\n        errorArray.push(displayError);\n        displayError.displayed = true;\n      }\n    }\n\n    if (errorArray.length) {\n      // If we don't have any panels the error message will replace the loading state, we want to set it as displayed but not render the toast\n      if (!this.activeLayoutContainsNoPanels()) {\n        appEvents.publish({\n          type: AppEvents.alertError.name,\n          payload: errorArray?.map((err, key) => this.renderError(key, err)),\n        });\n      }\n      this.setState({\n        errors,\n      });\n    }\n  }\n\n  private renderError(key: number, err: DataQueryError) {\n    return (\n      <div key={key}>\n        {err.status && (\n          <>\n            <strong>Status</strong>: {err.status} <br />\n          </>\n        )}\n        {err.message && (\n          <>\n            <strong>Message</strong>: {err.message} <br />\n          </>\n        )}\n        {err.traceId && (\n          <>\n            <strong>TraceId</strong>: {err.traceId}\n          </>\n        )}\n      </div>\n    );\n  }\n\n  public static Selector({ model }: SceneComponentProps<LabelValuesBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && body instanceof LayoutSwitcher && <body.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LabelValuesBreakdownScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <>{body && <body.Component model={body} />}</>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import React from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Field, RadioButtonGroup } from '@grafana/ui';\nimport { USER_EVENTS_ACTIONS, USER_EVENTS_PAGES, reportAppInteraction } from 'services/analytics';\nimport { getDrilldownSlug } from '../../../services/routing';\n\nexport interface LayoutSwitcherState extends SceneObjectState {\n  active: LayoutType;\n  layouts: SceneObject[];\n  options: Array<SelectableValue<LayoutType>>;\n}\n\nexport type LayoutType = 'single' | 'grid' | 'rows';\n\nexport class LayoutSwitcher extends SceneObjectBase<LayoutSwitcherState> {\n  public Selector({ model }: { model: LayoutSwitcher }) {\n    const { active, options } = model.useState();\n\n    return (\n      <Field>\n        <RadioButtonGroup options={options} value={active} onChange={model.onLayoutChange} />\n      </Field>\n    );\n  }\n\n  public onLayoutChange = (active: LayoutType) => {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.layout_type_changed, {\n      layout: active,\n      view: getDrilldownSlug(),\n    });\n    this.setState({ active });\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LayoutSwitcher>) => {\n    const { layouts, options, active } = model.useState();\n\n    const index = options.findIndex((o) => o.value === active);\n    if (index === -1) {\n      return null;\n    }\n\n    const layout = layouts[index];\n\n    return <layout.Component model={layout} />;\n  };\n}\n","import { css } from '@emotion/css';\nimport { Icon, Input } from '@grafana/ui';\nimport React, { HTMLProps } from 'react';\n\ninterface Props extends Omit<HTMLProps<HTMLInputElement>, 'width'> {\n  onClear(): void;\n  suffix?: React.ReactNode;\n}\n\nexport const SearchInput = ({ value, onChange, placeholder, onClear, suffix, ...rest }: Props) => {\n  return (\n    <Input\n      value={value}\n      onChange={onChange}\n      suffix={\n        <>\n          {value ? (\n            <Icon onClick={onClear} title={'Clear search'} name=\"times\" className={styles.clearIcon} />\n          ) : undefined}\n          {suffix && suffix}\n        </>\n      }\n      prefix={<Icon name=\"search\" />}\n      placeholder={placeholder}\n      {...rest}\n    />\n  );\n};\n\nconst styles = {\n  clearIcon: css({\n    cursor: 'pointer',\n  }),\n};\n","import {\n  AdHocFiltersVariable,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { getLogsPanelFrame, ServiceScene } from '../ServiceScene';\nimport { navigateToValueBreakdown } from '../../../services/navigate';\nimport { getPrimaryLabelFromUrl, ValueSlugs } from '../../../services/routing';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\nimport { addToFilters, VariableFilterType } from './AddToFiltersButton';\nimport { FilterButton } from '../../FilterButton';\nimport { EMPTY_VARIABLE_VALUE, LEVEL_VARIABLE_VALUE } from '../../../services/variables';\nimport { AdHocVariableFilter, Field, Labels, LoadingState } from '@grafana/data';\nimport { FilterOp } from '../../../services/filters';\nimport {\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getValueFromAdHocVariableFilter,\n} from '../../../services/variableGetters';\n\ninterface SelectLabelActionSceneState extends SceneObjectState {\n  labelName: string;\n  fieldType: ValueSlugs;\n  hideValueDrilldown?: boolean;\n  showFilterField?: boolean;\n}\n\nexport class SelectLabelActionScene extends SceneObjectBase<SelectLabelActionSceneState> {\n  constructor(state: SelectLabelActionSceneState) {\n    super(state);\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Component = ({ model }: SceneComponentProps<SelectLabelActionScene>) => {\n    const { hideValueDrilldown, labelName, showFilterField } = model.useState();\n    const variable = model.getVariable();\n    const variableName = variable.useState().name as VariableFilterType;\n    const existingFilter = model.getExistingFilter(variable);\n    const fieldValue = getValueFromAdHocVariableFilter(variable, existingFilter);\n    const value = fieldValue?.value;\n\n    return (\n      <>\n        {showFilterField === true && (\n          <FilterButton\n            isExcluded={existingFilter?.operator === FilterOp.Equal && value === EMPTY_VARIABLE_VALUE}\n            isIncluded={existingFilter?.operator === FilterOp.NotEqual && value === EMPTY_VARIABLE_VALUE}\n            onInclude={() => model.onClickExcludeEmpty(variableName)}\n            onExclude={() => model.onClickIncludeEmpty(variableName)}\n            onClear={() => model.clearFilter(variableName)}\n            buttonFill={'text'}\n            titles={{\n              include: `Only show logs that contain ${labelName}`,\n              exclude: `Hide all logs that contain ${labelName}`,\n            }}\n          />\n        )}\n\n        {hideValueDrilldown !== true && (\n          <Button\n            title={`View breakdown of values for ${labelName}`}\n            variant=\"primary\"\n            fill=\"outline\"\n            size=\"sm\"\n            onClick={model.onClickViewValues}\n            aria-label={`Select ${labelName}`}\n          >\n            Select\n          </Button>\n        )}\n      </>\n    );\n  };\n\n  private getExistingFilter(variable?: AdHocFiltersVariable): AdHocVariableFilter | undefined {\n    let { labelName } = getPrimaryLabelFromUrl();\n    if (this.state.labelName !== labelName) {\n      return variable?.state.filters.find((filter) => {\n        const value = getValueFromAdHocVariableFilter(variable, filter);\n        return filter.key === this.state.labelName && value.value === EMPTY_VARIABLE_VALUE;\n      });\n    }\n\n    return undefined;\n  }\n\n  public onActivate() {\n    this._subs.add(\n      sceneGraph.getData(this).subscribeToState((newState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n          if (serviceScene.state.$data?.state.data?.state === LoadingState.Done) {\n            this.calculateSparsity();\n          }\n\n          this._subs.add(\n            serviceScene.state.$data?.subscribeToState((newLogsPanelState) => {\n              if (newLogsPanelState.data?.state === LoadingState.Done) {\n                this.calculateSparsity();\n              }\n            })\n          );\n        }\n      })\n    );\n  }\n\n  public onClickViewValues = () => {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    navigateToValueBreakdown(this.state.fieldType, this.state.labelName, serviceScene);\n  };\n\n  public onClickExcludeEmpty = (variableType: VariableFilterType) => {\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'exclude', this, variableType);\n  };\n\n  public onClickIncludeEmpty = (variableType: VariableFilterType) => {\n    // If json do we want != '{}'?\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'include', this, variableType);\n  };\n\n  public clearFilter = (variableType: VariableFilterType) => {\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'clear', this, variableType);\n  };\n\n  private calculateSparsity() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const logsPanelData = getLogsPanelFrame(serviceScene.state.$data?.state.data);\n    const labels: Field<Labels> | undefined = logsPanelData?.fields.find((field) => field.name === 'labels');\n\n    if (!labels || !logsPanelData) {\n      this.setState({\n        showFilterField: false,\n      });\n      return;\n    }\n    const variable = this.getVariable();\n    // iterate through all the labels on the log panel query result and count how many times this exists\n    const logLinesWithLabelCount = labels.values.reduce((acc, labels) => {\n      if (labels?.[this.state.labelName]) {\n        acc++;\n      }\n      return acc;\n    }, 0);\n\n    const panel = sceneGraph.getAncestor(this, VizPanel);\n    if (logLinesWithLabelCount !== undefined && logsPanelData.length > 0) {\n      const percentage = ((logLinesWithLabelCount / logsPanelData.length) * 100).toLocaleString();\n      const description = `${this.state.labelName} exists on ${percentage}% of ${logsPanelData.length} sampled log lines`;\n\n      // Update the desc\n      panel.setState({\n        description,\n      });\n    } else {\n      panel.setState({\n        description: undefined,\n      });\n    }\n\n    if (logLinesWithLabelCount < logsPanelData.length || this.getExistingFilter(variable)) {\n      this.setState({\n        showFilterField: true,\n      });\n    } else {\n      this.setState({\n        showFilterField: false,\n      });\n    }\n  }\n\n  private getVariable() {\n    if (this.state.fieldType === ValueSlugs.field) {\n      return getFieldsVariable(this);\n    } else if (this.state.labelName === LEVEL_VARIABLE_VALUE) {\n      return getLevelsVariable(this);\n    } else {\n      return getLabelsVariable(this);\n    }\n  }\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\nimport { BusEventBase, DataFrame, FieldReducerInfo, ReducerID, SelectableValue, fieldReducers } from '@grafana/data';\nimport { getLabelValueFromDataFrame } from 'services/levels';\nimport { InlineField, Select } from '@grafana/ui';\nimport { getSortByPreference, setSortByPreference } from 'services/store';\nimport { testIds } from '../../../services/testIds';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\n\nexport type SortBy = 'changepoint' | 'outliers' | ReducerID | '';\nexport type SortDirection = 'asc' | 'desc';\nexport interface SortBySceneState extends SceneObjectState {\n  target: 'fields' | 'labels';\n  sortBy: SortBy;\n  direction: SortDirection;\n}\n\nexport class SortCriteriaChanged extends BusEventBase {\n  constructor(public target: 'fields' | 'labels', public sortBy: string, public direction: string) {\n    super();\n  }\n  public static type = 'sort-criteria-changed';\n}\n\nexport class SortByScene extends SceneObjectBase<SortBySceneState> {\n  public sortingOptions: Array<{ label: string; options: SelectableValue<SortBy> }> = [\n    {\n      label: '',\n      options: [\n        {\n          value: 'changepoint',\n          label: 'Most relevant',\n          description: 'Smart ordering of graphs based on the most significant spikes in the data',\n        },\n        {\n          value: 'outliers',\n          label: 'Detected outliers',\n          description: 'Order by the amount of detected outliers in the data',\n        },\n        {\n          value: ReducerID.stdDev,\n          label: 'Widest spread',\n          description: 'Sort graphs by deviation from the average value',\n        },\n        {\n          value: 'alphabetical',\n          label: 'Name',\n          description: 'Alphabetical order',\n        },\n        {\n          value: ReducerID.sum,\n          label: 'Count',\n          description: 'Sort graphs by total number of logs',\n        },\n        {\n          value: ReducerID.max,\n          label: 'Highest spike',\n          description: 'Sort graphs by the highest values (max)',\n        },\n        {\n          value: ReducerID.min,\n          label: 'Lowest dip',\n          description: 'Sort graphs by the smallest values (min)',\n        },\n      ],\n    },\n    {\n      label: 'Percentiles',\n      options: [...fieldReducers.selectOptions([], filterReducerOptions).options],\n    },\n  ];\n\n  constructor(state: Pick<SortBySceneState, 'target'>) {\n    const { sortBy, direction } = getSortByPreference(state.target, DEFAULT_SORT_BY, 'desc');\n    super({\n      target: state.target,\n      sortBy,\n      direction,\n    });\n  }\n\n  public onCriteriaChange = (criteria: SelectableValue<SortBy>) => {\n    if (!criteria.value) {\n      return;\n    }\n    this.setState({ sortBy: criteria.value });\n    setSortByPreference(this.state.target, criteria.value, this.state.direction);\n    this.publishEvent(new SortCriteriaChanged(this.state.target, criteria.value, this.state.direction), true);\n  };\n\n  public onDirectionChange = (direction: SelectableValue<SortDirection>) => {\n    if (!direction.value) {\n      return;\n    }\n    this.setState({ direction: direction.value });\n    setSortByPreference(this.state.target, this.state.sortBy, direction.value);\n    this.publishEvent(new SortCriteriaChanged(this.state.target, this.state.sortBy, direction.value), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SortByScene>) => {\n    const { sortBy, direction } = model.useState();\n    const group = model.sortingOptions.find((group) =>\n      group.options.find((option: SelectableValue<SortBy>) => option.value === sortBy)\n    );\n    const sortByValue: SelectableValue<SortBy> | undefined = group?.options.find(\n      (option: SelectableValue<SortBy>) => option.value === sortBy\n    );\n    return (\n      <>\n        <InlineField>\n          <Select\n            data-testid={testIds.breakdowns.common.sortByDirection}\n            onChange={model.onDirectionChange}\n            aria-label=\"Sort direction\"\n            placeholder=\"\"\n            value={direction}\n            options={[\n              {\n                label: 'Asc',\n                value: 'asc',\n              },\n              {\n                label: 'Desc',\n                value: 'desc',\n              },\n            ]}\n          ></Select>\n        </InlineField>\n        <InlineField\n          label=\"Sort by\"\n          htmlFor=\"sort-by-criteria\"\n          tooltip=\"Calculate a derived quantity from the values in your time series and sort by this criteria. Defaults to standard deviation.\"\n        >\n          <Select\n            data-testid={testIds.breakdowns.common.sortByFunction}\n            value={sortByValue}\n            width={20}\n            isSearchable={true}\n            options={model.sortingOptions}\n            placeholder={'Choose criteria'}\n            onChange={model.onCriteriaChange}\n            inputId=\"sort-by-criteria\"\n          />\n        </InlineField>\n      </>\n    );\n  };\n}\n\nconst ENABLED_PERCENTILES = ['p10', 'p25', 'p75', 'p90', 'p99'];\nfunction filterReducerOptions(ext: FieldReducerInfo) {\n  if (ext.id >= 'p1' && ext.id <= 'p99') {\n    return ENABLED_PERCENTILES.includes(ext.id);\n  }\n  return false;\n}\n\nexport function getLabelValue(frame: DataFrame) {\n  return getLabelValueFromDataFrame(frame) ?? 'No labels';\n}\n","import { css } from '@emotion/css';\nimport React, { ReactNode } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { LoadingPlaceholder, useStyles2 } from '@grafana/ui';\n\ntype Props = {\n  blockingMessage?: string;\n  isLoading?: boolean;\n  children?: ReactNode;\n};\n\nexport function StatusWrapper({ blockingMessage, isLoading, children }: Props) {\n  const styles = useStyles2(getStyles);\n\n  if (isLoading && !blockingMessage) {\n    blockingMessage = 'Loading...';\n  }\n\n  if (isLoading) {\n    return <LoadingPlaceholder className={styles.statusMessage} text={blockingMessage} />;\n  }\n\n  if (!blockingMessage) {\n    return <>{children}</>;\n  }\n\n  return <div className={styles.statusMessage}>{blockingMessage}</div>;\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    statusMessage: css({\n      fontStyle: 'italic',\n      marginTop: theme.spacing(7),\n      textAlign: 'center',\n    }),\n  };\n}\n","import { Button, Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2, LoadingState, PanelData } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport {\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\n\nexport const MAX_NUMBER_OF_TIME_SERIES = 20;\n\nexport interface TimeSeriesLimitSeriesTitleItemSceneState extends SceneObjectState {\n  toggleShowAllSeries: (model: TimeSeriesLimitSeriesTitleItemScene) => void;\n  showAllSeries: boolean;\n  currentSeriesCount?: number;\n}\n\nexport class TimeSeriesLimitSeriesTitleItemScene extends SceneObjectBase<TimeSeriesLimitSeriesTitleItemSceneState> {\n  constructor(state: TimeSeriesLimitSeriesTitleItemSceneState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const panel = sceneGraph.getAncestor(this, VizPanel);\n    this._subs.add(\n      panel.subscribeToState((newState, prevState) => {\n        const $data = sceneGraph.getData(this);\n        if ($data.state.data?.state === LoadingState.Done) {\n          this.setState({\n            currentSeriesCount: $data.state.data?.series.length,\n          });\n        }\n      })\n    );\n  }\n  public static Component = ({ model }: SceneComponentProps<TimeSeriesLimitSeriesTitleItemScene>) => {\n    const { toggleShowAllSeries, showAllSeries, currentSeriesCount } = model.useState();\n    const $data = sceneGraph.getData(model);\n    const { data } = $data.useState();\n    const styles = useStyles2(getStyles);\n\n    if (\n      !($data instanceof SceneDataTransformer) ||\n      showAllSeries ||\n      data?.state !== LoadingState.Done ||\n      !currentSeriesCount ||\n      data.series.length < MAX_NUMBER_OF_TIME_SERIES\n    ) {\n      return null;\n    }\n\n    //@todo is there a better way to get the total number of series before transforming then accessing a private prop?\n    const prevData: PanelData | undefined = $data['_prevDataFromSource'];\n    const totalLength = prevData?.series.length;\n\n    return (\n      <div key=\"disclaimer\" className={styles.timeSeriesDisclaimer}>\n        <span className={styles.warningMessage}>\n          <>\n            <Icon\n              title={`Showing only ${MAX_NUMBER_OF_TIME_SERIES} series`}\n              name=\"exclamation-triangle\"\n              aria-hidden=\"true\"\n            />\n          </>\n        </span>\n        <Tooltip\n          content={\n            'Rendering too many series in a single panel may impact performance and make data harder to read. Consider adding more filters.'\n          }\n        >\n          <Button variant=\"secondary\" size=\"sm\" onClick={() => toggleShowAllSeries(model)}>\n            <>Show all {totalLength}</>\n          </Button>\n        </Tooltip>\n      </div>\n    );\n  };\n}\n\nexport function limitMaxNumberOfSeriesForPanel(child: SceneCSSGridItem) {\n  const panel = child.state.body as VizPanel | undefined;\n  const dataTransformer = child.state.body?.state.$data;\n  if (dataTransformer instanceof SceneDataTransformer) {\n    panel?.setState({\n      titleItems: [\n        new TimeSeriesLimitSeriesTitleItemScene({\n          showAllSeries: false,\n          toggleShowAllSeries: (timeSeriesLimiter) => {\n            dataTransformer.setState({\n              transformations: [],\n            });\n            timeSeriesLimiter.setState({\n              showAllSeries: true,\n            });\n            dataTransformer.reprocessTransformations();\n          },\n        }),\n      ],\n    });\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  timeSeriesDisclaimer: css({\n    label: 'time-series-disclaimer',\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(1),\n  }),\n  warningMessage: css({\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(0.5),\n    color: theme.colors.warning.main,\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import React from 'react';\n\nimport { toURLRange, urlUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { sceneGraph } from '@grafana/scenes';\nimport { ToolbarButton } from '@grafana/ui';\n\nimport { getDataSource, getQueryExpr } from 'services/scenes';\nimport { testIds } from 'services/testIds';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport { USER_EVENTS_ACTIONS, USER_EVENTS_PAGES, reportAppInteraction } from 'services/analytics';\ninterface GoToExploreButtonState {\n  exploration: IndexScene;\n}\n\nexport const GoToExploreButton = ({ exploration }: GoToExploreButtonState) => {\n  const onClick = () => {\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.open_in_explore_clicked\n    );\n    const datasource = getDataSource(exploration);\n    const expr = getQueryExpr(exploration).replace(/\\s+/g, ' ').trimEnd();\n    const timeRange = sceneGraph.getTimeRange(exploration).state.value;\n    const exploreState = JSON.stringify({\n      ['loki-explore']: {\n        range: toURLRange(timeRange.raw),\n        queries: [{ refId: 'logs', expr, datasource }],\n        datasource,\n      },\n    });\n    const subUrl = config.appSubUrl ?? '';\n    const link = urlUtil.renderUrl(`${subUrl}/explore`, { panes: exploreState, schemaVersion: 1 });\n    window.open(link, '_blank');\n  };\n\n  return (\n    <ToolbarButton\n      data-testid={testIds.exploreServiceDetails.openExplore}\n      variant={'canvas'}\n      icon={'compass'}\n      onClick={onClick}\n    >\n      Open in Explore\n    </ToolbarButton>\n  );\n};\n","import { useTheme2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\ninterface Props {\n  onCaseSensitiveToggle: (state: 'sensitive' | 'insensitive') => void;\n  caseSensitive: boolean;\n}\n\nexport const LineFilterIcon = (props: Props) => {\n  const theme = useTheme2();\n  const fill = props.caseSensitive ? theme.colors.text.maxContrast : theme.colors.text.disabled;\n  const styles = getStyles(theme, fill);\n\n  return (\n    <span className={styles.container} title={`Case ${props.caseSensitive ? 'insensitive' : 'sensitive'} search`}>\n      <svg\n        onClick={() => props.onCaseSensitiveToggle(props.caseSensitive ? 'insensitive' : 'sensitive')}\n        fill={fill}\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <text fontSize=\"13\" width=\"16\" height=\"16\" x=\"50%\" y=\"50%\" dominantBaseline=\"central\" textAnchor=\"middle\">\n          Aa\n        </text>\n      </svg>\n    </span>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2, fill: string) => {\n  return {\n    container: css({\n      display: 'flex',\n      justifyContent: 'center',\n      marginLeft: theme.spacing.x0_5,\n      cursor: 'pointer',\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Field } from '@grafana/ui';\nimport { debounce, escapeRegExp } from 'lodash';\nimport React, { ChangeEvent, KeyboardEvent } from 'react';\nimport { testIds } from 'services/testIds';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { SearchInput } from './Breakdowns/SearchInput';\nimport { LineFilterIcon } from './LineFilterIcon';\nimport { getLineFilterVariable } from '../../services/variableGetters';\n\ninterface LineFilterState extends SceneObjectState {\n  lineFilter: string;\n  caseSensitive: boolean;\n}\n\nexport class LineFilterScene extends SceneObjectBase<LineFilterState> {\n  static Component = LineFilterRenderer;\n\n  constructor(state?: Partial<LineFilterState>) {\n    super({\n      lineFilter: state?.lineFilter || '',\n      caseSensitive: false,\n      ...state,\n    });\n    this.addActivationHandler(this.onActivate);\n  }\n\n  private onActivate = () => {\n    const lineFilterValue = getLineFilterVariable(this).getValue();\n    const lineFilterString = lineFilterValue.toString();\n    if (!lineFilterValue) {\n      return;\n    }\n    const caseSensitive = lineFilterString.includes('|=');\n    const matches = caseSensitive ? lineFilterString.match(/\\|=.`(.+?)`/) : lineFilterString.match(/`\\(\\?i\\)(.+)`/);\n\n    if (!matches || matches.length !== 2) {\n      return;\n    }\n    this.setState({\n      lineFilter: matches[1].replace(/\\\\(.)/g, '$1'),\n      caseSensitive,\n    });\n  };\n\n  updateFilter(lineFilter: string, debounced = true) {\n    this.setState({\n      lineFilter,\n    });\n    if (debounced) {\n      this.updateVariableDebounced(lineFilter);\n    } else {\n      this.updateVariable(lineFilter);\n    }\n  }\n\n  handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n    this.updateFilter(e.target.value);\n  };\n\n  handleEnter = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      this.updateVariable(this.state.lineFilter);\n    }\n  };\n\n  onCaseSensitiveToggle = (newState: 'sensitive' | 'insensitive') => {\n    this.setState({\n      caseSensitive: newState === 'sensitive',\n    });\n\n    this.updateFilter(this.state.lineFilter);\n  };\n\n  updateVariableDebounced = debounce((search: string) => {\n    this.updateVariable(search);\n  }, 1000);\n\n  updateVariable = (search: string) => {\n    const variable = getLineFilterVariable(this);\n    if (search === '') {\n      variable.changeValueTo('');\n    } else {\n      if (this.state.caseSensitive) {\n        variable.changeValueTo(`|= \\`${escapeRegExp(search)}\\``);\n      } else {\n        variable.changeValueTo(`|~ \\`(?i)${escapeRegExp(search)}\\``);\n      }\n    }\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.search_string_in_logs_changed,\n      {\n        searchQueryLength: search.length,\n        containsLevel: search.toLowerCase().includes('level'),\n      }\n    );\n  };\n}\n\nfunction LineFilterRenderer({ model }: SceneComponentProps<LineFilterScene>) {\n  const { lineFilter, caseSensitive } = model.useState();\n  return (\n    <Field className={styles.field}>\n      <SearchInput\n        data-testid={testIds.exploreServiceDetails.searchLogs}\n        value={lineFilter}\n        className={styles.input}\n        onChange={model.handleChange}\n        suffix={<LineFilterIcon caseSensitive={caseSensitive} onCaseSensitiveToggle={model.onCaseSensitiveToggle} />}\n        placeholder=\"Search in log lines\"\n        onClear={() => {\n          model.updateFilter('', false);\n        }}\n        onKeyUp={model.handleEnter}\n      />\n    </Field>\n  );\n}\n\nconst styles = {\n  input: css({\n    width: '100%',\n  }),\n  field: css({\n    label: 'field',\n    width: '100%',\n    marginBottom: 0,\n  }),\n};\n","import { DataFrame, DataFrameType, Field, FieldCache, FieldType, FieldWithIndex, Labels } from '@grafana/data';\n\n// these are like Labels, but their values can be\n// arbitrary structures, not just strings\nexport type LogFrameLabels = Record<string, unknown>;\n\n// the attributes-access is a little awkward, but it's necessary\n// because there are multiple,very different dataFrame-representations.\nexport type LogsFrame = {\n  timeField: FieldWithIndex;\n  bodyField: FieldWithIndex;\n  timeNanosecondField: FieldWithIndex | null;\n  severityField: FieldWithIndex | null;\n  idField: FieldWithIndex | null;\n  getLogFrameLabels: () => LogFrameLabels[] | null; // may be slow, so we only do it when asked for it explicitly\n  getLogFrameLabelsAsLabels: () => Labels[] | null; // temporarily exists to make the labels=>attributes migration simpler\n  getLabelFieldName: () => string | null;\n  extraFields: FieldWithIndex[];\n  raw: DataFrame;\n};\n\nfunction getField(cache: FieldCache, name: string, fieldType: FieldType): FieldWithIndex | undefined {\n  const field = cache.getFieldByName(name);\n  if (field === undefined) {\n    return undefined;\n  }\n\n  return field.type === fieldType ? field : undefined;\n}\n\nexport const DATAPLANE_TIMESTAMP_NAME = 'timestamp';\nexport const DATAPLANE_BODY_NAME = 'body';\nexport const DATAPLANE_SEVERITY_NAME = 'severity';\nexport const DATAPLANE_ID_NAME = 'id';\nexport const DATAPLANE_LABELS_NAME = 'labels';\n\nexport function logFrameLabelsToLabels(logFrameLabels: LogFrameLabels): Labels {\n  const result: Labels = {};\n\n  Object.entries(logFrameLabels).forEach(([k, v]) => {\n    result[k] = typeof v === 'string' ? v : JSON.stringify(v);\n  });\n\n  return result;\n}\n\nexport function parseLogsFrame(frame: DataFrame): LogsFrame | null {\n  if (frame.meta?.type === DataFrameType.LogLines) {\n    return parseDataplaneLogsFrame(frame);\n  } else {\n    return parseLegacyLogsFrame(frame);\n  }\n}\n\nexport function parseDataplaneLogsFrame(frame: DataFrame): LogsFrame | null {\n  const cache = new FieldCache(frame);\n\n  const timestampField = getField(cache, DATAPLANE_TIMESTAMP_NAME, FieldType.time);\n  const bodyField = getField(cache, DATAPLANE_BODY_NAME, FieldType.string);\n\n  // these two are mandatory\n  if (timestampField === undefined || bodyField === undefined) {\n    return null;\n  }\n\n  const severityField = getField(cache, DATAPLANE_SEVERITY_NAME, FieldType.string) ?? null;\n  const idField = getField(cache, DATAPLANE_ID_NAME, FieldType.string) ?? null;\n  const labelsField = getField(cache, DATAPLANE_LABELS_NAME, FieldType.other) ?? null;\n\n  const labels = labelsField === null ? null : labelsField.values;\n\n  const extraFields = cache.fields.filter(\n    (_, i) =>\n      i !== timestampField.index &&\n      i !== bodyField.index &&\n      i !== severityField?.index &&\n      i !== idField?.index &&\n      i !== labelsField?.index\n  );\n\n  return {\n    raw: frame,\n    timeField: timestampField,\n    bodyField,\n    severityField,\n    idField,\n    getLogFrameLabels: () => labels,\n    timeNanosecondField: null,\n    getLogFrameLabelsAsLabels: () => (labels !== null ? labels.map(logFrameLabelsToLabels) : null),\n    getLabelFieldName: () => (labelsField !== null ? labelsField.name : null),\n    extraFields,\n  };\n}\n\n// Copied from https://github.com/grafana/grafana/blob/main/public/app/features/logs/legacyLogsFrame.ts\nexport function parseLegacyLogsFrame(frame: DataFrame): LogsFrame | null {\n  const cache = new FieldCache(frame);\n  const timeField = cache.getFirstFieldOfType(FieldType.time);\n  const bodyField = cache.getFirstFieldOfType(FieldType.string);\n\n  // these two are mandatory\n  if (timeField === undefined || bodyField === undefined) {\n    return null;\n  }\n\n  const timeNanosecondField = cache.getFieldByName('tsNs') ?? null;\n  const severityField = cache.getFieldByName('level') ?? null;\n  const idField = cache.getFieldByName('id') ?? null;\n\n  // extracting the labels is done very differently for old-loki-style and simple-style\n  // dataframes, so it's a little awkward to handle it,\n  // we both need to on-demand extract the labels, and also get teh labelsField,\n  // but only if the labelsField is used.\n  const [labelsField, getL] = makeLabelsGetter(cache, bodyField, frame);\n\n  const extraFields = cache.fields.filter(\n    (_, i) =>\n      i !== timeField.index &&\n      i !== bodyField.index &&\n      i !== timeNanosecondField?.index &&\n      i !== severityField?.index &&\n      i !== idField?.index &&\n      i !== labelsField?.index\n  );\n\n  return {\n    timeField,\n    bodyField,\n    timeNanosecondField,\n    severityField,\n    idField,\n    getLogFrameLabels: getL,\n    getLogFrameLabelsAsLabels: getL,\n    getLabelFieldName: () => labelsField?.name ?? null,\n    extraFields,\n    raw: frame,\n  };\n}\n\n// if the frame has \"labels\" field with type \"other\", adjust the behavior.\n// we also have to return the labels-field (if we used it),\n// to be able to remove it from the unused-fields, later.\nfunction makeLabelsGetter(\n  cache: FieldCache,\n  lineField: Field,\n  frame: DataFrame\n): [FieldWithIndex | null, () => Labels[] | null] {\n  // If we have labels field with type \"other\", use that\n  const labelsField = cache.getFieldByName('labels');\n  if (labelsField !== undefined && labelsField.type === FieldType.other) {\n    const values = labelsField.values.map(logFrameLabelsToLabels);\n    return [labelsField, () => values];\n  } else {\n    // Otherwise we use the labels on the line-field, and make an array with it\n    return [null, () => makeLabelsArray(lineField, frame.length)];\n  }\n}\n\n// take the labels from the line-field, and \"stretch\" it into an array\n// with the length of the frame (so there are the same labels for every row)\nfunction makeLabelsArray(lineField: Field, length: number): Labels[] | null {\n  const lineLabels = lineField.labels;\n  if (lineLabels !== undefined) {\n    const result = new Array(length);\n    result.fill(lineLabels);\n    return result;\n  } else {\n    return null;\n  }\n}\n\nexport function getTimeName(logsFrame?: LogsFrame) {\n  return logsFrame?.timeField.name ?? DATAPLANE_TIMESTAMP_NAME;\n}\n\nexport function getBodyName(logsFrame?: LogsFrame | null): string {\n  return logsFrame?.bodyField.name ?? DATAPLANE_BODY_NAME;\n}\n\nexport function getIdName(logsFrame?: LogsFrame): string {\n  return logsFrame?.idField?.name ?? DATAPLANE_ID_NAME;\n}\n","import React, { createContext, ReactNode, useCallback, useContext, useEffect, useState } from 'react';\nimport { ActiveFieldMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { getBodyName, getTimeName, LogsFrame } from '../../../services/logsFrame';\nimport { logger } from '../../../services/logger';\nimport { PLUGIN_ID } from '../../../services/routing';\n\nconst tableColumnCustomWidths = `${PLUGIN_ID}.tableColumnWidths`;\n\ntype TableColumnsContextType = {\n  // the current list of labels from the dataframe combined with UI metadata\n  columns: FieldNameMetaStore;\n  // The active search results\n  filteredColumns?: FieldNameMetaStore;\n  // Update the column state\n  setColumns(newColumns: FieldNameMetaStore): void;\n  // Update search state\n  setFilteredColumns(newColumns?: FieldNameMetaStore): void;\n  // WIP - sets the visibility of the drawer right now\n  visible: boolean;\n  setVisible: (v: boolean) => void;\n  bodyState: LogLineState;\n  setBodyState: (s: LogLineState) => void;\n  clearSelectedLine: () => void;\n  setColumnWidthMap(map: Record<string, number>): void;\n  columnWidthMap: Record<string, number>;\n};\n\nexport enum LogLineState {\n  text = 'text',\n  labels = 'labels',\n  auto = 'auto',\n}\n\nconst TableColumnsContext = createContext<TableColumnsContextType>({\n  columnWidthMap: {},\n  setColumnWidthMap: () => {},\n  columns: {},\n  filteredColumns: {},\n  setColumns: () => {},\n  setFilteredColumns: () => {},\n  setVisible: () => false,\n  visible: false,\n  bodyState: LogLineState.auto,\n  setBodyState: () => {},\n  clearSelectedLine: () => {},\n});\n\nfunction setDefaultColumns(\n  columns: FieldNameMetaStore,\n  handleSetColumns: (newColumns: FieldNameMetaStore) => void,\n  logsFrame: LogsFrame\n) {\n  const pendingColumns = { ...columns };\n\n  pendingColumns[getTimeName(logsFrame)] = {\n    index: 0,\n    active: true,\n    type: 'TIME_FIELD',\n    percentOfLinesWithLabel: 100,\n    cardinality: Infinity,\n  };\n  pendingColumns[getBodyName(logsFrame)] = {\n    index: 1,\n    active: true,\n    type: 'BODY_FIELD',\n    percentOfLinesWithLabel: 100,\n    cardinality: Infinity,\n  };\n  handleSetColumns(pendingColumns);\n}\n\nfunction getColumnWidthsFromLocalStorage() {\n  let initialColumnWidths = {};\n  const existingWidths = localStorage.getItem(tableColumnCustomWidths);\n  if (existingWidths) {\n    try {\n      initialColumnWidths = JSON.parse(existingWidths);\n    } catch (e) {\n      logger.error(e, { msg: 'error parsing table column widths from local storage' });\n    }\n  }\n  return initialColumnWidths;\n}\n\nexport const TableColumnContextProvider = ({\n  children,\n  initialColumns,\n  logsFrame,\n  setUrlColumns,\n  clearSelectedLine,\n}: {\n  children: ReactNode;\n  initialColumns: FieldNameMetaStore;\n  logsFrame: LogsFrame;\n  setUrlColumns: (columns: string[]) => void;\n  clearSelectedLine: () => void;\n}) => {\n  const [columns, setColumns] = useState<FieldNameMetaStore>(removeExtraColumns(initialColumns));\n  const [bodyState, setBodyState] = useState<LogLineState>(LogLineState.auto);\n  const [filteredColumns, setFilteredColumns] = useState<FieldNameMetaStore | undefined>(undefined);\n  const [visible, setVisible] = useState(false);\n  const initialColumnWidths = getColumnWidthsFromLocalStorage();\n\n  const [columnWidthMap, setColumnWidthMapState] = useState<Record<string, number>>(initialColumnWidths);\n  const setColumnWidthMap = (map: Record<string, number>) => {\n    localStorage.setItem(tableColumnCustomWidths, JSON.stringify(map));\n    setColumnWidthMapState(map);\n  };\n\n  const getActiveColumns = (columns: FieldNameMetaStore): string[] => {\n    let activeColumns: string[] = [];\n    Object.keys(columns).forEach((fieldName) => {\n      if (columns[fieldName].active && columns[fieldName].index !== undefined) {\n        activeColumns.push(fieldName);\n      }\n    });\n    activeColumns.sort((a, b) => {\n      // Typescript doesn't seem to know that the indicies we picked in the loop above are only for ActiveFieldMeta, so we're forced to assert\n      const colA: ActiveFieldMeta = columns[a] as ActiveFieldMeta;\n      const colB: ActiveFieldMeta = columns[b] as ActiveFieldMeta;\n      return colA.index - colB.index;\n    });\n    return activeColumns;\n  };\n\n  const handleSetColumns = useCallback(\n    (newColumns: FieldNameMetaStore) => {\n      if (newColumns) {\n        const columns = removeExtraColumns(newColumns);\n\n        setColumns(columns);\n\n        // Sync react state update with scenes url management\n        setUrlColumns(getActiveColumns(columns));\n      }\n    },\n    [setUrlColumns]\n  );\n\n  const handleClearSelectedLine = () => {\n    clearSelectedLine();\n  };\n\n  const handleSetVisible = useCallback((isVisible: boolean) => {\n    setVisible(isVisible);\n  }, []);\n\n  // When the parent component recalculates new columns on dataframe change, we need to update or the column UI will be stale!\n  useEffect(() => {\n    if (initialColumns) {\n      handleSetColumns(initialColumns);\n    }\n  }, [initialColumns, handleSetColumns]);\n\n  // When the columns are updated, we need to check if nothing is selected so we can set the default\n  useEffect(() => {\n    const activeColumns = getDefaultColumns(columns, logsFrame);\n    if (activeColumns?.length) {\n      const activeFields = Object.keys(columns).filter((col) => columns[col].active);\n\n      // If we're missing all fields, the user must have removed the last column, let's revert back to the default state\n      if (activeFields.length === 0) {\n        setDefaultColumns(columns, handleSetColumns, logsFrame);\n      }\n\n      // Reset any local search state\n      setFilteredColumns(undefined);\n    }\n  }, [columns, logsFrame, setFilteredColumns, handleSetColumns]);\n\n  return (\n    <TableColumnsContext.Provider\n      value={{\n        setColumnWidthMap,\n        columnWidthMap,\n        bodyState,\n        setBodyState,\n        setFilteredColumns,\n        filteredColumns,\n        columns,\n        setColumns: handleSetColumns,\n        visible: visible,\n        setVisible: handleSetVisible,\n        clearSelectedLine: handleClearSelectedLine,\n      }}\n    >\n      {children}\n    </TableColumnsContext.Provider>\n  );\n};\n/**\n * Filter out fields that shouldn't be exposed in the UI\n * @param columns\n */\nconst removeExtraColumns = (columns: FieldNameMetaStore): FieldNameMetaStore => {\n  // Remove label Types\n  if ('labelTypes' in columns) {\n    const { labelTypes, ...columnsToSet }: FieldNameMetaStore = {\n      ...columns,\n    };\n    return columnsToSet;\n  }\n  return columns;\n};\n\nfunction getDefaultColumns(pendingLabelState: FieldNameMetaStore, logsFrame: LogsFrame) {\n  if (!logsFrame) {\n    logger.warn('missing dataframe, cannot set url state');\n    return;\n  }\n  // Get all active columns and sort by index\n  const newColumnsArray = Object.keys(pendingLabelState)\n    // Only include active filters\n    .filter((key) => pendingLabelState[key]?.active)\n    .sort((a, b) => {\n      const pa = pendingLabelState[a];\n      const pb = pendingLabelState[b];\n      if (pa.index !== undefined && pb.index !== undefined) {\n        return pa.index - pb.index; // sort by index\n      }\n      return 0;\n    });\n\n  const timeField = logsFrame.timeField;\n  const bodyField = logsFrame.bodyField;\n\n  if ((timeField && bodyField) || newColumnsArray.length) {\n    const defaultColumns = [];\n    if (timeField?.name) {\n      defaultColumns.push(timeField.name);\n    }\n    if (bodyField?.name) {\n      defaultColumns.push(bodyField.name);\n    }\n\n    // Update url state\n    return newColumnsArray.length ? newColumnsArray : defaultColumns;\n  }\n\n  return [];\n}\n\nexport const useTableColumnContext = () => {\n  return useContext(TableColumnsContext);\n};\n","import React, { createContext, ReactNode, useCallback, useContext, useState } from 'react';\n\nexport type CellIndex = {\n  fieldName?: string;\n  // If the field contains labels (like log line), we need to know which field (line) and which label (e.g. level)\n  subFieldName?: string;\n  index: number | null;\n  numberOfMenuItems?: number;\n};\n\ntype TableCellContextType = {\n  cellIndex: CellIndex;\n  setActiveCellIndex(cellIndex: CellIndex): void;\n};\n\nconst TableCellContext = createContext<TableCellContextType>({\n  cellIndex: { index: null, numberOfMenuItems: 3 },\n  setActiveCellIndex: (cellIndex: CellIndex) => false,\n});\n\nexport const TableCellContextProvider = ({ children }: { children: ReactNode }) => {\n  const [cellActive, setCellActive] = useState<CellIndex>({ index: null });\n\n  const handleCellActive = useCallback((cellIndex: CellIndex) => {\n    setCellActive(cellIndex);\n  }, []);\n\n  return (\n    <TableCellContext.Provider value={{ cellIndex: cellActive, setActiveCellIndex: handleCellActive }}>\n      {children}\n    </TableCellContext.Provider>\n  );\n};\n\nexport const useTableCellContext = () => {\n  return useContext(TableCellContext);\n};\n","import React, { createContext, ReactNode, useCallback, useContext, useState } from 'react';\n\ntype TableHeaderContextType = {\n  isHeaderMenuActive: boolean;\n  setHeaderMenuActive: (isHeaderMenuActive: boolean) => void;\n};\n\nconst TableHeaderContext = createContext<TableHeaderContextType>({\n  isHeaderMenuActive: false,\n  setHeaderMenuActive: (isHeaderMenuActive: boolean) => false,\n});\n\nexport const TableHeaderContextProvider = ({ children }: { children: ReactNode }) => {\n  const [isHeaderMenuActive, setHeaderMenuActive] = useState<boolean>(false);\n\n  const handleisHeaderMenuActive = useCallback((isHeaderMenuActive: boolean) => {\n    setHeaderMenuActive(isHeaderMenuActive);\n  }, []);\n\n  return (\n    <TableHeaderContext.Provider value={{ isHeaderMenuActive, setHeaderMenuActive: handleisHeaderMenuActive }}>\n      {children}\n    </TableHeaderContext.Provider>\n  );\n};\n\nexport const useTableHeaderContext = () => {\n  return useContext(TableHeaderContext);\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Field, Input, useTheme2 } from '@grafana/ui';\n\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { reportInteraction } from '@grafana/runtime';\nimport { debouncedFuzzySearch } from '../../../services/search';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    searchWrap: css({\n      padding: `${theme.spacing(0.4)} 0 ${theme.spacing(0.4)} ${theme.spacing(0.4)}`,\n    }),\n  };\n}\n\ninterface LogsColumnSearchProps {\n  searchValue: string;\n  setSearchValue: (value: string) => void;\n}\nexport function LogsColumnSearch({ searchValue, setSearchValue }: LogsColumnSearchProps) {\n  const { columns, setFilteredColumns } = useTableColumnContext();\n\n  // uFuzzy search dispatcher, adds any matches to the local state\n  const dispatcher = (data: string[][]) => {\n    const matches = data[0];\n    let newColumnsWithMeta: FieldNameMetaStore = {};\n    let numberOfResults = 0;\n    matches.forEach((match) => {\n      if (match in columns) {\n        newColumnsWithMeta[match] = columns[match];\n        numberOfResults++;\n      }\n    });\n    setFilteredColumns(newColumnsWithMeta);\n    searchFilterEvent(numberOfResults);\n  };\n\n  // uFuzzy search\n  const search = (needle: string) => {\n    debouncedFuzzySearch(Object.keys(columns), needle, dispatcher);\n  };\n\n  // onChange handler for search input\n  const onSearchInputChange = (e: React.FormEvent<HTMLInputElement>) => {\n    const value = e.currentTarget?.value;\n    setSearchValue(value);\n    if (value) {\n      search(value);\n    } else {\n      // If the search input is empty, reset the local search state.\n      setFilteredColumns(undefined);\n    }\n  };\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <Field className={styles.searchWrap}>\n      <Input value={searchValue} type={'text'} placeholder={'Search fields by name'} onChange={onSearchInputChange} />\n    </Field>\n  );\n}\n\nfunction searchFilterEvent(searchResultCount: number) {\n  reportInteraction('grafana_logs_app_table_text_search_result_count', {\n    resultCount: searchResultCount,\n  });\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    empty: css({\n      marginBottom: theme.spacing(2),\n      marginLeft: theme.spacing(1.75),\n      fontSize: theme.typography.fontSize,\n    }),\n  };\n}\n\nexport function LogsTableEmptyFields() {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return <div className={styles.empty}>No fields</div>;\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Checkbox, Icon, useTheme2 } from '@grafana/ui';\n\nimport { FieldNameMeta } from '../TableTypes';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    dragIcon: css({\n      cursor: 'drag',\n      marginLeft: theme.spacing(1),\n      opacity: 0.4,\n    }),\n    labelCount: css({\n      marginLeft: theme.spacing(0.5),\n      marginRight: theme.spacing(0.5),\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      fontSize: theme.typography.pxToRem(11),\n      opacity: 0.6,\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'self-end',\n    }),\n    contentWrap: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      width: '100%',\n    }),\n    customWidthWrap: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      cursor: 'pointer',\n    }),\n    // Hide text that overflows, had to select elements within the Checkbox component, so this is a bit fragile\n    checkboxLabel: css({\n      '> span': {\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n        display: 'block',\n        maxWidth: '100%',\n      },\n    }),\n  };\n}\n\nexport function LogsTableNavField(props: {\n  label: string;\n  onChange: () => void;\n  labels: Record<string, FieldNameMeta>;\n  draggable?: boolean;\n  showCount?: boolean;\n  setColumnWidthMap?: (map: Record<string, number>) => void;\n  columnWidthMap?: Record<string, number>;\n}): React.JSX.Element | null {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  if (props.labels[props.label]) {\n    return (\n      <>\n        <div className={styles.contentWrap}>\n          <Checkbox\n            className={styles.checkboxLabel}\n            label={props.label}\n            onChange={props.onChange}\n            checked={props.labels[props.label]?.active ?? false}\n          />\n          {props.showCount && (\n            <div className={styles.labelCount}>\n              <div>{props.labels[props.label]?.percentOfLinesWithLabel}%</div>\n              <div>\n                {props.labels[props.label]?.cardinality}{' '}\n                {props.labels[props.label]?.cardinality === 1 ? 'value' : 'values'}\n              </div>\n            </div>\n          )}\n          {props.columnWidthMap && props.setColumnWidthMap && props.columnWidthMap?.[props.label] !== undefined && (\n            <div\n              onClick={() => {\n                const { [props.label]: omit, ...map } = { ...props.columnWidthMap };\n                props.setColumnWidthMap?.(map);\n              }}\n              title={'Clear column width override'}\n              className={styles.customWidthWrap}\n            >\n              Width: {props.columnWidthMap?.[props.label]}\n              <Icon name={'x'} />\n            </div>\n          )}\n        </div>\n        {props.draggable && (\n          <Icon\n            aria-label=\"Drag and drop icon\"\n            title=\"Drag and drop to reorder\"\n            name=\"draggabledots\"\n            size=\"lg\"\n            className={styles.dragIcon}\n          />\n        )}\n      </>\n    );\n  }\n\n  return null;\n}\n","import React, { ReactElement } from 'react';\nimport { DragDropContext, Draggable, DraggableProvided, Droppable, DropResult } from '@hello-pangea/dnd';\nimport { css, cx } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data/';\nimport { useTheme2 } from '@grafana/ui/';\n\nimport { FieldNameMeta, FieldNameMetaStore } from '../TableTypes';\n\nimport { LogsTableEmptyFields } from './LogsTableEmptyFields';\nimport { LogsTableNavField } from './LogsTableNavField';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\n\nexport function getLogsFieldsStyles(theme: GrafanaTheme2) {\n  return {\n    wrap: css({\n      marginTop: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n      display: 'flex',\n      background: theme.colors.background.primary,\n    }),\n    dragging: css({\n      background: theme.colors.background.secondary,\n    }),\n    columnWrapper: css({\n      marginBottom: theme.spacing(1.5),\n      // need some space or the outline of the checkbox is cut off\n      paddingLeft: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction sortLabels(labels: Record<string, FieldNameMeta>) {\n  return (a: string, b: string) => {\n    const la = labels[a];\n    const lb = labels[b];\n\n    // Sort by index\n    if (la.index != null && lb.index != null) {\n      return la.index - lb.index;\n    }\n\n    // otherwise do not sort\n    return 0;\n  };\n}\n\nexport const LogsTableActiveFields = (props: {\n  labels: Record<string, FieldNameMeta>;\n  valueFilter: (value: string) => boolean;\n  toggleColumn: (columnName: string) => void;\n  reorderColumn: (cols: FieldNameMetaStore, sourceIndex: number, destinationIndex: number) => void;\n  id: string;\n}): ReactElement => {\n  const { columnWidthMap, setColumnWidthMap } = useTableColumnContext();\n  const { reorderColumn, labels, valueFilter, toggleColumn } = props;\n  const theme = useTheme2();\n  const { columns } = useTableColumnContext();\n  const styles = getLogsFieldsStyles(theme);\n  const labelKeys = Object.keys(labels).filter((labelName) => valueFilter(labelName));\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n    reorderColumn(columns, result.source.index, result.destination.index);\n  };\n\n  const renderTitle = (labelName: string) => {\n    const label = labels[labelName];\n    if (label) {\n      return `${labelName} appears in ${label?.percentOfLinesWithLabel}% of log lines`;\n    }\n\n    return undefined;\n  };\n\n  if (labelKeys.length) {\n    return (\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable droppableId=\"order-fields\" direction=\"vertical\">\n          {(provided) => (\n            <div className={styles.columnWrapper} {...provided.droppableProps} ref={provided.innerRef}>\n              {labelKeys.sort(sortLabels(labels)).map((labelName, index) => (\n                <Draggable draggableId={labelName} key={labelName} index={index}>\n                  {(provided: DraggableProvided, snapshot) => (\n                    <div\n                      className={cx(styles.wrap, snapshot.isDragging ? styles.dragging : undefined)}\n                      ref={provided.innerRef}\n                      {...provided.draggableProps}\n                      {...provided.dragHandleProps}\n                      title={renderTitle(labelName)}\n                    >\n                      <LogsTableNavField\n                        setColumnWidthMap={setColumnWidthMap}\n                        columnWidthMap={columnWidthMap}\n                        label={labelName}\n                        onChange={() => toggleColumn(labelName)}\n                        labels={labels}\n                        draggable={true}\n                      />\n                    </div>\n                  )}\n                </Draggable>\n              ))}\n              {provided.placeholder}\n            </div>\n          )}\n        </Droppable>\n      </DragDropContext>\n    );\n  }\n\n  return <LogsTableEmptyFields />;\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { FieldNameMeta } from '../TableTypes';\n\nimport { LogsTableEmptyFields } from './LogsTableEmptyFields';\nimport { LogsTableNavField } from './LogsTableNavField';\n\nconst collator = new Intl.Collator(undefined, { sensitivity: 'base' });\n\nfunction getLogsFieldsStyles(theme: GrafanaTheme2) {\n  return {\n    wrap: css({\n      marginTop: theme.spacing(0.25),\n      marginBottom: theme.spacing(0.25),\n      display: 'flex',\n      background: theme.colors.background.primary,\n      borderBottom: `1px solid ${theme.colors.background.canvas}`,\n    }),\n    dragging: css({\n      background: theme.colors.background.secondary,\n    }),\n    columnWrapper: css({\n      marginBottom: theme.spacing(1.5),\n      // need some space or the outline of the checkbox is cut off\n      paddingLeft: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction sortLabels(labels: Record<string, FieldNameMeta>) {\n  return (a: string, b: string) => {\n    const la = labels[a];\n    const lb = labels[b];\n\n    // ...sort by type and alphabetically\n    if (la != null && lb != null) {\n      return (\n        Number(lb.type === 'TIME_FIELD') - Number(la.type === 'TIME_FIELD') ||\n        Number(lb.type === 'BODY_FIELD') - Number(la.type === 'BODY_FIELD') ||\n        collator.compare(a, b)\n      );\n    }\n\n    // otherwise do not sort\n    return 0;\n  };\n}\n\nexport const LogsTableAvailableFields = (props: {\n  labels: Record<string, FieldNameMeta>;\n  valueFilter: (value: string) => boolean;\n  toggleColumn: (columnName: string) => void;\n}): React.ReactElement => {\n  const { labels, valueFilter, toggleColumn } = props;\n  const theme = useTheme2();\n  const styles = getLogsFieldsStyles(theme);\n  const labelKeys = Object.keys(labels).filter((labelName) => valueFilter(labelName));\n  if (labelKeys.length) {\n    // Otherwise show list with a hardcoded order\n    return (\n      <div className={styles.columnWrapper}>\n        {labelKeys.sort(sortLabels(labels)).map((labelName) => (\n          <div\n            key={labelName}\n            className={styles.wrap}\n            title={`${labelName} appears in ${labels[labelName]?.percentOfLinesWithLabel}% of log lines`}\n          >\n            <LogsTableNavField\n              showCount={true}\n              label={labelName}\n              onChange={() => toggleColumn(labelName)}\n              labels={labels}\n            />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return <LogsTableEmptyFields />;\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { LogsTableActiveFields } from 'Components/Table/ColumnSelection/LogsTableActiveFields';\nimport { LogsTableAvailableFields } from 'Components/Table/ColumnSelection/LogsTableAvailableFields';\n\nimport { FieldNameMeta, FieldNameMetaStore } from '../TableTypes';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    sidebarWrap: css({\n      overflowY: 'scroll',\n      height: 'calc(100% - 50px)',\n      /* Hide scrollbar for Chrome, Safari, and Opera */\n      '&::-webkit-scrollbar': {\n        display: 'none',\n      },\n      /* Hide scrollbar for Firefox */\n      scrollbarWidth: 'none',\n    }),\n    columnHeaderButton: css({\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      fontSize: theme.typography.pxToRem(11),\n    }),\n    columnHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      fontSize: theme.typography.h6.fontSize,\n      background: theme.colors.background.secondary,\n      position: 'sticky',\n      top: 0,\n      left: 0,\n      paddingTop: theme.spacing(0.75),\n      paddingRight: theme.spacing(0.75),\n      paddingBottom: theme.spacing(0.75),\n      paddingLeft: theme.spacing(1.5),\n      zIndex: 3,\n      marginBottom: theme.spacing(2),\n    }),\n  };\n}\n\nexport const LogsTableMultiSelect = (props: {\n  toggleColumn: (columnName: string) => void;\n  filteredColumnsWithMeta: Record<string, FieldNameMeta> | undefined;\n  columnsWithMeta: Record<string, FieldNameMeta>;\n  clear: () => void;\n  reorderColumn: (cols: FieldNameMetaStore, oldIndex: number, newIndex: number) => void;\n}) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  return (\n    <div className={styles.sidebarWrap}>\n      {/* Sidebar columns */}\n      <>\n        <div className={styles.columnHeader}>\n          Selected fields\n          <button onClick={props.clear} className={styles.columnHeaderButton}>\n            Reset\n          </button>\n        </div>\n        <LogsTableActiveFields\n          reorderColumn={props.reorderColumn}\n          toggleColumn={props.toggleColumn}\n          labels={props.filteredColumnsWithMeta ?? props.columnsWithMeta}\n          valueFilter={(value) => props.columnsWithMeta[value]?.active ?? false}\n          id={'selected-fields'}\n        />\n\n        <div className={styles.columnHeader}>Fields</div>\n        <LogsTableAvailableFields\n          toggleColumn={props.toggleColumn}\n          labels={props.filteredColumnsWithMeta ?? props.columnsWithMeta}\n          valueFilter={(value) => !props.columnsWithMeta[value]?.active}\n        />\n      </>\n    </div>\n  );\n};\n","import React, { useState } from 'react';\n\nimport { ClickOutsideWrapper } from '@grafana/ui';\n\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { LogsColumnSearch } from 'Components/Table/ColumnSelection/LogsColumnSearch';\nimport { LogsTableMultiSelect } from 'Components/Table/ColumnSelection/LogsTableMultiSelect';\n\nimport { FieldNameMetaStore } from '../TableTypes';\nimport { reportInteraction } from '@grafana/runtime';\nimport { logger } from '../../../services/logger';\n\nexport function getReorderColumn(setColumns: (cols: FieldNameMetaStore) => void) {\n  return (columns: FieldNameMetaStore, sourceIndex: number, destinationIndex: number) => {\n    if (sourceIndex === destinationIndex) {\n      return;\n    }\n\n    const pendingLabelState = { ...columns };\n    const keys = Object.keys(pendingLabelState)\n      .filter((key) => pendingLabelState[key].active)\n      .map((key) => ({\n        fieldName: key,\n        index: pendingLabelState[key].index ?? 0,\n      }))\n      .sort((a, b) => a.index - b.index);\n\n    const [source] = keys.splice(sourceIndex, 1);\n    keys.splice(destinationIndex, 0, source);\n\n    keys\n      .filter((key) => key !== undefined)\n      .forEach((key, index) => {\n        pendingLabelState[key.fieldName].index = index;\n      });\n\n    // Set local state\n    setColumns(pendingLabelState);\n  };\n}\n\nfunction logError(columnName: string, columns: FieldNameMetaStore) {\n  let logContext;\n  try {\n    logContext = {\n      columns: JSON.stringify(columns),\n      columnName: columnName,\n    };\n  } catch (e) {\n    logContext = {\n      msg: 'Table: ColumnSelectionDrawerWrap failed to encode context',\n      columnName: columnName,\n    };\n  }\n  logger.warn('failed to get column', logContext);\n}\n\nexport function ColumnSelectionDrawerWrap() {\n  const { columns, setColumns, setVisible, filteredColumns, setFilteredColumns } = useTableColumnContext();\n  const [searchValue, setSearchValue] = useState<string>('');\n  const toggleColumn = (columnName: string) => {\n    if (!columns || !(columnName in columns)) {\n      logError(columnName, columns);\n      return;\n    }\n\n    const length = Object.keys(columns).filter((c) => columns[c].active).length;\n    const isActive = !columns[columnName].active ? true : undefined;\n\n    let pendingLabelState: FieldNameMetaStore;\n    if (isActive) {\n      pendingLabelState = {\n        ...columns,\n        [columnName]: {\n          ...columns[columnName],\n          active: isActive,\n          index: length,\n        },\n      };\n    } else {\n      pendingLabelState = {\n        ...columns,\n        [columnName]: {\n          ...columns[columnName],\n          active: false,\n          index: undefined,\n        },\n      };\n    }\n\n    // Analytics\n    columnFilterEvent(columnName);\n\n    // Set local state\n    setColumns(pendingLabelState);\n\n    // If user is currently filtering, update filtered state\n    if (filteredColumns) {\n      const active = !filteredColumns[columnName]?.active;\n      let pendingFilteredLabelState: FieldNameMetaStore;\n      if (active) {\n        pendingFilteredLabelState = {\n          ...filteredColumns,\n          [columnName]: {\n            ...filteredColumns[columnName],\n            active: active,\n            index: length,\n          },\n        };\n      } else {\n        pendingFilteredLabelState = {\n          ...filteredColumns,\n          [columnName]: {\n            ...filteredColumns[columnName],\n            active: false,\n            index: undefined,\n          },\n        };\n      }\n\n      setFilteredColumns(pendingFilteredLabelState);\n      setSearchValue('');\n    }\n  };\n\n  const reorderColumn = getReorderColumn(setColumns);\n\n  const clearSelection = () => {\n    const pendingLabelState = { ...columns };\n    let index = 0;\n    Object.keys(pendingLabelState).forEach((key) => {\n      const isDefaultField =\n        pendingLabelState[key].type === 'BODY_FIELD' || pendingLabelState[key].type === 'TIME_FIELD';\n      // after reset the only active fields are the special time and body fields\n      pendingLabelState[key].active = isDefaultField;\n      // reset the index\n      pendingLabelState[key].index = isDefaultField ? index++ : undefined;\n    });\n\n    setColumns(pendingLabelState);\n    setFilteredColumns(pendingLabelState);\n    setSearchValue('');\n  };\n\n  // Tracking event for filtering columns\n  function columnFilterEvent(columnName: string) {\n    if (columns) {\n      const newState = !columns[columnName]?.active;\n      const priorActiveCount = Object.keys(columns).filter((column) => columns[column]?.active)?.length;\n      const event = {\n        columnAction: newState ? 'add' : 'remove',\n        columnCount: newState ? priorActiveCount + 1 : priorActiveCount - 1,\n      };\n      reportInteraction('grafana_logs_app_table_column_filter_clicked', event);\n    }\n  }\n\n  return (\n    <ClickOutsideWrapper\n      onClick={() => {\n        setVisible(false);\n        setFilteredColumns(columns);\n        setSearchValue('');\n      }}\n      useCapture={true}\n    >\n      <LogsColumnSearch searchValue={searchValue} setSearchValue={setSearchValue} />\n      <LogsTableMultiSelect\n        toggleColumn={toggleColumn}\n        filteredColumnsWithMeta={filteredColumns}\n        columnsWithMeta={columns}\n        clear={clearSelection}\n        reorderColumn={reorderColumn}\n      />\n    </ClickOutsideWrapper>\n  );\n}\n","import React, { PropsWithChildren } from 'react';\nimport { css, cx } from '@emotion/css';\n\nimport { Field, GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\n\ninterface DefaultCellWrapComponentProps {}\n\ninterface Props extends PropsWithChildren<DefaultCellWrapComponentProps> {\n  rowIndex: number;\n  field: Field;\n  onClick?: () => void;\n  onMouseIn?: () => void;\n  onMouseOut?: () => void;\n}\n\nconst getStyles = (theme: GrafanaTheme2, bgColor?: string, numberOfMenuItems?: number) => ({\n  active: css({\n    // Save 20px for context menu\n    height: `calc(${100}% + 36px)`,\n    zIndex: theme.zIndex.tooltip,\n    background: 'transparent',\n  }),\n  wrap: css({\n    position: 'absolute',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    height: '100%',\n    left: 0,\n    top: 0,\n    margin: 'auto',\n    background: bgColor ?? 'transparent',\n  }),\n});\n\nexport const DefaultCellWrapComponent = (props: Props) => {\n  return (\n    <CellWrapInnerComponent\n      onMouseOut={props.onMouseOut}\n      onMouseIn={props.onMouseIn}\n      onClick={props.onClick}\n      field={props.field}\n      rowIndex={props.rowIndex}\n    >\n      {props.children}\n    </CellWrapInnerComponent>\n  );\n};\n\nconst CellWrapInnerComponent = (props: Props) => {\n  const theme = useTheme2();\n  const cellState = useTableCellContext();\n  const styles = getStyles(theme, undefined, cellState.cellIndex?.numberOfMenuItems);\n\n  return (\n    <div\n      onMouseLeave={props.onMouseOut}\n      onMouseEnter={props.onMouseIn}\n      onClick={props.onClick}\n      className={\n        cellState.cellIndex.index === props.rowIndex && cellState.cellIndex.fieldName === props.field.name\n          ? cx(styles.wrap, styles.active)\n          : styles.wrap\n      }\n    >\n      {props.children}\n    </div>\n  );\n};\n","import React, { createContext, ReactNode, useContext } from 'react';\nimport { LogsFrame } from '../../../services/logsFrame';\nimport { AdHocVariableFilter, TimeRange } from '@grafana/data';\nimport { SelectedTableRow } from '../LogLineCellComponent';\n\nexport type Label = { name: string; values: string[]; indexed: boolean };\n\nexport type QueryContextType = {\n  logsFrame: LogsFrame | null;\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n};\n\nexport const initialState = {\n  logsFrame: null,\n  addFilter: (filter: AdHocVariableFilter) => {},\n  timeRange: undefined,\n  selectedLine: undefined,\n};\n\nexport const QueryContext = createContext<QueryContextType>(initialState);\n\nexport const QueryContextProvider = ({\n  children,\n  logsFrame,\n  addFilter,\n  selectedLine,\n  timeRange,\n}: {\n  children: ReactNode;\n  logsFrame: LogsFrame;\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n}) => {\n  return (\n    <QueryContext.Provider\n      value={{\n        logsFrame,\n        addFilter,\n        selectedLine,\n        timeRange,\n      }}\n    >\n      {children}\n    </QueryContext.Provider>\n  );\n};\n\nexport const useQueryContext = () => {\n  return useContext(QueryContext);\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2, LinkModel } from '@grafana/data';\nimport { Icon, useTheme2 } from '@grafana/ui';\nimport { useQueryContext } from './Context/QueryContext';\nimport { FilterOp } from 'services/filters';\n\ninterface Props {\n  fieldType?: 'derived';\n  label: string;\n  value: string;\n  showColumn?: () => void;\n  links?: LinkModel[];\n  pillType: 'logPill' | 'column';\n}\n\nconst getStyles = (theme: GrafanaTheme2, pillType: 'logPill' | 'column') => ({\n  menu: css({\n    position: 'relative',\n    paddingRight: '5px',\n    display: 'flex',\n    minWidth: '60px',\n    justifyContent: 'flex-start',\n  }),\n  menuItemsWrap: css({\n    boxShadow: theme.shadows.z3,\n    display: 'flex',\n    background: theme.colors.background.secondary,\n    padding: '5px 0',\n    marginLeft: pillType === 'column' ? '5px' : undefined,\n  }),\n  menuItem: css({\n    overflow: 'auto',\n    textOverflow: 'ellipsis',\n    cursor: 'pointer',\n    paddingLeft: '5px',\n    paddingRight: '5px',\n    display: 'flex',\n    alignItems: 'center',\n  }),\n});\n\nexport const CellContextMenu = (props: Props) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.pillType);\n  const { addFilter } = useQueryContext();\n\n  return (\n    <span className={styles.menu}>\n      <span className={styles.menuItemsWrap}>\n        {props.fieldType !== 'derived' && (\n          <>\n            <div\n              className={styles.menuItem}\n              onClick={() => {\n                addFilter({\n                  key: props.label,\n                  value: props.value,\n                  operator: FilterOp.Equal,\n                });\n              }}\n            >\n              <Icon title={'Add to search'} size={'md'} name={'plus-circle'} />\n            </div>\n            <div\n              className={styles.menuItem}\n              onClick={() => {\n                addFilter({\n                  key: props.label,\n                  value: props.value,\n                  operator: FilterOp.NotEqual,\n                });\n              }}\n            >\n              <Icon title={'Exclude from search'} size={'md'} name={'minus-circle'} />\n            </div>\n          </>\n        )}\n\n        {props.showColumn && (\n          <div title={'Add column'} onClick={props.showColumn} className={styles.menuItem}>\n            <svg width=\"18\" height=\"16\" viewBox=\"0 0 18 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path\n                fillRule=\"evenodd\"\n                clipRule=\"evenodd\"\n                d=\"M1.38725 1.33301H13.3872C13.5641 1.33301 13.7336 1.40325 13.8587 1.52827C13.9837 1.65329 14.0539 1.82286 14.0539 1.99967V2.33333C14.0539 2.70152 13.7554 3 13.3872 3H13.0542C12.87 3 12.7206 2.85062 12.7206 2.66634H8.05391V13.333H12.7206C12.7206 13.1491 12.8697 13 13.0536 13H13.3872C13.7554 13 14.0539 13.2985 14.0539 13.6667V13.9997C14.0539 14.1765 13.9837 14.3461 13.8587 14.4711C13.7336 14.5961 13.5641 14.6663 13.3872 14.6663H1.38725C1.21044 14.6663 1.04087 14.5961 0.915843 14.4711C0.790819 14.3461 0.720581 14.1765 0.720581 13.9997V1.99967C0.720581 1.82286 0.790819 1.65329 0.915843 1.52827C1.04087 1.40325 1.21044 1.33301 1.38725 1.33301ZM2.05391 13.333H6.72058V2.66634H2.05391V13.333Z\"\n                fill=\"#CCCCDC\"\n                fillOpacity=\"1\"\n              />\n              <path\n                d=\"M13.8538 7.19999H16.2538C16.466 7.19999 16.6695 7.28429 16.8195 7.4343C16.9696 7.58432 17.0538 7.78783 17.0538 7.99999C17.0538 8.21214 16.9696 8.41566 16.8195 8.56567C16.6695 8.71569 16.466 8.79999 16.2538 8.79999H13.8538V11.2C13.8538 11.4121 13.7696 11.6156 13.6195 11.7657C13.4695 11.9157 13.266 12 13.0538 12C12.8416 12 12.6382 11.9157 12.4881 11.7657C12.3381 11.6156 12.2538 11.4121 12.2538 11.2V8.79999H9.85384C9.64165 8.79999 9.43819 8.71569 9.28815 8.56567C9.13811 8.41566 9.05383 8.21214 9.05383 7.99999C9.05383 7.78783 9.13811 7.58432 9.28815 7.4343C9.43819 7.28429 9.64165 7.19999 9.85384 7.19999H12.2538V4.8C12.2538 4.58784 12.3381 4.38433 12.4881 4.23431C12.6382 4.0843 12.8416 4 13.0538 4C13.266 4 13.4695 4.0843 13.6195 4.23431C13.7696 4.38433 13.8538 4.58784 13.8538 4.8V7.19999Z\"\n                fill=\"#CCCCDC\"\n                fillOpacity=\"1\"\n              />\n            </svg>\n          </div>\n        )}\n\n        {props.links &&\n          props.links.map((link) => {\n            return (\n              <div\n                className={styles.menuItem}\n                onClick={() => {\n                  window.open(link.href, '_blank');\n                }}\n                key={link.href}\n              >\n                <Icon title={link.title ?? 'Link'} key={link.href} size={'md'} name={'link'} />\n              </div>\n            );\n          })}\n      </span>\n    </span>\n  );\n};\n","export const LEVEL_NAME = 'detected_level';\n","import React, { ReactElement } from 'react';\nimport { css, cx } from '@emotion/css';\n\nimport { Field, FieldType, GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { CellContextMenu } from 'Components/Table/CellContextMenu';\nimport { getFieldMappings } from 'Components/Table/Table';\nimport { LEVEL_NAME } from './constants';\n\ninterface DefaultPillProps {\n  label: string;\n  showColumns?: () => void;\n  value: string | unknown | ReactElement;\n  rowIndex: number;\n  field: Field;\n}\n\nconst getStyles = (theme: GrafanaTheme2, levelColor?: string) => ({\n  activePillWrap: css({}),\n  pillWrap: css({\n    width: '100%',\n  }),\n  pill: css({\n    border: `1px solid ${theme.colors.border.weak}`,\n    '&:hover': {\n      border: `1px solid ${theme.colors.border.strong}`,\n    },\n    marginRight: '5px',\n    marginTop: '4px',\n    marginLeft: '5px',\n    padding: '2px 5px',\n    position: 'relative',\n    display: 'inline-flex',\n    flexDirection: 'row-reverse',\n    backgroundColor: 'transparent',\n\n    paddingLeft: levelColor ? `${theme.spacing(0.75)}` : `2px`,\n\n    '&:before': {\n      content: '\"\"',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      height: '100%',\n      width: `${theme.spacing(0.25)}`,\n      backgroundColor: levelColor,\n    },\n  }),\n  menu: css({\n    width: '100%',\n  }),\n  menuItem: css({\n    overflow: 'auto',\n    textOverflow: 'ellipsis',\n  }),\n  menuItemText: css({\n    width: '65px',\n    display: 'inline-block',\n  }),\n});\nexport const DefaultPill = (props: DefaultPillProps) => {\n  const { label, value } = props;\n  const theme = useTheme2();\n  const { cellIndex } = useTableCellContext();\n  let levelColor;\n\n  if (label === LEVEL_NAME) {\n    const mappings = getFieldMappings().options;\n    if (typeof value === 'string' && value in mappings) {\n      levelColor = mappings[value].color;\n    }\n  }\n\n  const isPillActive = cellIndex.index === props.rowIndex && props.field.name === cellIndex.fieldName;\n\n  const styles = getStyles(theme, levelColor);\n  return (\n    <div className={cx(styles.pillWrap, isPillActive ? styles.activePillWrap : undefined)}>\n      {!!value && (\n        <>\n          <span className={styles.pill}>\n            <>{value}</>\n          </span>\n          {isPillActive && typeof value === 'string' && props.field.type !== FieldType.time && (\n            <CellContextMenu label={props.label} value={value} pillType={'column'} />\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n","import { ClipboardButton, IconButton, Modal, useTheme2 } from '@grafana/ui';\nimport React, { useState } from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { SelectedTableRow } from 'Components/Table/LogLineCellComponent';\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { testIds } from '../../services/testIds';\nimport { locationService } from '@grafana/runtime';\n\nexport enum UrlParameterType {\n  SelectedLine = 'selectedLine',\n  From = 'from',\n  To = 'to',\n}\n\nexport const getStyles = (theme: GrafanaTheme2, bgColor?: string) => ({\n  clipboardButton: css({\n    padding: 0,\n    height: '100%',\n    lineHeight: '1',\n    width: '20px',\n  }),\n  inspectButton: css({\n    display: 'inline-flex',\n    verticalAlign: 'middle',\n    margin: 0,\n    overflow: 'hidden',\n    borderRadius: '5px',\n  }),\n  iconWrapper: css({\n    height: '35px',\n    position: 'sticky',\n    left: 0,\n    display: 'flex',\n    background: theme.colors.background.secondary,\n    padding: `0 ${theme.spacing(0.5)}`,\n    zIndex: 1,\n    boxShadow: theme.shadows.z2,\n  }),\n  inspect: css({\n    padding: '5px 3px',\n\n    '&:hover': {\n      color: theme.colors.text.link,\n      cursor: 'pointer',\n    },\n  }),\n});\nexport function LineActionIcons(props: { rowIndex: number; value: unknown }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const { logsFrame, timeRange } = useQueryContext();\n  const logId = logsFrame?.idField?.values[props.rowIndex];\n  const lineValue = logsFrame?.bodyField.values[props.rowIndex];\n  const [isInspecting, setIsInspecting] = useState(false);\n  return (\n    <>\n      <div className={styles.iconWrapper}>\n        <div className={styles.inspect}>\n          <IconButton\n            data-testid={testIds.table.inspectLine}\n            className={styles.inspectButton}\n            tooltip=\"View log line\"\n            variant=\"secondary\"\n            aria-label=\"View log line\"\n            tooltipPlacement=\"top\"\n            size=\"md\"\n            name=\"eye\"\n            onClick={() => setIsInspecting(true)}\n            tabIndex={0}\n          />\n        </div>\n        <div className={styles.inspect}>\n          <ClipboardButton\n            className={styles.clipboardButton}\n            icon=\"share-alt\"\n            variant=\"secondary\"\n            fill=\"text\"\n            size=\"md\"\n            tooltip=\"Copy link to log line\"\n            tooltipPlacement=\"top\"\n            tabIndex={0}\n            getText={() => {\n              const location = locationService.getLocation();\n              const searchParams = new URLSearchParams(location.search);\n              if (searchParams && timeRange) {\n                const selectedLine: SelectedTableRow = {\n                  row: props.rowIndex,\n                  id: logId,\n                };\n\n                searchParams.set(UrlParameterType.From, timeRange.from.toISOString());\n                searchParams.set(UrlParameterType.To, timeRange.to.toISOString());\n                searchParams.set(UrlParameterType.SelectedLine, JSON.stringify(selectedLine));\n\n                // @todo can encoding + as %20 break other stuff? Can label names or values have + in them that we don't want encoded? Should we just update values?\n                // + encoding for whitespace is for application/x-www-form-urlencoded, which appears to be the default encoding for URLSearchParams, replacing + with %20 to keep urls meant for the browser from breaking\n                const searchString = searchParams.toString().replace(/\\+/g, '%20');\n                return window.location.origin + location.pathname + '?' + searchString;\n              }\n              return '';\n            }}\n          />\n        </div>\n      </div>\n      <>\n        {isInspecting && (\n          <Modal onDismiss={() => setIsInspecting(false)} isOpen={true} title=\"Inspect value\">\n            <pre>{lineValue}</pre>\n            <Modal.ButtonRow>\n              <ClipboardButton icon=\"copy\" getText={() => props.value as string}>\n                Copy to Clipboard\n              </ClipboardButton>\n            </Modal.ButtonRow>\n          </Modal>\n        )}\n      </>\n    </>\n  );\n}\n","import React, { ReactElement } from 'react';\nimport { Row } from 'react-table';\nimport { css } from '@emotion/css';\n\nimport { FieldType, formattedValueToString, GrafanaTheme2 } from '@grafana/data';\nimport { CustomCellRendererProps, DataLinksContextMenu, getCellLinks, useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { DefaultCellWrapComponent } from 'Components/Table/DefaultCellWrapComponent';\nimport { DefaultPill } from 'Components/Table/DefaultPill';\nimport { LineActionIcons } from 'Components/Table/LineActionIcons';\n\nconst getStyles = (theme: GrafanaTheme2, fieldType?: FieldType) => ({\n  flexWrap: css({\n    display: 'flex',\n    alignItems: 'flex-start',\n    flexDirection: fieldType === FieldType.number ? 'row-reverse' : 'row',\n    textAlign: fieldType === FieldType.number ? 'right' : 'left',\n  }),\n  content: css({\n    position: 'relative',\n    overflow: 'hidden',\n    display: 'flex',\n    height: '100%',\n  }),\n  linkWrapper: css({\n    color: theme.colors.text.link,\n    marginTop: '7px',\n    marginLeft: '7px',\n    '&:hover': {\n      textDecoration: 'underline',\n    },\n  }),\n});\n\ninterface DefaultCellComponentCustomProps {\n  fieldIndex: number;\n}\nexport const DefaultCellComponent = (props: CustomCellRendererProps & DefaultCellComponentCustomProps) => {\n  let value = props.value;\n  const field = props.field;\n  const displayValue = field.display!(value);\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.field.type);\n  const { setVisible } = useTableColumnContext();\n  const { cellIndex, setActiveCellIndex } = useTableCellContext();\n\n  // We don't get back the full react.table row here, but the calling function only uses the index, which are in `CustomCellRendererProps`\n  const row = { index: props.rowIndex } as Row;\n  const hasLinks = Boolean(getCellLinks(props.field, row)?.length);\n\n  if (value === null) {\n    return <></>;\n  }\n\n  if (React.isValidElement(props.value)) {\n    value = props.value;\n  } else if (typeof value === 'object') {\n    value = JSON.stringify(props.value);\n  } else {\n    value = formattedValueToString(displayValue);\n  }\n\n  const renderValue = (value: string | unknown | ReactElement, label: string) => {\n    return (\n      <DefaultPill\n        field={props.field}\n        rowIndex={props.rowIndex}\n        showColumns={() => setVisible(true)}\n        label={label}\n        value={value}\n      />\n    );\n  };\n\n  return (\n    <DefaultCellWrapComponent\n      onClick={() => {\n        if (props.rowIndex === cellIndex.index && props.field.name === cellIndex.fieldName) {\n          return setActiveCellIndex({ index: null });\n        }\n        return setActiveCellIndex({ index: props.rowIndex, fieldName: props.field.name, numberOfMenuItems: 3 });\n      }}\n      field={props.field}\n      rowIndex={props.rowIndex}\n    >\n      <div className={styles.content}>\n        {props.fieldIndex === 0 && <LineActionIcons value={value} rowIndex={props.rowIndex} />}\n        <div className={styles.flexWrap}></div>\n\n        {!hasLinks && renderValue(value, field.name)}\n\n        {hasLinks && field.getLinks && (\n          <DataLinksContextMenu links={() => getCellLinks(field, row) ?? []}>\n            {(api) => {\n              if (api.openMenu) {\n                return (\n                  <div className={styles.linkWrapper} onClick={api.openMenu}>\n                    <>{value}</>\n                  </div>\n                );\n              } else {\n                return (\n                  <div className={styles.linkWrapper}>\n                    <>{value}</>\n                  </div>\n                );\n              }\n            }}\n          </DataLinksContextMenu>\n        )}\n      </div>\n    </DefaultCellWrapComponent>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { Row } from 'react-table';\nimport { css, cx } from '@emotion/css';\n\nimport { DataFrame, Field, FieldType, getLinksSupplier, GrafanaTheme2, LinkModel } from '@grafana/data';\nimport { getCellLinks, useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { CellContextMenu } from 'Components/Table/CellContextMenu';\nimport { getFieldMappings } from 'Components/Table/Table';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { LEVEL_NAME } from './constants';\n\ninterface LogLinePillProps {\n  originalField?: Field;\n  field?: Field;\n  columns: FieldNameMetaStore;\n  label: string;\n  showColumns: () => void;\n  rowIndex: number;\n  frame: DataFrame;\n  originalFrame: DataFrame | undefined;\n  isDerivedField: boolean;\n  value: string;\n}\n\nconst getStyles = (theme: GrafanaTheme2, levelColor?: string) => ({\n  pill: css({\n    flex: '0 1 auto',\n    marginLeft: theme.spacing(0.5),\n    marginRight: theme.spacing(0.5),\n    padding: `${theme.spacing(0.25)} ${theme.spacing(0.25)}`,\n    position: 'relative',\n    display: 'inline-flex',\n    flexDirection: 'column',\n    marginTop: theme.spacing(0.5),\n  }),\n  activePill: css({}),\n  valueWrap: css({\n    border: `1px solid ${theme.colors.background.secondary}`,\n    boxShadow: `-2px 2px 5px 0px ${theme.colors.background.secondary}`,\n    backgroundColor: 'transparent',\n    cursor: 'pointer',\n    position: 'relative',\n\n    paddingRight: `${theme.spacing(0.5)}`,\n    paddingLeft: levelColor ? `${theme.spacing(0.75)}` : `${theme.spacing(0.5)}`,\n\n    '&:before': {\n      content: '\"\"',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      height: '100%',\n      width: `${theme.spacing(0.25)}`,\n      backgroundColor: levelColor,\n    },\n\n    '&:hover': {\n      border: `1px solid ${theme.colors.border.strong}`,\n    },\n  }),\n});\n\nfunction LogLinePillValue(props: {\n  fieldType?: 'derived';\n  onClick: () => void;\n  label: string;\n  value: string;\n  menuActive: boolean;\n  onClickAdd: () => void;\n  links?: LinkModel[];\n}) {\n  const theme = useTheme2();\n\n  let levelColor;\n  if (props.label === LEVEL_NAME) {\n    const mappings = getFieldMappings().options;\n    if (props.value in mappings) {\n      levelColor = mappings[props.value].color;\n    }\n  }\n\n  const styles = getStyles(theme, levelColor);\n\n  return (\n    <span className={cx(styles.pill, props.menuActive ? styles.activePill : undefined)} onClick={props.onClick}>\n      <span className={styles.valueWrap}>\n        {props.label}={props.value}\n      </span>\n      {props.menuActive && (\n        <CellContextMenu\n          pillType={'logPill'}\n          fieldType={props.fieldType}\n          links={props.links}\n          label={props.label}\n          value={props.value}\n          showColumn={props.onClickAdd}\n        />\n      )}\n    </span>\n  );\n}\n\nexport const LogLinePill = (props: LogLinePillProps) => {\n  const { label } = props;\n  const { cellIndex, setActiveCellIndex } = useTableCellContext();\n  const { columns, setColumns } = useTableColumnContext();\n  const value = props.value;\n  const templateSrv = getTemplateSrv();\n  const replace = useMemo(() => templateSrv.replace.bind(templateSrv), [templateSrv]);\n\n  // Need untransformed frame for links?\n  const field = props.field;\n\n  if (!field || field?.type === FieldType.other) {\n    return null;\n  }\n  const row = { index: props.rowIndex } as Row;\n\n  if (props.originalField && props.isDerivedField && props.originalFrame) {\n    props.originalField.getLinks = getLinksSupplier(props.originalFrame, props.originalField, {}, replace);\n  }\n\n  const links = props.originalField && getCellLinks(props.originalField, row);\n\n  /**\n   * This Could be moved?\n   * Callback called by the pill context menu\n   * @param fieldName\n   */\n  const addFieldToColumns = (fieldName: string) => {\n    const pendingColumns = { ...columns };\n\n    const length = Object.keys(columns).filter((c) => columns[c].active).length;\n    if (pendingColumns[fieldName].active) {\n      pendingColumns[fieldName].active = false;\n      pendingColumns[fieldName].index = undefined;\n    } else {\n      pendingColumns[fieldName].active = true;\n      pendingColumns[fieldName].index = length;\n    }\n\n    setColumns(pendingColumns);\n  };\n\n  return (\n    <LogLinePillValue\n      onClick={() => {\n        if (\n          props.rowIndex === cellIndex.index &&\n          field.name === cellIndex.fieldName &&\n          label === cellIndex.subFieldName\n        ) {\n          return setActiveCellIndex({ index: null });\n        }\n\n        return setActiveCellIndex({\n          index: props.rowIndex,\n          fieldName: field.name,\n          subFieldName: label,\n          numberOfMenuItems: props.isDerivedField ? 2 : 3,\n        });\n      }}\n      menuActive={\n        cellIndex.index === props.rowIndex && cellIndex.fieldName === field.name && cellIndex.subFieldName === label\n      }\n      fieldType={props.isDerivedField ? 'derived' : undefined}\n      label={label}\n      value={value}\n      onClickAdd={() => addFieldToColumns(label)}\n      links={links}\n    />\n  );\n};\n","import { Icon, useTheme2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  scroller: css`\n    position: absolute;\n    right: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 20px;\n    top: 32px;\n    margin-top: -24px;\n    // For some reason clicking on this button causes text to be selected in the following row\n    user-select: none;\n  `,\n  scrollLeft: css`\n    cursor: pointer;\n    background: ${theme.colors.background.primary};\n\n    &:hover {\n      background: ${theme.colors.background.secondary};\n    }\n  `,\n  scrollRight: css`\n    cursor: pointer;\n    background: ${theme.colors.background.primary};\n\n    &:hover {\n      background: ${theme.colors.background.secondary};\n    }\n  `,\n});\n\nconst stopScroll = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    left: id.current?.scrollLeft,\n  });\n};\n\nconst goLeft = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    top: 0,\n    left: 0,\n    behavior: 'smooth',\n  });\n};\n\nconst goRight = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    top: 0,\n    left: id.current.scrollWidth,\n    behavior: 'smooth',\n  });\n};\n\nexport function Scroller({ scrollerRef: ref }: { scrollerRef: React.MutableRefObject<HTMLDivElement | null> }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <div className={styles.scroller}>\n      <span onPointerDown={() => goLeft(ref)} onPointerUp={() => stopScroll(ref)} className={styles.scrollLeft}>\n        <Icon name={'arrow-left'} />\n      </span>\n      <span onPointerDown={() => goRight(ref)} onPointerUp={() => stopScroll(ref)} className={styles.scrollRight}>\n        <Icon name={'arrow-right'} />\n      </span>\n    </div>\n  );\n}\n","import React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { useTheme2 } from '@grafana/ui';\n\nexport function RawLogLineText(props: { value: unknown }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <div className={styles.rawLogLine}>\n      <>{props.value}</>\n    </div>\n  );\n}\n\nexport const getStyles = (theme: GrafanaTheme2, bgColor?: string) => ({\n  rawLogLine: css({\n    fontFamily: theme.typography.fontFamilyMonospace,\n    height: '35px',\n    lineHeight: '35px',\n    paddingRight: theme.spacing(1.5),\n    paddingLeft: theme.spacing(1),\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import React, { useRef, useState } from 'react';\nimport { ScrollSyncPane } from 'react-scroll-sync';\n\nimport { FieldType, formattedValueToString, GrafanaTheme2, Labels } from '@grafana/data';\nimport { CustomCellRendererProps, useTheme2 } from '@grafana/ui';\n\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { LogLineState, useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { DefaultCellWrapComponent } from 'Components/Table/DefaultCellWrapComponent';\nimport { LogLinePill } from 'Components/Table/LogLinePill';\nimport { Scroller } from 'Components/Table/Scroller';\nimport { css } from '@emotion/css';\nimport { LineActionIcons } from 'Components/Table/LineActionIcons';\nimport { RawLogLineText } from 'Components/Table/RawLogLineText';\nimport { getBodyName } from '../../services/logsFrame';\nimport { LEVEL_NAME } from './constants';\n\nexport type SelectedTableRow = {\n  row: number;\n  id: string;\n};\n\ninterface Props extends CustomCellRendererProps {\n  labels: Labels;\n  fieldIndex: number;\n}\nexport const LogLineCellComponent = (props: Props) => {\n  let value = props.value;\n  const field = props.field;\n  const displayValue = field.display!(value);\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const { columns, setVisible, bodyState } = useTableColumnContext();\n  const { logsFrame } = useQueryContext();\n  const [isHover, setIsHover] = useState(false);\n  const ref = useRef<HTMLDivElement | null>(null);\n\n  if (React.isValidElement(props.value)) {\n    value = props.value;\n  } else if (typeof value === 'object') {\n    value = JSON.stringify(props.value);\n  } else {\n    value = formattedValueToString(displayValue);\n  }\n\n  /**\n   * Render labels as log line pills\n   * @param labels Label[]\n   */\n  const renderLabels = (labels: Labels) => {\n    const columnLabelNames = Object.keys(columns);\n    const labelNames = columnLabelNames\n      .filter((name) => name !== getBodyName(logsFrame))\n      .sort((a, b) => {\n        // Sort level first\n        if (a === LEVEL_NAME) {\n          return -1;\n        }\n        if (b === LEVEL_NAME) {\n          return 1;\n        }\n        // Then sort links\n        if (columns[a].type === 'LINK_FIELD') {\n          return -1;\n        }\n        if (columns[b].type === 'LINK_FIELD') {\n          return 1;\n        }\n\n        // Finally sort fields by cardinality descending\n        return columns[a].cardinality > columns[b].cardinality ? -1 : 1;\n      });\n\n    const filteredLabels = labelNames.filter(\n      (label) =>\n        // Not already visible in another column\n        !columns[label].active &&\n        // And the cardinality is greater than 1\n        columns[label].cardinality > 1\n    );\n\n    return filteredLabels\n      .map((label) => {\n        const labelValue = labels[label];\n        const untransformedField = logsFrame?.raw?.fields.find((field) => field.name === label);\n        const rawValue = field?.values[props.rowIndex];\n        const isDerived = !labelValue && !!rawValue;\n\n        // If we have a label value, the field is not derived\n        if (labelValue) {\n          return (\n            <LogLinePill\n              originalFrame={undefined}\n              field={field}\n              columns={columns}\n              rowIndex={props.rowIndex}\n              frame={props.frame}\n              showColumns={() => setVisible(true)}\n              key={label}\n              label={label}\n              isDerivedField={false}\n              value={labelValue}\n            />\n          );\n        }\n\n        // Otherwise, the field might be derived\n        if (isDerived && untransformedField?.name) {\n          const untransformedValue = untransformedField?.values[props.rowIndex];\n          if (untransformedField?.type === FieldType.string && untransformedValue) {\n            return (\n              <LogLinePill\n                originalFrame={logsFrame?.raw}\n                originalField={untransformedField}\n                field={field}\n                value={untransformedValue}\n                columns={columns}\n                rowIndex={props.rowIndex}\n                frame={props.frame}\n                showColumns={() => setVisible(true)}\n                key={untransformedField.name}\n                label={untransformedField.name}\n                isDerivedField={true}\n              />\n            );\n          }\n        }\n\n        return null;\n      })\n      .filter((v) => v);\n  };\n\n  const labels = renderLabels(props.labels);\n  const isAuto = bodyState === LogLineState.auto;\n  const hasLabels = labels.length > 0;\n\n  return (\n    <DefaultCellWrapComponent\n      onMouseIn={() => {\n        setIsHover(true);\n      }}\n      onMouseOut={() => {\n        setIsHover(false);\n      }}\n      rowIndex={props.rowIndex}\n      field={props.field}\n    >\n      <ScrollSyncPane innerRef={ref} group=\"horizontal\">\n        <div className={styles.content}>\n          {/* First Field gets the icons */}\n          {props.fieldIndex === 0 && <LineActionIcons rowIndex={props.rowIndex} value={value} />}\n          {/* Labels */}\n          {isAuto && hasLabels && <>{labels}</>}\n          {bodyState === LogLineState.labels && hasLabels && <>{labels}</>}\n          {bodyState === LogLineState.labels && !hasLabels && <RawLogLineText value={value} />}\n\n          {/* Raw log line*/}\n          {isAuto && !hasLabels && <RawLogLineText value={value} />}\n          {bodyState === LogLineState.text && <RawLogLineText value={value} />}\n\n          {isHover && <Scroller scrollerRef={ref} />}\n        </div>\n      </ScrollSyncPane>\n    </DefaultCellWrapComponent>\n  );\n};\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  content: css`\n    white-space: nowrap;\n    overflow-x: auto;\n    -ms-overflow-style: none; /* IE and Edge */\n    scrollbar-width: none; /* Firefox */\n    padding-right: 30px;\n    display: flex;\n    align-items: flex-start;\n    height: 100%;\n    &::-webkit-scrollbar {\n      display: none; /* Chrome, Safari and Opera */\n    }\n\n    &:after {\n      pointer-events: none;\n      content: '';\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      left: 0;\n      top: 0;\n      // Fade out text in last 10px to background color to add affordance to horiziontal scroll\n      background: linear-gradient(to right, transparent calc(100% - 10px), ${theme.colors.background.primary});\n    }\n  `,\n});\n","import React, { PropsWithChildren, useRef } from 'react';\nimport { css } from '@emotion/css';\n\nimport { Field, GrafanaTheme2 } from '@grafana/data';\nimport { ClickOutsideWrapper, Icon, Popover, useTheme2 } from '@grafana/ui';\n\nimport { useTableHeaderContext } from 'Components/Table/Context/TableHeaderContext';\nimport { useQueryContext } from './Context/QueryContext';\nimport { getBodyName } from '../../services/logsFrame';\n\nexport interface LogsTableHeaderProps extends PropsWithChildren<CustomHeaderRendererProps> {\n  fieldIndex: number;\n}\n//@todo delete when released in Grafana core\nexport interface CustomHeaderRendererProps {\n  field: Field;\n  defaultContent: React.ReactNode;\n}\n\nconst getStyles = (theme: GrafanaTheme2, isFirstColumn: boolean, isLine: boolean) => ({\n  tableHeaderMenu: css({\n    label: 'tableHeaderMenu',\n    width: '100%',\n    minWidth: '250px',\n    height: '100%',\n    maxHeight: '400px',\n    backgroundColor: theme.colors.background.primary,\n    border: `1px solid ${theme.colors.border.weak}`,\n    padding: theme.spacing(2),\n    margin: theme.spacing(1, 0),\n    boxShadow: theme.shadows.z3,\n    borderRadius: theme.shape.radius.default,\n  }),\n  button: css({\n    appearance: 'none',\n    right: '5px',\n    background: 'none',\n    border: 'none',\n    padding: 0,\n  }),\n  wrapper: css({\n    display: 'flex',\n    marginLeft: isFirstColumn ? '56px' : '6px',\n    // Body has extra padding then other columns\n    width: isLine ? 'calc(100% + 6px)' : '100%',\n\n    // Hack to show a visible resize indicator, despite 6px of padding on the header in grafana/table\n    borderRight: `1px solid ${theme.colors.border.weak}`,\n    marginRight: '-6px',\n  }),\n  defaultContentWrapper: css({\n    borderLeft: isFirstColumn ? `1px solid ${theme.colors.border.weak}` : 'none',\n    marginLeft: isFirstColumn ? '-6px' : 0,\n    paddingLeft: isFirstColumn ? '12px' : 0,\n    display: 'flex',\n  }),\n});\n\nexport const LogsTableHeader = (props: LogsTableHeaderProps) => {\n  const { setHeaderMenuActive, isHeaderMenuActive } = useTableHeaderContext();\n  const { logsFrame } = useQueryContext();\n  const referenceElement = useRef<HTMLButtonElement | null>(null);\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.fieldIndex === 0, props.field.name === getBodyName(logsFrame));\n\n  return (\n    <span className={styles.wrapper}>\n      <span className={styles.defaultContentWrapper}>{props.defaultContent}</span>\n      <button\n        className={styles.button}\n        ref={referenceElement}\n        onClick={(e) => {\n          setHeaderMenuActive(!isHeaderMenuActive);\n        }}\n      >\n        <Icon title={'Show menu'} name={'ellipsis-v'} />\n      </button>\n      {referenceElement.current && (\n        //@ts-ignore\n        <Popover\n          show={isHeaderMenuActive}\n          content={\n            <ClickOutsideWrapper onClick={() => setHeaderMenuActive(false)} useCapture={true}>\n              <div className={styles.tableHeaderMenu}>{props.children}</div>\n            </ClickOutsideWrapper>\n          }\n          referenceElement={referenceElement.current}\n        />\n      )}\n    </span>\n  );\n};\n","import { LogsTableHeader, LogsTableHeaderProps } from 'Components/Table/LogsTableHeader';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useTableHeaderContext } from 'Components/Table/Context/TableHeaderContext';\nimport { LogLineState, useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { Icon } from '@grafana/ui';\nimport React, { useCallback } from 'react';\nimport { Field } from '@grafana/data';\nimport { getBodyName } from '../../services/logsFrame';\nimport { css, cx } from '@emotion/css';\nimport { useQueryContext } from './Context/QueryContext';\n\nexport function LogsTableHeaderWrap(props: {\n  headerProps: LogsTableHeaderProps;\n  openColumnManagementDrawer: () => void;\n\n  // Moves the current column forward or backward one index\n  slideLeft?: (cols: FieldNameMetaStore) => void;\n  slideRight?: (cols: FieldNameMetaStore) => void;\n\n  autoColumnWidths?: () => void;\n}) {\n  const { setHeaderMenuActive } = useTableHeaderContext();\n  const { columns, setColumns, bodyState, setBodyState } = useTableColumnContext();\n  const { logsFrame } = useQueryContext();\n  const styles = getStyles();\n\n  const hideColumn = useCallback(\n    (field: Field) => {\n      const pendingColumnState = { ...columns };\n\n      const columnsThatNeedIndexUpdate = Object.keys(pendingColumnState)\n        .filter((col) => {\n          const columnIndex = pendingColumnState[col].index;\n          const fieldIndex = pendingColumnState[field.name].index;\n          return pendingColumnState[col].active && fieldIndex && columnIndex && columnIndex > fieldIndex;\n        })\n        .map((cols) => pendingColumnState[cols]);\n\n      columnsThatNeedIndexUpdate.forEach((col) => {\n        if (col.index !== undefined) {\n          col.index--;\n        }\n      });\n\n      pendingColumnState[field.name].active = false;\n      pendingColumnState[field.name].index = undefined;\n      setColumns(pendingColumnState);\n    },\n    [columns, setColumns]\n  );\n\n  const isBodyField = props.headerProps.field.name === getBodyName(logsFrame);\n\n  return (\n    <LogsTableHeader {...props.headerProps}>\n      <div className={styles.linkWrap}>\n        <a\n          className={styles.link}\n          onClick={() => {\n            props.openColumnManagementDrawer();\n            setHeaderMenuActive(false);\n          }}\n        >\n          <Icon className={styles.icon} name={'columns'} size={'md'} />\n          Manage columns\n        </a>\n      </div>\n      <div className={styles.linkWrap}>\n        <a className={styles.link} onClick={() => hideColumn(props.headerProps.field)}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 17 16\"\n            width=\"17\"\n            height=\"16\"\n            className=\"css-q2u0ig-Icon\"\n          >\n            <path\n              fillRule=\"evenodd\"\n              clipRule=\"evenodd\"\n              d=\"M1.73446 1.33301H12.2345C12.3892 1.33301 12.5375 1.40325 12.6469 1.52827C12.7563 1.65329 12.8178 1.82286 12.8178 1.99967V4.74967C12.8178 5.07184 12.5566 5.33301 12.2345 5.33301C11.9123 5.33301 11.6511 5.07184 11.6511 4.74967V2.66634H7.56779V13.333H11.6511V10.9163C11.6511 10.5942 11.9123 10.333 12.2345 10.333C12.5566 10.333 12.8178 10.5942 12.8178 10.9163V13.9997C12.8178 14.1765 12.7563 14.3461 12.6469 14.4711C12.5375 14.5961 12.3892 14.6663 12.2345 14.6663H1.73446C1.57975 14.6663 1.43137 14.5961 1.32198 14.4711C1.21258 14.3461 1.15112 14.1765 1.15112 13.9997V1.99967C1.15112 1.82286 1.21258 1.65329 1.32198 1.52827C1.43137 1.40325 1.57975 1.33301 1.73446 1.33301ZM2.31779 13.333H6.40112V2.66634H2.31779V13.333Z\"\n              fill=\"#CCCCDC\"\n              fillOpacity=\"1\"\n            />\n            <path\n              d=\"M15.9893 10.6315C15.9498 10.7263 15.8919 10.8123 15.819 10.8846C15.7467 10.9575 15.6607 11.0154 15.5659 11.0549C15.4712 11.0943 15.3695 11.1147 15.2668 11.1147C15.1641 11.1147 15.0625 11.0943 14.9677 11.0549C14.8729 11.0154 14.7869 10.9575 14.7146 10.8846L12.9335 9.09573L11.1524 10.8846C11.0801 10.9575 10.9941 11.0154 10.8993 11.0549C10.8045 11.0943 10.7028 11.1147 10.6002 11.1147C10.4975 11.1147 10.3958 11.0943 10.301 11.0549C10.2063 11.0154 10.1202 10.9575 10.0479 10.8846C9.97504 10.8123 9.91717 10.7263 9.87769 10.6315C9.8382 10.5367 9.81787 10.4351 9.81787 10.3324C9.81787 10.2297 9.8382 10.1281 9.87769 10.0333C9.91717 9.9385 9.97504 9.85248 10.0479 9.78017L11.8368 7.99906L10.0479 6.21795C9.90148 6.07149 9.8192 5.87285 9.8192 5.66573C9.8192 5.4586 9.90148 5.25996 10.0479 5.1135C10.1944 4.96705 10.393 4.88477 10.6002 4.88477C10.8073 4.88477 11.0059 4.96705 11.1524 5.1135L12.9335 6.90239L14.7146 5.1135C14.8611 4.96705 15.0597 4.88477 15.2668 4.88477C15.4739 4.88477 15.6726 4.96705 15.819 5.1135C15.9655 5.25996 16.0478 5.4586 16.0478 5.66573C16.0478 5.87285 15.9655 6.07149 15.819 6.21795L14.0302 7.99906L15.819 9.78017C15.8919 9.85248 15.9498 9.9385 15.9893 10.0333C16.0288 10.1281 16.0491 10.2297 16.0491 10.3324C16.0491 10.4351 16.0288 10.5367 15.9893 10.6315Z\"\n              fill=\"#CCCCDC\"\n              fillOpacity=\"1\"\n            />\n          </svg>\n          Remove column\n        </a>\n      </div>\n      {props.slideLeft && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.slideLeft?.(columns)}>\n            <Icon className={cx(styles.icon, styles.reverse)} name={'arrow-from-right'} size={'md'} />\n            Move left\n          </a>\n        </div>\n      )}\n      {props.slideRight && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.slideRight?.(columns)}>\n            <Icon className={styles.icon} name={'arrow-from-right'} size={'md'} />\n            Move right\n          </a>\n        </div>\n      )}\n      {isBodyField && (\n        <div className={styles.linkWrap}>\n          <a\n            className={styles.link}\n            onClick={() => {\n              if (bodyState === LogLineState.text) {\n                setBodyState(LogLineState.labels);\n              } else {\n                setBodyState(LogLineState.text);\n              }\n            }}\n          >\n            {bodyState === LogLineState.text ? (\n              <Icon className={styles.icon} name={'brackets-curly'} size={'md'} />\n            ) : (\n              <Icon className={styles.icon} name={'text-fields'} size={'md'} />\n            )}\n\n            {bodyState === LogLineState.text ? 'Show labels' : 'Show log text'}\n          </a>\n        </div>\n      )}\n\n      {props.autoColumnWidths && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.autoColumnWidths?.()}>\n            <Icon className={styles.icon} name={'arrows-h'} size={'md'} />\n            Reset column widths\n          </a>\n        </div>\n      )}\n    </LogsTableHeader>\n  );\n}\n\nconst getStyles = () => {\n  return {\n    reverse: css({\n      transform: 'scaleX(-1)',\n    }),\n    link: css({\n      paddingTop: '5px',\n      paddingBottom: '5px',\n    }),\n    icon: css({\n      marginRight: '10px',\n    }),\n    linkWrap: css({}),\n  };\n};\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { ScrollSync } from 'react-scroll-sync';\nimport { css } from '@emotion/css';\nimport { lastValueFrom } from 'rxjs';\n\nimport {\n  applyFieldOverrides,\n  CustomTransformOperator,\n  DataFrame,\n  DataFrameType,\n  DataTransformerConfig,\n  Field,\n  FieldType,\n  FieldWithIndex,\n  Labels,\n  MappingType,\n  transformDataFrame,\n  ValueMap,\n} from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { TableCellHeight, TableColoredBackgroundCellOptions } from '@grafana/schema';\nimport { Drawer, Table as GrafanaTable, TableCellDisplayMode, TableCustomCellOptions, useTheme2 } from '@grafana/ui';\n\nimport { TableCellContextProvider } from 'Components/Table/Context/TableCellContext';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { TableHeaderContextProvider } from 'Components/Table/Context/TableHeaderContext';\nimport {\n  ColumnSelectionDrawerWrap,\n  getReorderColumn,\n} from 'Components/Table/ColumnSelection/ColumnSelectionDrawerWrap';\nimport { DefaultCellComponent } from 'Components/Table/DefaultCellComponent';\nimport { LogLineCellComponent } from 'Components/Table/LogLineCellComponent';\nimport { CustomHeaderRendererProps } from 'Components/Table/LogsTableHeader';\nimport { FieldName, FieldNameMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { guessLogsFieldTypeForValue } from 'Components/Table/TableWrap';\nimport { LogsTableHeaderWrap } from 'Components/Table/LogsTableHeaderWrap';\nimport { getBodyName, getIdName, getTimeName, LogsFrame } from '../../services/logsFrame';\nimport { useQueryContext } from './Context/QueryContext';\nimport { testIds } from '../../services/testIds';\nimport { debounce } from 'lodash';\n\ninterface Props {\n  height: number;\n  timeZone: string;\n  logsFrame: LogsFrame;\n  width: number;\n  labels: Labels[];\n}\n\nconst getStyles = () => ({\n  section: css({\n    position: 'relative',\n  }),\n  tableWrap: css({\n    '.cellActions': {\n      // Hacky but without inspect turned on the table will change the width of the row on hover, but we don't want the default icons to show\n      display: 'none !important',\n    },\n  }),\n});\n\nfunction TableAndContext(props: {\n  data: DataFrame;\n  height: number;\n  width: number;\n  selectedLine?: number;\n  logsFrame: LogsFrame;\n  onResize: (fieldDisplayName: string, width: number) => void;\n}) {\n  return (\n    <GrafanaTable\n      onColumnResize={props.onResize}\n      initialSortBy={[{ displayName: getTimeName(props.logsFrame), desc: true }]}\n      initialRowIndex={props.selectedLine}\n      cellHeight={TableCellHeight.Sm}\n      data={props.data}\n      height={props.height}\n      width={props.width}\n      footerOptions={{ show: true, reducer: ['count'], countRows: true }}\n    />\n  );\n}\n\nexport const Table = (props: Props) => {\n  const { height, timeZone, logsFrame, width, labels } = props;\n  const theme = useTheme2();\n  const styles = getStyles();\n\n  const [tableFrame, setTableFrame] = useState<DataFrame | undefined>(undefined);\n  const {\n    columns,\n    visible,\n    setVisible,\n    setFilteredColumns,\n    setColumns,\n    clearSelectedLine,\n    columnWidthMap,\n    setColumnWidthMap,\n  } = useTableColumnContext();\n\n  const { selectedLine } = useQueryContext();\n\n  // Create a local state for selected line so we can clear the state tied to the URL\n  const [localSelectedLine] = useState(selectedLine);\n\n  const reorderColumn = getReorderColumn(setColumns);\n\n  const templateSrv = getTemplateSrv();\n  const replace = useMemo(() => templateSrv.replace.bind(templateSrv), [templateSrv]);\n\n  const prepareTableFrame = useCallback(\n    (frame: DataFrame): DataFrame => {\n      if (!frame.length) {\n        return frame;\n      }\n\n      const [frameWithOverrides] = applyFieldOverrides({\n        data: [frame],\n        timeZone: timeZone,\n        theme: theme,\n        replaceVariables: replace,\n        fieldConfig: {\n          defaults: {\n            custom: {},\n          },\n          overrides: [],\n        },\n      });\n\n      // `getLinks` and `applyFieldOverrides` are taken from TableContainer.tsx\n      for (const [index, field] of frameWithOverrides.fields.entries()) {\n        // If it's a string, then try to guess for a better type for numeric support in viz\n        field.type =\n          field.type === FieldType.string ? guessLogsFieldTypeForField(field) ?? FieldType.string : field.type;\n\n        field.config = {\n          ...field.config,\n\n          custom: {\n            inspect: true,\n            filterable: true, // This sets the columns to be filterable\n            headerComponent: (props: CustomHeaderRendererProps) => (\n              <TableHeaderContextProvider>\n                <LogsTableHeaderWrap\n                  headerProps={{ ...props, fieldIndex: index }}\n                  openColumnManagementDrawer={() => setVisible(true)}\n                  slideLeft={\n                    index !== 0 ? (cols: FieldNameMetaStore) => reorderColumn(cols, index, index - 1) : undefined\n                  }\n                  slideRight={\n                    index !== frame.fields.length - 1\n                      ? (cols: FieldNameMetaStore) => reorderColumn(cols, index, index + 1)\n                      : undefined\n                  }\n                  autoColumnWidths={\n                    Object.keys(columnWidthMap).length > 0\n                      ? () => {\n                          setColumnWidthMap({});\n                        }\n                      : undefined\n                  }\n                />\n              </TableHeaderContextProvider>\n            ),\n            width:\n              columnWidthMap[field.name] ??\n              getInitialFieldWidth(field, index, columns, width, frameWithOverrides.fields.length, logsFrame),\n            cellOptions: getTableCellOptions(field, index, labels, logsFrame),\n            ...field.config.custom,\n          },\n          // This sets the individual field value as filterable\n          // filterable: isFieldFilterable(field, logsFrame?.bodyField.name ?? '', logsFrame?.timeField.name ?? ''),\n          filterable: true,\n        };\n      }\n\n      return frameWithOverrides;\n    },\n    // This function is building the table dataframe that will be transformed, even though the components within the dataframe (cells, headers) can mutate the dataframe!\n    // If we try to update the dataframe whenever the columns are changed (which are rebuilt using this dataframe after being transformed), react will infinitely update frame -> columns -> frame -> ...\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [timeZone, theme, labels, width, replace, setVisible, columnWidthMap]\n  );\n\n  // prepare dataFrame\n  useEffect(() => {\n    const prepare = async () => {\n      const transformations: Array<DataTransformerConfig | CustomTransformOperator> = getExtractFieldsTransform(\n        logsFrame.raw\n      );\n\n      let labelFilters = buildColumnsWithMeta(columns);\n\n      const labelFiltersTransform = getOrganizeFieldsTransform(labelFilters);\n      if (labelFiltersTransform) {\n        transformations.push(labelFiltersTransform);\n      } else {\n        const specialFields = {\n          time: logsFrame.timeField,\n          body: logsFrame.bodyField,\n          extraFields: logsFrame.extraFields,\n        };\n        if (specialFields && specialFields.body !== undefined && specialFields.time !== undefined) {\n          transformations.push(\n            getDefaultStateOrganizeFieldsTransform(\n              specialFields as {\n                time: FieldWithIndex;\n                body: FieldWithIndex;\n              }\n            )\n          );\n        }\n      }\n\n      if (transformations.length > 0) {\n        const transformedDataFrame: DataFrame[] = await lastValueFrom(\n          // @ts-ignore\n          transformDataFrame(transformations, [logsFrame.raw])\n        );\n        const tableFrame = prepareTableFrame(transformedDataFrame[0]);\n        setTableFrame(tableFrame);\n      } else {\n        setTableFrame(prepareTableFrame(logsFrame.raw));\n      }\n    };\n    prepare();\n  }, [logsFrame.raw, logsFrame.bodyField, logsFrame.timeField, logsFrame.extraFields, prepareTableFrame, columns]);\n\n  // Clear selected line from URL so it doesn't pollute future queries\n  useEffect(() => {\n    if (localSelectedLine && selectedLine) {\n      clearSelectedLine();\n      return;\n    }\n  }, [localSelectedLine, clearSelectedLine, selectedLine]);\n\n  const idField = logsFrame.raw.fields.find((field) => field.name === getIdName(logsFrame));\n  const lineIndex = idField?.values.findIndex((v) => v === localSelectedLine?.id);\n  const cleanLineIndex = lineIndex && lineIndex !== -1 ? lineIndex : undefined;\n\n  if (!tableFrame) {\n    return <></>;\n  }\n\n  const onResize = (fieldDisplayName: string, width: number) => {\n    const key = Object.keys(columns)\n      .filter((key) => columns[key].active)\n      .find((key) => key === fieldDisplayName);\n\n    if (key && width > 0) {\n      const map = { ...columnWidthMap };\n      map[key] = width;\n      setColumnWidthMap(map);\n    }\n  };\n\n  return (\n    <div data-testid={testIds.table.wrapper} className={styles.section}>\n      {visible && (\n        <Drawer\n          size={'sm'}\n          onClose={() => {\n            setVisible(false);\n            setFilteredColumns(columns);\n          }}\n        >\n          <ColumnSelectionDrawerWrap />\n        </Drawer>\n      )}\n\n      <div className={styles.tableWrap}>\n        <TableCellContextProvider>\n          <ScrollSync horizontal={true} vertical={false} proportional={false}>\n            <TableAndContext\n              logsFrame={logsFrame}\n              selectedLine={cleanLineIndex}\n              data={tableFrame}\n              height={height}\n              width={width}\n              onResize={debounce(onResize, 100)}\n            />\n          </ScrollSync>\n        </TableCellContextProvider>\n      </div>\n    </div>\n  );\n};\n\nfunction getDefaultStateOrganizeFieldsTransform(specialFields: { time: FieldWithIndex; body: FieldWithIndex }) {\n  return {\n    id: 'organize',\n    options: {\n      indexByName: {\n        [specialFields.time.name]: 0,\n        [specialFields.body.name]: 1,\n      },\n      includeByName: {\n        [specialFields.body.name]: true,\n        [specialFields.time.name]: true,\n      },\n    },\n  };\n}\n\nfunction guessLogsFieldTypeForField(field: Field): FieldType | undefined {\n  // 1. Use the column name to guess\n  if (field.name) {\n    const name = field.name.toLowerCase();\n    if (name === 'date' || name === 'time') {\n      return FieldType.time;\n    }\n  }\n\n  // 2. Check the first non-null value\n  for (let i = 0; i < field.values.length; i++) {\n    const v = field.values[i];\n    if (v != null) {\n      return guessLogsFieldTypeForValue(v);\n    }\n  }\n\n  // Could not find anything\n  return undefined;\n}\n\nexport const getFieldMappings = (): ValueMap => {\n  return {\n    options: {\n      critical: {\n        color: '#705da0',\n        index: 0,\n      },\n      crit: {\n        color: '#705da0',\n        index: 1,\n      },\n      error: {\n        color: '#e24d42',\n        index: 2,\n      },\n      err: {\n        color: '#e24d42',\n        index: 3,\n      },\n      eror: {\n        color: '#e24d42',\n        index: 4,\n      },\n      warning: {\n        color: '#FF9900',\n        index: 5,\n      },\n      warn: {\n        color: '#FF9900',\n        index: 6,\n      },\n      info: {\n        color: '#7eb26d',\n        index: 7,\n      },\n      debug: {\n        color: '#1f78c1',\n        index: 8,\n      },\n      trace: {\n        color: '#6ed0e0',\n        index: 9,\n      },\n    },\n    type: MappingType.ValueToText,\n  };\n};\n\nfunction buildColumnsWithMeta(columnsWithMeta: Record<FieldName, FieldNameMeta>) {\n  // Create object of label filters to include columns selected by the user\n  let labelFilters: Record<FieldName, number> = {};\n  Object.keys(columnsWithMeta)\n    .filter((key) => columnsWithMeta[key].active)\n    .forEach((key) => {\n      const index = columnsWithMeta[key].index;\n      // Index should always be defined for any active column\n      if (index !== undefined) {\n        labelFilters[key] = index;\n      }\n    });\n\n  return labelFilters;\n}\n\nfunction getOrganizeFieldsTransform(labelFilters: Record<FieldName, number>) {\n  let labelFiltersInclude: Record<FieldName, boolean> = {};\n\n  for (const key in labelFilters) {\n    labelFiltersInclude[key] = true;\n  }\n\n  if (Object.keys(labelFilters).length > 0) {\n    return {\n      id: 'organize',\n      options: {\n        indexByName: labelFilters,\n        includeByName: labelFiltersInclude,\n      },\n    };\n  }\n  return null;\n}\n\nexport function getExtractFieldsTransform(dataFrame: DataFrame) {\n  return dataFrame.fields\n    .filter((field: Field & { typeInfo?: { frame: string } }) => {\n      const isFieldLokiLabels =\n        field.typeInfo?.frame === 'json.RawMessage' &&\n        field.name === 'labels' &&\n        dataFrame?.meta?.type !== DataFrameType.LogLines;\n      const isFieldDataplaneLabels =\n        field.name === 'labels' && field.type === FieldType.other && dataFrame?.meta?.type === DataFrameType.LogLines;\n      return isFieldLokiLabels || isFieldDataplaneLabels;\n    })\n    .flatMap((field: Field) => {\n      return [\n        {\n          id: 'extractFields',\n          options: {\n            format: 'json',\n            keepTime: false,\n            replace: false,\n            source: field.name,\n          },\n        },\n      ];\n    });\n}\n\nfunction getTableCellOptions(\n  field: Field,\n  fieldIndex: number,\n  labels: Labels[],\n  logsFrame: LogsFrame\n): TableCustomCellOptions | TableColoredBackgroundCellOptions {\n  if (field.name === getBodyName(logsFrame)) {\n    return {\n      cellComponent: (props) => (\n        <LogLineCellComponent {...props} fieldIndex={fieldIndex} labels={labels[props.rowIndex]} />\n      ),\n      type: TableCellDisplayMode.Custom,\n    };\n  }\n\n  return {\n    cellComponent: (props) => <DefaultCellComponent {...props} fieldIndex={fieldIndex} />,\n    type: TableCellDisplayMode.Custom,\n  };\n}\n\nfunction getInitialFieldWidth(\n  field: Field,\n  fieldIndex: number,\n  columns: FieldNameMetaStore,\n  tableWidth: number,\n  numberOfFields: number,\n  logsFrame: LogsFrame\n): number | undefined {\n  const minWidth = 90;\n\n  // Columns shouldn't take more than half the available space, unless there are only 2 columns\n  const maxWidth = numberOfFields <= 2 ? tableWidth : Math.min(tableWidth / 2);\n\n  // First field gets icons, and a little extra width\n  const extraPadding = fieldIndex === 0 ? 50 : 0;\n\n  // Time fields have consistent widths\n  if (field.type === FieldType.time) {\n    return 200 + extraPadding;\n  }\n\n  const columnMeta = columns[field.name];\n\n  if (columnMeta === undefined) {\n    return undefined;\n  }\n\n  const maxLength = Math.max(columnMeta.maxLength ?? 0, field.name.length);\n\n  if (columnMeta.maxLength) {\n    // Super rough estimate, about 6.5px per char, and 95px for some space for the header icons (remember when sorted a new icon is added to the table header).\n    // I guess to be a little tighter we could only add the extra padding IF the field name is longer then the longest value\n    return Math.min(Math.max(maxLength * 6.5 + 95 + extraPadding, minWidth + extraPadding), maxWidth);\n  }\n\n  if (field.name === getBodyName(logsFrame)) {\n    return undefined;\n  }\n\n  // Just derived fields, which should have uniform length\n  return Math.min(\n    Math.max((field.values?.[0]?.length ?? 80) * 6.5 + 95 + extraPadding, minWidth + extraPadding),\n    maxWidth\n  );\n}\n","import React, { useCallback, useState } from 'react';\nimport { css } from '@emotion/css';\n\nimport { DataFrame, FieldType, FieldWithIndex, getTimeZone, guessFieldTypeFromValue, Labels } from '@grafana/data';\n\nimport { TableColumnContextProvider } from 'Components/Table/Context/TableColumnsContext';\nimport { Table } from 'Components/Table/Table';\nimport { FieldNameMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { useResizeObserver } from '@react-aria/utils';\n\nexport type SpecialFieldsType = {\n  time: FieldWithIndex;\n  body: FieldWithIndex;\n  extraFields: FieldWithIndex[];\n};\n\n// matches common ISO 8601\nconst iso8601Regex = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d{3,})?(?:Z|[-+]\\d{2}:?\\d{2})$/;\n\ninterface TableWrapProps {\n  urlColumns: string[];\n  setUrlColumns: (columns: string[]) => void;\n  panelWrap: React.RefObject<HTMLDivElement>;\n  clearSelectedLine: () => void;\n}\n\nconst getStyles = () => ({\n  section: css({\n    position: 'relative',\n  }),\n});\n\nexport const TableWrap = (props: TableWrapProps) => {\n  const { logsFrame } = useQueryContext();\n\n  const [panelWrapSize, setPanelWrapSize] = useState({ width: 0, height: 0 });\n\n  // Table needs to be positioned absolutely, passing in reference wrapping panelChrome from parent\n  useResizeObserver({\n    ref: props.panelWrap,\n    onResize: () => {\n      const element = props.panelWrap.current;\n      if (element) {\n        if (panelWrapSize.width !== element.clientWidth || panelWrapSize.height !== element.clientHeight) {\n          setPanelWrapSize({\n            width: element.clientWidth,\n            height: element.clientHeight,\n          });\n        }\n      }\n    },\n  });\n\n  const styles = getStyles();\n  const timeZone = getTimeZone();\n\n  // This function is called when we want to grab the column names that are currently stored in the URL.\n  // So instead we have to grab the current columns directly from the URL.\n  const getColumnsFromProps = useCallback(\n    (fieldNames: FieldNameMetaStore) => {\n      const previouslySelected = props.urlColumns;\n      if (previouslySelected?.length) {\n        Object.values(previouslySelected).forEach((key, index) => {\n          if (fieldNames[key]) {\n            fieldNames[key].active = true;\n            fieldNames[key].index = index;\n          }\n        });\n      }\n\n      return fieldNames;\n    },\n    [props.urlColumns]\n  );\n\n  // If the data frame is empty, there's nothing to viz, it could mean the user has unselected all columns\n  if (!logsFrame || !logsFrame.raw.length) {\n    return null;\n  }\n\n  const labels = logsFrame.getLogFrameLabelsAsLabels() ?? [];\n  const numberOfLogLines = logsFrame ? logsFrame.raw.length : 0;\n\n  // If we have labels and log lines\n  let pendingLabelState = mapLabelsToInitialState(logsFrame.raw, labels);\n  const specialFields = {\n    time: logsFrame.timeField,\n    body: logsFrame.bodyField,\n    extraFields: logsFrame.extraFields,\n  };\n\n  // Normalize the other fields\n  if (specialFields) {\n    addSpecialLabelsState(\n      [specialFields.time, specialFields.body, ...specialFields.extraFields],\n      pendingLabelState,\n      numberOfLogLines\n    );\n\n    pendingLabelState = getColumnsFromProps(pendingLabelState);\n\n    // Get all active columns\n    const active = Object.keys(pendingLabelState).filter((key) => pendingLabelState[key].active);\n\n    // If nothing is selected, then select the default columns\n    setSpecialFieldMeta(active, specialFields, pendingLabelState);\n  }\n\n  return (\n    <section className={styles.section}>\n      <TableColumnContextProvider\n        logsFrame={logsFrame}\n        initialColumns={pendingLabelState}\n        setUrlColumns={props.setUrlColumns}\n        clearSelectedLine={props.clearSelectedLine}\n      >\n        <Table\n          logsFrame={logsFrame}\n          timeZone={timeZone}\n          height={panelWrapSize.height - 50}\n          width={panelWrapSize.width - 25}\n          labels={labels}\n        />\n      </TableColumnContextProvider>\n    </section>\n  );\n};\n\nconst normalize = (value: number, total: number): number => {\n  return Math.ceil((100 * value) / total);\n};\n\ntype labelName = string;\ntype labelValue = string;\n\nexport function getCardinalityMapFromLabels(labels: Labels[]) {\n  const cardinalityMap = new Map<labelName, { valueSet: Set<labelValue>; maxLength: number }>();\n  labels.forEach((fieldLabels) => {\n    const labelNames = Object.keys(fieldLabels);\n    labelNames.forEach((labelName) => {\n      if (cardinalityMap.has(labelName)) {\n        const setObj = cardinalityMap.get(labelName);\n        const values = setObj?.valueSet;\n        const maxLength = setObj?.maxLength;\n\n        if (values && !values?.has(fieldLabels[labelName])) {\n          values?.add(fieldLabels[labelName]);\n          if (maxLength && fieldLabels[labelName].length > maxLength) {\n            cardinalityMap.set(labelName, { maxLength: fieldLabels[labelName].length, valueSet: values });\n          }\n        }\n      } else {\n        cardinalityMap.set(labelName, {\n          maxLength: fieldLabels[labelName].length,\n          valueSet: new Set([fieldLabels[labelName]]),\n        });\n      }\n    });\n  });\n\n  return cardinalityMap;\n}\n\n/**\n * Guess the field type of the value\n * @param value\n */\nexport function guessLogsFieldTypeForValue(value: string) {\n  let fieldType = guessFieldTypeFromValue(value);\n  const isISO8601 = fieldType === 'string' && iso8601Regex.test(value);\n  if (isISO8601) {\n    fieldType = FieldType.time;\n  }\n  return fieldType;\n}\n\nfunction mapLabelsToInitialState(dataFrame: DataFrame, labels: Labels[]) {\n  let pendingLabelState: FieldNameMetaStore = {};\n\n  // Use a map to dedupe labels and count their occurrences in the logs\n  const labelMap = new Map<string, FieldNameMeta>();\n  const cardinality = getCardinalityMapFromLabels(labels);\n  const numberOfLogLines = dataFrame ? dataFrame.length : 0;\n\n  if (labels?.length && numberOfLogLines) {\n    // Iterate through all of Labels\n    labels.forEach((labels: Labels) => {\n      const labelsArray = Object.keys(labels);\n      // Iterate through the label values\n      labelsArray.forEach((label) => {\n        const cardinalityMap = cardinality.get(label);\n        const cardinalityCount = cardinalityMap?.valueSet?.size ?? 0;\n        // If it's already in our map, increment the count\n        if (labelMap.has(label)) {\n          const value = labelMap.get(label);\n\n          if (value) {\n            if (value?.active) {\n              labelMap.set(label, {\n                percentOfLinesWithLabel: value.percentOfLinesWithLabel + 1,\n                active: true,\n                index: value.index,\n                cardinality: cardinalityCount,\n                maxLength: cardinalityMap?.maxLength,\n              });\n            } else {\n              labelMap.set(label, {\n                percentOfLinesWithLabel: value.percentOfLinesWithLabel + 1,\n                active: false,\n                index: undefined,\n                cardinality: cardinalityCount,\n                maxLength: cardinalityMap?.maxLength,\n              });\n            }\n          }\n          // Otherwise add it\n        } else {\n          labelMap.set(label, {\n            percentOfLinesWithLabel: 1,\n            active: false,\n            index: undefined,\n            cardinality: cardinalityCount,\n            maxLength: cardinalityMap?.maxLength,\n          });\n        }\n      });\n    });\n\n    // Converting the map to an object\n    pendingLabelState = Object.fromEntries(labelMap);\n\n    // Convert count to percent of log lines\n    Object.keys(pendingLabelState).forEach((key) => {\n      pendingLabelState[key].percentOfLinesWithLabel = normalize(\n        pendingLabelState[key].percentOfLinesWithLabel,\n        numberOfLogLines\n      );\n    });\n  }\n  return pendingLabelState;\n}\n\n/**\n * Add special fields like time and body\n * @param specialFieldArray\n * @param pendingLabelState\n * @param numberOfLogLines\n */\nfunction addSpecialLabelsState(\n  specialFieldArray: Array<FieldWithIndex | undefined>,\n  pendingLabelState: FieldNameMetaStore,\n  numberOfLogLines: number\n) {\n  specialFieldArray.forEach((field) => {\n    if (!field) {\n      return;\n    }\n    const isActive = pendingLabelState[field.name]?.active;\n    const index = pendingLabelState[field.name]?.index;\n    if (isActive && index !== undefined) {\n      pendingLabelState[field.name] = {\n        percentOfLinesWithLabel: normalize(\n          field.values.filter((value) => value !== null && value !== undefined).length,\n          numberOfLogLines\n        ),\n        active: true,\n        index: index,\n        cardinality: numberOfLogLines,\n      };\n    } else {\n      pendingLabelState[field.name] = {\n        percentOfLinesWithLabel: normalize(\n          field.values.filter((value) => value !== null && value !== undefined).length,\n          numberOfLogLines\n        ),\n        active: false,\n        index: undefined,\n        cardinality: numberOfLogLines,\n      };\n    }\n  });\n\n  return pendingLabelState;\n}\n\nfunction setSpecialFieldMeta(\n  active: string[],\n  specialFields: SpecialFieldsType,\n  pendingLabelState: FieldNameMetaStore\n) {\n  // If no fields are visible, set defaults\n  if (active.length === 0) {\n    if (specialFields.body?.name) {\n      pendingLabelState[specialFields.body?.name].active = true;\n      pendingLabelState[specialFields.body?.name].index = 1;\n    }\n    if (specialFields.time?.name) {\n      pendingLabelState[specialFields.time?.name].active = true;\n      pendingLabelState[specialFields.time?.name].index = 0;\n    }\n  }\n\n  if (specialFields.time?.name && specialFields.body?.name) {\n    pendingLabelState[specialFields.body?.name].type = 'BODY_FIELD';\n    pendingLabelState[specialFields.time?.name].type = 'TIME_FIELD';\n  }\n\n  if (specialFields.extraFields.length) {\n    specialFields.extraFields.forEach((field) => {\n      const hasLinks = field.config.links?.length;\n      if (hasLinks) {\n        pendingLabelState[field.name].type = 'LINK_FIELD';\n      }\n    });\n  }\n}\n","import React from 'react';\n\nimport { TableWrap } from 'Components/Table/TableWrap';\nimport { AdHocVariableFilter, DataFrame, TimeRange } from '@grafana/data';\nimport { QueryContextProvider } from 'Components/Table/Context/QueryContext';\nimport { parseLogsFrame } from '../../services/logsFrame';\nimport { SelectedTableRow } from './LogLineCellComponent';\n\ninterface TableProviderProps {\n  dataFrame: DataFrame;\n  setUrlColumns: (columns: string[]) => void;\n  urlColumns: string[];\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n  panelWrap: React.RefObject<HTMLDivElement>;\n  clearSelectedLine: () => void;\n}\n\nexport const TableProvider = ({\n  dataFrame,\n  setUrlColumns,\n  urlColumns,\n  addFilter,\n  selectedLine,\n  timeRange,\n  panelWrap,\n  clearSelectedLine,\n}: TableProviderProps) => {\n  if (!dataFrame) {\n    return null;\n  }\n\n  const logsFrame = parseLogsFrame(dataFrame);\n  if (!logsFrame) {\n    return null;\n  }\n\n  return (\n    <QueryContextProvider addFilter={addFilter} selectedLine={selectedLine} timeRange={timeRange} logsFrame={logsFrame}>\n      <TableWrap\n        setUrlColumns={setUrlColumns}\n        urlColumns={urlColumns}\n        panelWrap={panelWrap}\n        clearSelectedLine={clearSelectedLine}\n      />\n    </QueryContextProvider>\n  );\n};\n","import React from 'react';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { LogsVisualizationType } from '../ServiceScene/LogsListScene';\n\nexport function LogsPanelHeaderActions(props: {\n  vizType: LogsVisualizationType;\n  onChange: (type: LogsVisualizationType) => void;\n}) {\n  return (\n    <div className={styles.visualisationType}>\n      <RadioButtonGroup\n        className={styles.visualisationTypeRadio}\n        options={[\n          {\n            label: 'Logs',\n            value: 'logs',\n            description: 'Show results in logs visualisation',\n          },\n          {\n            label: 'Table',\n            value: 'table',\n            description: 'Show results in table visualisation',\n          },\n        ]}\n        size=\"sm\"\n        value={props.vizType}\n        onChange={props.onChange}\n      />\n    </div>\n  );\n}\n\nconst styles = {\n  visualisationType: css({\n    display: 'flex',\n    flex: '1',\n    justifyContent: 'space-between',\n    marginTop: '8px',\n  }),\n  visualisationTypeRadio: css({\n    margin: `0 0 0 8px`,\n  }),\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase } from '@grafana/scenes';\nimport { LogsListScene } from './LogsListScene';\nimport { AdHocVariableFilter } from '@grafana/data';\nimport { TableProvider } from '../Table/TableProvider';\nimport React, { useRef } from 'react';\nimport { PanelChrome } from '@grafana/ui';\nimport { LogsPanelHeaderActions } from '../Table/LogsHeaderActions';\nimport { css } from '@emotion/css';\nimport { addAdHocFilter } from './Breakdowns/AddToFiltersButton';\nimport { areArraysEqual } from '../../services/comparison';\nimport { getLogsPanelFrame } from './ServiceScene';\nimport { getVariableForLabel } from '../../services/fields';\n\nexport class LogsTableScene extends SceneObjectBase {\n  public static Component = ({ model }: SceneComponentProps<LogsTableScene>) => {\n    const styles = getStyles();\n    // Get state from parent model\n    const parentModel = sceneGraph.getAncestor(model, LogsListScene);\n    const { data } = sceneGraph.getData(model).useState();\n    const { selectedLine, urlColumns, visualizationType } = parentModel.useState();\n\n    // Get time range\n    const timeRange = sceneGraph.getTimeRange(model);\n    const { value: timeRangeValue } = timeRange.useState();\n\n    const dataFrame = getLogsPanelFrame(data);\n\n    // Define callback function to update filters in react\n    const addFilter = (filter: AdHocVariableFilter) => {\n      const variableType = getVariableForLabel(dataFrame, filter.key, model);\n      addAdHocFilter(filter, parentModel, variableType);\n    };\n\n    // Get reference to panel wrapper so table knows how much space it can use to render\n    const panelWrap = useRef<HTMLDivElement>(null);\n\n    // Define callback function to update url columns in react\n    const setUrlColumns = (urlColumns: string[]) => {\n      if (!areArraysEqual(urlColumns, parentModel.state.urlColumns)) {\n        parentModel.setState({ urlColumns });\n      }\n    };\n\n    const clearSelectedLine = () => {\n      if (parentModel.state.selectedLine) {\n        parentModel.clearSelectedLine();\n      }\n    };\n\n    return (\n      <div className={styles.panelWrapper} ref={panelWrap}>\n        <PanelChrome\n          loadingState={data?.state}\n          title={'Logs'}\n          actions={<LogsPanelHeaderActions vizType={visualizationType} onChange={parentModel.setVisualizationType} />}\n        >\n          {dataFrame && (\n            <TableProvider\n              panelWrap={panelWrap}\n              addFilter={addFilter}\n              timeRange={timeRangeValue}\n              selectedLine={selectedLine}\n              urlColumns={urlColumns ?? []}\n              setUrlColumns={setUrlColumns}\n              dataFrame={dataFrame}\n              clearSelectedLine={clearSelectedLine}\n            />\n          )}\n        </PanelChrome>\n      </div>\n    );\n  };\n}\n\nconst getStyles = () => ({\n  panelWrapper: css({\n    height: '100%',\n  }),\n});\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, sceneGraph } from '@grafana/scenes';\nimport { Button, InlineField, InlineSwitch, Tooltip } from '@grafana/ui';\nimport React, { ChangeEvent } from 'react';\nimport { getLogOption, setLogOption } from 'services/store';\nimport { LogsListScene } from './LogsListScene';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\n\ninterface LogOptionsState extends SceneObjectState {\n  wrapLines?: boolean;\n}\n\nexport class LogOptionsScene extends SceneObjectBase<LogOptionsState> {\n  static Component = LogOptionsRenderer;\n\n  constructor(state?: Partial<LogOptionsState>) {\n    super({\n      ...state,\n      wrapLines: Boolean(getLogOption('wrapLines')),\n    });\n  }\n\n  handleWrapLinesChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const checked = e.target.checked;\n    this.setState({ wrapLines: checked });\n    setLogOption('wrapLines', checked);\n    this.getParentScene().setLogsVizOption({ wrapLogMessage: checked });\n  };\n\n  getParentScene = () => {\n    return sceneGraph.getAncestor(this, LogsListScene);\n  };\n\n  clearDisplayedFields = () => {\n    const parentScene = this.getParentScene();\n    parentScene.clearDisplayedFields();\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_clear_displayed_fields\n    );\n  };\n}\n\nfunction LogOptionsRenderer({ model }: SceneComponentProps<LogOptionsScene>) {\n  const { wrapLines } = model.useState();\n  const { displayedFields } = model.getParentScene().useState();\n\n  return (\n    <>\n      <InlineField label=\"Wrap lines\" transparent htmlFor=\"wrap-lines-switch\">\n        <InlineSwitch\n          value={wrapLines}\n          onChange={model.handleWrapLinesChange}\n          className={styles.horizontalInlineSwitch}\n          transparent\n          id=\"wrap-lines-switch\"\n        />\n      </InlineField>\n      {displayedFields.length > 0 && (\n        <Tooltip content={`Clear displayed fields: ${displayedFields.join(', ')}`}>\n          <Button variant=\"secondary\" fill=\"outline\" onClick={model.clearDisplayedFields}>\n            Show original log line\n          </Button>\n        </Tooltip>\n      )}\n    </>\n  );\n}\n\nconst styles = {\n  input: css({\n    width: '100%',\n  }),\n  field: css({\n    label: 'field',\n    marginBottom: 0,\n  }),\n  horizontalInlineSwitch: css({\n    padding: `0 4px 0 0`,\n  }),\n};\n","import {\n  AdHocFiltersVariable,\n  PanelBuilders,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { DataFrame } from '@grafana/data';\nimport { getLogOption, setDisplayedFields } from '../../services/store';\nimport { LogsPanelHeaderActions } from '../Table/LogsHeaderActions';\nimport React from 'react';\nimport { LogsListScene } from './LogsListScene';\nimport { LoadingPlaceholder } from '@grafana/ui';\nimport { addToFilters, FilterType } from './Breakdowns/AddToFiltersButton';\nimport { getVariableForLabel } from '../../services/fields';\nimport { VAR_FIELDS, VAR_LABELS, VAR_LEVELS, VAR_METADATA } from '../../services/variables';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { getAdHocFiltersVariable, getValueFromFieldsFilter } from '../../services/variableGetters';\n\ninterface LogsPanelSceneState extends SceneObjectState {\n  body?: VizPanel;\n}\n\nexport class LogsPanelScene extends SceneObjectBase<LogsPanelSceneState> {\n  constructor(state: Partial<LogsPanelSceneState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public onActivate() {\n    if (!this.state.body) {\n      this.setState({\n        body: this.getLogsPanel(),\n      });\n    }\n  }\n\n  onClickShowField = (field: string) => {\n    const parent = this.getParentScene();\n    const index = parent.state.displayedFields.indexOf(field);\n\n    if (index === -1 && this.state.body) {\n      const displayedFields = [...parent.state.displayedFields, field];\n      this.setLogsVizOption({\n        displayedFields,\n      });\n      parent.setState({ displayedFields });\n      setDisplayedFields(this, parent.state.displayedFields);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_toggle_displayed_field\n      );\n    }\n  };\n\n  onClickHideField = (field: string) => {\n    const parent = this.getParentScene();\n    const index = parent.state.displayedFields.indexOf(field);\n\n    if (index >= 0 && this.state.body) {\n      const displayedFields = parent.state.displayedFields.filter((displayedField) => field !== displayedField);\n      this.setLogsVizOption({\n        displayedFields,\n      });\n      parent.setState({ displayedFields });\n      setDisplayedFields(this, parent.state.displayedFields);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_toggle_displayed_field\n      );\n    }\n  };\n\n  setLogsVizOption(options = {}) {\n    if (!this.state.body) {\n      return;\n    }\n    this.state.body.onOptionsChange(options);\n  }\n\n  clearDisplayedFields = () => {\n    if (!this.state.body) {\n      return;\n    }\n    this.setLogsVizOption({\n      displayedFields: [],\n    });\n    setDisplayedFields(this, []);\n  };\n\n  private getParentScene() {\n    return sceneGraph.getAncestor(this, LogsListScene);\n  }\n\n  private getLogsPanel() {\n    const parentModel = this.getParentScene();\n    const visualizationType = parentModel.state.visualizationType;\n\n    return PanelBuilders.logs()\n      .setTitle('Logs')\n      .setOption('showTime', true)\n      .setOption('onClickFilterLabel', this.handleLabelFilterClick)\n      .setOption('onClickFilterOutLabel', this.handleLabelFilterOutClick)\n      .setOption('isFilterLabelActive', this.handleIsFilterLabelActive)\n      .setOption('onClickFilterString', this.handleFilterStringClick)\n      .setOption('onClickShowField', this.onClickShowField)\n      .setOption('onClickHideField', this.onClickHideField)\n      .setOption('displayedFields', parentModel.state.displayedFields)\n      .setOption('wrapLogMessage', Boolean(getLogOption('wrapLines')))\n      .setOption('showLogContextToggle', true)\n      .setHeaderActions(\n        <LogsPanelHeaderActions vizType={visualizationType} onChange={parentModel.setVisualizationType} />\n      )\n      .build();\n  }\n\n  private handleLabelFilterClick = (key: string, value: string, frame?: DataFrame) => {\n    this.handleLabelFilter(key, value, frame, 'toggle');\n  };\n\n  private handleLabelFilterOutClick = (key: string, value: string, frame?: DataFrame) => {\n    this.handleLabelFilter(key, value, frame, 'exclude');\n  };\n\n  private handleIsFilterLabelActive = (key: string, value: string) => {\n    const labels = getAdHocFiltersVariable(VAR_LABELS, this);\n    const fields = getAdHocFiltersVariable(VAR_FIELDS, this);\n    const levels = getAdHocFiltersVariable(VAR_LEVELS, this);\n    const metadata = getAdHocFiltersVariable(VAR_METADATA, this);\n\n    const hasKeyValueFilter = (filter: AdHocFiltersVariable | null) => {\n      return (\n        filter &&\n        filter.state.filters.findIndex(\n          (filter) => filter.operator === '=' && filter.key === key && filter.value === value\n        ) >= 0\n      );\n    };\n\n    // Fields have json encoded values unlike the other variables, get the value for the matching filter and parse it before comparing\n    const hasKeyValueFilterField = (filter: AdHocFiltersVariable | null) => {\n      if (filter) {\n        const fieldFilter = filter.state.filters.find((filter) => filter.operator === '=' && filter.key === key);\n\n        if (fieldFilter) {\n          const fieldValue = getValueFromFieldsFilter(fieldFilter, key);\n          return fieldValue.value === value;\n        }\n      }\n      return false;\n    };\n\n    return (\n      hasKeyValueFilter(labels) ||\n      hasKeyValueFilterField(fields) ||\n      hasKeyValueFilter(levels) ||\n      hasKeyValueFilter(metadata)\n    );\n  };\n\n  private handleFilterStringClick = (value: string) => {\n    const parentModel = sceneGraph.getAncestor(this, LogsListScene);\n    const lineFilterScene = parentModel.getLineFilterScene();\n    if (lineFilterScene) {\n      lineFilterScene.updateFilter(value, false);\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_popover_line_filter,\n        {\n          selectionLength: value.length,\n        }\n      );\n    }\n  };\n\n  private handleLabelFilter(key: string, value: string, frame: DataFrame | undefined, operator: FilterType) {\n    const variableType = getVariableForLabel(frame, key, this);\n\n    addToFilters(key, value, operator, this, variableType);\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_detail_filter_applied,\n      {\n        filterType: variableType,\n        key,\n        action: operator,\n      }\n    );\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LogsPanelScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import React from 'react';\n\nimport {\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneTimeRangeLike,\n} from '@grafana/scenes';\nimport { LineFilterScene } from './LineFilterScene';\nimport { SelectedTableRow } from '../Table/LogLineCellComponent';\nimport { LogsTableScene } from './LogsTableScene';\nimport { css } from '@emotion/css';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { locationService } from '@grafana/runtime';\nimport { LogOptionsScene } from './LogOptionsScene';\nimport { LogsPanelScene } from './LogsPanelScene';\nimport { getDisplayedFields } from 'services/store';\nimport { logger } from '../../services/logger';\n\nexport interface LogsListSceneState extends SceneObjectState {\n  loading?: boolean;\n  panel?: SceneFlexLayout;\n  visualizationType: LogsVisualizationType;\n  urlColumns?: string[];\n  selectedLine?: SelectedTableRow;\n  $timeRange?: SceneTimeRangeLike;\n  displayedFields: string[];\n}\n\nexport type LogsVisualizationType = 'logs' | 'table';\n// If we use the local storage key from explore the user will get more consistent UX?\nconst VISUALIZATION_TYPE_LOCALSTORAGE_KEY = 'grafana.explore.logs.visualisationType';\n\nexport class LogsListScene extends SceneObjectBase<LogsListSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: ['urlColumns', 'selectedLine', 'visualizationType', 'displayedFields'],\n  });\n  private lineFilterScene?: LineFilterScene = undefined;\n  private logsPanelScene?: LogsPanelScene = undefined;\n  constructor(state: Partial<LogsListSceneState>) {\n    super({\n      ...state,\n      visualizationType: (localStorage.getItem(VISUALIZATION_TYPE_LOCALSTORAGE_KEY) as LogsVisualizationType) ?? 'logs',\n      displayedFields: [],\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  getUrlState() {\n    const urlColumns = this.state.urlColumns ?? [];\n    const selectedLine = this.state.selectedLine;\n    const visualizationType = this.state.visualizationType;\n    const displayedFields = this.state.displayedFields ?? getDisplayedFields(this) ?? [];\n    return {\n      urlColumns: JSON.stringify(urlColumns),\n      selectedLine: JSON.stringify(selectedLine),\n      visualizationType: JSON.stringify(visualizationType),\n      displayedFields: JSON.stringify(displayedFields),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<LogsListSceneState> = {};\n    try {\n      if (typeof values.urlColumns === 'string') {\n        const decodedUrlColumns: string[] = JSON.parse(values.urlColumns);\n        if (decodedUrlColumns !== this.state.urlColumns) {\n          stateUpdate.urlColumns = decodedUrlColumns;\n        }\n      }\n      if (typeof values.selectedLine === 'string') {\n        const decodedSelectedTableRow: SelectedTableRow = JSON.parse(values.selectedLine);\n        if (decodedSelectedTableRow !== this.state.selectedLine) {\n          stateUpdate.selectedLine = decodedSelectedTableRow;\n        }\n      }\n\n      if (typeof values.visualizationType === 'string') {\n        const decodedVisualizationType: LogsVisualizationType = JSON.parse(values.visualizationType);\n        if (decodedVisualizationType !== this.state.visualizationType) {\n          stateUpdate.visualizationType = decodedVisualizationType;\n        }\n      }\n\n      if (typeof values.displayedFields === 'string') {\n        const displayedFields = JSON.parse(values.displayedFields);\n        if (displayedFields && displayedFields.length) {\n          stateUpdate.displayedFields = displayedFields;\n        }\n      }\n    } catch (e) {\n      // URL Params can be manually changed and it will make JSON.parse() fail.\n      logger.error(e, { msg: 'LogsListScene: updateFromUrl unexpected error' });\n    }\n\n    if (Object.keys(stateUpdate).length) {\n      this.setState(stateUpdate);\n    }\n  }\n\n  clearSelectedLine() {\n    this.setState({\n      selectedLine: undefined,\n    });\n  }\n\n  clearDisplayedFields = () => {\n    this.setState({ displayedFields: [] });\n    if (this.logsPanelScene) {\n      this.logsPanelScene.clearDisplayedFields();\n    }\n  };\n\n  public onActivate() {\n    const searchParams = new URLSearchParams(locationService.getLocation().search);\n    this.setStateFromUrl(searchParams);\n\n    if (!this.state.panel) {\n      this.updateLogsPanel();\n    }\n\n    this._subs.add(\n      this.subscribeToState((newState, prevState) => {\n        if (newState.visualizationType !== prevState.visualizationType) {\n          this.updateLogsPanel();\n        }\n      })\n    );\n  }\n\n  public getLineFilterScene() {\n    return this.lineFilterScene;\n  }\n\n  private setStateFromUrl(searchParams: URLSearchParams) {\n    const selectedLineUrl = searchParams.get('selectedLine');\n    const urlColumnsUrl = searchParams.get('urlColumns');\n    const vizTypeUrl = searchParams.get('visualizationType');\n    const displayedFieldsUrl = searchParams.get('displayedFields') ?? JSON.stringify(getDisplayedFields(this));\n\n    this.updateFromUrl({\n      selectedLine: selectedLineUrl,\n      urlColumns: urlColumnsUrl,\n      vizType: vizTypeUrl,\n      displayedFields: displayedFieldsUrl,\n    });\n  }\n\n  public setLogsVizOption = (options = {}) => {\n    if (this.logsPanelScene) {\n      this.logsPanelScene.setLogsVizOption(options);\n    }\n  };\n\n  public updateLogsPanel = () => {\n    this.setState({\n      panel: this.getVizPanel(),\n    });\n  };\n\n  public setVisualizationType = (type: LogsVisualizationType) => {\n    this.setState({\n      visualizationType: type,\n    });\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_visualization_toggle,\n      {\n        visualisationType: type,\n      }\n    );\n    localStorage.setItem(VISUALIZATION_TYPE_LOCALSTORAGE_KEY, type);\n  };\n\n  private getVizPanel() {\n    this.lineFilterScene = new LineFilterScene();\n    this.logsPanelScene = new LogsPanelScene({});\n\n    return new SceneFlexLayout({\n      direction: 'column',\n      children:\n        this.state.visualizationType === 'logs'\n          ? [\n              new SceneFlexLayout({\n                children: [\n                  new SceneFlexItem({\n                    body: this.lineFilterScene,\n                    xSizing: 'fill',\n                  }),\n                  new LogOptionsScene(),\n                ],\n              }),\n              new SceneFlexItem({\n                height: 'calc(100vh - 220px)',\n                body: this.logsPanelScene,\n              }),\n            ]\n          : [\n              new SceneFlexItem({\n                body: this.lineFilterScene,\n                xSizing: 'fill',\n              }),\n              new SceneFlexItem({\n                height: 'calc(100vh - 220px)',\n                body: new LogsTableScene({}),\n              }),\n            ],\n    });\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LogsListScene>) => {\n    const { panel } = model.useState();\n\n    if (!panel) {\n      return;\n    }\n\n    return (\n      <div className={styles.panelWrapper}>\n        <panel.Component model={panel} />\n      </div>\n    );\n  };\n}\n\nconst styles = {\n  panelWrapper: css({\n    // If you use hover-header without any header options we must manually hide the remnants, or it shows up as a 1px line in the top-right corner of the viz\n    '.show-on-hover': {\n      display: 'none',\n    },\n\n    // Hack to select internal div\n    'section > div[class$=\"panel-content\"]': css({\n      // A components withing the Logs viz sets contain, which creates a new containing block that is not body which breaks the popover menu\n      contain: 'none',\n      // Prevent overflow from spilling out of parent container\n      overflow: 'auto',\n    }),\n  }),\n};\n","import { sceneGraph, SceneObjectState } from '@grafana/scenes';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { logger } from '../../../../services/logger';\n\nexport interface FilterByPatternsButtonState extends SceneObjectState {\n  pattern: string;\n  type: 'exclude' | 'include' | 'undo';\n}\n\nexport interface FilterByPatternsState extends FilterByPatternsButtonState {\n  indexScene: IndexScene;\n}\n\nexport function onPatternClick(props: FilterByPatternsState) {\n  const { indexScene: staleIndex, pattern, type } = { ...props };\n\n  const indexScene = sceneGraph.getAncestor(staleIndex, IndexScene);\n\n  if (!indexScene) {\n    logger.warn('logs exploration scene not found');\n    return;\n  }\n\n  const { patterns = [] } = indexScene.state;\n\n  // Remove the pattern if it's already there\n  const filteredPatterns = patterns.filter((pat) => pat.pattern !== pattern);\n  // Analytics\n  const includePatternsLength = filteredPatterns.filter((p) => p.type === 'include')?.length ?? 0;\n  const excludePatternsLength = filteredPatterns.filter((p) => p.type === 'exclude')?.length ?? 0;\n  reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_selected, {\n    type: type,\n    includePatternsLength: includePatternsLength + (type === 'include' ? 1 : 0),\n    excludePatternsLength: excludePatternsLength + (type === 'exclude' ? 1 : 0),\n  });\n\n  // If we have type undo, then we don't need to add the pattern\n  if (type === 'undo') {\n    indexScene.setState({\n      patterns: filteredPatterns,\n    });\n  } else {\n    // Otherwise, add the pattern\n    indexScene.setState({\n      patterns: [...filteredPatterns, { pattern: pattern, type: type }],\n    });\n  }\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsStatsRow: css({\n    margin: `${theme.spacing(1.15)}px 0`,\n  }),\n  logsStatsRowActive: css({\n    color: theme.colors.primary.text,\n    position: 'relative',\n  }),\n  logsStatsRowLabel: css({\n    display: 'flex',\n    marginBottom: '1px',\n  }),\n  logsStatsRowValue: css({\n    flex: 1,\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n  }),\n  logsStatsRowCount: css({\n    textAlign: 'right',\n    marginLeft: theme.spacing(0.75),\n  }),\n  logsStatsRowPercent: css({\n    textAlign: 'right',\n    marginLeft: theme.spacing(0.75),\n    width: theme.spacing(4.5),\n  }),\n  logsStatsRowBar: css({\n    height: theme.spacing(0.5),\n    overflow: 'hidden',\n    background: theme.colors.text.disabled,\n  }),\n  logsStatsRowInnerBar: css({\n    height: theme.spacing(0.5),\n    overflow: 'hidden',\n    background: theme.colors.primary.main,\n  }),\n});\n\nexport interface Props {\n  active?: boolean;\n  count: number;\n  proportion: number;\n  value?: string;\n}\n\nexport const PatternFieldLabelStatsRow = ({ active, count, proportion, value }: Props) => {\n  const style = useStyles2(getStyles);\n  const percent = `${Math.round(proportion * 100)}%`;\n  const barStyle = { width: percent };\n\n  return (\n    <div className={active ? `${style.logsStatsRow} ${style.logsStatsRowActive}` : style.logsStatsRow}>\n      <div className={style.logsStatsRowLabel}>\n        <div className={style.logsStatsRowValue} title={value}>\n          {value}\n        </div>\n        <div className={style.logsStatsRowCount}>{count}</div>\n        <div className={style.logsStatsRowPercent}>{percent}</div>\n      </div>\n      <div className={style.logsStatsRowBar}>\n        <div className={style.logsStatsRowInnerBar} style={barStyle} />\n      </div>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { LogLabelStatsModel, GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\n//Components\nimport { PatternFieldLabelStatsRow } from './PatternFieldLabelStatsRow';\n\nconst STATS_ROW_LIMIT = 10;\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsStats: css({\n    background: 'inherit',\n    color: theme.colors.text.primary,\n    wordBreak: 'break-all',\n    width: 'fit-content',\n    maxHeight: '40vh',\n    overflowY: 'auto',\n    marginTop: theme.spacing(1),\n  }),\n  logsStatsHeader: css({\n    borderBottom: `1px solid ${theme.colors.border.medium}`,\n    display: 'flex',\n  }),\n  logsStatsTitle: css({\n    fontWeight: theme.typography.fontWeightMedium,\n    paddingRight: theme.spacing(2),\n    display: 'inline-block',\n    whiteSpace: 'nowrap',\n    textOverflow: 'ellipsis',\n    flexGrow: 1,\n  }),\n  logsStatsClose: css({\n    cursor: 'pointer',\n  }),\n  logsStatsBody: css({\n    padding: '5px 0px',\n  }),\n});\n\ninterface PatternFieldLabelStatsProps {\n  stats: LogLabelStatsModel[];\n  value: string;\n}\n\nexport const PatternFieldLabelStats = (props: PatternFieldLabelStatsProps) => {\n  const style = useStyles2(getStyles);\n\n  const { stats, value } = props;\n\n  const topRows = stats.slice(0, STATS_ROW_LIMIT);\n  let activeRow = topRows.find((row) => row.value === value);\n  let otherRows = stats.slice(STATS_ROW_LIMIT);\n  const insertActiveRow = !activeRow;\n\n  // Remove active row from other to show extra\n  if (insertActiveRow) {\n    activeRow = otherRows.find((row) => row.value === value);\n    otherRows = otherRows.filter((row) => row.value !== value);\n  }\n\n  const otherCount = otherRows.reduce((sum, row) => sum + row.count, 0);\n  const topCount = topRows.reduce((sum, row) => sum + row.count, 0);\n  const total = topCount + otherCount;\n\n  // Combine topRows and otherRows\n  let combinedRows = [...topRows];\n\n  // If there's an \"Other\" category, add it to combinedRows\n  if (otherCount > 0) {\n    combinedRows.push({ value: 'Other', count: otherCount, proportion: otherCount / total });\n  }\n\n  // Sort combinedRows by count in descending order\n  combinedRows.sort((a, b) => b.count - a.count);\n\n  return (\n    <div className={style.logsStats}>\n      <div className={style.logsStatsHeader}>\n        <div className={style.logsStatsTitle}>From a sample of {total} rows found</div>\n      </div>\n      <div className={style.logsStatsBody}>\n        {combinedRows.map((stat) => (\n          <PatternFieldLabelStatsRow key={stat.value} {...stat} active={stat.value === value} />\n        ))}\n      </div>\n    </div>\n  );\n};\n","import React, { useMemo, useRef, useState } from 'react';\nimport { AdHocFiltersVariable, sceneGraph } from '@grafana/scenes';\nimport { Spinner, Toggletip, useStyles2 } from '@grafana/ui';\nimport { getLokiDatasource } from 'services/scenes';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport { buildDataQuery } from 'services/query';\nimport { PatternFieldLabelStats } from './PatternFieldLabelStats';\nimport { GrafanaTheme2, LoadingState, LogLabelStatsModel, TimeRange } from '@grafana/data';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { css } from '@emotion/css';\nimport { getLabelsVariable } from '../../../../services/variableGetters';\n\ninterface PatternNameLabelProps {\n  exploration: IndexScene;\n  pattern: string;\n}\n\nconst LINE_LIMIT = 1000;\n\nexport const PatternNameLabel = ({ exploration, pattern }: PatternNameLabelProps) => {\n  const patternIndices = extractPatternIndices(pattern);\n  const [stats, setStats] = useState<LogLabelStatsModel[][] | undefined>(undefined);\n  const [statsError, setStatsError] = useState(false);\n  const styles = useStyles2(getStyles);\n\n  // Refs to store the previous values of query and timeRange\n  const previousQueryRef = useRef<string | null>(null);\n  const previousTimeRangeRef = useRef<TimeRange | null>(null);\n\n  const handlePatternClick = async () => {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_field_clicked);\n    const query = constructQuery(pattern, patternIndices, getLabelsVariable(exploration));\n    const datasource = await getLokiDatasource(exploration);\n    const currentTimeRange = sceneGraph.getTimeRange(exploration).state.value;\n\n    // If the query and timeRange are the same as the previous ones, do not re-query\n    if (stats && query === previousQueryRef.current && currentTimeRange === previousTimeRangeRef.current) {\n      return;\n    }\n\n    // Update the refs with the new values\n    previousQueryRef.current = query;\n    previousTimeRangeRef.current = currentTimeRange;\n\n    datasource\n      ?.query({\n        requestId: '1',\n        interval: '',\n        intervalMs: 0,\n        scopedVars: {},\n        range: currentTimeRange,\n        targets: [buildDataQuery(query, { maxLines: LINE_LIMIT })],\n        timezone: '',\n        app: '',\n        startTime: 0,\n      })\n      .forEach((result) => {\n        if (result.state === LoadingState.Done && !result.errors?.length) {\n          setStats(convertResultToStats(result, patternIndices.length));\n          setStatsError(false);\n        } else if (result.state === LoadingState.Error || result.errors?.length) {\n          setStats(undefined);\n          setStatsError(true);\n        }\n      });\n  };\n\n  const parts = useMemo(() => pattern.split('<_>'), [pattern]);\n\n  return (\n    <div>\n      {parts.map((part, index) => (\n        <span key={index}>\n          {part}\n          {index !== patternIndices.length && (\n            <Toggletip\n              onOpen={handlePatternClick}\n              content={\n                <>\n                  {stats && stats[index].length > 0 && <PatternFieldLabelStats stats={stats[index]} value=\"\" />}\n                  {stats && stats[index].length === 0 && (\n                    <div>No available stats for this field in the current timestamp.</div>\n                  )}\n                  {!stats && statsError && <div>Could not load stats for this pattern.</div>}\n                  {!stats && !statsError && (\n                    <div style={{ padding: '10px' }}>\n                      <Spinner size=\"xl\" />\n                    </div>\n                  )}\n                </>\n              }\n            >\n              <span className={styles.pattern}>&lt;_&gt;</span>\n            </Toggletip>\n          )}\n        </span>\n      ))}\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    pattern: css({\n      cursor: 'pointer',\n      backgroundColor: theme.colors.emphasize(theme.colors.background.primary, 0.1),\n      margin: '0 2px',\n\n      '&:hover': {\n        backgroundColor: theme.colors.emphasize(theme.colors.background.primary, 0.2),\n      },\n    }),\n  };\n}\n\n// Convert the result to statistics data structure\nfunction convertResultToStats(result: any, fieldCount: number): LogLabelStatsModel[][] {\n  const fieldStatsMap = new Map<string, Map<string, number>>();\n\n  // Populate the fieldStatsMap with values from the result\n  result.data[0].fields[0].values.toArray().forEach((value: Record<string, any>) => {\n    Object.keys(value).forEach((key) => {\n      if (!fieldStatsMap.has(key)) {\n        fieldStatsMap.set(key, new Map<string, number>());\n      }\n      fieldStatsMap.get(key)?.set(value[key], (fieldStatsMap.get(key)?.get(value[key]) || 0) + 1);\n    });\n  });\n\n  const stats: LogLabelStatsModel[][] = [];\n\n  // Construct stats array from fieldStatsMap\n  for (let i = 0; i <= fieldCount; i++) {\n    const fieldStats: LogLabelStatsModel[] = [];\n    fieldStatsMap.get(`field_${i + 1}`)?.forEach((count, key) => {\n      fieldStats.push({ value: key, count, proportion: count / LINE_LIMIT });\n    });\n    fieldStats.sort((a, b) => b.count - a.count);\n    stats.push(fieldStats);\n  }\n\n  return stats;\n}\n\n// Extract indices of the pattern '<_>' in the given string\nfunction extractPatternIndices(pattern: string): number[] {\n  const indices: number[] = [];\n  let currentIndex = pattern.indexOf('<_>');\n\n  while (currentIndex !== -1) {\n    indices.push(currentIndex);\n    currentIndex = pattern.indexOf('<_>', currentIndex + 1);\n  }\n  return indices;\n}\n\n// Construct the query string based on pattern and other conditions\nfunction constructQuery(pattern: string, patternIndices: number[], filters: AdHocFiltersVariable): string {\n  let fieldIndex = 1;\n  const patternExtractor = pattern.replace(/<_>/g, () => `<field_${fieldIndex++}>`);\n  const filterExpression = filters.state.filterExpression;\n  const fields = patternIndices.map((_value, index) => `field_${index + 1}`).join(' ,');\n  return `{${filterExpression}} |> \\`${pattern}\\` | pattern \\`${patternExtractor}\\` | keep ${fields} | line_format \"\"`;\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataProviderResult,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n  VizPanel,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { LoadingState } from '@grafana/data';\nimport { Alert, Button } from '@grafana/ui';\nimport {\n  LOG_STREAM_SELECTOR_EXPR,\n  PATTERNS_SAMPLE_SELECTOR_EXPR,\n  VAR_PATTERNS_EXPR,\n} from '../../../../services/variables';\nimport { buildDataQuery, renderPatternFilters } from '../../../../services/query';\nimport { getQueryRunner } from '../../../../services/panel';\nimport { AppliedPattern } from '../../../IndexScene/IndexScene';\nimport { PatternsViewTableScene } from './PatternsViewTableScene';\nimport { emptyStateStyles } from '../FieldsBreakdownScene';\nimport { getFieldsVariable, getLevelsVariable, getLineFilterVariable } from '../../../../services/variableGetters';\nimport { LokiQuery } from '../../../../services/lokiQuery';\nimport { logger } from '../../../../services/logger';\n\ninterface PatternsLogsSampleSceneState extends SceneObjectState {\n  pattern: string;\n  body?: SceneFlexLayout;\n}\nexport class PatternsLogsSampleScene extends SceneObjectBase<PatternsLogsSampleSceneState> {\n  constructor(state: PatternsLogsSampleSceneState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    if (this.state.body) {\n      return;\n    }\n\n    // We start by querying with the users current query context\n    const queryWithFilters = buildDataQuery(LOG_STREAM_SELECTOR_EXPR);\n    this.replacePatternsInQuery(queryWithFilters);\n\n    // but if that fails to return results, we fire the query without the filters, instead of showing no-data in the viz\n    const queryRunnerWithFilters = getQueryRunner([queryWithFilters]);\n    queryRunnerWithFilters.getResultsStream().subscribe((value) => {\n      this.onQueryWithFiltersResult(value);\n    });\n\n    this.setState({\n      body: new SceneFlexLayout({\n        direction: 'column',\n        children: [\n          new SceneFlexItem({\n            body: undefined,\n            width: '100%',\n            height: 0,\n          }),\n          new SceneFlexItem({\n            height: 300,\n            width: '100%',\n            body: PanelBuilders.logs()\n              .setHoverHeader(true)\n              .setOption('showLogContextToggle', true)\n              .setOption('showTime', true)\n              .setData(queryRunnerWithFilters)\n              .build(),\n          }),\n        ],\n      }),\n    });\n  }\n\n  private replacePatternsInQuery(queryWithFilters: LokiQuery) {\n    const pendingPattern: AppliedPattern = {\n      pattern: this.state.pattern,\n      type: 'include',\n    };\n    const patternsLine = renderPatternFilters([pendingPattern]);\n    queryWithFilters.expr = queryWithFilters.expr.replace(VAR_PATTERNS_EXPR, patternsLine);\n  }\n\n  private clearFilters = () => {\n    const filterVariable = getFieldsVariable(this);\n    const lineFilterVariable = getLineFilterVariable(this);\n    const levelsVariable = getLevelsVariable(this);\n    filterVariable.setState({\n      filters: [],\n    });\n    levelsVariable.setState({\n      filters: [],\n    });\n    if (lineFilterVariable.state.value) {\n      lineFilterVariable.changeValueTo('');\n\n      const noticeFlexItem = this.getNoticeFlexItem();\n\n      // The query we just fired is already correct after we clear the filters, we just need to hide the warning, and allow filtering\n      noticeFlexItem?.setState({\n        isHidden: true,\n      });\n\n      this.removePatternFromFilterExclusion();\n    }\n  };\n\n  private removePatternFromFilterExclusion() {\n    const patternsViewTableScene = sceneGraph.getAncestor(this, PatternsViewTableScene);\n    const patternsNotMatchingFilters = patternsViewTableScene.state.patternsNotMatchingFilters ?? [];\n\n    const index = patternsNotMatchingFilters.findIndex((pattern) => pattern === this.state.pattern);\n\n    if (index !== -1) {\n      patternsNotMatchingFilters.splice(index, 1);\n      // remove this pattern, as they can filter by this pattern again\n      patternsViewTableScene.setState({\n        patternsNotMatchingFilters: patternsNotMatchingFilters,\n      });\n    }\n  }\n\n  /**\n   * If the first query with the users filters applied fails, we run another one after removing the filters\n   * @param value\n   */\n  private onQueryError = (value: SceneDataProviderResult) => {\n    if (\n      (value.data.state === LoadingState.Done &&\n        (value.data.series.length === 0 || value.data.series.every((frame) => frame.length === 0))) ||\n      value.data.state === LoadingState.Error\n    ) {\n      // Logging an error so loki folks can debug why some patterns returned from the API seem to fail.\n      let logContext;\n      try {\n        logContext = {\n          pattern: this.state.pattern,\n          traceIds: JSON.stringify(value.data.traceIds),\n          request: JSON.stringify(value.data.request),\n        };\n      } catch (e) {\n        logContext = {\n          pattern: this.state.pattern,\n          msg: 'Failed to encode context',\n        };\n      }\n\n      // Logging an error so loki folks can debug why some patterns returned from the API seem to fail.\n      logger.error(new Error('Pattern sample query returns no results'), logContext);\n\n      this.setWarningMessage(\n        <Alert severity={'error'} title={''}>\n          This pattern returns no logs.\n        </Alert>\n      );\n\n      const panelFlexItem = this.getVizFlexItem();\n\n      // Run another query without the filters so we can still show log lines of what the pattern looks like.\n      if (panelFlexItem instanceof SceneFlexItem) {\n        panelFlexItem.setState({\n          isHidden: true,\n        });\n      }\n    }\n  };\n\n  private setWarningMessage(reactNode: React.ReactNode) {\n    const noticeFlexItem = this.getNoticeFlexItem();\n    const vizFlexItem = this.getVizFlexItem();\n\n    if (noticeFlexItem instanceof SceneFlexItem) {\n      noticeFlexItem.setState({\n        isHidden: false,\n        height: 'auto',\n        body: new SceneReactObject({\n          reactNode: reactNode,\n        }),\n      });\n    }\n    return vizFlexItem;\n  }\n\n  private getNoticeFlexItem() {\n    const children = this.getFlexItemChildren();\n    return children?.[0];\n  }\n  private getVizFlexItem() {\n    const children = this.getFlexItemChildren();\n    return children?.[1];\n  }\n\n  private getFlexItemChildren() {\n    return this.state.body?.state.children;\n  }\n\n  /**\n   * Callback to subscription of pattern sample query with all of the current query filters applied.\n   * If this query fails to return data, we show a warning, and attempt the pattern sample query again without applying the existing filters.\n   * We also add the pattern to the state of the PatternsTableViewScene so we can hide the filter buttons for this pattern, as including it would break the query\n   * @param value\n   */\n  private onQueryWithFiltersResult = (value: SceneDataProviderResult) => {\n    const queryWithoutFilters = buildDataQuery(PATTERNS_SAMPLE_SELECTOR_EXPR);\n    this.replacePatternsInQuery(queryWithoutFilters);\n\n    const queryRunnerWithoutFilters = getQueryRunner([queryWithoutFilters]);\n\n    // Subscribe to the secondary query, so we can log errors and update the UI\n    queryRunnerWithoutFilters.getResultsStream().subscribe(this.onQueryError);\n\n    if (\n      value.data.state === LoadingState.Done &&\n      (value.data.series.length === 0 || value.data.series.every((frame) => frame.length === 0))\n    ) {\n      const noticeFlexItem = this.getNoticeFlexItem();\n      const panelFlexItem = this.getVizFlexItem();\n\n      // Add a warning notice that the patterns shown will not show up in their current log results due to their existing filters.\n      if (noticeFlexItem instanceof SceneFlexItem) {\n        noticeFlexItem.setState({\n          isHidden: false,\n          height: 'auto',\n          body: new SceneReactObject({\n            reactNode: (\n              <Alert severity={'warning'} title={''}>\n                The logs returned by this pattern do not match the current query filters.\n                <Button className={emptyStateStyles.button} onClick={() => this.clearFilters()}>\n                  Clear filters\n                </Button>\n              </Alert>\n            ),\n          }),\n        });\n      }\n\n      // Run another query without the filters so we can still show log lines of what the pattern looks like.\n      if (panelFlexItem instanceof SceneFlexItem) {\n        const panel = panelFlexItem.state.body;\n        if (panel instanceof VizPanel) {\n          panel?.setState({\n            $data: queryRunnerWithoutFilters,\n          });\n        }\n      }\n      this.excludeThisPatternFromFiltering();\n    }\n\n    if (value.data.state === LoadingState.Error) {\n      this.onQueryError(value);\n    }\n  };\n\n  private excludeThisPatternFromFiltering() {\n    const patternsViewTableScene = sceneGraph.getAncestor(this, PatternsViewTableScene);\n    const patternsThatDontMatchCurrentFilters = patternsViewTableScene.state.patternsNotMatchingFilters ?? [];\n\n    // Add this pattern to the array of patterns that don't match current filters\n    patternsViewTableScene.setState({\n      patternsNotMatchingFilters: [...patternsThatDontMatchCurrentFilters, this.state.pattern],\n    });\n  }\n\n  public static Component({ model }: SceneComponentProps<PatternsLogsSampleScene>) {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n    return null;\n  }\n}\n","import React, { useEffect } from 'react';\nimport { PatternsLogsSampleScene } from './PatternsLogsSampleScene';\nimport { PatternsTableCellData, PatternsViewTableScene } from './PatternsViewTableScene';\n\ninterface ExpandedRowProps {\n  tableViz: PatternsViewTableScene;\n  row: PatternsTableCellData;\n}\n\nexport function PatternsTableExpandedRow({ tableViz, row }: ExpandedRowProps) {\n  const { expandedRows } = tableViz.useState();\n\n  const rowScene = expandedRows?.find((scene) => scene.state.key === row.pattern);\n\n  useEffect(() => {\n    if (!rowScene) {\n      const newRowScene = buildExpandedRowScene(row.pattern);\n      tableViz.setState({ expandedRows: [...(tableViz.state.expandedRows ?? []), newRowScene] });\n    }\n  }, [row, tableViz, rowScene]);\n\n  return rowScene ? <rowScene.Component model={rowScene} /> : null;\n}\n\nfunction buildExpandedRowScene(pattern: string) {\n  return new PatternsLogsSampleScene({\n    pattern: pattern,\n    key: pattern,\n  });\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataNode,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n} from '@grafana/scenes';\nimport { PatternFrame } from './PatternsBreakdownScene';\nimport React from 'react';\nimport { AppliedPattern, IndexScene } from '../../../IndexScene/IndexScene';\nimport { DataFrame, GrafanaTheme2, LoadingState, PanelData, scaledUnits } from '@grafana/data';\nimport { AxisPlacement, Column, InteractiveTable, TooltipDisplayMode, useTheme2 } from '@grafana/ui';\nimport { CellProps } from 'react-table';\nimport { css, cx } from '@emotion/css';\nimport { onPatternClick } from './FilterByPatternsButton';\nimport { FilterButton } from '../../../FilterButton';\nimport { config } from '@grafana/runtime';\nimport { testIds } from '../../../../services/testIds';\nimport { PatternsFrameScene } from './PatternsFrameScene';\nimport { PatternNameLabel } from './PatternNameLabel';\nimport { getExplorationFor } from 'services/scenes';\nimport { PatternsTableExpandedRow } from './PatternsTableExpandedRow';\n\n// copied from from grafana repository packages/grafana-data/src/valueFormats/categories.ts\n// that is used in Grafana codebase for \"short\" units\nconst SCALED_UNITS = ['', ' K', ' Mil', ' Bil', ' Tri', ' Quadr', ' Quint', ' Sext', ' Sept'];\nexport interface SingleViewTableSceneState extends SceneObjectState {\n  // The local copy of the pattern frames, the parent breakdown scene decides if we get the filtered subset or not, in this scene we just present the data\n  patternFrames: PatternFrame[] | undefined;\n  expandedRows?: SceneObject[];\n\n  // An array of patterns to exclude links\n  patternsNotMatchingFilters?: string[];\n}\n\nexport interface PatternsTableCellData {\n  pattern: string;\n  dataFrame: DataFrame;\n  sum: number;\n  includeLink: () => void;\n  excludeLink: () => void;\n  undoLink: () => void;\n}\n\nexport class PatternsViewTableScene extends SceneObjectBase<SingleViewTableSceneState> {\n  constructor(state: SingleViewTableSceneState) {\n    super(state);\n  }\n\n  public static Component = PatternTableViewSceneComponent;\n\n  /**\n   * Build columns for interactive table (wrapper for react-table v7)\n   * @param total\n   * @param appliedPatterns\n   * @param theme\n   * @param patternsNotMatchingFilters\n   * @protected\n   */\n  public buildColumns(\n    total: number,\n    appliedPatterns: AppliedPattern[] | undefined,\n    theme: GrafanaTheme2,\n    patternsNotMatchingFilters?: string[]\n  ) {\n    const styles = getColumnStyles(theme);\n    const timeRange = sceneGraph.getTimeRange(this).state.value;\n    const columns: Array<Column<PatternsTableCellData>> = [\n      {\n        id: 'volume-samples',\n        header: '',\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          const panelData: PanelData = {\n            timeRange: timeRange,\n            series: [props.cell.row.original.dataFrame],\n            state: LoadingState.Done,\n          };\n          const dataNode = new SceneDataNode({\n            data: panelData,\n          });\n\n          const timeSeries = PanelBuilders.timeseries()\n            .setData(dataNode)\n            .setHoverHeader(true)\n            .setOption('tooltip', {\n              mode: TooltipDisplayMode.None,\n            })\n            .setCustomFieldConfig('hideFrom', {\n              legend: true,\n              tooltip: true,\n            })\n            .setCustomFieldConfig('axisPlacement', AxisPlacement.Hidden)\n            .setDisplayMode('transparent')\n            .build();\n\n          return (\n            <div className={styles.tableTimeSeriesWrap}>\n              <div className={styles.tableTimeSeries}>\n                <timeSeries.Component model={timeSeries} />\n              </div>\n            </div>\n          );\n        },\n      },\n      {\n        id: 'count',\n        header: 'Count',\n        sortType: 'number',\n        cell: (props) => {\n          const value = scaledUnits(1000, SCALED_UNITS)(props.cell.row.original.sum);\n          return (\n            <div className={styles.countTextWrap}>\n              <div>\n                {value.prefix ?? ''}\n                {value.text}\n                {value.suffix ?? ''}\n              </div>\n            </div>\n          );\n        },\n      },\n      {\n        id: 'percent',\n        header: '%',\n        sortType: 'number',\n        cell: (props) => (\n          <div className={styles.countTextWrap}>\n            <div>{((100 * props.cell.row.original.sum) / total).toFixed(0)}%</div>\n          </div>\n        ),\n      },\n      {\n        id: 'pattern',\n        header: 'Pattern',\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          return (\n            <div className={cx(getTablePatternTextStyles(), styles.tablePatternTextDefault)}>\n              <PatternNameLabel exploration={getExplorationFor(this)} pattern={props.cell.row.original.pattern} />\n            </div>\n          );\n        },\n      },\n      {\n        id: 'include',\n        header: undefined,\n        disableGrow: true,\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          if (patternsNotMatchingFilters?.includes(props.cell.row.original.pattern)) {\n            return undefined;\n          }\n\n          const existingPattern = appliedPatterns?.find(\n            (appliedPattern) => appliedPattern.pattern === props.cell.row.original.pattern\n          );\n          const isIncluded = existingPattern?.type === 'include';\n          const isExcluded = existingPattern?.type === 'exclude';\n          return (\n            <FilterButton\n              isExcluded={isExcluded}\n              isIncluded={isIncluded}\n              onInclude={() => props.cell.row.original.includeLink()}\n              onExclude={() => props.cell.row.original.excludeLink()}\n              onClear={() => props.cell.row.original.undoLink()}\n              buttonFill={'outline'}\n            />\n          );\n        },\n      },\n    ];\n    return columns;\n  }\n\n  /**\n   * Filter visible patterns in table, and return cell data for InteractiveTable\n   * @param patternFrames\n   * @param legendSyncPatterns\n   * @private\n   */\n  public buildTableData(patternFrames: PatternFrame[], legendSyncPatterns: Set<string>): PatternsTableCellData[] {\n    const logExploration = sceneGraph.getAncestor(this, IndexScene);\n    return patternFrames\n      .filter((patternFrame) => {\n        return legendSyncPatterns.size ? legendSyncPatterns.has(patternFrame.pattern) : true;\n      })\n      .map((pattern: PatternFrame) => {\n        return {\n          dataFrame: pattern.dataFrame,\n          pattern: pattern.pattern,\n          sum: pattern.sum,\n          includeLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'include',\n              indexScene: logExploration,\n            }),\n          excludeLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'exclude',\n              indexScene: logExploration,\n            }),\n          undoLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'undo',\n              indexScene: logExploration,\n            }),\n        };\n      });\n  }\n}\n\nconst theme = config.theme2;\n\nconst getTablePatternTextStyles = () => {\n  return css({\n    minWidth: '200px',\n    fontFamily: theme.typography.fontFamilyMonospace,\n    overflow: 'hidden',\n    overflowWrap: 'break-word',\n  });\n};\n\nconst getTableStyles = (theme: GrafanaTheme2) => {\n  return {\n    link: css({\n      textDecoration: 'underline',\n    }),\n    tableWrap: css({\n      // Override interactive table style\n      '> div': {\n        // Need to define explicit height for overflowX\n        height: 'calc(100vh - 450px)',\n        minHeight: '470px',\n      },\n      // Make table headers sticky\n      th: {\n        top: 0,\n        position: 'sticky',\n        backgroundColor: theme.colors.background.canvas,\n        zIndex: theme.zIndex.navbarFixed,\n      },\n    }),\n  };\n};\nconst getColumnStyles = (theme: GrafanaTheme2) => {\n  return {\n    tablePatternTextDefault: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      minWidth: '200px',\n      maxWidth: '100%',\n      overflow: 'hidden',\n      overflowWrap: 'break-word',\n      fontSize: theme.typography.bodySmall.fontSize,\n      wordBreak: 'break-word',\n    }),\n    countTextWrap: css({\n      textAlign: 'right',\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n    tableTimeSeriesWrap: css({\n      width: '230px',\n      pointerEvents: 'none',\n    }),\n    tableTimeSeries: css({\n      height: '30px',\n      overflow: 'hidden',\n    }),\n  };\n};\n\nexport function PatternTableViewSceneComponent({ model }: SceneComponentProps<PatternsViewTableScene>) {\n  const indexScene = sceneGraph.getAncestor(model, IndexScene);\n  const { patterns: appliedPatterns } = indexScene.useState();\n  const theme = useTheme2();\n  const styles = getTableStyles(theme);\n\n  // Get state from parent\n  const patternsFrameScene = sceneGraph.getAncestor(model, PatternsFrameScene);\n  const { legendSyncPatterns } = patternsFrameScene.useState();\n\n  // Must use local patternFrames as the parent decides if we get the filtered or not\n  const { patternFrames: patternFramesRaw, patternsNotMatchingFilters } = model.useState();\n  const patternFrames = patternFramesRaw ?? [];\n\n  // Calculate total for percentages\n  const total = patternFrames.reduce((previousValue, frame) => {\n    return previousValue + frame.sum;\n  }, 0);\n\n  const tableData = model.buildTableData(patternFrames, legendSyncPatterns);\n  const columns = model.buildColumns(total, appliedPatterns, theme, patternsNotMatchingFilters);\n\n  return (\n    <div data-testid={testIds.patterns.tableWrapper} className={styles.tableWrap}>\n      <InteractiveTable\n        columns={columns}\n        data={tableData}\n        getRowId={(r: PatternsTableCellData) => r.pattern}\n        renderExpandedRow={(row) => <PatternsTableExpandedRow tableViz={model} row={row} />}\n      />\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { ConfigOverrideRule, FieldColor, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataNode,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { LegendDisplayMode, PanelContext, SeriesVisibilityChangeMode } from '@grafana/ui';\nimport { ServiceScene } from '../../ServiceScene';\nimport { onPatternClick } from './FilterByPatternsButton';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { PatternsViewTableScene } from './PatternsViewTableScene';\nimport { config } from '@grafana/runtime';\nimport { css } from '@emotion/css';\nimport { PatternFrame, PatternsBreakdownScene } from './PatternsBreakdownScene';\nimport { areArraysEqual } from '../../../../services/comparison';\nimport { logger } from '../../../../services/logger';\n\nconst palette = config.theme2.visualization.palette;\n\nexport interface PatternsFrameSceneState extends SceneObjectState {\n  body?: SceneCSSGridLayout;\n  loading?: boolean;\n  legendSyncPatterns: Set<string>;\n}\n\nexport class PatternsFrameScene extends SceneObjectBase<PatternsFrameSceneState> {\n  constructor(state?: Partial<PatternsFrameSceneState>) {\n    super({\n      loading: true,\n      ...state,\n      legendSyncPatterns: new Set(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  // parent render\n  public static Component = ({ model }: SceneComponentProps<PatternsFrameScene>) => {\n    const { body, loading } = model.useState();\n    const logsByServiceScene = sceneGraph.getAncestor(model, ServiceScene);\n    const { $patternsData } = logsByServiceScene.useState();\n    const patterns = $patternsData?.state.data?.series;\n\n    return (\n      <div className={styles.container}>\n        {!loading && patterns && patterns.length > 0 && <>{body && <body.Component model={body} />}</>}\n      </div>\n    );\n  };\n\n  private onActivate() {\n    this.updateBody();\n\n    // If the patterns have changed, recalculate the dataframes\n    this._subs.add(\n      sceneGraph.getAncestor(this, ServiceScene).subscribeToState((newState, prevState) => {\n        const newFrame = newState?.$patternsData?.state?.data?.series;\n        const prevFrame = prevState?.$patternsData?.state?.data?.series;\n\n        if (!areArraysEqual(newFrame, prevFrame)) {\n          const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n          this.updatePatterns(patternsBreakdownScene.state.patternFrames);\n\n          // In order to keep the search state from clearing, we need to clear the filtered state\n          patternsBreakdownScene.setState({\n            filteredPatterns: undefined,\n          });\n        }\n      })\n    );\n\n    // If the text search results have changed, update the components to use the filtered dataframe\n    this._subs.add(\n      sceneGraph.getAncestor(this, PatternsBreakdownScene).subscribeToState((newState, prevState) => {\n        const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n        if (newState.filteredPatterns && !areArraysEqual(newState.filteredPatterns, prevState.filteredPatterns)) {\n          this.updatePatterns(patternsBreakdownScene.state.filteredPatterns);\n        } else {\n          // If there is no search string, clear the state\n          if (!patternsBreakdownScene.state.patternFilter) {\n            this.updatePatterns(patternsBreakdownScene.state.patternFrames);\n          }\n        }\n      })\n    );\n  }\n\n  private async updatePatterns(patternFrames: PatternFrame[] = []) {\n    // CSS Grid doesn't need rebuilding, just the children need the updated dataframe\n    this.state.body?.forEachChild((child) => {\n      if (child instanceof VizPanel) {\n        child.setState({\n          $data: this.getTimeseriesDataNode(patternFrames),\n        });\n      }\n      if (child instanceof PatternsViewTableScene) {\n        child.setState({\n          patternFrames,\n        });\n      }\n    });\n  }\n\n  private async updateBody() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternsBreakdownScene.state.patternFrames;\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n\n    const lokiPatterns = serviceScene.state.$patternsData?.state.data?.series;\n    if (!lokiPatterns || !patternFrames) {\n      logger.warn('Failed to update PatternsFrameScene body');\n      return;\n    }\n\n    this.setState({\n      body: this.getSingleViewLayout(),\n      legendSyncPatterns: new Set(),\n      loading: false,\n    });\n  }\n\n  private extendTimeSeriesLegendBus(vizPanel: VizPanel, context: PanelContext) {\n    const originalOnToggleSeriesVisibility = context.onToggleSeriesVisibility;\n\n    context.onToggleSeriesVisibility = (label: string, mode: SeriesVisibilityChangeMode) => {\n      originalOnToggleSeriesVisibility?.(label, mode);\n\n      const override: ConfigOverrideRule | undefined = vizPanel.state.fieldConfig.overrides?.[0];\n      const patternsToShow: string[] = override?.matcher.options.names;\n      const legendSyncPatterns = new Set<string>();\n\n      if (patternsToShow) {\n        patternsToShow.forEach(legendSyncPatterns.add, legendSyncPatterns);\n      }\n\n      this.setState({\n        legendSyncPatterns,\n      });\n    };\n  }\n\n  private getSingleViewLayout() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternsBreakdownScene.state.patternFrames;\n\n    if (!patternFrames) {\n      logger.warn('Failed to set getSingleViewLayout');\n      return;\n    }\n\n    const timeSeries = this.getTimeSeries(patternFrames);\n\n    return new SceneCSSGridLayout({\n      templateColumns: '100%',\n      autoRows: '200px',\n      isLazy: true,\n\n      children: [\n        timeSeries,\n        new PatternsViewTableScene({\n          patternFrames,\n        }),\n      ],\n    });\n  }\n\n  private getTimeSeries(patternFrames: PatternFrame[]) {\n    const logExploration = sceneGraph.getAncestor(this, IndexScene);\n\n    const timeSeries = PanelBuilders.timeseries()\n      .setData(this.getTimeseriesDataNode(patternFrames))\n      .setOption('legend', {\n        asTable: true,\n        showLegend: true,\n        displayMode: LegendDisplayMode.Table,\n        placement: 'right',\n        width: 200,\n      })\n      .setHoverHeader(true)\n      .setUnit('short')\n      .setLinks([\n        {\n          url: '#',\n          targetBlank: false,\n          onClick: (event) => {\n            onPatternClick({\n              pattern: event.origin.labels.name,\n              type: 'include',\n              indexScene: logExploration,\n            });\n          },\n          title: 'Include',\n        },\n        {\n          url: '#',\n          targetBlank: false,\n          onClick: (event) => {\n            onPatternClick({\n              pattern: event.origin.labels.name,\n              type: 'exclude',\n              indexScene: logExploration,\n            });\n          },\n          title: 'Exclude',\n        },\n      ])\n      .build();\n\n    timeSeries.setState({\n      extendPanelContext: (vizPanel, context) => this.extendTimeSeriesLegendBus(vizPanel, context),\n    });\n\n    return timeSeries;\n  }\n\n  private getTimeseriesDataNode(patternFrames: PatternFrame[]) {\n    const timeRange = sceneGraph.getTimeRange(this).state.value;\n\n    return new SceneDataNode({\n      data: {\n        series: patternFrames.map((patternFrame, seriesIndex) => {\n          // Mutating the dataframe config here means that we don't need to update the colors in the table view\n          const dataFrame = patternFrame.dataFrame;\n          dataFrame.fields[1].config.color = overrideToFixedColor(seriesIndex);\n          dataFrame.fields[1].name = '';\n          return dataFrame;\n        }),\n        state: LoadingState.Done,\n        timeRange: timeRange,\n      },\n    });\n  }\n}\n\nexport function overrideToFixedColor(key: keyof typeof palette): FieldColor {\n  return {\n    mode: 'fixed',\n    fixedColor: palette[key] as string,\n  };\n}\n\nconst styles = {\n  container: css({\n    width: '100%',\n    // Hide header on hover hack\n    '.show-on-hover': {\n      display: 'none',\n    },\n  }),\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React, { ChangeEvent } from 'react';\nimport { Field } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { PatternFrame, PatternsBreakdownScene } from './PatternsBreakdownScene';\nimport { debouncedFuzzySearch, fuzzySearch } from '../../../../services/search';\nimport { SearchInput } from '../SearchInput';\nimport { areArraysEqual } from '../../../../services/comparison';\n\nexport interface PatternsViewTextSearchState extends SceneObjectState {}\n\nexport class PatternsViewTextSearch extends SceneObjectBase<PatternsViewTextSearchState> {\n  public static Component = PatternTextSearchComponent;\n\n  constructor(state?: Partial<PatternsViewTextSearchState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  /**\n   * On click callback to clear current text search\n   */\n  public clearSearch = () => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      patternFilter: '',\n    });\n  };\n\n  /**\n   * Search input onchange callback\n   * @param e\n   */\n  public handleSearchChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      patternFilter: e.target.value,\n    });\n  };\n\n  /**\n   * Activation handler\n   * @private\n   */\n  private onActivate() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    this._subs.add(\n      patternsBreakdownScene.subscribeToState((newState, prevState) => {\n        if (newState.patternFilter !== prevState.patternFilter) {\n          const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n          if (patternsBreakdownScene.state.patternFrames) {\n            debouncedFuzzySearch(\n              patternsBreakdownScene.state.patternFrames.map((frame) => frame.pattern),\n              patternsBreakdownScene.state.patternFilter,\n              this.onSearchResult\n            );\n          }\n        }\n      })\n    );\n\n    this._subs.add(\n      patternsBreakdownScene.subscribeToState((newState, prevState) => {\n        // If we have a search string, but no filtered patterns, run the search\n        if (\n          newState.patternFilter &&\n          !newState.filteredPatterns &&\n          newState.patternFrames &&\n          !areArraysEqual(newState.filteredPatterns, prevState.filteredPatterns)\n        ) {\n          fuzzySearch(\n            newState.patternFrames.map((frame) => frame.pattern),\n            newState.patternFilter,\n            this.onSearchResult\n          );\n        }\n      })\n    );\n  }\n\n  /**\n   * Sets the patterns filtered by string match\n   * @param patterns\n   * @param patternFramesOverride\n   */\n  setFilteredPatterns(patterns: string[], patternFramesOverride?: PatternFrame[]) {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternFramesOverride ?? patternsBreakdownScene.state.patternFrames;\n\n    if (patternFrames) {\n      const filteredPatternFrames = patternFrames.filter((patternFrame) => {\n        if (patternsBreakdownScene.state.patternFilter && patternFrames?.length) {\n          return patterns.find((pattern) => pattern === patternFrame.pattern);\n        }\n        return false;\n      });\n\n      patternsBreakdownScene.setState({\n        filteredPatterns: filteredPatternFrames,\n      });\n    }\n  }\n\n  /**\n   * Fuzzy search callback\n   * @param data\n   */\n  onSearchResult = (data: string[][]) => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    // If we have a search string\n    if (patternsBreakdownScene.state.patternFilter) {\n      this.setFilteredPatterns(data[0]);\n    } else if (patternsBreakdownScene.state.filteredPatterns && !patternsBreakdownScene.state.patternFilter) {\n      // Wipe the parent filtered state\n      this.setEmptySearch();\n    }\n  };\n\n  /**\n   * Wipes filtered patterns when search string is empty\n   */\n  private setEmptySearch() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      filteredPatterns: undefined,\n    });\n  }\n}\n\nconst styles = {\n  field: css({\n    label: 'field',\n    marginBottom: 0,\n  }),\n  icon: css({\n    cursor: 'pointer',\n  }),\n};\n\nexport function PatternTextSearchComponent({ model }: SceneComponentProps<PatternsViewTextSearch>) {\n  const patternsBreakdownScene = sceneGraph.getAncestor(model, PatternsBreakdownScene);\n  const { patternFilter } = patternsBreakdownScene.useState();\n  return (\n    <Field className={styles.field}>\n      <SearchInput\n        onChange={model.handleSearchChange}\n        onClear={model.clearSearch}\n        value={patternFilter}\n        placeholder=\"Search patterns\"\n      />\n    </Field>\n  );\n}\n","import { GrotError } from '../../../GrotError';\nimport { TextLink } from '@grafana/ui';\nimport React from 'react';\nimport { PATTERNS_MAX_AGE_HOURS } from './PatternsBreakdownScene';\n\nexport function PatternsNotDetected() {\n  return (\n    <GrotError>\n      <div>\n        <p>\n          <strong>Sorry, we could not detect any patterns.</strong>\n        </p>\n        <p>\n          Check back later or reach out to the team in the{' '}\n          <TextLink href=\"https://slack.grafana.com/\" external>\n            Grafana Labs community Slack channel\n          </TextLink>\n        </p>\n        <p>Patterns let you detect similar log lines to include or exclude from your search.</p>\n      </div>\n    </GrotError>\n  );\n}\n\nexport function PatternsTooOld() {\n  return (\n    <GrotError>\n      <div>\n        <p>\n          <strong>Patterns are only available for the most recent {PATTERNS_MAX_AGE_HOURS} hours of data.</strong>\n        </p>\n        <p>\n          See the{' '}\n          <TextLink\n            href=\"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/patterns/\"\n            external\n          >\n            patterns docs\n          </TextLink>{' '}\n          for more info.\n        </p>\n      </div>\n    </GrotError>\n  );\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { DataFrame, dateTime, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  CustomVariable,\n  SceneComponentProps,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport { Text, useStyles2 } from '@grafana/ui';\nimport { StatusWrapper } from 'Components/ServiceScene/Breakdowns/StatusWrapper';\nimport { VAR_LABEL_GROUP_BY } from 'services/variables';\nimport { ServiceScene } from '../../ServiceScene';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { PatternsFrameScene } from './PatternsFrameScene';\nimport { PatternsViewTextSearch } from './PatternsViewTextSearch';\nimport { PatternsNotDetected, PatternsTooOld } from './PatternsNotDetected';\nimport { areArraysEqual } from '../../../../services/comparison';\n\nexport interface PatternsBreakdownSceneState extends SceneObjectState {\n  body?: SceneFlexLayout;\n  value?: string;\n  loading?: boolean;\n  error?: string;\n  blockingMessage?: string;\n  // The dataframe built from the patterns that we get back from the loki Patterns API\n  patternFrames?: PatternFrame[];\n\n  // Subset of patternFrames, undefined if empty, empty array if search results returned nothing (no data)\n  filteredPatterns?: PatternFrame[];\n  patternFilter: string;\n}\n\nexport type PatternFrame = {\n  dataFrame: DataFrame;\n  pattern: string;\n  sum: number;\n  status?: 'include' | 'exclude';\n};\n\nexport const PATTERNS_MAX_AGE_HOURS = 3;\n\nexport class PatternsBreakdownScene extends SceneObjectBase<PatternsBreakdownSceneState> {\n  constructor(state: Partial<PatternsBreakdownSceneState>) {\n    super({\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [new CustomVariable({ name: VAR_LABEL_GROUP_BY, defaultToAll: true, includeAll: true })],\n        }),\n      loading: true,\n      patternFilter: '',\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  // parent render\n  public static Component = ({ model }: SceneComponentProps<PatternsBreakdownScene>) => {\n    const { body, loading, blockingMessage, patternFrames } = model.useState();\n    const { value: timeRange } = sceneGraph.getTimeRange(model).useState();\n    const styles = useStyles2(getStyles);\n    const timeRangeTooOld = dateTime().diff(timeRange.to, 'hours') >= PATTERNS_MAX_AGE_HOURS;\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          {!loading && !patternFrames && (\n            <div className={styles.patternMissingText}>\n              <Text textAlignment=\"center\" color=\"primary\">\n                <p>There are no pattern matches.</p>\n                <p>Pattern matching has not been configured.</p>\n                <p>Patterns let you detect similar log lines and add or exclude them from your search.</p>\n                <p>To see them in action, add the following to your configuration</p>\n                <p>\n                  <code>--pattern-ingester.enabled=true</code>\n                </p>\n              </Text>\n            </div>\n          )}\n\n          {!loading && patternFrames?.length === 0 && timeRangeTooOld && <PatternsTooOld />}\n          {!loading && patternFrames?.length === 0 && !timeRangeTooOld && <PatternsNotDetected />}\n          {!loading && patternFrames && patternFrames.length > 0 && (\n            <div className={styles.content}>{body && <body.Component model={body} />}</div>\n          )}\n        </StatusWrapper>\n      </div>\n    );\n  };\n\n  private onActivate() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    this.setBody();\n\n    const dataFrames = serviceScene.state.$patternsData?.state.data?.series;\n\n    // If the patterns exist already, update the dataframe\n    if (dataFrames) {\n      this.updatePatternFrames(dataFrames);\n    }\n\n    // Subscribe to changes from pattern API call\n    this._subs.add(serviceScene.state.$patternsData?.subscribeToState(this.onDataChange));\n  }\n\n  private onDataChange = (newState: SceneDataState, prevState: SceneDataState) => {\n    const newFrames = newState.data?.series;\n    const prevFrames = prevState.data?.series;\n\n    if (newState.data?.state === LoadingState.Done) {\n      this.setState({\n        loading: false,\n      });\n\n      if (!areArraysEqual(newFrames, prevFrames)) {\n        this.updatePatternFrames(newFrames);\n      }\n    } else if (newState.data?.state === LoadingState.Loading) {\n      this.setState({\n        loading: true,\n      });\n    }\n  };\n\n  private setBody() {\n    this.setState({\n      body: new SceneFlexLayout({\n        direction: 'column',\n        children: [\n          new SceneFlexItem({\n            ySizing: 'content',\n            body: new PatternsViewTextSearch(),\n          }),\n          new SceneFlexItem({\n            body: new PatternsFrameScene(),\n          }),\n        ],\n      }),\n    });\n  }\n\n  private updatePatternFrames(dataFrames?: DataFrame[]) {\n    if (!dataFrames) {\n      return;\n    }\n\n    const patternFrames = this.dataFrameToPatternFrame(dataFrames);\n\n    this.setState({\n      patternFrames,\n    });\n  }\n\n  private dataFrameToPatternFrame(dataFrame: DataFrame[]): PatternFrame[] {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const appliedPatterns = sceneGraph.getAncestor(serviceScene, IndexScene).state.patterns;\n\n    return dataFrame.map((dataFrame) => {\n      const existingPattern = appliedPatterns?.find((appliedPattern) => appliedPattern.pattern === dataFrame.name);\n\n      const sum: number = dataFrame.meta?.custom?.sum;\n      const patternFrame: PatternFrame = {\n        dataFrame,\n        pattern: dataFrame.name ?? '',\n        sum,\n        status: existingPattern?.type,\n      };\n\n      return patternFrame;\n    });\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      gap: theme.spacing(2),\n    }),\n    controlsRight: css({\n      flexGrow: 0,\n      display: 'flex',\n      justifyContent: 'flex-end',\n    }),\n    controlsLeft: css({\n      display: 'flex',\n      justifyContent: 'flex-left',\n      justifyItems: 'left',\n      width: '100%',\n      flexDirection: 'column',\n    }),\n    patternMissingText: css({\n      padding: theme.spacing(2),\n    }),\n  };\n}\n","import {\n  JSON_FORMAT_EXPR,\n  LEVEL_VARIABLE_VALUE,\n  LOGS_FORMAT_EXPR,\n  MIXED_FORMAT_EXPR,\n  VAR_FIELDS_EXPR,\n  VAR_LABELS_EXPR,\n  VAR_LINE_FILTER_EXPR,\n  VAR_METADATA_EXPR,\n  VAR_PATTERNS_EXPR,\n} from './variables';\nimport { SceneObject } from '@grafana/scenes';\nimport { getParserFromFieldsFilters } from './fields';\nimport { getFieldsVariable } from './variableGetters';\n\n/**\n * Crafts count over time query that excludes empty values for stream selector name\n * Will only add parsers if there are filters that require them.\n * @param sceneRef\n * @param streamSelectorName - the name of the stream selector we are aggregating by\n * @param excludeEmpty - if true, the query will exclude empty values for the given streamSelectorName\n */\nexport function getTimeSeriesExpr(sceneRef: SceneObject, streamSelectorName: string, excludeEmpty = true): string {\n  const fieldsVariable = getFieldsVariable(sceneRef);\n\n  let metadataExpressionToAdd = '';\n  if (excludeEmpty) {\n    // `LEVEL_VARIABLE_VALUE` is a special case where we don't want to add this to the stream selector\n    if (streamSelectorName === LEVEL_VARIABLE_VALUE) {\n      metadataExpressionToAdd = `| ${LEVEL_VARIABLE_VALUE} != \"\"`;\n    }\n  }\n\n  const fieldFilters = fieldsVariable.state.filters;\n  const parser = getParserFromFieldsFilters(fieldsVariable);\n\n  // if we have fields, we also need to add parsers\n  if (fieldFilters.length) {\n    if (parser === 'mixed') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_LINE_FILTER_EXPR} ${VAR_PATTERNS_EXPR} ${MIXED_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n    if (parser === 'json') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_LINE_FILTER_EXPR} ${VAR_PATTERNS_EXPR} ${JSON_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n    if (parser === 'logfmt') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_LINE_FILTER_EXPR} ${VAR_PATTERNS_EXPR} ${LOGS_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n  }\n  return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_LINE_FILTER_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n}\n","import React from 'react';\n\nimport { PanelBuilders, SceneComponentProps, SceneObjectBase, SceneObjectState, VizPanel } from '@grafana/scenes';\nimport { LegendDisplayMode, PanelContext, SeriesVisibilityChangeMode } from '@grafana/ui';\nimport { getQueryRunner, setLogsVolumeFieldConfigs, syncLogsPanelVisibleSeries } from 'services/panel';\nimport { buildDataQuery } from 'services/query';\nimport { LEVEL_VARIABLE_VALUE } from 'services/variables';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getTimeSeriesExpr } from '../../services/expressions';\nimport { toggleLevelFromFilter } from 'services/levels';\nimport { LoadingState } from '@grafana/data';\nimport { getFieldsVariable, getLabelsVariable, getLevelsVariable } from '../../services/variableGetters';\n\nexport interface LogsVolumePanelState extends SceneObjectState {\n  panel?: VizPanel;\n}\n\nexport class LogsVolumePanel extends SceneObjectBase<LogsVolumePanelState> {\n  constructor(state: LogsVolumePanelState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    if (!this.state.panel) {\n      this.setState({\n        panel: this.getVizPanel(),\n      });\n    }\n\n    const labels = getLabelsVariable(this);\n    const fields = getFieldsVariable(this);\n\n    labels.subscribeToState(() => {\n      this.setState({\n        panel: this.getVizPanel(),\n      });\n    });\n\n    fields.subscribeToState(() => {\n      this.setState({\n        panel: this.getVizPanel(),\n      });\n    });\n  }\n\n  private getVizPanel() {\n    const viz = PanelBuilders.timeseries()\n      .setTitle('Log volume')\n      .setOption('legend', { showLegend: true, calcs: ['sum'], displayMode: LegendDisplayMode.List })\n      .setUnit('short')\n      .setData(\n        getQueryRunner([\n          buildDataQuery(getTimeSeriesExpr(this, LEVEL_VARIABLE_VALUE, false), {\n            legendFormat: `{{${LEVEL_VARIABLE_VALUE}}}`,\n          }),\n        ])\n      );\n\n    setLogsVolumeFieldConfigs(viz);\n\n    const panel = viz.build();\n    panel.setState({\n      extendPanelContext: (_, context) => this.extendTimeSeriesLegendBus(context),\n    });\n\n    this._subs.add(\n      panel.state.$data?.subscribeToState((newState) => {\n        if (newState.data?.state !== LoadingState.Done) {\n          return;\n        }\n        syncLogsPanelVisibleSeries(panel, newState.data.series, this);\n      })\n    );\n\n    return panel;\n  }\n\n  private extendTimeSeriesLegendBus = (context: PanelContext) => {\n    const levelFilter = getLevelsVariable(this);\n    this._subs.add(\n      levelFilter?.subscribeToState(() => {\n        const panel = this.state.panel;\n        if (!panel?.state.$data?.state.data?.series) {\n          return;\n        }\n\n        syncLogsPanelVisibleSeries(panel, panel?.state.$data?.state.data?.series, this);\n      })\n    );\n\n    context.onToggleSeriesVisibility = (level: string, mode: SeriesVisibilityChangeMode) => {\n      // @TODO. We don't yet support filters with multiple values.\n      if (mode === SeriesVisibilityChangeMode.AppendToSelection) {\n        return;\n      }\n\n      const action = toggleLevelFromFilter(level, this);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.level_in_logs_volume_clicked,\n        {\n          level,\n          action,\n        }\n      );\n    };\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LogsVolumePanel>) => {\n    const { panel } = model.useState();\n    if (!panel) {\n      return;\n    }\n\n    return <panel.Component model={panel} />;\n  };\n}\n","import { PageSlugs, ValueSlugs } from '../../services/routing';\nimport { LogsListScene } from './LogsListScene';\nimport { testIds } from '../../services/testIds';\nimport { LabelBreakdownScene } from './Breakdowns/LabelBreakdownScene';\nimport { FieldsBreakdownScene } from './Breakdowns/FieldsBreakdownScene';\nimport { PatternsBreakdownScene } from './Breakdowns/Patterns/PatternsBreakdownScene';\nimport { SceneFlexItem, SceneFlexLayout, SceneObject } from '@grafana/scenes';\nimport { LogsVolumePanel } from './LogsVolumePanel';\nimport { buildLabelValuesBreakdownActionScene } from '../../services/labels';\n\ninterface ValueBreakdownViewDefinition {\n  displayName: string;\n  value: ValueSlugs;\n  testId: string;\n  getScene: (value: string) => SceneObject;\n}\n\nexport enum TabNames {\n  logs = 'Logs',\n  labels = 'Labels',\n  fields = 'Fields',\n  patterns = 'Patterns',\n}\nexport interface BreakdownViewDefinition {\n  displayName: TabNames;\n  value: PageSlugs;\n  testId: string;\n  getScene: (changeFields: (f: number) => void) => SceneObject;\n}\n\nexport const breakdownViewsDefinitions: BreakdownViewDefinition[] = [\n  {\n    displayName: TabNames.logs,\n    value: PageSlugs.logs,\n    getScene: () => buildLogsListScene(),\n    testId: testIds.exploreServiceDetails.tabLogs,\n  },\n  {\n    displayName: TabNames.labels,\n    value: PageSlugs.labels,\n    getScene: () => buildLabelBreakdownActionScene(),\n    testId: testIds.exploreServiceDetails.tabLabels,\n  },\n  {\n    displayName: TabNames.fields,\n    value: PageSlugs.fields,\n    getScene: (f) => buildFieldsBreakdownActionScene(f),\n    testId: testIds.exploreServiceDetails.tabFields,\n  },\n  {\n    displayName: TabNames.patterns,\n    value: PageSlugs.patterns,\n    getScene: () => buildPatternsScene(),\n    testId: testIds.exploreServiceDetails.tabPatterns,\n  },\n];\nexport const valueBreakdownViews: ValueBreakdownViewDefinition[] = [\n  {\n    displayName: 'Label',\n    value: ValueSlugs.label,\n    getScene: (value: string) => buildLabelValuesBreakdownActionScene(value),\n    testId: testIds.exploreServiceDetails.tabLabels,\n  },\n  {\n    displayName: 'Field',\n    value: ValueSlugs.field,\n    getScene: (value: string) => buildFieldValuesBreakdownActionScene(value),\n    testId: testIds.exploreServiceDetails.tabFields,\n  },\n];\n\nfunction buildPatternsScene() {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new PatternsBreakdownScene({}),\n      }),\n    ],\n  });\n}\n\nfunction buildFieldsBreakdownActionScene(changeFieldNumber: (n: number) => void) {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new FieldsBreakdownScene({ changeFieldCount: changeFieldNumber }),\n      }),\n    ],\n  });\n}\n\nfunction buildFieldValuesBreakdownActionScene(value: string) {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new FieldsBreakdownScene({ value }),\n      }),\n    ],\n  });\n}\n\nfunction buildLogsListScene() {\n  return new SceneFlexLayout({\n    direction: 'column',\n    children: [\n      new SceneFlexItem({\n        minHeight: 200,\n        body: new LogsVolumePanel({}),\n      }),\n      new SceneFlexItem({\n        minHeight: '470px',\n        height: 'calc(100vh - 500px)',\n        body: new LogsListScene({}),\n      }),\n    ],\n  });\n}\n\nfunction buildLabelBreakdownActionScene() {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new LabelBreakdownScene({}),\n      }),\n    ],\n  });\n}\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Box, Stack, Tab, TabsBar, useStyles2 } from '@grafana/ui';\nimport { getExplorationFor } from '../../services/scenes';\nimport { getDrilldownSlug, getDrilldownValueSlug, PageSlugs, ValueSlugs } from '../../services/routing';\nimport { GoToExploreButton } from './GoToExploreButton';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { navigateToDrilldownPage } from '../../services/navigate';\nimport React from 'react';\nimport { ServiceScene, ServiceSceneState } from './ServiceScene';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { BreakdownViewDefinition, breakdownViewsDefinitions } from './BreakdownViews';\n\nexport interface ActionBarSceneState extends SceneObjectState {}\n\nexport class ActionBarScene extends SceneObjectBase<ActionBarSceneState> {\n  public static Component = ({ model }: SceneComponentProps<ActionBarScene>) => {\n    const styles = useStyles2(getStyles);\n    const exploration = getExplorationFor(model);\n    let currentBreakdownViewSlug = getDrilldownSlug();\n    let allowNavToParent = false;\n\n    if (!Object.values(PageSlugs).includes(currentBreakdownViewSlug)) {\n      const drilldownValueSlug = getDrilldownValueSlug();\n      allowNavToParent = true;\n      if (drilldownValueSlug === ValueSlugs.field) {\n        currentBreakdownViewSlug = PageSlugs.fields;\n      }\n      if (drilldownValueSlug === ValueSlugs.label) {\n        currentBreakdownViewSlug = PageSlugs.labels;\n      }\n    }\n\n    const serviceScene = sceneGraph.getAncestor(model, ServiceScene);\n    const { loading, $data, ...state } = serviceScene.useState();\n    const loadingStates = state.loadingStates;\n\n    return (\n      <Box paddingY={0}>\n        <div className={styles.actions}>\n          <Stack gap={1}>\n            <GoToExploreButton exploration={exploration} />\n          </Stack>\n        </div>\n\n        <TabsBar>\n          {breakdownViewsDefinitions.map((tab, index) => {\n            return (\n              <Tab\n                data-testid={tab.testId}\n                key={index}\n                label={tab.displayName}\n                active={currentBreakdownViewSlug === tab.value}\n                counter={loadingStates[tab.displayName] ? undefined : getCounter(tab, { ...state, $data })}\n                icon={loadingStates[tab.displayName] ? 'spinner' : undefined}\n                onChangeTab={() => {\n                  if ((tab.value && tab.value !== currentBreakdownViewSlug) || allowNavToParent) {\n                    reportAppInteraction(\n                      USER_EVENTS_PAGES.service_details,\n                      USER_EVENTS_ACTIONS.service_details.action_view_changed,\n                      {\n                        newActionView: tab.value,\n                        previousActionView: currentBreakdownViewSlug,\n                      }\n                    );\n\n                    const serviceScene = sceneGraph.getAncestor(model, ServiceScene);\n                    navigateToDrilldownPage(tab.value, serviceScene);\n                  }\n                }}\n              />\n            );\n          })}\n        </TabsBar>\n      </Box>\n    );\n  };\n}\nconst getCounter = (tab: BreakdownViewDefinition, state: ServiceSceneState) => {\n  switch (tab.value) {\n    case 'fields':\n      return state.fieldsCount;\n    case 'patterns':\n      return state.patternsCount;\n    case 'labels':\n      return state.labelsCount;\n    default:\n      return undefined;\n  }\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    actions: css({\n      [theme.breakpoints.up(theme.breakpoints.values.md)]: {\n        position: 'absolute',\n        right: 0,\n        zIndex: 2,\n      },\n    }),\n  };\n}\n","import React from 'react';\n\nimport { LoadingState, PanelData } from '@grafana/data';\nimport {\n  QueryRunnerState,\n  SceneComponentProps,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VariableDependencyConfig,\n} from '@grafana/scenes';\nimport { LoadingPlaceholder } from '@grafana/ui';\nimport { getQueryRunner, getResourceQueryRunner } from 'services/panel';\nimport { buildDataQuery, buildResourceQuery } from 'services/query';\nimport {\n  EMPTY_VARIABLE_VALUE,\n  LEVEL_VARIABLE_VALUE,\n  LOG_STREAM_SELECTOR_EXPR,\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  VAR_DATASOURCE,\n  VAR_FIELDS,\n  VAR_LABELS,\n  VAR_LABELS_EXPR,\n  VAR_LEVELS,\n  VAR_PATTERNS,\n} from 'services/variables';\nimport { getMetadataService } from '../../services/metadata';\nimport { navigateToDrilldownPage, navigateToIndex, navigateToValueBreakdown } from '../../services/navigate';\nimport { areArraysEqual } from '../../services/comparison';\nimport { ActionBarScene } from './ActionBarScene';\nimport { breakdownViewsDefinitions, TabNames, valueBreakdownViews } from './BreakdownViews';\nimport {\n  getDataSourceVariable,\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getMetadataVariable,\n  getPatternsVariable,\n} from '../../services/variableGetters';\nimport { logger } from '../../services/logger';\nimport { IndexScene } from '../IndexScene/IndexScene';\nimport {\n  getDrilldownSlug,\n  getDrilldownValueSlug,\n  getPrimaryLabelFromUrl,\n  PageSlugs,\n  ValueSlugs,\n} from '../../services/routing';\nimport { replaceSlash } from '../../services/extensions/links';\n\nconst LOGS_PANEL_QUERY_REFID = 'logsPanelQuery';\nconst PATTERNS_QUERY_REFID = 'patterns';\nconst DETECTED_LABELS_QUERY_REFID = 'detectedLabels';\nconst DETECTED_FIELDS_QUERY_REFID = 'detectedFields';\n\ntype MakeOptional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\ntype ServiceSceneLoadingStates = {\n  [name in TabNames]: boolean;\n};\n\nexport interface ServiceSceneCustomState {\n  labelsCount?: number;\n  patternsCount?: number;\n  fieldsCount?: number;\n  loading?: boolean;\n}\n\nexport interface ServiceSceneState extends SceneObjectState, ServiceSceneCustomState {\n  body: SceneFlexLayout | undefined;\n  drillDownLabel?: string;\n  $data: SceneDataProvider | undefined;\n  $patternsData: SceneQueryRunner | undefined;\n  $detectedLabelsData: SceneQueryRunner | undefined;\n  $detectedFieldsData: SceneQueryRunner | undefined;\n  loadingStates: ServiceSceneLoadingStates;\n}\n\nexport function getLogsPanelFrame(data: PanelData | undefined) {\n  return data?.series.find((series) => series.refId === LOGS_PANEL_QUERY_REFID);\n}\n\nexport function getDetectedLabelsFrame(sceneRef: SceneObject) {\n  const serviceScene = sceneGraph.getAncestor(sceneRef, ServiceScene);\n  return serviceScene.state.$detectedLabelsData?.state.data?.series?.[0];\n}\n\nexport function getDetectedFieldsFrame(sceneRef: SceneObject) {\n  const serviceScene = sceneGraph.getAncestor(sceneRef, ServiceScene);\n  return getDetectedFieldsFrameFromQueryRunnerState(serviceScene.state.$detectedFieldsData?.state);\n}\n\nexport const getDetectedFieldsFrameFromQueryRunnerState = (state?: QueryRunnerState) => {\n  // Only ever one frame in the response\n  return state?.data?.series?.[0];\n};\n\nexport const getDetectedFieldsNamesFromQueryRunnerState = (state: QueryRunnerState) => {\n  // The first field, DETECTED_FIELDS_NAME_FIELD, has the list of names of the detected fields\n  return state.data?.series?.[0]?.fields?.[0];\n};\n\nexport class ServiceScene extends SceneObjectBase<ServiceSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_DATASOURCE, VAR_LABELS, VAR_FIELDS, VAR_PATTERNS, VAR_LEVELS],\n  });\n\n  public constructor(\n    state: MakeOptional<\n      ServiceSceneState,\n      'body' | '$data' | '$patternsData' | '$detectedLabelsData' | '$detectedFieldsData' | 'loadingStates'\n    >\n  ) {\n    super({\n      loadingStates: {\n        [TabNames.patterns]: false,\n        [TabNames.labels]: false,\n        [TabNames.fields]: false,\n        [TabNames.logs]: false,\n      },\n      loading: true,\n      body: state.body ?? buildGraphScene(),\n      $data: getServiceSceneQueryRunner(),\n      $patternsData: getPatternsQueryRunner(),\n      $detectedLabelsData: getDetectedLabelsQueryRunner(),\n      $detectedFieldsData: getDetectedFieldsQueryRunner(),\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private setSubscribeToLabelsVariable() {\n    const variable = getLabelsVariable(this);\n    if (variable.state.filters.length === 0) {\n      this.redirectToStart();\n      return;\n    }\n    this._subs.add(\n      variable.subscribeToState((newState, prevState) => {\n        if (newState.filters.length === 0) {\n          this.redirectToStart();\n        }\n        // If we remove the service name filter, we should redirect to the start\n        let { labelName, labelValue, breakdownLabel } = getPrimaryLabelFromUrl();\n\n        // Before we dynamically pulled label filter keys into the URL, we had hardcoded \"service\" as the primary label slug, we want to keep URLs the same, so overwrite \"service_name\" with \"service\" if that's the primary label\n        if (labelName === SERVICE_UI_LABEL) {\n          labelName = SERVICE_NAME;\n        }\n        const indexScene = sceneGraph.getAncestor(this, IndexScene);\n        const prevRouteMatch = indexScene.state.routeMatch;\n\n        // The \"primary\" label used in the URL is no longer active, pick a new one\n        if (!newState.filters.some((f) => f.key === labelName && f.operator === '=' && f.value === labelValue)) {\n          const newPrimaryLabel = newState.filters.find((f) => f.operator === '=' && f.value !== EMPTY_VARIABLE_VALUE);\n          if (newPrimaryLabel) {\n            indexScene.setState({\n              routeMatch: {\n                ...prevRouteMatch,\n                params: {\n                  ...prevRouteMatch?.params,\n                  labelName: newPrimaryLabel.key === SERVICE_NAME ? SERVICE_UI_LABEL : newPrimaryLabel.key,\n                  labelValue: replaceSlash(newPrimaryLabel.value),\n                },\n                url: prevRouteMatch?.url ?? '',\n                path: prevRouteMatch?.path ?? '',\n                isExact: prevRouteMatch?.isExact ?? true,\n              },\n            });\n\n            this.resetTabCount();\n\n            if (!breakdownLabel) {\n              navigateToDrilldownPage(getDrilldownSlug(), this);\n            } else {\n              navigateToValueBreakdown(getDrilldownValueSlug(), breakdownLabel, this);\n            }\n          } else {\n            this.redirectToStart();\n          }\n        } else if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.state.$patternsData?.runQueries();\n          this.state.$detectedLabelsData?.runQueries();\n          this.state.$detectedFieldsData?.runQueries();\n        }\n      })\n    );\n  }\n\n  private redirectToStart() {\n    // Clear ongoing queries\n    this.setState({\n      $data: undefined,\n      body: undefined,\n      $patternsData: undefined,\n      $detectedLabelsData: undefined,\n      $detectedFieldsData: undefined,\n      patternsCount: undefined,\n      labelsCount: undefined,\n      fieldsCount: undefined,\n    });\n    getMetadataService().setServiceSceneState(this.state);\n    this._subs.unsubscribe();\n\n    this.clearAdHocVariables();\n\n    // Redirect to root with updated params, which will trigger history push back to index route, preventing empty page or empty service query bugs\n    navigateToIndex();\n  }\n\n  /**\n   * If the scene has previously been activated, we can see cached variable states when re-activating\n   * To prevent this we clear out the variable filters\n   */\n  private clearAdHocVariables = () => {\n    const variables = [getLabelsVariable(this), getFieldsVariable(this), getLevelsVariable(this)];\n    variables.forEach((variable) => {\n      variable.setState({\n        filters: [],\n      });\n    });\n  };\n\n  /**\n   * After routing we need to pull any data set to the service scene by other routes from the metadata singleton,\n   * as each route has a different instantiation of this scene\n   * @private\n   */\n  private getMetadata() {\n    const metadataService = getMetadataService();\n    const state = metadataService.getServiceSceneState();\n\n    if (state) {\n      this.setState({\n        ...state,\n      });\n    }\n  }\n\n  private onActivate() {\n    this.getMetadata();\n    this.resetBodyAndData();\n\n    this.setBreakdownView();\n\n    // Run queries on activate\n    this.runQueries();\n\n    // Query Subscriptions\n    this._subs.add(this.subscribeToPatternsQuery());\n    this._subs.add(this.subscribeToDetectedLabelsQuery());\n\n    // Fields tab will update its own count, and update count when a query fails\n    if (getDrilldownSlug() !== PageSlugs.fields) {\n      this._subs.add(this.subscribeToDetectedFieldsQuery());\n    }\n\n    this._subs.add(this.subscribeToLogsQuery());\n\n    // Variable subscriptions\n    this.setSubscribeToLabelsVariable();\n    this._subs.add(this.subscribeToFieldsVariable());\n    this._subs.add(this.subscribeToMetadataVariable());\n    this._subs.add(this.subscribeToLevelsVariable());\n    this._subs.add(this.subscribeToDataSourceVariable());\n    this._subs.add(this.subscribeToPatternsVariable());\n\n    // Update query runner on manual time range change\n    this._subs.add(this.subscribeToTimeRange());\n  }\n\n  private subscribeToPatternsVariable() {\n    return getPatternsVariable(this).subscribeToState((newState, prevState) => {\n      if (newState.value !== prevState.value) {\n        this.state.$detectedFieldsData?.runQueries();\n      }\n    });\n  }\n\n  private subscribeToDataSourceVariable() {\n    return getDataSourceVariable(this).subscribeToState(() => {\n      this.redirectToStart();\n    });\n  }\n\n  private resetTabCount() {\n    this.setState({\n      fieldsCount: undefined,\n      labelsCount: undefined,\n      patternsCount: undefined,\n    });\n\n    getMetadataService().setServiceSceneState(this.state);\n  }\n\n  private subscribeToFieldsVariable() {\n    return getFieldsVariable(this).subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$detectedFieldsData?.runQueries();\n      }\n    });\n  }\n\n  private subscribeToMetadataVariable() {\n    return getMetadataVariable(this).subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$detectedFieldsData?.runQueries();\n      }\n    });\n  }\n\n  private subscribeToLevelsVariable() {\n    return getLevelsVariable(this).subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$detectedFieldsData?.runQueries();\n      }\n    });\n  }\n\n  private runQueries() {\n    const slug = getDrilldownSlug();\n    const parentSlug = getDrilldownValueSlug();\n\n    // If we don't have a patterns count in the tabs, or we are activating the patterns scene, run the pattern query\n    if (slug === PageSlugs.patterns || this.state.patternsCount === undefined) {\n      this.state.$patternsData?.runQueries();\n    }\n\n    // If we don't have a detected labels count, or we are activating the labels scene, run the detected labels query\n    if (slug === PageSlugs.labels || parentSlug === ValueSlugs.label || this.state.labelsCount === undefined) {\n      this.state.$detectedLabelsData?.runQueries();\n    }\n\n    // If we don't have a detected fields count, or we are activating the fields scene, run the detected fields query\n    if (slug === PageSlugs.fields || parentSlug === ValueSlugs.field || this.state.fieldsCount === undefined) {\n      this.state.$detectedFieldsData?.runQueries();\n    }\n  }\n\n  private subscribeToPatternsQuery() {\n    return this.state.$patternsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.patterns);\n      if (newState.data?.state === LoadingState.Done) {\n        const patternsResponse = newState.data.series;\n        if (patternsResponse?.length !== undefined) {\n          // Save the count of patterns to state\n          this.setState({\n            patternsCount: patternsResponse.length,\n          });\n          getMetadataService().setPatternsCount(patternsResponse.length);\n        }\n      }\n    });\n  }\n\n  private subscribeToDetectedLabelsQuery() {\n    return this.state.$detectedLabelsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.labels);\n      if (newState.data?.state === LoadingState.Done) {\n        const detectedLabelsResponse = newState.data;\n        // Detected labels API call always returns a single frame, with a field for each label\n        const detectedLabelsFields = detectedLabelsResponse.series[0].fields;\n        if (detectedLabelsResponse.series.length !== undefined && detectedLabelsFields.length !== undefined) {\n          const removeSpecialFields = detectedLabelsResponse.series[0].fields.filter(\n            (f) => LEVEL_VARIABLE_VALUE !== f.name\n          );\n\n          this.setState({\n            labelsCount: removeSpecialFields.length + 1, // Add one for detected_level\n          });\n          getMetadataService().setLabelsCount(detectedLabelsFields.length);\n        }\n      }\n    });\n  }\n\n  private updateLoadingState(newState: SceneDataState, key: keyof ServiceSceneLoadingStates) {\n    const loadingStates = this.state.loadingStates;\n    loadingStates[key] = newState.data?.state === LoadingState.Loading;\n    // set loading state to true if any of the queries are loading\n    const loading = Object.values(loadingStates).some((v) => v);\n    this.setState({ loading, loadingStates });\n  }\n\n  private subscribeToLogsQuery() {\n    return this.state.$data?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.logs);\n    });\n  }\n\n  private subscribeToDetectedFieldsQuery() {\n    return this.state.$detectedFieldsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.fields);\n      if (newState.data?.state === LoadingState.Done) {\n        const detectedFieldsResponse = newState.data;\n        const detectedFieldsFields = detectedFieldsResponse.series[0];\n\n        if (detectedFieldsFields !== undefined && detectedFieldsFields.length !== this.state.fieldsCount) {\n          this.setState({\n            fieldsCount: detectedFieldsFields.length,\n          });\n          getMetadataService().setFieldsCount(detectedFieldsFields.length);\n        }\n      }\n    });\n  }\n\n  private subscribeToTimeRange() {\n    return sceneGraph.getTimeRange(this).subscribeToState(() => {\n      this.state.$patternsData?.runQueries();\n      this.state.$detectedLabelsData?.runQueries();\n      this.state.$detectedFieldsData?.runQueries();\n    });\n  }\n\n  private resetBodyAndData() {\n    let stateUpdate: Partial<ServiceSceneState> = {};\n\n    if (!this.state.$data) {\n      stateUpdate.$data = getServiceSceneQueryRunner();\n    }\n\n    if (!this.state.$patternsData) {\n      stateUpdate.$patternsData = getPatternsQueryRunner();\n    }\n\n    if (!this.state.$detectedLabelsData) {\n      stateUpdate.$detectedLabelsData = getDetectedLabelsQueryRunner();\n    }\n\n    if (!this.state.$detectedFieldsData) {\n      stateUpdate.$detectedFieldsData = getDetectedFieldsQueryRunner();\n    }\n\n    if (!this.state.body) {\n      stateUpdate.body = buildGraphScene();\n    }\n\n    if (Object.keys(stateUpdate).length) {\n      this.setState(stateUpdate);\n    }\n  }\n\n  public setBreakdownView() {\n    const { body } = this.state;\n    const breakdownView = getDrilldownSlug();\n    const breakdownViewDef = breakdownViewsDefinitions.find((v) => v.value === breakdownView);\n\n    if (!body) {\n      const err = new Error('body is not defined in setBreakdownView!');\n      logger.error(err, { msg: 'ServiceScene setBreakdownView error' });\n      throw err;\n    }\n\n    if (breakdownViewDef) {\n      body.setState({\n        children: [\n          ...body.state.children.slice(0, 1),\n          breakdownViewDef.getScene((length) => {\n            if (breakdownViewDef.value === 'fields') {\n              this.setState({ fieldsCount: length });\n            }\n          }),\n        ],\n      });\n    } else {\n      const valueBreakdownView = getDrilldownValueSlug();\n      const valueBreakdownViewDef = valueBreakdownViews.find((v) => v.value === valueBreakdownView);\n\n      if (valueBreakdownViewDef && this.state.drillDownLabel) {\n        body.setState({\n          children: [...body.state.children.slice(0, 1), valueBreakdownViewDef.getScene(this.state.drillDownLabel)],\n        });\n      } else {\n        logger.error(new Error('not setting breakdown view'));\n      }\n    }\n  }\n\n  static Component = ({ model }: SceneComponentProps<ServiceScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n\nfunction buildGraphScene() {\n  return new SceneFlexLayout({\n    direction: 'column',\n    children: [\n      new SceneFlexItem({\n        ySizing: 'content',\n        body: new ActionBarScene({}),\n      }),\n    ],\n  });\n}\n\nfunction getPatternsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(`{${VAR_LABELS_EXPR}}`, 'patterns', { refId: PATTERNS_QUERY_REFID }),\n  ]);\n}\n\nfunction getDetectedLabelsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(`{${VAR_LABELS_EXPR}}`, 'detected_labels', { refId: DETECTED_LABELS_QUERY_REFID }),\n  ]);\n}\n\nfunction getDetectedFieldsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(LOG_STREAM_SELECTOR_EXPR, 'detected_fields', { refId: DETECTED_FIELDS_QUERY_REFID }),\n  ]);\n}\n\nfunction getServiceSceneQueryRunner() {\n  return getQueryRunner([buildDataQuery(LOG_STREAM_SELECTOR_EXPR, { refId: LOGS_PANEL_QUERY_REFID })]);\n}\n","import { Observable, of } from 'rxjs';\nimport {\n  MultiValueVariable,\n  MultiValueVariableState,\n  renderSelectForVariable,\n  SceneComponentProps,\n  VariableGetOptionsArgs,\n  VariableValueOption,\n  VariableValueSingle,\n} from '@grafana/scenes';\n\nexport interface CustomConstantVariableState extends MultiValueVariableState {\n  value: VariableValueSingle;\n  isMulti?: false;\n}\n\nexport class CustomConstantVariable extends MultiValueVariable<CustomConstantVariableState> {\n  public constructor(initialState: Partial<CustomConstantVariableState>) {\n    super({\n      type: 'custom',\n      value: '',\n      text: '',\n      options: [],\n      name: '',\n      ...initialState,\n    });\n  }\n\n  public getValueOptions(args: VariableGetOptionsArgs): Observable<VariableValueOption[]> {\n    return of(this.state.options);\n  }\n\n  public static Component = ({ model }: SceneComponentProps<MultiValueVariable>) => {\n    return renderSelectForVariable(model);\n  };\n}\n","import { reportInteraction } from '@grafana/runtime';\nimport pluginJson from '../plugin.json';\n\n// Helper function to create a unique interaction name for analytics\nconst createInteractionName = (page: UserEventPagesType, action: string) => {\n  return `${pluginJson.id.replace(/-/g, '_')}_${page}_${action}`;\n};\n\n// Runs reportInteraction with a standardized interaction name\nexport const reportAppInteraction = (\n  page: UserEventPagesType,\n  action: UserEventActionType,\n  properties?: Record<string, unknown>\n) => {\n  reportInteraction(createInteractionName(page, action), properties);\n};\n\nexport const USER_EVENTS_PAGES = {\n  service_selection: 'service_selection',\n  service_details: 'service_details',\n} as const;\n\ntype UserEventPagesType = keyof typeof USER_EVENTS_PAGES;\ntype UserEventActionType =\n  | keyof (typeof USER_EVENTS_ACTIONS)['service_selection']\n  | keyof (typeof USER_EVENTS_ACTIONS)['service_details'];\n\nexport const USER_EVENTS_ACTIONS = {\n  [USER_EVENTS_PAGES.service_selection]: {\n    // Searching for service using search input. Props: searchQueryLength, containsLevel\n    search_services_changed: 'search_services_changed',\n    // Selecting service. Props: service\n    service_selected: 'service_selected',\n    // Toggling aggregated metrics on/off\n    aggregated_metrics_toggled: 'aggregated_metrics_toggled',\n  },\n  [USER_EVENTS_PAGES.service_details]: {\n    open_in_explore_clicked: 'open_in_explore_clicked',\n    // Selecting action view tab (logs/labels/fields/patterns). Props: newActionView, previousActionView\n    action_view_changed: 'action_view_changed',\n    // Clicking on \"Include\" button in time series panels. Used in multiple views. The view type is passed as a parameter. Props: filterType, key, isFilterDuplicate, filtersLength\n    add_to_filters_in_breakdown_clicked: 'add_to_filters_in_breakdown_clicked',\n    // Clicking on \"Select\" button button in time series panels. Used in multiple views.The view type is passed as a parameter. Props: field, previousField, view\n    select_field_in_breakdown_clicked: 'select_field_in_breakdown_clicked',\n    // Clicking on one of the levels in the Logs Volume panel\n    level_in_logs_volume_clicked: 'level_in_logs_volume_clicked',\n    // Changing layout type (e.g. single/grid/rows). Used in multiple views. The view type is passed as a parameter. Props: layout, view\n    layout_type_changed: 'layout_type_changed',\n    // Changing search string in logs. Props: searchQuery\n    search_string_in_logs_changed: 'search_string_in_logs_changed',\n    // Removing a pattern (e.g. include/exclude) from the list. Props: includePatternsLength, excludePatternsLength, type\n    pattern_removed: 'pattern_removed',\n    // Selecting a pattern (e.g. include/exclude) from the list. Props: includePatternsLength, excludePatternsLength, type\n    pattern_selected: 'pattern_selected',\n    // Clicking on a pattern field in the pattern name.\n    pattern_field_clicked: 'pattern_field_clicked',\n    // Toggling between logs/table view\n    logs_visualization_toggle: 'logs_visualization_toggle',\n    // Filter (include, exclude) from log details\n    logs_detail_filter_applied: 'logs_detail_filter_applied',\n    // Popover menu filter\n    logs_popover_line_filter: 'logs_popover_line_filter',\n    // Toggle displayed fields\n    logs_toggle_displayed_field: 'logs_toggle_displayed_field',\n    // Clear all displayed fields\n    logs_clear_displayed_fields: 'logs_clear_displayed_fields',\n    // Value breakdown sort change\n    value_breakdown_sort_change: 'value_breakdown_sort_change',\n    // Wasm not supported\n    wasm_not_supported: 'wasm_not_supported',\n  },\n} as const;\n","import _ from 'lodash';\n\n/**\n * Order doesn't matter, converts to sets, deep compare via lodash isEqual\n * @param arr1\n * @param arr2\n */\n\nexport const areArraysEqual = (arr1: any[] | undefined, arr2: any[] | undefined) => {\n  // If one array is undefined, and the other is empty, they will cast to the same set.\n  if (typeof arr1 !== typeof arr2) {\n    return false;\n  }\n  const set1 = new Set(arr1);\n  const set2 = new Set(arr2);\n\n  // Save us from running the isEqual check if the set sizes are different\n  if (set1.size !== set2.size) {\n    return false;\n  }\n\n  return _.isEqual(set1, set2);\n};\n","import { MetricExpr, parser, Selector } from '@grafana/lezer-logql';\nimport { LokiQuery } from './lokiQuery';\nimport { getNodesFromQuery } from './logqlMatchers';\nimport { SceneDataQueryRequest } from './datasourceTypes';\n\nexport function isQueryWithNode(query: string, nodeType: number): boolean {\n  let isQueryWithNode = false;\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: ({ type }): false | void => {\n      if (type.id === nodeType) {\n        isQueryWithNode = true;\n        return false;\n      }\n    },\n  });\n  return isQueryWithNode;\n}\n\nexport function isLogsQuery(query: string): boolean {\n  // As a safeguard we are checking for a length of 2, because at least the query should be `{}`\n  return query.trim().length > 2 && !isQueryWithNode(query, MetricExpr);\n}\n\nexport function isLogsRequest(request: SceneDataQueryRequest) {\n  return request.targets.find((query) => isLogsQuery(query.expr)) !== undefined;\n}\n\nexport function requestSupportsSharding(request: SceneDataQueryRequest) {\n  if (isLogsRequest(request)) {\n    return false;\n  }\n  for (let i = 0; i < request.targets.length; i++) {\n    if (request.targets[i].expr?.includes('avg_over_time')) {\n      return false;\n    }\n  }\n  return true;\n}\n\nconst SHARDING_PLACEHOLDER = '__stream_shard_number__';\nexport const addShardingPlaceholderSelector = (query: string) => {\n  return query.replace('}', `, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`);\n};\n\nexport const interpolateShardingSelector = (queries: LokiQuery[], shards?: number[]) => {\n  if (shards === undefined || shards.length === 0) {\n    return queries.map((query) => ({\n      ...query,\n      expr: query.expr.replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, '}'),\n    }));\n  }\n\n  let shardValue = shards.join('|');\n\n  // -1 means empty shard value\n  if (shardValue === '-1' || shards.length === 1) {\n    shardValue = shardValue === '-1' ? '' : shardValue;\n    return queries.map((query) => ({\n      ...query,\n      expr: query.expr.replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, `, __stream_shard__=\"${shardValue}\"}`),\n    }));\n  }\n\n  return queries.map((query) => ({\n    ...query,\n    expr: query.expr.replace(new RegExp(`${SHARDING_PLACEHOLDER}`, 'g'), shardValue),\n  }));\n};\n\nexport const getSelectorForShardValues = (query: string) => {\n  const selector = getNodesFromQuery(query, [Selector]);\n  if (selector.length > 0) {\n    return query\n      .substring(selector[0].from, selector[0].to)\n      .replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, '}');\n  }\n  return '';\n};\n","import {\n  closestIdx,\n  DataFrame,\n  DataFrameType,\n  DataQueryResponse,\n  DataQueryResponseData,\n  Field,\n  FieldType,\n  QueryResultMetaStat,\n  shallowCompare,\n} from '@grafana/data';\nimport { logger } from './logger';\n\nexport function combineResponses(currentResult: DataQueryResponse | null, newResult: DataQueryResponse) {\n  if (!currentResult) {\n    return cloneQueryResponse(newResult);\n  }\n\n  newResult.data.forEach((newFrame) => {\n    const currentFrame = currentResult.data.find((frame) => shouldCombine(frame, newFrame));\n    if (!currentFrame) {\n      currentResult.data.push(cloneDataFrame(newFrame));\n      return;\n    }\n    mergeFrames(currentFrame, newFrame);\n  });\n\n  const mergedErrors = [...(currentResult.errors ?? []), ...(newResult.errors ?? [])];\n\n  // we make sure to have `.errors` as undefined, instead of empty-array\n  // when no errors.\n\n  if (mergedErrors.length > 0) {\n    currentResult.errors = mergedErrors;\n  }\n\n  // the `.error` attribute is obsolete now,\n  // but we have to maintain it, otherwise\n  // some grafana parts do not behave well.\n  // we just choose the old error, if it exists,\n  // otherwise the new error, if it exists.\n  const mergedError = currentResult.error ?? newResult.error;\n  if (mergedError != null) {\n    currentResult.error = mergedError;\n  }\n\n  const mergedTraceIds = [...(currentResult.traceIds ?? []), ...(newResult.traceIds ?? [])];\n  if (mergedTraceIds.length > 0) {\n    currentResult.traceIds = mergedTraceIds;\n  }\n\n  return currentResult;\n}\n\n/**\n * Given two data frames, merge their values. Overlapping values will be added together.\n */\nexport function mergeFrames(dest: DataFrame, source: DataFrame) {\n  const destTimeField = dest.fields.find((field) => field.type === FieldType.time);\n  const destIdField = dest.fields.find((field) => field.type === FieldType.string && field.name === 'id');\n  const sourceTimeField = source.fields.find((field) => field.type === FieldType.time);\n  const sourceIdField = source.fields.find((field) => field.type === FieldType.string && field.name === 'id');\n\n  if (!destTimeField || !sourceTimeField) {\n    logger.error(new Error(`Time fields not found in the data frames`));\n    return;\n  }\n\n  const sourceTimeValues = sourceTimeField?.values.slice(0) ?? [];\n  const totalFields = Math.max(dest.fields.length, source.fields.length);\n\n  for (let i = 0; i < sourceTimeValues.length; i++) {\n    const destIdx = resolveIdx(destTimeField, sourceTimeField, i);\n\n    const entryExistsInDest = compareEntries(destTimeField, destIdField, destIdx, sourceTimeField, sourceIdField, i);\n\n    for (let f = 0; f < totalFields; f++) {\n      // For now, skip undefined fields that exist in the new frame\n      if (!dest.fields[f]) {\n        continue;\n      }\n      // Index is not reliable when frames have disordered fields, or an extra/missing field, so we find them by name.\n      // If the field has no name, we fallback to the old index version.\n      const sourceField = findSourceField(dest.fields[f], source.fields, f);\n      if (!sourceField) {\n        continue;\n      }\n      // Same value, accumulate\n      if (entryExistsInDest) {\n        if (dest.fields[f].type === FieldType.time) {\n          // Time already exists, skip\n          continue;\n        } else if (dest.fields[f].type === FieldType.number) {\n          // Number, add\n          dest.fields[f].values[destIdx] = (dest.fields[f].values[destIdx] ?? 0) + sourceField.values[i];\n        } else if (dest.fields[f].type === FieldType.other) {\n          // Possibly labels, combine\n          if (typeof sourceField.values[i] === 'object') {\n            dest.fields[f].values[destIdx] = {\n              ...dest.fields[f].values[destIdx],\n              ...sourceField.values[i],\n            };\n          } else if (sourceField.values[i]) {\n            dest.fields[f].values[destIdx] = sourceField.values[i];\n          }\n        } else {\n          // Replace value\n          dest.fields[f].values[destIdx] = sourceField.values[i];\n        }\n      } else if (sourceField.values[i] !== undefined) {\n        // Insert in the `destIdx` position\n        dest.fields[f].values.splice(destIdx, 0, sourceField.values[i]);\n        if (sourceField.nanos) {\n          dest.fields[f].nanos = dest.fields[f].nanos ?? new Array(dest.fields[f].values.length - 1).fill(0);\n          dest.fields[f].nanos?.splice(destIdx, 0, sourceField.nanos[i]);\n        }\n      }\n    }\n  }\n\n  dest.length = dest.fields[0].values.length;\n\n  dest.meta = {\n    ...dest.meta,\n    stats: getCombinedMetadataStats(dest.meta?.stats ?? [], source.meta?.stats ?? []),\n  };\n}\n\nfunction resolveIdx(destField: Field, sourceField: Field, index: number) {\n  const idx = closestIdx(sourceField.values[index], destField.values);\n  if (idx < 0) {\n    return 0;\n  }\n  if (sourceField.values[index] === destField.values[idx] && sourceField.nanos && destField.nanos) {\n    return sourceField.nanos[index] > destField.nanos[idx] ? idx + 1 : idx;\n  }\n  if (sourceField.values[index] > destField.values[idx]) {\n    return idx + 1;\n  }\n  return idx;\n}\n\nfunction compareEntries(\n  destTimeField: Field,\n  destIdField: Field | undefined,\n  destIndex: number,\n  sourceTimeField: Field,\n  sourceIdField: Field | undefined,\n  sourceIndex: number\n) {\n  const sameTimestamp = compareNsTimestamps(destTimeField, destIndex, sourceTimeField, sourceIndex);\n  if (!sameTimestamp) {\n    return false;\n  }\n  if (!destIdField || !sourceIdField) {\n    return true;\n  }\n  // Log frames, check indexes\n  return (\n    destIdField.values[destIndex] !== undefined && destIdField.values[destIndex] === sourceIdField.values[sourceIndex]\n  );\n}\n\nfunction compareNsTimestamps(destField: Field, destIndex: number, sourceField: Field, sourceIndex: number) {\n  if (destField.nanos && sourceField.nanos) {\n    return (\n      destField.values[destIndex] !== undefined &&\n      destField.values[destIndex] === sourceField.values[sourceIndex] &&\n      destField.nanos[destIndex] !== undefined &&\n      destField.nanos[destIndex] === sourceField.nanos[sourceIndex]\n    );\n  }\n  return destField.values[destIndex] !== undefined && destField.values[destIndex] === sourceField.values[sourceIndex];\n}\n\nfunction findSourceField(referenceField: Field, sourceFields: Field[], index: number) {\n  const candidates = sourceFields.filter((f) => f.name === referenceField.name);\n\n  if (candidates.length === 1) {\n    return candidates[0];\n  }\n\n  if (referenceField.labels) {\n    return candidates.find((candidate) => shallowCompare(referenceField.labels ?? {}, candidate.labels ?? {}));\n  }\n\n  return sourceFields[index];\n}\n\nconst TOTAL_BYTES_STAT = 'Summary: total bytes processed';\n// This is specific for Loki\nfunction getCombinedMetadataStats(\n  destStats: QueryResultMetaStat[],\n  sourceStats: QueryResultMetaStat[]\n): QueryResultMetaStat[] {\n  // in the current approach, we only handle a single stat\n  const destStat = destStats.find((s) => s.displayName === TOTAL_BYTES_STAT);\n  const sourceStat = sourceStats.find((s) => s.displayName === TOTAL_BYTES_STAT);\n\n  if (sourceStat != null && destStat != null) {\n    return [{ value: sourceStat.value + destStat.value, displayName: TOTAL_BYTES_STAT, unit: destStat.unit }];\n  }\n\n  // maybe one of them exist\n  const eitherStat = sourceStat ?? destStat;\n  if (eitherStat != null) {\n    return [eitherStat];\n  }\n\n  return [];\n}\n\n/**\n * Deep clones a DataQueryResponse\n */\nexport function cloneQueryResponse(response: DataQueryResponse): DataQueryResponse {\n  const newResponse = {\n    ...response,\n    data: response.data.map(cloneDataFrame),\n  };\n  return newResponse;\n}\n\nfunction cloneDataFrame(frame: DataQueryResponseData): DataQueryResponseData {\n  return {\n    ...frame,\n    fields: frame.fields.map((field: Field) => ({\n      ...field,\n      values: field.values,\n    })),\n  };\n}\n\nfunction shouldCombine(frame1: DataFrame, frame2: DataFrame): boolean {\n  if (frame1.refId !== frame2.refId || frame1.name !== frame2.name) {\n    return false;\n  }\n\n  const frameType1 = frame1.meta?.type;\n  const frameType2 = frame2.meta?.type;\n\n  if (frameType1 !== frameType2) {\n    // we do not join things that have a different type\n    return false;\n  }\n\n  // metric range query data\n  if (frameType1 === DataFrameType.TimeSeriesMulti) {\n    const field1 = frame1.fields.find((f) => f.type === FieldType.number);\n    const field2 = frame2.fields.find((f) => f.type === FieldType.number);\n    if (field1 === undefined || field2 === undefined) {\n      // should never happen\n      return false;\n    }\n\n    return shallowCompare(field1.labels ?? {}, field2.labels ?? {});\n  }\n\n  // logs query data\n  // logs use a special attribute in the dataframe's \"custom\" section\n  // because we do not have a good \"frametype\" value for them yet.\n  const customType1 = frame1.meta?.custom?.frameType;\n  const customType2 = frame2.meta?.custom?.frameType;\n  // Legacy frames have this custom type\n  if (customType1 === 'LabeledTimeValues' && customType2 === 'LabeledTimeValues') {\n    return true;\n  } else if (customType1 === customType2) {\n    // Data plane frames don't\n    return true;\n  }\n\n  // should never reach here\n  return false;\n}\n","import pluginJson from '../plugin.json';\nimport { Observable, Subscriber, Subscription } from 'rxjs';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { DataQueryRequest, LoadingState, DataQueryResponse, QueryResultMetaStat } from '@grafana/data';\nimport { addShardingPlaceholderSelector, getSelectorForShardValues, interpolateShardingSelector } from './logql';\nimport { combineResponses } from './combineResponses';\nimport { DataSourceWithBackend } from '@grafana/runtime';\nimport { LokiQuery } from './lokiQuery';\nimport { logger } from './logger';\nimport { isValidQuery } from './logqlMatchers';\n\n/**\n * Query splitting by stream shards.\n * Query splitting was introduced in Loki to optimize querying for long intervals and high volume of data,\n * dividing a big request into smaller sub-requests, combining and displaying the results as they arrive.\n *\n * This approach, inspired by the time-based query splitting, takes advantage of the __stream_shard__\n * internal label, representing how data is spread into different sources that can be queried individually.\n *\n * The main entry point of this module is runShardSplitQuery(), which prepares the query for execution and\n * passes it to splitQueriesByStreamShard() to begin the querying loop.\n *\n * splitQueriesByStreamShard() has the following structure:\n * - Creates and returns an Observable to which the UI will subscribe\n * - Requests the __stream_shard__ values of the selected service:\n *   . If there are no shard values, it falls back to the standard querying approach of the data source in runNonSplitRequest()\n *   . If there are shards:\n *     - It sorts them by value, descending. Higher shard numbers correspond with the least volume.\n *     - It defines an initial group size, roughly Math.sqrt(amountOfShards).\n *     - It begins the querying loop with runNextRequest().\n * - runNextRequest() will create a group of groupSize shards from the nth shard (cycle), and has the following internal structure:\n *   . groupShardRequests() returns an array of shards from cycle to cycle + groupSize.\n *   . interpolateShardingSelector() will update the stream selector with the shard numbers in the current group.\n *   . After query execution:\n *     - If the response is successful:\n *       . It will add new data to the response with combineResponses()\n *       . Using the data and meta data of the response, updateGroupSizeFromResponse() will increase or decrease the group size.\n *       . nextRequest() will use the current cycle and group size to determine the next request or complete execution with done().\n *     - If the response is unsuccessful:\n *       . If the response is not a query error, and the group size bigger than 1, it will decrease the group size.\n *       . If the group size is already 1, it will retry the request up to 4 times.\n *       . If there are retry attempts, it will retry the current cycle, or else stop querying.\n * - Once all request groups have been executed, it will be done().\n */\n\nexport function runShardSplitQuery(datasource: DataSourceWithBackend<LokiQuery>, request: DataQueryRequest<LokiQuery>) {\n  const queries = datasource\n    .interpolateVariablesInQueries(request.targets, request.scopedVars)\n    .filter((query) => query.expr)\n    .map((target) => ({\n      ...target,\n      expr: addShardingPlaceholderSelector(target.expr),\n    }));\n\n  return splitQueriesByStreamShard(datasource, request, queries);\n}\n\nfunction splitQueriesByStreamShard(\n  datasource: DataSourceWithBackend<LokiQuery>,\n  request: DataQueryRequest<LokiQuery>,\n  splittingTargets: LokiQuery[]\n) {\n  let shouldStop = false;\n  let mergedResponse: DataQueryResponse = { data: [], state: LoadingState.Streaming, key: uuidv4() };\n  let subquerySubscription: Subscription | null = null;\n  let retriesMap = new Map<number, number>();\n  let retryTimer: ReturnType<typeof setTimeout> | null = null;\n\n  const runNextRequest = (\n    subscriber: Subscriber<DataQueryResponse>,\n    cycle: number,\n    shards: number[],\n    groupSize: number\n  ) => {\n    let nextGroupSize = groupSize;\n    let retrying = false;\n\n    if (subquerySubscription != null) {\n      subquerySubscription.unsubscribe();\n      subquerySubscription = null;\n    }\n\n    if (shouldStop) {\n      subscriber.complete();\n      return;\n    }\n\n    const done = () => {\n      mergedResponse.state = LoadingState.Done;\n      subscriber.next(mergedResponse);\n      subscriber.complete();\n    };\n\n    const nextRequest = () => {\n      const nextCycle = Math.min(cycle + groupSize, shards.length);\n      if (cycle < shards.length && nextCycle <= shards.length) {\n        runNextRequest(subscriber, nextCycle, shards, nextGroupSize);\n        return;\n      }\n      done();\n    };\n\n    const retry = (errorResponse?: DataQueryResponse) => {\n      if (errorResponse?.errors && errorResponse.errors[0].message?.includes('maximum of series')) {\n        logger.info(`Maximum series reached, skipping retry`);\n        return false;\n      } else if (errorResponse?.errors && errorResponse.errors[0].message?.includes('parse error')) {\n        logger.info(`Parse error, skipping retry`);\n        shouldStop = true;\n        return false;\n      }\n\n      if (groupSize > 1) {\n        groupSize = Math.floor(Math.sqrt(groupSize));\n        debug(`Possible time out, new group size ${groupSize}`);\n        retrying = true;\n        runNextRequest(subscriber, cycle, shards, groupSize);\n        return true;\n      }\n\n      const retries = retriesMap.get(cycle) ?? 0;\n      if (retries > 3) {\n        shouldStop = true;\n        return false;\n      }\n\n      retriesMap.set(cycle, retries + 1);\n\n      retryTimer = setTimeout(() => {\n        logger.info(`Retrying ${cycle} (${retries + 1})`);\n        runNextRequest(subscriber, cycle, shards, groupSize);\n        retryTimer = null;\n      }, 1500 * Math.pow(2, retries)); // Exponential backoff\n\n      retrying = true;\n\n      return true;\n    };\n\n    const shardsToQuery = groupShardRequests(shards, cycle, groupSize);\n    debug(`Querying ${shardsToQuery.join(', ')}`);\n    const subRequest = { ...request, targets: interpolateShardingSelector(splittingTargets, shardsToQuery) };\n    // Request may not have a request id\n    if (request.requestId) {\n      subRequest.requestId = `${request.requestId}_shard_${cycle}_${groupSize}`;\n    }\n\n    // @ts-expect-error\n    subquerySubscription = datasource.runQuery(subRequest).subscribe({\n      next: (partialResponse: DataQueryResponse) => {\n        if ((partialResponse.errors ?? []).length > 0 || partialResponse.error != null) {\n          if (retry(partialResponse)) {\n            return;\n          }\n        }\n        nextGroupSize = constrainGroupSize(\n          cycle + groupSize,\n          updateGroupSizeFromResponse(partialResponse, groupSize),\n          shards.length\n        );\n        if (nextGroupSize !== groupSize) {\n          debug(`New group size ${nextGroupSize}`);\n        }\n        mergedResponse = combineResponses(mergedResponse, partialResponse);\n      },\n      complete: () => {\n        if (retrying) {\n          return;\n        }\n        // Prevent flashing \"no data\"\n        if (mergedResponse.data.length) {\n          subscriber.next(mergedResponse);\n        }\n        nextRequest();\n      },\n      error: (error: unknown) => {\n        logger.error(error, { msg: 'failed to shard' });\n        subscriber.next(mergedResponse);\n        if (retry()) {\n          return;\n        }\n        nextRequest();\n      },\n    });\n  };\n\n  const runNonSplitRequest = (subscriber: Subscriber<DataQueryResponse>) => {\n    subquerySubscription = datasource.query(request).subscribe({\n      next: (partialResponse: DataQueryResponse) => {\n        mergedResponse = partialResponse;\n      },\n      complete: () => {\n        subscriber.next(mergedResponse);\n      },\n      error: (error: unknown) => {\n        logger.error(error, { msg: 'runNonSplitRequest subscription error' });\n        subscriber.error(mergedResponse);\n      },\n    });\n  };\n\n  const response = new Observable<DataQueryResponse>((subscriber) => {\n    const selector = getSelectorForShardValues(splittingTargets[0].expr);\n\n    if (!isValidQuery(selector)) {\n      console.log(`Skipping invalid selector: ${selector}`);\n      subscriber.complete();\n      return;\n    }\n\n    datasource.languageProvider\n      .fetchLabelValues('__stream_shard__', {\n        timeRange: request.range,\n        streamSelector: selector ? selector : undefined,\n      })\n      .then((values: string[]) => {\n        const shards = values.map((value) => parseInt(value, 10));\n        if (!shards || !shards.length) {\n          logger.warn(`Shard splitting not supported. Issuing a regular query.`);\n          runNonSplitRequest(subscriber);\n        } else {\n          shards.sort((a, b) => b - a);\n          debug(`Querying ${shards.join(', ')} shards`);\n          runNextRequest(subscriber, 0, shards, getInitialGroupSize(shards));\n        }\n      })\n      .catch((e: unknown) => {\n        logger.error(e, { msg: 'failed to fetch label values for __stream_shard__' });\n        runNonSplitRequest(subscriber);\n      });\n    return () => {\n      shouldStop = true;\n      if (retryTimer) {\n        clearTimeout(retryTimer);\n      }\n      if (subquerySubscription != null) {\n        subquerySubscription.unsubscribe();\n        subquerySubscription = null;\n      }\n    };\n  });\n\n  return response;\n}\n\nfunction updateGroupSizeFromResponse(response: DataQueryResponse, currentSize: number) {\n  if (!response.data.length) {\n    // Empty response, increase group size\n    return currentSize + 1;\n  }\n\n  const metaExecutionTime: QueryResultMetaStat | undefined = response.data[0].meta?.stats?.find(\n    (stat: QueryResultMetaStat) => stat.displayName === 'Summary: exec time'\n  );\n\n  if (metaExecutionTime) {\n    const executionTime = Math.round(metaExecutionTime.value);\n    debug(`${metaExecutionTime.value}`);\n    // Positive scenarios\n    if (executionTime <= 1) {\n      return Math.floor(currentSize * 1.5);\n    } else if (executionTime < 6) {\n      return Math.ceil(currentSize * 1.1);\n    }\n\n    // Negative scenarios\n    if (currentSize === 1) {\n      return currentSize;\n    } else if (executionTime < 20) {\n      return Math.ceil(currentSize * 0.9);\n    } else {\n      return Math.floor(currentSize / 2);\n    }\n  }\n\n  return currentSize;\n}\n\n/**\n * Prevents the group size for ever being more than maxFactor% of the pending shards.\n */\nfunction constrainGroupSize(cycle: number, groupSize: number, shards: number) {\n  const maxFactor = 0.7;\n  return Math.min(groupSize, Math.max(Math.floor((shards - cycle) * maxFactor), 1));\n}\n\nfunction groupShardRequests(shards: number[], start: number, groupSize: number) {\n  if (start === shards.length) {\n    return [-1];\n  }\n  return shards.slice(start, start + groupSize);\n}\n\nfunction getInitialGroupSize(shards: number[]) {\n  return Math.floor(Math.sqrt(shards.length));\n}\n\n// Enable to output debugging logs\nconst DEBUG_ENABLED = Boolean(localStorage.getItem(`${pluginJson.id}.sharding_debug_enabled`));\nfunction debug(message: string) {\n  if (!DEBUG_ENABLED) {\n    return;\n  }\n  console.log(message);\n}\n","import {\n  createDataFrame,\n  DataFrame,\n  DataQueryRequest,\n  DataQueryResponse,\n  Field,\n  FieldType,\n  LoadingState,\n  TestDataSourceResponse,\n} from '@grafana/data';\nimport { config, DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { RuntimeDataSource, sceneUtils } from '@grafana/scenes';\nimport { DataQuery } from '@grafana/schema';\nimport { Observable, Subscriber } from 'rxjs';\nimport { getDataSource } from './scenes';\nimport { getPrimaryLabelFromUrl, PLUGIN_ID } from './routing';\nimport { DetectedFieldsResponse, DetectedLabelsResponse } from './fields';\nimport { FIELDS_TO_REMOVE, LABELS_TO_REMOVE, sortLabelsByCardinality } from './filters';\nimport { SERVICE_NAME } from './variables';\nimport { runShardSplitQuery } from './shardQuerySplitting';\nimport { requestSupportsSharding } from './logql';\nimport { LokiQuery } from './lokiQuery';\nimport { SceneDataQueryRequest, SceneDataQueryResourceRequest } from './datasourceTypes';\nimport { logger } from './logger';\n\nexport const WRAPPED_LOKI_DS_UID = 'wrapped-loki-ds-uid';\n\ntype TimeStampOfVolumeEval = number;\ntype VolumeCount = string;\ntype VolumeValue = [TimeStampOfVolumeEval, VolumeCount];\ntype VolumeResult = {\n  metric: {\n    service_name?: string;\n    __aggregated_metric__?: string;\n    [index: string]: string | undefined;\n  };\n  value: VolumeValue;\n};\n\ntype IndexVolumeResponse = {\n  data: {\n    result: VolumeResult[];\n  };\n};\n\ntype LabelsResponse = {\n  status: string;\n  data: string[];\n};\n\ntype SampleTimeStamp = number;\ntype SampleCount = number;\ntype PatternSample = [SampleTimeStamp, SampleCount];\n\nexport interface LokiPattern {\n  pattern: string;\n  samples: PatternSample[];\n}\n\ntype PatternsResponse = {\n  data: LokiPattern[];\n};\n\nexport const DETECTED_FIELDS_NAME_FIELD = 'name';\n\nexport const DETECTED_FIELDS_CARDINALITY_NAME = 'cardinality';\n\nexport const DETECTED_FIELDS_PARSER_NAME = 'parser';\n\nexport const DETECTED_FIELDS_TYPE_NAME = 'type';\n\nexport class WrappedLokiDatasource extends RuntimeDataSource<DataQuery> {\n  constructor(pluginId: string, uid: string) {\n    super(pluginId, uid);\n  }\n\n  query(request: SceneDataQueryRequest): Promise<DataQueryResponse> | Observable<DataQueryResponse> {\n    return new Observable<DataQueryResponse>((subscriber) => {\n      if (!request.scopedVars?.__sceneObject) {\n        throw new Error('Scene object not found in request');\n      }\n\n      getDataSourceSrv()\n        .get(getDataSource(request.scopedVars.__sceneObject.valueOf()))\n        .then(async (ds) => {\n          if (!(ds instanceof DataSourceWithBackend)) {\n            throw new Error('Invalid datasource!');\n          }\n\n          // override the target datasource to Loki\n          request.targets = request.targets?.map((target) => {\n            target.datasource = ds;\n            return target;\n          });\n\n          const targetsSet = new Set();\n          request.targets.forEach((target) => {\n            targetsSet.add(target.resource ?? '');\n          });\n\n          if (targetsSet.size !== 1) {\n            throw new Error('A request cannot contain queries to multiple endpoints');\n          }\n\n          const requestType = request.targets[0].resource;\n\n          switch (requestType) {\n            case 'volume': {\n              await this.getVolume(request, ds, subscriber);\n              break;\n            }\n            case 'patterns': {\n              await this.getPatterns(request, ds, subscriber);\n              break;\n            }\n            case 'detected_labels': {\n              await this.getDetectedLabels(request, ds, subscriber);\n              break;\n            }\n            case 'detected_fields': {\n              await this.getDetectedFields(request, ds, subscriber);\n              break;\n            }\n            case 'labels': {\n              await this.getLabels(request, ds, subscriber);\n              break;\n            }\n            default: {\n              this.getData(request, ds, subscriber);\n              break;\n            }\n          }\n        });\n    });\n  }\n\n  private getData(\n    request: SceneDataQueryRequest,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const shardingEnabled = config.featureToggles.exploreLogsShardSplitting;\n\n    // Query the datasource and return either observable or promise\n    const dsResponse =\n      requestSupportsSharding(request) === false || !shardingEnabled\n        ? ds.query(request)\n        : runShardSplitQuery(ds, request);\n    dsResponse.subscribe(subscriber);\n\n    return subscriber;\n  }\n\n  private async getPatterns(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'patterns';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Patterns query can only have a single target!');\n    }\n    const { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const dsResponse = ds.getResource(\n        'patterns',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'patterns',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n      const response: PatternsResponse = await dsResponse;\n      const lokiPatterns = response?.data;\n\n      let maxValue = -Infinity;\n      let minValue = 0;\n\n      const frames: DataFrame[] =\n        lokiPatterns?.map((pattern: LokiPattern) => {\n          const timeValues: number[] = [];\n          const countValues: number[] = [];\n          let sum = 0;\n          pattern.samples.forEach(([time, count]) => {\n            timeValues.push(time * 1000);\n            countValues.push(count);\n            if (count > maxValue) {\n              maxValue = count;\n            }\n            if (count < minValue) {\n              minValue = count;\n            }\n            if (count > maxValue) {\n              maxValue = count;\n            }\n            if (count < minValue) {\n              minValue = count;\n            }\n            sum += count;\n          });\n          return createDataFrame({\n            refId: interpolatedTarget.refId,\n            name: pattern.pattern,\n            fields: [\n              {\n                name: 'time',\n                type: FieldType.time,\n                values: timeValues,\n                config: {},\n              },\n              {\n                name: pattern.pattern,\n                type: FieldType.number,\n                values: countValues,\n                config: {},\n              },\n            ],\n            meta: {\n              preferredVisualisationType: 'graph',\n              custom: {\n                sum,\n              },\n            },\n          });\n        }) ?? [];\n\n      frames.sort((a, b) => (b.meta?.custom?.sum as number) - (a.meta?.custom?.sum as number));\n      subscriber.next({ data: frames, state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  private interpolate(\n    ds: DataSourceWithBackend<LokiQuery>,\n    targets: Array<LokiQuery & SceneDataQueryResourceRequest>,\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>\n  ) {\n    const targetsInterpolated = ds.interpolateVariablesInQueries(targets, request.scopedVars);\n    if (!targetsInterpolated.length) {\n      throw new Error('Datasource failed to interpolate query!');\n    }\n    const interpolatedTarget = targetsInterpolated[0];\n    const expression = interpolatedTarget.expr;\n    return { interpolatedTarget, expression };\n  }\n\n  private async getDetectedLabels(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'detected_labels';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Detected labels query can only have a single target!');\n    }\n\n    const { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const response = await ds.getResource<DetectedLabelsResponse>(\n        'detected_labels',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'detected_labels',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      const { labelName: primaryLabelName } = getPrimaryLabelFromUrl();\n\n      const labels = response.detectedLabels\n        ?.filter((label) => primaryLabelName !== label.label && !LABELS_TO_REMOVE.includes(label.label))\n        ?.sort((a, b) => sortLabelsByCardinality(a, b));\n\n      const detectedLabelFields: Array<Partial<Field>> = labels?.map((label) => {\n        return {\n          name: label.label,\n          values: [label.cardinality],\n        };\n      });\n\n      const dataFrame = createDataFrame({\n        refId: interpolatedTarget.refId,\n        fields: detectedLabelFields ?? [],\n      });\n\n      subscriber.next({ data: [dataFrame], state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  private async getDetectedFields(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'detected_fields';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Detected fields query can only have a single target!');\n    }\n\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    const { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n\n    try {\n      const response = await ds.getResource<DetectedFieldsResponse>(\n        'detected_fields',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'detected_fields',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      const nameField: Field = { name: DETECTED_FIELDS_NAME_FIELD, type: FieldType.string, values: [], config: {} };\n      const cardinalityField: Field = {\n        name: DETECTED_FIELDS_CARDINALITY_NAME,\n        type: FieldType.number,\n        values: [],\n        config: {},\n      };\n      const parserField: Field = { name: DETECTED_FIELDS_PARSER_NAME, type: FieldType.string, values: [], config: {} };\n      const typeField: Field = { name: DETECTED_FIELDS_TYPE_NAME, type: FieldType.string, values: [], config: {} };\n\n      response.fields?.forEach((field) => {\n        if (!FIELDS_TO_REMOVE.includes(field.label)) {\n          nameField.values.push(field.label);\n          cardinalityField.values.push(field.cardinality);\n          parserField.values.push(field.parsers?.length ? field.parsers.join(', ') : 'structuredMetadata');\n          typeField.values.push(field.type);\n        }\n      });\n\n      const dataFrame = createDataFrame({\n        refId: interpolatedTarget.refId,\n        fields: [nameField, cardinalityField, parserField, typeField],\n      });\n\n      subscriber.next({ data: [dataFrame], state: LoadingState.Done });\n    } catch (e) {\n      logger.error(e, { msg: 'Detected fields error' });\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  //@todo doesn't work with multiple queries\n  private async getVolume(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    if (request.targets.length !== 1) {\n      throw new Error('Volume query can only have a single target!');\n    }\n\n    const targetsInterpolated = ds.interpolateVariablesInQueries(request.targets, request.scopedVars);\n    const expression = targetsInterpolated[0].expr.replace('.*.*', '.+');\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const volumeResponse: IndexVolumeResponse = await ds.getResource(\n        'index/volume',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n          limit: 5000,\n        },\n        {\n          requestId: request.requestId ?? 'volume',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n      volumeResponse?.data.result.sort((lhs: VolumeResult, rhs: VolumeResult) => {\n        const lVolumeCount: VolumeCount = lhs.value[1];\n        const rVolumeCount: VolumeCount = rhs.value[1];\n        return Number(rVolumeCount) - Number(lVolumeCount);\n      });\n      // Scenes will only emit dataframes from the SceneQueryRunner, so for now we need to convert the API response to a dataframe\n\n      const df = createDataFrame({\n        fields: [\n          {\n            // @todo rename\n            name: SERVICE_NAME,\n            values: volumeResponse?.data.result?.map((r) => {\n              const key = Object.keys(r.metric)[0];\n              return r.metric[key];\n            }),\n          },\n          { name: 'volume', values: volumeResponse?.data.result?.map((r) => Number(r.value[1])) },\n        ],\n      });\n\n      subscriber.next({ data: [df] });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    subscriber.complete();\n\n    return subscriber;\n  }\n\n  private async getLabels(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: DataSourceWithBackend<LokiQuery>,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    if (request.targets.length !== 1) {\n      throw new Error('Volume query can only have a single target!');\n    }\n\n    try {\n      const labelsResponse: LabelsResponse = await ds.getResource(\n        'labels',\n        {\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'labels',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      // Scenes will only emit dataframes from the SceneQueryRunner, so for now we need to convert the API response to a dataframe\n      const df = createDataFrame({\n        fields: [{ name: 'labels', values: labelsResponse?.data }],\n      });\n      subscriber.next({ data: [df], state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    subscriber.complete();\n\n    return subscriber;\n  }\n\n  testDatasource(): Promise<TestDataSourceResponse> {\n    return Promise.resolve({ status: 'success', message: 'Data source is working', title: 'Success' });\n  }\n}\n\nfunction init() {\n  sceneUtils.registerRuntimeDataSource({\n    dataSource: new WrappedLokiDatasource('wrapped-loki-ds', WRAPPED_LOKI_DS_UID),\n  });\n}\n\nexport default init;\n","import { DataFrame, Field, ReducerID } from '@grafana/data';\nimport { DrawStyle, StackingMode } from '@grafana/ui';\nimport {\n  AdHocFiltersVariable,\n  PanelBuilders,\n  SceneCSSGridItem,\n  SceneDataTransformer,\n  SceneObject,\n} from '@grafana/scenes';\nimport { getColorByIndex } from './scenes';\nimport { AddToFiltersButton, VariableFilterType } from 'Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport {\n  LEVEL_VARIABLE_VALUE,\n  LogsQueryOptions,\n  ParserType,\n  VAR_FIELDS,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_METADATA,\n} from './variables';\nimport { setLevelColorOverrides } from './panel';\nimport { map, Observable } from 'rxjs';\nimport { SortBy, SortByScene } from '../Components/ServiceScene/Breakdowns/SortByScene';\nimport { getDetectedFieldsFrame } from '../Components/ServiceScene/ServiceScene';\nimport { averageFields } from '../Components/ServiceScene/Breakdowns/FieldsBreakdownScene';\nimport { getLogsStreamSelector, getValueFromFieldsFilter } from './variableGetters';\nimport { LabelType } from './fieldsTypes';\nimport { logger } from './logger';\n\nexport type DetectedLabel = {\n  label: string;\n  cardinality: number;\n};\n\nexport type DetectedLabelsResponse = {\n  detectedLabels: DetectedLabel[];\n};\n\nexport type DetectedField = {\n  label: string;\n  cardinality: number;\n  type: string;\n  parsers: string[] | null;\n};\n\nexport type DetectedFieldsResponse = {\n  fields: DetectedField[];\n};\n\nconst getReducerId = (sortBy: SortBy) => {\n  if (sortBy) {\n    const values: string[] = Object.values(ReducerID);\n    if (values.includes(sortBy)) {\n      return sortBy;\n    }\n  }\n  return undefined;\n};\n\n/**\n * Extracts the ExtractedFieldsType from the string returned on the detected_fields api parser field value\n * @param parserString\n */\nexport function extractParserFromString(parserString?: string): ParserType {\n  switch (parserString) {\n    case 'json':\n      return 'json';\n    case 'logfmt':\n      return 'logfmt';\n    case '': // Structured metadata is empty\n      return 'structuredMetadata';\n    case 'structuredMetadata': // Structured metadata is empty\n      return 'structuredMetadata';\n    default: // if we get a parser with multiple\n      return 'mixed';\n  }\n}\n\nexport function extractParserFromArray(parsers?: string[]): ParserType {\n  const parsersSet = new Set(parsers?.map((v) => v.toString()) ?? []);\n\n  // Structured metadata doesn't change the parser we use, so remove it\n  parsersSet.delete('structuredMetadata');\n\n  // get unique values\n  const parsersArray = Array.from(parsersSet);\n\n  if (parsersArray.length === 1) {\n    return extractParserFromString(parsersArray[0]);\n  }\n\n  // If the set size is zero, we only had structured metadata detected as a parser\n  if (parsersSet.size === 0) {\n    return 'structuredMetadata';\n  }\n\n  // Otherwise if there was more then one value, return mixed parser\n  return 'mixed';\n}\n\nexport function getParserForField(fieldName: string, sceneRef: SceneObject): ParserType | undefined {\n  const detectedFieldsFrame = getDetectedFieldsFrame(sceneRef);\n  const parserField: Field<string> | undefined = detectedFieldsFrame?.fields[2];\n  const namesField: Field<string> | undefined = detectedFieldsFrame?.fields[0];\n\n  const index = namesField?.values.indexOf(fieldName);\n  const parser =\n    index !== undefined && index !== -1 ? extractParserFromString(parserField?.values?.[index] ?? '') : undefined;\n\n  if (parser === undefined) {\n    logger.warn('missing parser, using mixed format for', { fieldName });\n    return 'mixed';\n  }\n  return parser;\n}\n\nexport function getFilterBreakdownValueScene(\n  getTitle: (df: DataFrame) => string,\n  style: DrawStyle,\n  variableName: typeof VAR_FIELDS | typeof VAR_LABELS | typeof VAR_METADATA,\n  sortByScene: SortByScene\n) {\n  return (frame: DataFrame, frameIndex: number) => {\n    const reducerID = getReducerId(sortByScene.state.sortBy);\n    const panel = PanelBuilders.timeseries() //\n      .setOption('legend', { showLegend: false })\n      .setCustomFieldConfig('fillOpacity', 9)\n      .setTitle(getTitle(frame))\n      .setData(\n        new SceneDataTransformer({\n          transformations: [() => selectFrameTransformation(frame)],\n        })\n      )\n      .setColor({ mode: 'fixed', fixedColor: getColorByIndex(frameIndex) })\n      .setOverrides(setLevelColorOverrides)\n      .setHeaderActions(new AddToFiltersButton({ frame, variableName }));\n\n    if (style === DrawStyle.Bars) {\n      panel\n        .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n        .setCustomFieldConfig('fillOpacity', 100)\n        .setCustomFieldConfig('lineWidth', 0)\n        .setCustomFieldConfig('pointSize', 0)\n        .setOverrides(setLevelColorOverrides)\n        .setCustomFieldConfig('drawStyle', DrawStyle.Bars);\n    }\n\n    if (reducerID) {\n      panel.setOption('legend', {\n        showLegend: true,\n        calcs: [reducerID],\n      });\n      // These will only have a single series, no need to show the title twice\n      panel.setDisplayName(' ');\n    }\n\n    return new SceneCSSGridItem({\n      body: panel.build(),\n    });\n  };\n}\n\nexport function selectFrameTransformation(frame: DataFrame) {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map(() => {\n        return [frame];\n      })\n    );\n  };\n}\n\nexport function getLabelTypeFromFrame(labelKey: string, frame: DataFrame, index = 0): null | LabelType {\n  const typeField = frame.fields.find((field) => field.name === 'labelTypes')?.values[index];\n  if (!typeField) {\n    return null;\n  }\n  switch (typeField[labelKey]) {\n    case 'I':\n      return LabelType.Indexed;\n    case 'S':\n      return LabelType.StructuredMetadata;\n    case 'P':\n      return LabelType.Parsed;\n    default:\n      return null;\n  }\n}\n\n/**\n * Returns the variable to use when adding filters in a panel.\n * @param frame\n * @param key\n * @param sceneRef\n */\nexport function getVariableForLabel(\n  frame: DataFrame | undefined,\n  key: string,\n  sceneRef: SceneObject\n): VariableFilterType {\n  const labelType = frame ? getLabelTypeFromFrame(key, frame) : LabelType.Parsed;\n\n  if (labelType) {\n    // Otherwise use the labelType from the dataframe\n    return getFilterTypeFromLabelType(labelType, key);\n  }\n\n  // If the dataframe doesn't have labelTypes, check if the detected_fields response returned a parser.\n  const parserForThisField = getParserForField(key, sceneRef);\n  if (parserForThisField === 'structuredMetadata') {\n    return VAR_METADATA;\n  }\n\n  logger.warn('unable to determine label variable, falling back to parsed field', {\n    key,\n    parserForThisField: parserForThisField ?? '',\n  });\n\n  return VAR_FIELDS;\n}\n\nexport function getFilterTypeFromLabelType(type: LabelType, key: string): VariableFilterType {\n  switch (type) {\n    case LabelType.Indexed: {\n      return VAR_LABELS;\n    }\n    case LabelType.Parsed: {\n      return VAR_FIELDS;\n    }\n    case LabelType.StructuredMetadata: {\n      // Structured metadata is either a special level variable, or a field variable\n      if (key === LEVEL_VARIABLE_VALUE) {\n        return VAR_LEVELS;\n      }\n      return VAR_METADATA;\n    }\n    default: {\n      const err = new Error(`Invalid label type for ${key}`);\n      logger.error(err, { type, msg: `Invalid label type for ${key}` });\n      throw err;\n    }\n  }\n}\n\nexport function getParserFromFieldsFilters(fields: AdHocFiltersVariable): ParserType {\n  const parsers = fields.state.filters.map((filter) => {\n    return getValueFromFieldsFilter(filter).parser;\n  });\n\n  return extractParserFromArray(parsers);\n}\n\nexport function isAvgField(field: string) {\n  return averageFields.includes(field);\n}\n\nexport function buildFieldsQuery(optionValue: string, options: LogsQueryOptions) {\n  if (isAvgField(optionValue)) {\n    return (\n      `avg_over_time(${getLogsStreamSelector(options)} | unwrap ` +\n      (optionValue === 'duration' ? `duration` : optionValue === 'bytes' ? `bytes` : ``) +\n      `(${optionValue}) [$__auto]) by ()`\n    );\n  } else {\n    return `sum by (${optionValue}) (count_over_time(${getLogsStreamSelector(options)} [$__auto]))`;\n  }\n}\n\nexport function buildFieldsQueryString(\n  optionValue: string,\n  fieldsVariable: AdHocFiltersVariable,\n  detectedFieldsFrame?: DataFrame\n) {\n  const parserField: Field<string> | undefined = detectedFieldsFrame?.fields[2];\n  const namesField: Field<string> | undefined = detectedFieldsFrame?.fields[0];\n  const index = namesField?.values.indexOf(optionValue);\n\n  const parserForThisField =\n    index !== undefined && index !== -1 ? extractParserFromString(parserField?.values?.[index]) : 'mixed';\n\n  // Get the parser from the json payload of each filter\n  const parsers = fieldsVariable.state.filters.map((filter) => {\n    const index = namesField?.values.indexOf(filter.key);\n    const parserFromFilterValue = getValueFromFieldsFilter(filter);\n    if (parserFromFilterValue.parser) {\n      return parserFromFilterValue.parser;\n    }\n\n    // Then fallback to check the latest response\n    const parser =\n      index !== undefined && index !== -1\n        ? extractParserFromString(parserField?.values?.[index] ?? 'mixed')\n        : undefined;\n    return parser ?? 'mixed';\n  });\n\n  const parser = extractParserFromArray([...parsers, parserForThisField]);\n\n  let fieldExpressionToAdd = '';\n  let structuredMetadataToAdd = '';\n\n  if (parserForThisField === 'structuredMetadata') {\n    structuredMetadataToAdd = `| ${optionValue}!=\"\"`;\n    // Structured metadata\n  } else {\n    fieldExpressionToAdd = `| ${optionValue}!=\"\"`;\n  }\n\n  // is option structured metadata\n  const options: LogsQueryOptions = {\n    structuredMetadataToAdd,\n    fieldExpressionToAdd,\n    parser: parser,\n  };\n\n  return buildFieldsQuery(optionValue, options);\n}\n","import { SceneFlexItem, SceneFlexLayout, SceneObject } from '@grafana/scenes';\nimport { LEVEL_VARIABLE_VALUE } from './variables';\nimport { getParserFromFieldsFilters } from './fields';\nimport { buildDataQuery } from './query';\nimport { LabelBreakdownScene } from '../Components/ServiceScene/Breakdowns/LabelBreakdownScene';\nimport { getFieldsVariable, getLogsStreamSelector } from './variableGetters';\n\nexport const LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\n\nexport function buildLabelValuesBreakdownActionScene(value: string) {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new LabelBreakdownScene({ value }),\n      }),\n    ],\n  });\n}\n\nexport function buildLabelsQuery(sceneRef: SceneObject, optionValue: string, optionName: string) {\n  let labelExpressionToAdd = '';\n  let structuredMetadataToAdd = '';\n\n  const fields = getFieldsVariable(sceneRef);\n  const parser = getParserFromFieldsFilters(fields);\n\n  if (optionName && optionName !== LEVEL_VARIABLE_VALUE) {\n    labelExpressionToAdd = ` ,${optionName} != \"\"`;\n  } else if (optionName && optionName === LEVEL_VARIABLE_VALUE) {\n    structuredMetadataToAdd = ` | ${optionName} != \"\"`;\n  }\n\n  return buildDataQuery(\n    `sum(count_over_time(${getLogsStreamSelector({\n      labelExpressionToAdd,\n      structuredMetadataToAdd,\n      parser,\n    })} [$__auto])) by (${optionValue})`,\n    { legendFormat: `{{${optionValue}}}`, refId: 'LABEL_BREAKDOWN_VALUES' }\n  );\n}\n","import { DataFrame } from '@grafana/data';\nimport { SeriesVisibilityChangeMode } from '@grafana/ui';\nimport { LEVEL_VARIABLE_VALUE } from './variables';\nimport { SceneObject } from '@grafana/scenes';\nimport { FilterOp } from './filters';\nimport { addToFilters, replaceFilter } from 'Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport { getLevelsVariable } from './variableGetters';\n\n/**\n * Given a set of `visibleLevels` in a panel, it returns a list of the new visible levels\n * after applying the visibility change in `mode`.\n */\nexport function toggleLevelVisibility(\n  level: string,\n  visibleLevels: string[] | undefined,\n  mode: SeriesVisibilityChangeMode,\n  allLevels: string[]\n) {\n  if (mode === SeriesVisibilityChangeMode.ToggleSelection) {\n    const levels = visibleLevels ?? [];\n    if (levels.length === 1 && levels.includes(level)) {\n      return [];\n    }\n    return [level];\n  }\n  /**\n   * When the behavior is `AppendToSelection` and the filter is empty, we initialize it\n   * with all levels because the user is excluding this level in their action.\n   */\n  let levels = !visibleLevels?.length ? allLevels : visibleLevels;\n  if (levels.includes(level)) {\n    return levels.filter((existingLevel) => existingLevel !== level);\n  }\n\n  return [...levels, level];\n}\n\nexport function getLabelsFromSeries(series: DataFrame[]) {\n  return series.map((dataFrame) => getLabelValueFromDataFrame(dataFrame) ?? 'logs');\n}\n\nexport function getLabelValueFromDataFrame(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels;\n\n  if (!labels) {\n    return null;\n  }\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return null;\n  }\n\n  return labels[keys[0]];\n}\n\n/*\n * From the current state of the levels filter, return the level names that\n * the user wants to see.\n */\nexport function getVisibleLevels(allLevels: string[], sceneRef: SceneObject) {\n  const levelsFilter = getLevelsVariable(sceneRef);\n  const wantedLevels = levelsFilter.state.filters\n    .filter((filter) => filter.operator === FilterOp.Equal)\n    .map((filter) => normalizeLevelName(filter.value));\n  const unwantedLevels = levelsFilter.state.filters\n    .filter((filter) => filter.operator === FilterOp.NotEqual)\n    .map((filter) => normalizeLevelName(filter.value));\n  return allLevels.filter((level) => {\n    if (unwantedLevels.includes(level)) {\n      return false;\n    }\n    return wantedLevels.length === 0 || wantedLevels.includes(level);\n  });\n}\n\nfunction normalizeLevelName(level: string) {\n  if (level === '\"\"') {\n    return 'logs';\n  }\n  return level;\n}\n\n/**\n * Toggle a level from the filter state.\n * If the filter is empty, it's added.\n * If the filter exists but it's different, it's replaced.\n * If the filter exists, it's removed.\n */\nexport function toggleLevelFromFilter(level: string, sceneRef: SceneObject) {\n  const levelFilter = getLevelsVariable(sceneRef);\n  const empty = levelFilter.state.filters.length === 0;\n  const filterExists = levelFilter.state.filters.find(\n    (filter) => filter.value === level && filter.operator === FilterOp.Equal\n  );\n\n  if (level === 'logs') {\n    level = '\"\"';\n  }\n\n  let action;\n  if (empty || !filterExists) {\n    replaceFilter(LEVEL_VARIABLE_VALUE, level, 'include', sceneRef);\n    action = 'add';\n  } else {\n    addToFilters(LEVEL_VARIABLE_VALUE, level, 'toggle', sceneRef);\n    action = 'remove';\n  }\n\n  return action;\n}\n","import { LogContext } from '@grafana/faro-web-sdk';\nimport { FetchError, logError, logInfo, logWarning } from '@grafana/runtime';\nimport pluginJson from '../plugin.json';\nimport packageJson from '../../package.json';\n\nconst defaultContext = {\n  app: pluginJson.id,\n  version: packageJson.version,\n};\n\nexport const logger = {\n  info: (msg: string, context?: LogContext) => {\n    const ctx = { ...defaultContext, ...context };\n    console.log(msg, ctx);\n    attemptFaroInfo(msg, ctx);\n  },\n  warn: (msg: string, context?: LogContext) => {\n    const ctx = { ...defaultContext, ...context };\n    console.warn(msg, ctx);\n    attemptFaroWarn(msg, ctx);\n  },\n  error: (err: Error | unknown, context?: LogContext) => {\n    const ctx = { ...defaultContext, ...context };\n    console.error(err, ctx);\n    attemptFaroErr(err, ctx);\n  },\n};\n\nconst attemptFaroInfo = (msg: string, context?: LogContext) => {\n  try {\n    logInfo(msg, context);\n  } catch (e) {\n    console.warn('Failed to log faro event!');\n  }\n};\n\nconst attemptFaroWarn = (msg: string, context?: LogContext) => {\n  try {\n    logWarning(msg, context);\n  } catch (e) {\n    console.warn('Failed to log faro warning!', { msg, context });\n  }\n};\n\nconst isRecord = (obj: unknown): obj is Record<string, unknown> => typeof obj === 'object';\n/**\n * Checks unknown error for properties from Records like FetchError and adds them to the context\n * @param err\n * @param context\n */\nfunction populateFetchErrorContext(err: unknown | FetchError, context: LogContext) {\n  if (typeof err === 'object' && err !== null) {\n    if (isRecord(err)) {\n      Object.keys(err).forEach((key: string) => {\n        const value = err[key];\n        if (typeof value === 'string' || typeof value === 'boolean' || typeof value === 'number') {\n          context[key] = value.toString();\n        }\n      });\n    }\n\n    if (hasData(err)) {\n      if (typeof err.data === 'object' && err.data !== null) {\n        try {\n          context.data = JSON.stringify(err.data);\n        } catch (e) {\n          // do nothing\n        }\n      } else if (typeof err.data === 'string' || typeof err.data === 'boolean' || typeof err.data === 'number') {\n        context.data = err.data.toString();\n      }\n    }\n  }\n}\n\nconst attemptFaroErr = (err: Error | FetchError | unknown, context2: LogContext) => {\n  let context = context2;\n  try {\n    populateFetchErrorContext(err, context);\n\n    if (err instanceof Error) {\n      logError(err, context);\n    } else if (typeof err === 'string') {\n      logError(new Error(err), context);\n    } else if (err && typeof err === 'object') {\n      if (context.msg) {\n        logError(new Error(context.msg), context);\n      } else {\n        logError(new Error('error object'), context);\n      }\n    } else {\n      logError(new Error('unknown error'), context);\n    }\n  } catch (e) {\n    console.error('Failed to log faro error!', { err, context });\n  }\n};\n\nconst hasData = (value: object): value is { data: unknown } => {\n  return 'data' in value;\n};\n","import { ServiceSceneCustomState } from '../Components/ServiceScene/ServiceScene';\n\nlet metadataService: MetadataService;\n\nexport function initializeMetadataService(): void {\n  if (!metadataService) {\n    metadataService = new MetadataService();\n  }\n}\n\n/**\n * Singleton class for sharing state across drilldown routes with common parent scene\n */\nexport class MetadataService {\n  private serviceSceneState: ServiceSceneCustomState | undefined = undefined;\n  public getServiceSceneState() {\n    return this.serviceSceneState;\n  }\n\n  public setPatternsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.patternsCount = count;\n  }\n\n  public setLabelsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.labelsCount = count;\n  }\n\n  public setFieldsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.fieldsCount = count;\n  }\n\n  public setServiceSceneState(state: ServiceSceneCustomState) {\n    this.serviceSceneState = {\n      patternsCount: state.patternsCount,\n      labelsCount: state.labelsCount,\n      fieldsCount: state.fieldsCount,\n      loading: state.loading,\n    };\n  }\n}\n\nexport function getMetadataService(): MetadataService {\n  return metadataService;\n}\n","import { ServiceScene } from '../Components/ServiceScene/ServiceScene';\nimport { IndexScene } from '../Components/IndexScene/IndexScene';\nimport { ALL_VARIABLE_VALUE } from './variables';\nimport { getMetadataService } from './metadata';\nimport { locationService } from '@grafana/runtime';\nimport { buildServicesUrl, DRILLDOWN_URL_KEYS, PageSlugs, prefixRoute, ROUTES, ValueSlugs } from './routing';\nimport { sceneGraph } from '@grafana/scenes';\nimport { UrlQueryMap, urlUtil } from '@grafana/data';\nimport { replaceSlash } from './extensions/links';\nimport { logger } from './logger';\n\nlet previousRoute: string | undefined = undefined;\n\nfunction buildValueBreakdownUrl(label: string, newPath: ValueSlugs, labelValue: string, labelName = 'service') {\n  if (label === ALL_VARIABLE_VALUE && newPath === ValueSlugs.label) {\n    return prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.labels}`);\n  } else if (label === ALL_VARIABLE_VALUE && newPath === ValueSlugs.field) {\n    return prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.fields}`);\n  } else {\n    return prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${newPath}/${replaceSlash(label)}`\n    );\n  }\n}\n\nexport function buildDrilldownPageUrl(path: PageSlugs | string, extraQueryParams?: UrlQueryMap): string {\n  return urlUtil.renderUrl(path, buildDrilldownPageRoute(extraQueryParams));\n}\n\nexport function buildDrilldownPageRoute(extraQueryParams?: UrlQueryMap): UrlQueryMap {\n  return {\n    ...Object.entries(urlUtil.getUrlSearchParams()).reduce<UrlQueryMap>((acc, [key, value]) => {\n      if (DRILLDOWN_URL_KEYS.includes(key)) {\n        acc[key] = value;\n      }\n\n      return acc;\n    }, {}),\n    ...extraQueryParams,\n  };\n}\n\n/**\n * Navigate to value breakdown url\n * @param newPath\n * @param label\n * @param serviceScene\n */\nexport function navigateToValueBreakdown(newPath: ValueSlugs, label: string, serviceScene: ServiceScene) {\n  const indexScene = sceneGraph.getAncestor(serviceScene, IndexScene);\n\n  if (indexScene) {\n    const urlLabelName = indexScene.state.routeMatch?.params.labelName;\n    const urlLabelValue = indexScene.state.routeMatch?.params.labelValue;\n    if (urlLabelName && urlLabelValue) {\n      let urlPath = buildValueBreakdownUrl(label, newPath, urlLabelValue, urlLabelName);\n      const fullUrl = buildDrilldownPageUrl(urlPath);\n\n      // If we're going to navigate, we need to share the state between this instantiation of the service scene\n      if (serviceScene) {\n        const metadataService = getMetadataService();\n        metadataService.setServiceSceneState(serviceScene.state);\n      }\n\n      pushUrlHandler(fullUrl);\n      return;\n    } else {\n      logger.warn('missing url params', {\n        urlLabelName: urlLabelName ?? '',\n        urlLabelValue: urlLabelValue ?? '',\n      });\n    }\n  }\n}\n\n/**\n * The case for initial navigation from the service selection to the service index is a special case, as we don't yet have a serviceScene constructed to pull the selected service.\n * This function will route users to the initial (logs) page from the service selection view, which will populate the service scene state with the selected service string.\n * @param labelName\n * @param labelValue\n */\nexport function navigateToInitialPageAfterServiceSelection(labelName: string, labelValue: string) {\n  const breakdownUrl = buildDrilldownPageUrl(ROUTES.logs(labelValue, labelName));\n  pushUrlHandler(breakdownUrl);\n}\n\n/**\n * Navigates to the drilldown page specified by the path slug\n *\n * @param path\n * @param serviceScene\n * @param extraQueryParams\n */\nexport function navigateToDrilldownPage(path: PageSlugs, serviceScene: ServiceScene, extraQueryParams?: UrlQueryMap) {\n  const indexScene = sceneGraph.getAncestor(serviceScene, IndexScene);\n  const urlLabelValue = indexScene.state.routeMatch?.params.labelValue;\n  const urlLabelName = indexScene.state.routeMatch?.params.labelName;\n\n  if (urlLabelValue) {\n    const fullUrl = prefixRoute(`${PageSlugs.explore}/${urlLabelName}/${replaceSlash(urlLabelValue)}/${path}`);\n    const breakdownUrl = buildDrilldownPageUrl(fullUrl, extraQueryParams);\n\n    // If we're going to navigate, we need to share the state between this instantiation of the service scene\n    if (serviceScene) {\n      const metadataService = getMetadataService();\n      metadataService.setServiceSceneState(serviceScene.state);\n    }\n\n    pushUrlHandler(breakdownUrl);\n    return;\n  }\n}\n\nexport function pushUrlHandler(newUrl: string) {\n  previousRoute = newUrl;\n  locationService.push(newUrl);\n}\n\n/**\n * Navigate to the services selection url\n */\nexport function navigateToIndex() {\n  const location = locationService.getLocation();\n  const serviceUrl = buildServicesUrl(ROUTES.explore());\n  const currentUrl = location.pathname + location.search;\n  const search = locationService.getSearch();\n\n  if (serviceUrl === currentUrl || currentUrl.includes(serviceUrl)) {\n    return;\n  }\n\n  if (!search.get('var-filters')) {\n    // If we don't have filters, we don't want to keep this url in browser history since this is fired AFTER the url props are made invalid, push the previous route and replace it\n    if (previousRoute) {\n      locationService.replace(previousRoute);\n    }\n    locationService.push(serviceUrl);\n  } else {\n    pushUrlHandler(serviceUrl);\n  }\n}\n","import { QueryRunnerState, sceneGraph, SceneQueryRunner } from '@grafana/scenes';\n\nexport class LogsSceneQueryRunner extends SceneQueryRunner {\n  constructor(initialState: QueryRunnerState) {\n    super(initialState);\n  }\n\n  public runQueries() {\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    // We don't want to subscribe to time range changes, or we'll get duplicate queries\n    // this.subscribeToTimeRangeChanges(timeRange);\n\n    // @todo can we make runWithTimeRange protected? (https://github.com/grafana/scenes/pull/866)\n    // Hack to call private method\n    this['runWithTimeRange'](timeRange);\n  }\n}\n","import { DataFrame, FieldConfig, FieldMatcherID } from '@grafana/data';\nimport {\n  FieldConfigBuilder,\n  FieldConfigBuilders,\n  FieldConfigOverridesBuilder,\n  PanelBuilders,\n  QueryRunnerState,\n  SceneDataProvider,\n  SceneDataTransformer,\n  SceneObject,\n  SceneQueryRunner,\n  VizPanel,\n} from '@grafana/scenes';\nimport { map, Observable } from 'rxjs';\nimport { HideSeriesConfig } from '@grafana/schema';\nimport { WRAPPED_LOKI_DS_UID } from './datasource';\nimport { LogsSceneQueryRunner } from './LogsSceneQueryRunner';\nimport { DrawStyle, StackingMode } from '@grafana/ui';\nimport { getLabelsFromSeries, getVisibleLevels } from './levels';\nimport { LokiQuery } from './lokiQuery';\n\nconst UNKNOWN_LEVEL_LOGS = 'logs';\nexport function setLevelColorOverrides(overrides: FieldConfigOverridesBuilder<FieldConfig>) {\n  overrides.matchFieldsWithName('info').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-green',\n  });\n  overrides.matchFieldsWithName('debug').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-blue',\n  });\n  overrides.matchFieldsWithName('error').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-red',\n  });\n  overrides.matchFieldsWithName('warn').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-orange',\n  });\n  overrides.matchFieldsWithName('logs').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'darkgray',\n  });\n}\n\nexport function setLogsVolumeFieldConfigs(\n  builder: ReturnType<typeof PanelBuilders.timeseries> | ReturnType<typeof FieldConfigBuilders.timeseries>\n) {\n  return builder\n    .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n    .setCustomFieldConfig('fillOpacity', 100)\n    .setCustomFieldConfig('lineWidth', 0)\n    .setCustomFieldConfig('pointSize', 0)\n    .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n    .setOverrides(setLevelColorOverrides);\n}\n\ninterface TimeSeriesFieldConfig extends FieldConfig {\n  hideFrom: HideSeriesConfig;\n}\n\nexport function setLevelSeriesOverrides(levels: string[], overrideConfig: FieldConfigOverridesBuilder<FieldConfig>) {\n  overrideConfig\n    .match({\n      id: FieldMatcherID.byNames,\n      options: {\n        mode: 'exclude',\n        names: levels,\n        prefix: 'All except:',\n        readOnly: true,\n      },\n    })\n    .overrideCustomFieldConfig<TimeSeriesFieldConfig, 'hideFrom'>('hideFrom', {\n      legend: false,\n      tooltip: false,\n      viz: true,\n    });\n\n  // Setting __systemRef to hideSeriesFrom, allows the override to be changed by interacting with the viz\n  const overrides = overrideConfig.build();\n  // @ts-expect-error\n  overrides[overrides.length - 1].__systemRef = 'hideSeriesFrom';\n}\n\nexport function syncLogsPanelVisibleSeries(panel: VizPanel, series: DataFrame[], sceneRef: SceneObject) {\n  const focusedLevels = getVisibleLevels(getLabelsFromSeries(series), sceneRef);\n  if (focusedLevels?.length) {\n    const config = setLogsVolumeFieldConfigs(FieldConfigBuilders.timeseries()).setOverrides(\n      setLevelSeriesOverrides.bind(null, focusedLevels)\n    );\n    if (config instanceof FieldConfigBuilder) {\n      panel.onFieldConfigChange(config.build(), true);\n    }\n  }\n}\n\nexport function sortLevelTransformation() {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map((data: DataFrame[]) => {\n        return data\n          .map((d) => {\n            if (!d.fields[1].config.displayNameFromDS) {\n              d.fields[1].config.displayNameFromDS = UNKNOWN_LEVEL_LOGS;\n            }\n            return d;\n          })\n          .sort((a, b) => {\n            const aName: string | undefined = a.fields[1].config.displayNameFromDS;\n            const aVal = aName?.includes('error') ? 4 : aName?.includes('warn') ? 3 : aName?.includes('info') ? 2 : 1;\n            const bName: string | undefined = b.fields[1].config.displayNameFromDS;\n            const bVal = bName?.includes('error') ? 4 : bName?.includes('warn') ? 3 : bName?.includes('info') ? 2 : 1;\n            return aVal - bVal;\n          });\n      })\n    );\n  };\n}\n\nexport function getResourceQueryRunner(queries: LokiQuery[]) {\n  return new LogsSceneQueryRunner({\n    datasource: { uid: WRAPPED_LOKI_DS_UID },\n    queries: queries,\n  });\n}\n\nexport function getQueryRunner(queries: LokiQuery[], queryRunnerOptions?: Partial<QueryRunnerState>) {\n  // if there's a legendFormat related to any `level` like label, we want to\n  // sort the output equally. That's purposefully not `LEVEL_VARIABLE_VALUE`,\n  // such that the `detected_level` graph looks the same as a graph for the\n  // `level` label.\n\n  const hasLevel = queries.find((query) => query.legendFormat?.toLowerCase().includes('level'));\n\n  if (hasLevel) {\n    return new SceneDataTransformer({\n      $data: getSceneQueryRunner({\n        datasource: { uid: WRAPPED_LOKI_DS_UID },\n        queries: queries,\n      }),\n      transformations: [sortLevelTransformation],\n    });\n  }\n\n  return getSceneQueryRunner({\n    queries: queries,\n    ...queryRunnerOptions,\n  });\n}\n\nexport function getSceneQueryRunner(queryRunnerOptions?: Partial<QueryRunnerState>) {\n  return new SceneQueryRunner({\n    datasource: { uid: WRAPPED_LOKI_DS_UID },\n    queries: [],\n    ...queryRunnerOptions,\n  });\n}\n\nexport function getQueryRunnerFromProvider(provider: SceneDataProvider): SceneQueryRunner {\n  if (provider instanceof SceneQueryRunner) {\n    return provider;\n  }\n\n  if (provider.state.$data instanceof SceneQueryRunner) {\n    return provider.state.$data;\n  }\n\n  throw new Error('SceneDataProvider is missing SceneQueryRunner');\n}\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { AppliedPattern } from 'Components/IndexScene/IndexScene';\nimport { PLUGIN_ID } from './routing';\nimport { EMPTY_VARIABLE_VALUE, VAR_DATASOURCE_EXPR } from './variables';\nimport { FilterOp } from './filters';\nimport { groupBy, trim } from 'lodash';\nimport { getValueFromFieldsFilter } from './variableGetters';\nimport { LokiQuery } from './lokiQuery';\nimport { SceneDataQueryResourceRequest } from './datasourceTypes';\n\n/**\n * Builds the resource query\n * @param expr string to be interpolated and executed in the resource request\n * @param resource\n * @param queryParamsOverrides\n */\nexport const buildResourceQuery = (\n  expr: string,\n  resource: 'volume' | 'patterns' | 'detected_labels' | 'detected_fields' | 'labels',\n  queryParamsOverrides?: Record<string, unknown>\n): LokiQuery & SceneDataQueryResourceRequest => {\n  return {\n    ...defaultQueryParams,\n    resource,\n    refId: resource,\n    ...queryParamsOverrides,\n    datasource: { uid: VAR_DATASOURCE_EXPR },\n    expr,\n  };\n};\n/**\n * Builds a loki data query\n * @param expr\n * @param queryParamsOverrides\n * @returns LokiQuery\n */\nexport const buildDataQuery = (expr: string, queryParamsOverrides?: Record<string, unknown>): LokiQuery => {\n  return {\n    ...defaultQueryParams,\n    ...queryParamsOverrides,\n    expr,\n  };\n};\n\nconst defaultQueryParams = {\n  refId: 'A',\n  queryType: 'range',\n  editorMode: 'code',\n  supportingQueryType: PLUGIN_ID,\n};\n\nexport function renderLogQLLabelFilters(filters: AdHocVariableFilter[]) {\n  const positive = filters.filter((filter) => filter.operator === FilterOp.Equal);\n  const negative = filters.filter((filter) => filter.operator === FilterOp.NotEqual);\n\n  const positiveGroups = groupBy(positive, (filter) => filter.key);\n\n  let positiveFilters: string[] = [];\n  for (const key in positiveGroups) {\n    const values = positiveGroups[key].map((filter) => filter.value);\n    positiveFilters.push(\n      values.length === 1 ? renderMetadata(positiveGroups[key][0]) : renderRegexLabelFilter(key, values)\n    );\n  }\n\n  const negativeFilters = negative.map((filter) => renderMetadata(filter)).join(', ');\n\n  return trim(`${positiveFilters.join(', ')}, ${negativeFilters}`, ' ,');\n}\n\nexport function renderLogQLFieldFilters(filters: AdHocVariableFilter[]) {\n  const positive = filters.filter((filter) => filter.operator === FilterOp.Equal);\n  const negative = filters.filter((filter) => filter.operator === FilterOp.NotEqual);\n\n  const positiveGroups = groupBy(positive, (filter) => filter.key);\n\n  let positiveFilters = '';\n  for (const key in positiveGroups) {\n    positiveFilters += ' | ' + positiveGroups[key].map((filter) => `${fieldFilterToQueryString(filter)}`).join(' or ');\n  }\n\n  const negativeFilters = negative.map((filter) => `| ${fieldFilterToQueryString(filter)}`).join(' ');\n\n  return `${positiveFilters} ${negativeFilters}`.trim();\n}\n\nexport function renderLogQLMetadataFilters(filters: AdHocVariableFilter[]) {\n  const positive = filters.filter((filter) => filter.operator === FilterOp.Equal);\n  const negative = filters.filter((filter) => filter.operator === FilterOp.NotEqual);\n\n  const positiveGroups = groupBy(positive, (filter) => filter.key);\n\n  let positiveFilters = '';\n  for (const key in positiveGroups) {\n    positiveFilters += ' | ' + positiveGroups[key].map((filter) => `${renderMetadata(filter)}`).join(' or ');\n  }\n\n  const negativeFilters = negative.map((filter) => `| ${renderMetadata(filter)}`).join(' ');\n\n  return `${positiveFilters} ${negativeFilters}`.trim();\n}\n\nfunction renderMetadata(filter: AdHocVariableFilter) {\n  // If the filter value is an empty string, we don't want to wrap it in backticks!\n  if (filter.value === EMPTY_VARIABLE_VALUE) {\n    return `${filter.key}${filter.operator}${filter.value}`;\n  }\n  return `${filter.key}${filter.operator}\\`${filter.value}\\``;\n}\n\nfunction fieldFilterToQueryString(filter: AdHocVariableFilter) {\n  const fieldObject = getValueFromFieldsFilter(filter);\n  const value = fieldObject.value;\n  // If the filter value is an empty string, we don't want to wrap it in backticks!\n  if (value === EMPTY_VARIABLE_VALUE) {\n    return `${filter.key}${filter.operator}${value}`;\n  }\n  return `${filter.key}${filter.operator}\\`${value}\\``;\n}\n\nfunction renderRegexLabelFilter(key: string, values: string[]) {\n  return `${key}=~\"${values.join('|')}\"`;\n}\n\nexport function renderPatternFilters(patterns: AppliedPattern[]) {\n  const excludePatterns = patterns.filter((pattern) => pattern.type === 'exclude');\n  const excludePatternsLine = excludePatterns\n    .map((p) => `!> \\`${p.pattern}\\``)\n    .join(' ')\n    .trim();\n\n  const includePatterns = patterns.filter((pattern) => pattern.type === 'include');\n  let includePatternsLine = '';\n  if (includePatterns.length > 0) {\n    if (includePatterns.length === 1) {\n      includePatternsLine = `|> \\`${includePatterns[0].pattern}\\``;\n    } else {\n      includePatternsLine = `|>  ${includePatterns.map((p) => `\\`${p.pattern}\\``).join(' or ')}`;\n    }\n  }\n  return `${excludePatternsLine} ${includePatternsLine}`.trim();\n}\n","import pluginJson from '../plugin.json';\nimport { UrlQueryMap, urlUtil } from '@grafana/data';\nimport {\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  VAR_DATASOURCE,\n  VAR_FIELD_GROUP_BY,\n  VAR_FIELDS,\n  VAR_LABEL_GROUP_BY,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_LINE_FILTER,\n  VAR_METADATA,\n  VAR_PATTERNS,\n} from './variables';\nimport { locationService } from '@grafana/runtime';\nimport { RouteMatch, RouteProps } from '../Components/Pages';\nimport { replaceSlash } from './extensions/links';\nimport { SceneObject } from '@grafana/scenes';\nimport { getLabelsVariable } from './variableGetters';\nimport { logger } from './logger';\n\nexport const PLUGIN_ID = pluginJson.id;\nexport const PLUGIN_BASE_URL = `/a/${PLUGIN_ID}`;\n\nexport enum PageSlugs {\n  explore = 'explore',\n  logs = 'logs',\n  labels = 'labels',\n  patterns = 'patterns',\n  fields = 'fields',\n}\nexport enum ValueSlugs {\n  field = 'field',\n  label = 'label',\n}\n\nexport type ParentDrilldownSlugs =\n  | PageSlugs.explore\n  | PageSlugs.fields\n  | PageSlugs.logs\n  | PageSlugs.labels\n  | PageSlugs.patterns;\nexport type ChildDrilldownSlugs = ValueSlugs.field | ValueSlugs.label;\n\nexport const ROUTES = {\n  explore: () => prefixRoute(PageSlugs.explore),\n  logs: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.logs}`),\n  fields: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.fields}`),\n  patterns: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.patterns}`),\n  labels: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.labels}`),\n};\n\nexport const SUB_ROUTES = {\n  label: (labelValue: string, labelName = 'service', breakdownLabelName: string) =>\n    prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${ValueSlugs.label}/${breakdownLabelName}`\n    ),\n  field: (labelValue: string, labelName = 'service', breakdownLabelName: string) =>\n    prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${ValueSlugs.field}/${breakdownLabelName}`\n    ),\n};\n\nexport const ROUTE_DEFINITIONS: Record<keyof typeof PageSlugs, string> = {\n  explore: prefixRoute(PageSlugs.explore),\n  logs: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.logs}`),\n  fields: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.fields}`),\n  patterns: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.patterns}`),\n  labels: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.labels}`),\n};\n\nexport const CHILD_ROUTE_DEFINITIONS: Record<keyof typeof ValueSlugs, string> = {\n  field: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${ValueSlugs.field}/:breakdownLabel`),\n  label: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${ValueSlugs.label}/:breakdownLabel`),\n};\n\nexport const EXPLORATIONS_ROUTE = `${PLUGIN_BASE_URL}/${PageSlugs.explore}`;\n\n// Prefixes the route with the base URL of the plugin\nexport function prefixRoute(route: string): string {\n  return `${PLUGIN_BASE_URL}/${route}`;\n}\n\n// For redirect back to service, we just want to keep datasource, and timerange\nexport const SERVICE_URL_KEYS = ['from', 'to', `var-${VAR_DATASOURCE}`];\n//@todo why patterns and var-patterns?\nexport const DRILLDOWN_URL_KEYS = [\n  'from',\n  'to',\n  'mode',\n  'urlColumns',\n  'visualizationType',\n  'selectedLine',\n  'displayedFields',\n  VAR_PATTERNS,\n  `var-${VAR_PATTERNS}`,\n  `var-${VAR_DATASOURCE}`,\n  `var-${VAR_LABELS}`,\n  `var-${VAR_FIELDS}`,\n  `var-${VAR_LEVELS}`,\n  `var-${VAR_FIELD_GROUP_BY}`,\n  `var-${VAR_LABEL_GROUP_BY}`,\n  `var-${VAR_DATASOURCE}`,\n  `var-${VAR_LINE_FILTER}`,\n  `var-${VAR_METADATA}`,\n];\n\nexport function getDrilldownSlug() {\n  const location = locationService.getLocation();\n  const slug = location.pathname.slice(location.pathname.lastIndexOf('/') + 1, location.pathname.length);\n  return slug as PageSlugs;\n}\n\n/**\n * The \"primary\" label, is the replacement for the service_name paradigm\n * It must be an indexed label with an include filter\n * Note: Will return the label as it exists in the url, so \"service_name\" will be returned as \"service\", we'll need to adjust for this case if we want to support URLs from before this change\n */\nexport function getPrimaryLabelFromUrl(): RouteProps {\n  const location = locationService.getLocation();\n  const startOfUrl = '/a/grafana-lokiexplore-app/explore';\n  const endOfUrl = location.pathname.slice(location.pathname.indexOf(startOfUrl) + startOfUrl.length + 1);\n  const routeParams = endOfUrl.split('/');\n\n  let labelName = routeParams[0];\n  const labelValue = routeParams[1];\n  const breakdownLabel = routeParams[3];\n  // Keep urls the same\n  if (labelName === SERVICE_NAME) {\n    labelName = SERVICE_UI_LABEL;\n  }\n  return { labelName, labelValue, breakdownLabel };\n}\n\nexport function getDrilldownValueSlug() {\n  const location = locationService.getLocation();\n  const locationArray = location.pathname.split('/');\n  const slug = locationArray[locationArray.length - 2];\n  return slug as ValueSlugs;\n}\n\nexport function buildServicesUrl(path: string, extraQueryParams?: UrlQueryMap): string {\n  return urlUtil.renderUrl(path, buildServicesRoute(extraQueryParams));\n}\nexport function extractValuesFromRoute(routeMatch: RouteMatch): RouteProps {\n  return {\n    labelName: routeMatch.params.labelName,\n    labelValue: routeMatch.params.labelValue,\n    breakdownLabel: routeMatch.params.breakdownLabel,\n  };\n}\n\nexport function buildServicesRoute(extraQueryParams?: UrlQueryMap): UrlQueryMap {\n  return {\n    ...Object.entries(urlUtil.getUrlSearchParams()).reduce<UrlQueryMap>((acc, [key, value]) => {\n      if (SERVICE_URL_KEYS.includes(key)) {\n        acc[key] = value;\n      }\n\n      return acc;\n    }, {}),\n    ...extraQueryParams,\n  };\n}\n\n/**\n * Compare slugs against variable filters and log discrepancies\n * These don't cause errors or render empty UIs, but shouldn't be possible when routing within the app\n * If we see these logged in production it indicates we're navigating users incorrectly\n * @param sceneRef\n */\nexport function checkPrimaryLabel(sceneRef: SceneObject) {\n  const labelsVariable = getLabelsVariable(sceneRef);\n  let { labelName, labelValue } = getPrimaryLabelFromUrl();\n  if (labelName === SERVICE_UI_LABEL) {\n    labelName = SERVICE_NAME;\n  }\n  const primaryLabel = labelsVariable.state.filters.find((filter) => filter.key === labelName);\n  if (!primaryLabel) {\n    const location = locationService.getLocation();\n\n    logger.info('invalid primary label name in url', {\n      labelName,\n      url: `${location.pathname}${location.search}`,\n    });\n  }\n\n  const primaryLabelValue = labelsVariable.state.filters.find((filter) => replaceSlash(filter.value) === labelValue);\n  if (!primaryLabelValue) {\n    const location = locationService.getLocation();\n\n    logger.info('invalid primary label value in url', {\n      labelValue,\n      url: `${location.pathname}${location.search}`,\n    });\n  }\n}\n","import { urlUtil } from '@grafana/data';\nimport { config, DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, SceneObject, SceneObjectUrlValues } from '@grafana/scenes';\nimport { LOG_STREAM_SELECTOR_EXPR, VAR_DATASOURCE_EXPR, VAR_LABELS_EXPR } from './variables';\nimport { EXPLORATIONS_ROUTE } from './routing';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\n\nexport function getExplorationFor(model: SceneObject): IndexScene {\n  return sceneGraph.getAncestor(model, IndexScene);\n}\n\nexport function getUrlForValues(values: SceneObjectUrlValues) {\n  return urlUtil.renderUrl(EXPLORATIONS_ROUTE, values);\n}\n\nexport function getDataSource(sceneObject: SceneObject) {\n  return sceneGraph.interpolate(sceneObject, VAR_DATASOURCE_EXPR);\n}\n\nexport function getQueryExpr(exploration: IndexScene) {\n  return sceneGraph.interpolate(exploration, LOG_STREAM_SELECTOR_EXPR).replace(/\\s+/g, ' ');\n}\n\nexport function getPatternExpr(exploration: IndexScene) {\n  return sceneGraph.interpolate(exploration, VAR_LABELS_EXPR).replace(/\\s+/g, ' ');\n}\n\nexport function getColorByIndex(index: number) {\n  const visTheme = config.theme2.visualization;\n  return visTheme.getColorByName(visTheme.palette[index % 8]);\n}\n\nexport async function getLokiDatasource(sceneObject: SceneObject) {\n  const ds = (await getDataSourceSrv().get(VAR_DATASOURCE_EXPR, { __sceneObject: { value: sceneObject } })) as\n    | DataSourceWithBackend\n    | undefined;\n  return ds;\n}\n\nexport function isDefined<T>(value: T | null | undefined): value is T {\n  return value !== null && value !== undefined;\n}\n","import uFuzzy from '@leeoniya/ufuzzy';\nimport { debounce as debounceLodash } from 'lodash';\n\nconst uf = new uFuzzy({\n  intraMode: 1,\n  intraIns: 1,\n  intraSub: 1,\n  intraTrn: 1,\n  intraDel: 1,\n});\n\nexport function fuzzySearch(haystack: string[], query: string, callback: (data: string[][]) => void) {\n  const [idxs, info, order] = uf.search(haystack, query, 0, 1e5);\n\n  let haystackOrder: string[] = [];\n  let matchesSet: Set<string> = new Set();\n  if (idxs && order) {\n    /**\n     * get the fuzzy matches for highlighting\n     * @param part\n     * @param matched\n     */\n    const mark = (part: string, matched: boolean) => {\n      if (matched) {\n        matchesSet.add(part);\n      }\n    };\n\n    // Iterate to create the order of needles(queries) and the matches\n    for (let i = 0; i < order.length; i++) {\n      let infoIdx = order[i];\n\n      /** Evaluate the match, get the matches for highlighting */\n      uFuzzy.highlight(haystack[info.idx[infoIdx]], info.ranges[infoIdx], mark);\n      /** Get the order */\n      haystackOrder.push(haystack[info.idx[infoIdx]]);\n    }\n\n    callback([haystackOrder, [...matchesSet]]);\n  } else if (!query) {\n    callback([]);\n  }\n}\n\nexport const debouncedFuzzySearch = debounceLodash(fuzzySearch, 300);\n","import { ChangepointDetector, OutlierDetector, OutlierOutput } from '@bsull/augurs';\nimport { DataFrame, doStandardCalcs, fieldReducers, FieldType, outerJoinDataFrames, ReducerID } from '@grafana/data';\nimport { getLabelValueFromDataFrame } from './levels';\nimport { memoize } from 'lodash';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from './analytics';\nimport { logger } from './logger';\n\nexport const DEFAULT_SORT_BY = 'changepoint';\n\nexport const sortSeries = memoize(\n  (series: DataFrame[], sortBy: string, direction: string) => {\n    if (sortBy === 'alphabetical') {\n      return sortSeriesByName(series, direction);\n    }\n\n    if (sortBy === 'outliers') {\n      initOutlierDetector(series);\n    }\n\n    const reducer = (dataFrame: DataFrame) => {\n      // ML & Wasm sorting options\n      try {\n        if (sortBy === 'changepoint') {\n          return calculateDataFrameChangepoints(dataFrame);\n        } else if (sortBy === 'outliers') {\n          return calculateOutlierValue(series, dataFrame);\n        }\n      } catch (e) {\n        logger.error(e, { msg: 'failed to sort' });\n\n        // ML sorting panicked, fallback to stdDev\n        sortBy = ReducerID.stdDev;\n      }\n      const fieldReducer = fieldReducers.get(sortBy);\n      const value =\n        fieldReducer.reduce?.(dataFrame.fields[1], true, true) ?? doStandardCalcs(dataFrame.fields[1], true, true);\n      return value[sortBy] ?? 0;\n    };\n\n    const seriesCalcs = series.map((dataFrame) => ({\n      value: reducer(dataFrame),\n      dataFrame: dataFrame,\n    }));\n\n    seriesCalcs.sort((a, b) => {\n      if (a.value !== undefined && b.value !== undefined) {\n        return b.value - a.value;\n      }\n      return 0;\n    });\n\n    if (direction === 'asc') {\n      seriesCalcs.reverse();\n    }\n\n    return seriesCalcs.map(({ dataFrame }) => dataFrame);\n  },\n  (series: DataFrame[], sortBy: string, direction: string) => {\n    const firstTimestamp = series.length > 0 ? series[0].fields[0].values[0] : 0;\n    const lastTimestamp =\n      series.length > 0\n        ? series[series.length - 1].fields[0].values[series[series.length - 1].fields[0].values.length - 1]\n        : 0;\n    const firstValue = series.length > 0 ? getLabelValueFromDataFrame(series[0]) : '';\n    const lastValue = series.length > 0 ? getLabelValueFromDataFrame(series[series.length - 1]) : '';\n    // This still isn't good enough, if the dataframe returns the same number of fields, with the same start and end values, we'll fail to update the UI\n    const allSeriesKey = series.map(\n      (frame) =>\n        frame.length +\n        '_' +\n        frame.fields.map((field) => field.name + '_' + field.values[0] + '_' + field.values[field.values.length - 1])\n    );\n    return `${firstValue}_${lastValue}_${firstTimestamp}_${lastTimestamp}_${series.length}_${allSeriesKey}_${sortBy}_${direction}`;\n  }\n);\n\nexport const calculateDataFrameChangepoints = (data: DataFrame) => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported, fall back to stdDev');\n  }\n\n  const fields = data.fields.filter((f) => f.type === FieldType.number);\n\n  const dataPoints = fields[0].values.length;\n\n  let samplingStep = Math.floor(dataPoints / 100) || 1;\n  if (samplingStep > 1) {\n    // Avoiding \"big\" steps for more accuracy\n    samplingStep = Math.ceil(samplingStep / 2);\n  }\n\n  const sample = fields[0].values.filter((_, i) => i % samplingStep === 0);\n\n  const values = new Float64Array(sample);\n  const points = ChangepointDetector.defaultArgpcp().detectChangepoints(values);\n\n  return points.indices.length;\n};\n\nexport const sortSeriesByName = (series: DataFrame[], direction: string) => {\n  const sortedSeries = [...series];\n  sortedSeries.sort((a, b) => {\n    const valueA = getLabelValueFromDataFrame(a);\n    const valueB = getLabelValueFromDataFrame(b);\n    if (!valueA || !valueB) {\n      return 0;\n    }\n    return valueA?.localeCompare(valueB) ?? 0;\n  });\n  if (direction === 'desc') {\n    sortedSeries.reverse();\n  }\n  return sortedSeries;\n};\n\nconst initOutlierDetector = (series: DataFrame[]) => {\n  if (!wasmSupported()) {\n    return;\n  }\n\n  // Combine all frames into one by joining on time.\n  const joined = outerJoinDataFrames({ frames: series });\n  if (!joined) {\n    return;\n  }\n\n  // Get number fields: these are our series.\n  const joinedSeries = joined.fields.filter((f) => f.type === FieldType.number);\n  const nTimestamps = joinedSeries[0].values.length;\n  const points = new Float64Array(joinedSeries.flatMap((series) => series.values as number[]));\n\n  try {\n    const detector = OutlierDetector.dbscan({ sensitivity: 0.4 }).preprocess(points, nTimestamps);\n    outliers = detector.detect();\n  } catch (e) {\n    logger.error(e, { msg: 'initOutlierDetector: OutlierDetector error' });\n  }\n};\n\nlet outliers: OutlierOutput | undefined = undefined;\n\nexport const calculateOutlierValue = (series: DataFrame[], data: DataFrame): number => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported, fall back to stdDev');\n  }\n  if (!outliers) {\n    throw new Error('Initialize outlier detector first');\n  }\n\n  const index = series.indexOf(data);\n  if (outliers.seriesResults[index].isOutlier) {\n    return outliers.seriesResults[index].outlierIntervals.length;\n  }\n\n  return 0;\n};\n\nexport const wasmSupported = () => {\n  const support = typeof WebAssembly === 'object';\n\n  if (!support) {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.wasm_not_supported);\n  }\n\n  return support;\n};\n","import pluginJson from '../plugin.json';\nimport { SortBy, SortDirection } from '../Components/ServiceScene/Breakdowns/SortByScene';\nimport { SceneObject } from '@grafana/scenes';\nimport { getDataSourceName, getServiceName } from './variableGetters';\nimport { logger } from './logger';\nimport { SERVICE_NAME } from './variables';\n\nconst FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY = `${pluginJson.id}.services.favorite`;\nconst FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY = `${pluginJson.id}.primarylabels.tabs.favorite`;\nconst DS_LOCALSTORAGE_KEY = `${pluginJson.id}.datasource`;\n\n// This should be a string, but we'll accept anything and return an empty array if it's not a string\nexport function getFavoriteLabelValuesFromStorage(dsKey: string | unknown, labelName: string): string[] {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return [];\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let labelValues = [];\n  try {\n    labelValues = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(labelValues)) {\n    labelValues = [];\n  }\n  return labelValues;\n}\n\n// This should be a string, but we'll accept anything and return early\nexport function addToFavoriteLabelValueInStorage(dsKey: string | unknown, labelName: string, labelValue: string) {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return;\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let services = [];\n  try {\n    services = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n\n  // We want to put this service at the top of the list and remove any duplicates\n  const servicesToStore = services.filter((service: string) => service !== labelValue);\n  servicesToStore.unshift(labelValue);\n\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function removeFromFavoritesInStorage(dsKey: string, labelName: string, labelValue: string) {\n  if (!dsKey || !labelName || !labelValue) {\n    return;\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let services = [];\n  try {\n    services = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n  const servicesToStore = services.filter((service: string) => service !== labelValue);\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function addTabToLocalStorage(dsKey: string, labelName: string) {\n  if (!dsKey || !labelName) {\n    return;\n  }\n\n  const key = createTabsLocalStorageKey(dsKey);\n\n  let services = [];\n  try {\n    services = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing saved tabs from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n\n  if (services.indexOf(labelName) === -1) {\n    // We want to put this service at the top of the list and remove any duplicates\n    const servicesToStore = services.filter((tabName: string) => tabName !== labelName);\n    servicesToStore.unshift(labelName);\n\n    localStorage.setItem(key, JSON.stringify(servicesToStore));\n  }\n}\n\nexport function removeTabFromLocalStorage(dsKey: string, labelName: string) {\n  if (!dsKey || !labelName) {\n    return;\n  }\n  const key = createTabsLocalStorageKey(dsKey);\n  let services = [];\n  try {\n    services = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n  const servicesToStore = services.filter((tabName: string) => tabName !== labelName);\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function getFavoriteTabsFromStorage(dsKey: string | unknown): string[] {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return [];\n  }\n  const key = createTabsLocalStorageKey(dsKey);\n  let tabNames = [];\n  try {\n    tabNames = JSON.parse(localStorage.getItem(key) || '[]');\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(tabNames)) {\n    tabNames = [];\n  }\n  return tabNames;\n}\n\nfunction createPrimaryLabelLocalStorageKey(ds: string, labelName: string) {\n  if (labelName === SERVICE_NAME) {\n    labelName = '';\n  } else {\n    labelName = `_${labelName}`;\n  }\n  return `${FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY}_${ds}${labelName}`;\n}\n\nfunction createTabsLocalStorageKey(ds: string) {\n  return `${FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY}_${ds}`;\n}\n\nexport function getLastUsedDataSourceFromStorage(): string | undefined {\n  return localStorage.getItem(DS_LOCALSTORAGE_KEY) ?? undefined;\n}\n\nexport function addLastUsedDataSourceToStorage(dsKey: string) {\n  localStorage.setItem(DS_LOCALSTORAGE_KEY, dsKey);\n}\n\nconst SORT_BY_LOCALSTORAGE_KEY = `${pluginJson.id}.values.sort`;\nexport function getSortByPreference(\n  target: string,\n  defaultSortBy: SortBy,\n  defaultDirection: SortDirection\n): { sortBy: SortBy | ''; direction: SortDirection } {\n  const preference = localStorage.getItem(`${SORT_BY_LOCALSTORAGE_KEY}.${target}.by`) ?? '';\n  const parts = preference.split('.');\n  if (!parts[0] || !parts[1]) {\n    return { sortBy: defaultSortBy, direction: defaultDirection };\n  }\n  const sortBy = parts[0] as SortBy;\n  const direction = parts[1] as SortDirection;\n  return { sortBy, direction };\n}\n\nexport function setSortByPreference(target: string, sortBy: string, direction: string) {\n  // Prevent storing empty values\n  if (sortBy && direction) {\n    localStorage.setItem(`${SORT_BY_LOCALSTORAGE_KEY}.${target}.by`, `${sortBy}.${direction}`);\n  }\n}\n\nconst LOG_OPTIONS_LOCALSTORAGE_KEY = `${pluginJson.id}.logs.option`;\nexport type LogOption = 'wrapLines';\nexport function getLogOption(option: LogOption) {\n  return localStorage.getItem(`${LOG_OPTIONS_LOCALSTORAGE_KEY}.${option}`);\n}\n\nexport function setLogOption(option: LogOption, value: string | number | boolean) {\n  let storedValue = value.toString();\n  if (typeof value === 'boolean' && !value) {\n    storedValue = '';\n  }\n  localStorage.setItem(`${LOG_OPTIONS_LOCALSTORAGE_KEY}.${option}`, storedValue);\n}\n\nfunction getExplorationPrefix(sceneRef: SceneObject) {\n  const ds = getDataSourceName(sceneRef);\n  const serviceName = getServiceName(sceneRef);\n  return `${ds}.${serviceName}`;\n}\n\nexport function getDisplayedFields(sceneRef: SceneObject) {\n  const PREFIX = getExplorationPrefix(sceneRef);\n  const storedFields = localStorage.getItem(`${pluginJson.id}.${PREFIX}.logs.fields`);\n  if (storedFields) {\n    return JSON.parse(storedFields);\n  }\n  return [];\n}\n\nexport function setDisplayedFields(sceneRef: SceneObject, fields: string[]) {\n  const PREFIX = getExplorationPrefix(sceneRef);\n  localStorage.setItem(`${pluginJson.id}.${PREFIX}.logs.fields`, JSON.stringify(fields));\n}\n","export const testIds = {\n  appConfig: {\n    container: 'data-testid ac-container',\n    apiKey: 'data-testid ac-api-key',\n    apiUrl: 'data-testid ac-api-url',\n    submit: 'data-testid ac-submit-form',\n  },\n  exploreServiceSearch: {\n    search: 'data-testid search-services',\n  },\n  header: {\n    refreshPicker: 'data-testid RefreshPicker run button',\n  },\n  variables: {\n    datasource: {\n      label: 'data-testid Dashboard template variables submenu Label Data source',\n    },\n    serviceName: {\n      label: 'data-testid Dashboard template variables submenu Label service_name',\n    },\n  },\n  breakdowns: {\n    labels: {},\n    fields: {},\n    common: {\n      sortByFunction: 'data-testid SortBy function',\n      sortByDirection: 'data-testid SortBy direction',\n    },\n  },\n\n  index: {\n    addNewLabelTab: 'data-testid Tab Add label',\n    searchLabelValueInput: 'data-testid search-services-input',\n  },\n\n  exploreServiceDetails: {\n    searchLogs: 'data-testid search-logs',\n    openExplore: 'data-testid open-explore',\n    tabPatterns: 'data-testid tab-patterns',\n    tabLogs: 'data-testid tab-logs',\n    tabFields: 'data-testid tab-fields',\n    tabLabels: 'data-testid tab-labels',\n    buttonRemovePattern: 'data-testid button-remove-pattern',\n    buttonFilterInclude: 'data-testid button-filter-include',\n    buttonFilterExclude: 'data-testid button-filter-exclude',\n  },\n  patterns: {\n    tableWrapper: 'data-testid table-wrapper',\n    buttonIncludedPattern: 'data-testid button-included-pattern',\n    buttonExcludedPattern: 'data-testid button-excluded-pattern',\n  },\n  logsPanelHeader: {\n    header: 'data-testid Panel header Logs',\n    radio: 'data-testid radio-button',\n  },\n  table: {\n    wrapper: 'data-testid table-wrapper',\n    inspectLine: 'data-testid inspect',\n  },\n};\n","import { logger } from './logger';\n\nexport const copyText = async (text: string, buttonRef: React.MutableRefObject<HTMLButtonElement | null>) => {\n  if (navigator.clipboard && window.isSecureContext) {\n    return navigator.clipboard.writeText(text);\n    // eslint-disable-next-line deprecation/deprecation\n  } else if (document.execCommand) {\n    // Use a fallback method for browsers/contexts that don't support the Clipboard API.\n    // See https://web.dev/async-clipboard/#feature-detection.\n    // Use textarea so the user can copy multi-line content.\n    const textarea = document.createElement('textarea');\n    // Normally we'd append this to the body. However if we're inside a focus manager\n    // from react-aria, we can't focus anything outside of the managed area.\n    // Instead, let's append it to the button. Then we're guaranteed to be able to focus + copy.\n    buttonRef.current?.appendChild(textarea);\n    textarea.value = text;\n    textarea.focus();\n    textarea.select();\n    // eslint-disable-next-line deprecation/deprecation\n    document.execCommand('copy');\n    textarea.remove();\n  }\n};\n\nexport function capitalizeFirstLetter(input: string) {\n  if (input.length) {\n    return input?.charAt(0).toUpperCase() + input.slice(1);\n  }\n\n  logger.warn('invalid string argument');\n  return input;\n}\n\nexport function truncateText(input: string, length: number, ellipsis: boolean) {\n  return input.substring(0, length) + (ellipsis && input.length > length ? '' : '');\n}\n","import {\n  AdHocFiltersVariable,\n  CustomVariable,\n  DataSourceVariable,\n  sceneGraph,\n  SceneObject,\n  SceneVariableState,\n} from '@grafana/scenes';\nimport { CustomConstantVariable } from './CustomConstantVariable';\nimport {\n  AdHocFieldValue,\n  FieldValue,\n  JSON_FORMAT_EXPR,\n  LOGS_FORMAT_EXPR,\n  LogsQueryOptions,\n  MIXED_FORMAT_EXPR,\n  VAR_AGGREGATED_METRICS,\n  SERVICE_NAME,\n  VAR_DATASOURCE,\n  VAR_FIELD_GROUP_BY,\n  VAR_FIELDS,\n  VAR_FIELDS_EXPR,\n  VAR_LABEL_GROUP_BY,\n  VAR_LABELS,\n  VAR_LABELS_EXPR,\n  VAR_LEVELS,\n  VAR_LEVELS_EXPR,\n  VAR_LINE_FILTER,\n  VAR_LINE_FILTER_EXPR,\n  VAR_PATTERNS,\n  VAR_PATTERNS_EXPR,\n  VAR_PRIMARY_LABEL,\n  VAR_PRIMARY_LABEL_SEARCH,\n  VAR_METADATA_EXPR,\n  VAR_METADATA,\n} from './variables';\nimport { AdHocVariableFilter } from '@grafana/data';\nimport { logger } from './logger';\n\nexport function getLogsStreamSelector(options: LogsQueryOptions) {\n  const {\n    labelExpressionToAdd = '',\n    structuredMetadataToAdd = '',\n    fieldExpressionToAdd = '',\n    parser = undefined,\n  } = options;\n\n  switch (parser) {\n    case 'structuredMetadata':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_METADATA_EXPR} ${VAR_LEVELS_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTER_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    case 'json':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_METADATA_EXPR} ${VAR_LEVELS_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTER_EXPR} ${JSON_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    case 'logfmt':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_METADATA_EXPR} ${VAR_LEVELS_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTER_EXPR} ${LOGS_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    default:\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_METADATA_EXPR} ${VAR_LEVELS_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTER_EXPR} ${MIXED_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n  }\n}\n\nexport function getPatternsVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PATTERNS, scene);\n  if (!(variable instanceof CustomVariable)) {\n    throw new Error('VAR_PATTERNS not found');\n  }\n  return variable;\n}\n\nexport function getLabelsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_LABELS, scene);\n}\n\nexport function getFieldsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_FIELDS, scene);\n}\n\nexport function getMetadataVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_METADATA, scene);\n}\n\nexport function getLevelsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_LEVELS, scene);\n}\n\nexport function getLineFilterVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_LINE_FILTER, scene);\n  if (!(variable instanceof CustomVariable)) {\n    throw new Error('VAR_LINE_FILTER not found');\n  }\n  return variable;\n}\n\nexport function getLabelGroupByVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_LABEL_GROUP_BY, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_LABEL_GROUP_BY not found');\n  }\n  return variable;\n}\n\nexport function getAggregatedMetricsVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_AGGREGATED_METRICS, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('SERVICE_LABEL_VAR not found');\n  }\n  return variable;\n}\n\nexport function getFieldGroupByVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_FIELD_GROUP_BY, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_FIELD_GROUP_BY not found');\n  }\n  return variable;\n}\n\nexport function getDataSourceVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_DATASOURCE, scene);\n  if (!(variable instanceof DataSourceVariable)) {\n    throw new Error('VAR_DATASOURCE not found');\n  }\n  return variable;\n}\n\nexport function getAdHocFiltersVariable(variableName: string, scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(variableName, scene);\n\n  if (!(variable instanceof AdHocFiltersVariable)) {\n    throw new Error(`Could not get AdHocFiltersVariable ${variableName}. Variable not found.`);\n  }\n  return variable;\n}\n\nexport function getServiceSelectionSearchVariable(sceneRef: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PRIMARY_LABEL_SEARCH, sceneRef);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_PRIMARY_LABEL_SEARCH not found');\n  }\n  return variable;\n}\n\nexport function clearServiceSelectionSearchVariable(sceneRef: SceneObject) {\n  getServiceSelectionSearchVariable(sceneRef).setState({\n    value: '.+',\n    label: '',\n  });\n}\n\nexport function getServiceSelectionPrimaryLabel(sceneRef: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PRIMARY_LABEL, sceneRef);\n  if (!(variable instanceof AdHocFiltersVariable)) {\n    throw new Error('VAR_PRIMARY_LABEL not found');\n  }\n  return variable;\n}\n\nexport function setServiceSelectionPrimaryLabelKey(key: string, sceneRef: SceneObject) {\n  getServiceSelectionPrimaryLabel(sceneRef).setState({\n    filters: [\n      {\n        // the value is replaced by the value in VAR_PRIMARY_LABEL_SEARCH if a search is active, so we just need to set the filter key (label name)\n        value: '.+',\n        operator: '=~',\n        key: key,\n      },\n    ],\n  });\n}\n\nexport function getUrlParamNameForVariable(variableName: string) {\n  return `var-${variableName}`;\n}\n\nexport function getValueFromFieldsFilter(filter: AdHocVariableFilter, variableName: string = VAR_FIELDS): FieldValue {\n  try {\n    return JSON.parse(filter.value);\n  } catch (e) {\n    logger.warn(`Failed to parse ${variableName}`, { value: filter.value });\n\n    // If the user has a URL from before 0.1.4 where detected_fields changed the format of the fields value to include the parser, fall back to mixed parser if we have a value\n    if (filter.value) {\n      return {\n        value: filter.value,\n        parser: 'mixed',\n      };\n    }\n    throw e;\n  }\n}\n\nexport function getValueFromAdHocVariableFilter(\n  variable: AdHocFiltersVariable,\n  filter?: AdHocVariableFilter\n): AdHocFieldValue {\n  if (variable.state.name === VAR_FIELDS && filter) {\n    return getValueFromFieldsFilter(filter);\n  }\n\n  return {\n    value: filter?.value,\n  };\n}\n\nexport function getServiceName(scene: SceneObject) {\n  const labelsVariable = getLabelsVariable(scene);\n  return getServiceNameFromVariableState(labelsVariable.state);\n}\n\nexport function getServiceNameFromVariableState(\n  adHocFiltersVariableState: SceneVariableState & { filters: AdHocVariableFilter[] }\n) {\n  const serviceName = adHocFiltersVariableState.filters\n    .filter((filter) => filter.key === SERVICE_NAME)\n    .map((filter) => filter.value);\n\n  if (!serviceName) {\n    throw new Error('Service present in filters selected');\n  }\n  return serviceName[0];\n}\n\nexport function getDataSourceName(scene: SceneObject) {\n  const dsVariable = getDataSourceVariable(scene);\n  return dsVariable.getValue();\n}\n"],"names":["FilterButton","props","isExcluded","isIncluded","onInclude","onExclude","onClear","titles","buttonFill","styles","useStyles2","getStyles","div","className","container","Button","variant","fill","size","aria-selected","includeButton","onClick","data-testid","testIds","exploreServiceDetails","buttonFilterInclude","title","include","excludeButton","exclude","buttonFilterExclude","theme","css","display","justifyContent","borderRadius","borderRight","undefined","shape","radius","default","borderLeft","graphicContainer","margin","graphic","width","height","padding","spacing","text","alignItems","wrap","GrotError","children","useTheme2","SVG","src","isDark","Text","textAlignment","color","element","PatternTag","onRemove","pattern","expanded","setExpanded","useState","onMouseLeave","Tag","key","name","getPatternPreview","tag","aria-label","buttonRemovePattern","removeButton","Icon","PREVIEW_WIDTH","sm","lg","Math","round","window","innerWidth","length","substringLength","substring","fontFamily","gap","cursor","overflow","borderTopRightRadius","borderBottomRightRadius","backgroundColor","colors","secondary","main","border","boxSizing","textOverflow","paddingLeft","paddingRight","PatternControls","patterns","includePatterns","filter","type","excludePatterns","onRemovePattern","pat","reportAppInteraction","USER_EVENTS_PAGES","service_details","USER_EVENTS_ACTIONS","pattern_removed","includePatternsLength","excludePatternsLength","patternsContainer","weight","buttonIncludedPattern","map","p","buttonExcludedPattern","paddingBottom","flexWrap","GiveFeedbackButton","wrapper","a","href","feedback","target","rel","marginLeft","position","top","alignSelf","fontSize","typography","bodySmall","link","InterceptBanner","Alert","severity","br","interceptBannerStorageKey","PLUGIN_ID","LayoutScene","SceneObjectBase","dismiss","this","setState","interceptDismissed","localStorage","setItem","constructor","state","super","getItem","bodyContainer","flexGrow","minHeight","flexDirection","maxWidth","body","controlsContainer","filters","visibility","flex","controlsWrapper","controls","textAlign","rotateIcon","svg","transform","Component","model","parent","contentScene","control","VariableValueSelectors","selectLabel","primaryLabelName","primaryLabelValue","sceneRef","variable","getLabelsVariable","service_selection","service_selected","value","label","f","operator","FilterOp","Equal","hide","VariableHide","hideLabel","ds","getDataSourceVariable","getValue","SERVICE_NAME","SERVICE_UI_LABEL","addToFavoriteLabelValueInStorage","navigateToInitialPageAfterServiceSelection","SelectServiceButton","labelValue","labelName","button","tooltip","ConfigureVolumeError","TextLink","external","pre","code","NoServiceSearchResults","AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY","pluginJson","ToolbarScene","userOverride","active","config","featureToggles","exploreLogsAggregatedMetrics","isOpen","options","aggregatedMetrics","disabled","toggleAggregatedMetricsOverride","aggregated_metrics_toggled","enabled","toString","onToggleOpen","popover","background","primary","boxShadow","shadows","z3","weak","zIndex","marginRight","heading","fontWeight","fontWeightMedium","gridTemplateColumns","rowGap","columnGap","Dropdown","overlay","evt","stopPropagation","span","AGGREGATED_METRIC_START_DATE","toLocaleString","Switch","onChange","placement","onVisibleChange","ToolbarButton","icon","TabPopoverScene","serviceSelectionScene","sceneGraph","getAncestor","ServiceSelectionScene","serviceSelectionTabsScene","ServiceSelectionTabsScene","tabOptions","showPopover","popoverStyles","getPopoverStyles","tabOptionsWithIcon","opt","saved","counter","Stack","direction","role","card","Select","menuShouldPortal","onBlur","toggleShowPopover","autoFocus","placeholder","isSearchable","openMenuOnFocus","option","setSelectedTab","getLabelsFromQueryRunnerState","$labelsData","data","series","fields","cardinality","values","populatePrimaryLabelsVariableOptions","labels","selectedTab","getSelectedTab","savedTabs","getFavoriteTabsFromStorage","l","savedIndex","indexOf","sort","b","onActivate","runQueries","_subs","add","subscribeToState","getServiceSelectionPrimaryLabel","getTimeRange","newState","LoadingState","Done","some","selectDefaultLabelTab","getSceneQueryRunner","queries","buildResourceQuery","runQueriesMode","removeSavedTab","removeTabFromLocalStorage","addActivationHandler","bind","getTabsStyles","popoverRef","useRef","TabsBar","tabLabel","tab","Tab","onChangeTab","truncateText","suffix","Tooltip","content","onKeyDownCapture","e","cx","Loading","ref","PopoverController","showPopper","hidePopper","popperProps","blurFocusProps","onFocus","current","Popover","rest","show","wrapperClassName","referenceElement","renderArrow","FavoriteServiceHeaderActionScene","setHover","hover","getIconType","isFavorite","removeFromFavoritesInStorage","forceRender","getFavoriteLabelValuesFromStorage","includes","tooltipCopy","onMouseOver","onMouseOut","NoServiceVolume","strong","aggregatedMetricsEnabled","AGGREGATED_SERVICE_NAME","dateTime","primaryLabelUrlKey","datasourceUrlKey","getUrlState","getSelectedTabFromUrl","updateFromUrl","console","log","addDatasourceChangeToBrowserHistory","newDs","location","locationService","getLocation","search","URLSearchParams","dsUrl","get","currentUrl","pathname","set","newUrl","pushUrlHandler","addLabelChangeToBrowserHistory","newKey","replace","primaryLabelRaw","primaryLabelSplit","split","join","getSelectedTabLabel","addTabToLocalStorage","clearServiceSelectionSearchVariable","setServiceSelectionPrimaryLabelKey","buildServiceLayout","timeRange","serviceLabelVar","primaryLabelVar","datasourceVar","splitDuration","to","diff","from","panel","PanelBuilders","timeseries","setTitle","setData","getQueryRunner","buildDataQuery","getMetricExpression","legendFormat","LEVEL_VARIABLE_VALUE","refId","setCustomFieldConfig","mode","StackingMode","Normal","DrawStyle","Bars","setUnit","setOverrides","setLevelColorOverrides","setOption","showLegend","calcs","displayMode","LegendDisplayMode","Table","setHeaderActions","build","extendPanelContext","_","context","extendTimeSeriesLegendBus","SceneCSSGridItem","$behaviors","behaviors","sync","DashboardCursorSync","Crosshair","isAggregatedMetricsActive","toolbar","getQueryOptionsToolbar","formatPrimaryLabelForUI","fixRequiredUrlParams","$data","VAR_PRIMARY_LABEL_EXPR","prevState","filterExpression","runVolumeQuery","areArraysEqual","updateBody","isTimeRangeTooEarlyForAggMetrics","onUnsupportedAggregatedMetricTimeRange","onSupportedAggregatedMetricTimeRange","getAggregatedMetricsVariable","SceneCSSGridLayout","isBefore","IndexScene","find","wrapWildcardSearch","input","unwrapWildcardSearch","slice","updateAggregatedMetricVariable","changeValueTo","updateTabs","tabs","labelsToQuery","getLabels","newChildren","existingChildren","aggregatedMetricsVariable","datasourceVariable","existing","child","vizPanel","push","buildServiceLogsLayout","isLazy","templateColumns","autoRows","md","serviceIndex","splice","getLogExpression","levelFilter","labelsByVolume","dsString","searchString","getServiceSelectionSearchVariable","services","favoriteServicesToQuery","service","toLowerCase","Array","Set","createListOfLabelsToQuery","String","$variables","SceneVariableSet","variables","CustomConstantVariable","VAR_PRIMARY_LABEL_SEARCH","hideVariable","skipUrlSync","VAR_AGGREGATED_METRICS","AdHocFiltersVariable","VAR_PRIMARY_LABEL","expressionBuilder","renderPrimaryLabelFilters","serviceLevel","Map","_urlSync","SceneObjectUrlSyncConfig","keys","onSearchServicesChange","debounce","primaryLabelSearch","searchVar","search_services_changed","searchQuery","getLevelFilterForService","serviceLevels","level","Off","logs","setHoverHeader","maxLines","originalOnToggleSeriesVisibility","onToggleSeriesVisibility","allLevels","getLabelsFromSeries","levels","toggleLevelVisibility","updateServiceLogs","headingWrapper","marginTop","loadingText","header","right","bodyWrapper","x1","searchFieldPlaceholderText","searchWrapper","searchField","serviceStringVariable","searchValue","hasSearch","isLogVolumeLoading","Streaming","volumeApiError","Error","totalServices","renderedServices","Field","ServiceFieldSelector","initialFilter","isLoading","serviceName","onSearchChange","selectOption","IconButton","stateUpdate","drillDownLabel","routeMatch","params","breakdownLabel","getDrilldownSlug","PageSlugs","explore","ServiceScene","updatePatterns","getPatternsVariable","resetVariablesIfNotInUrl","getFieldsVariable","getUrlParamNameForVariable","VAR_FIELDS","getLevelsVariable","VAR_LEVELS","urlParamName","patternsVariable","patternsLine","renderPatternFilters","JSON","stringify","parse","getLastUsedDataSourceFromStorage","variablesScene","unsub","initialDatasourceUid","initialFilters","operators","NotEqual","labelVariable","VAR_LABELS","datasource","EXPLORATION_DS","layout","renderLogQLLabelFilters","_getOperators","fieldsVariable","applyMode","getTagKeysProvider","Promise","resolve","getTagValuesProvider","renderLogQLFieldFilters","metadataVariable","VAR_METADATA","renderLogQLMetadataFilters","levelsVariable","dsVariable","DataSourceVariable","VAR_DATASOURCE","pluginId","dsValue","addLastUsedDataSourceToStorage","CustomVariable","VAR_PATTERNS","VAR_LINE_FILTER","VAR_LOGS_FORMAT","MIXED_FORMAT_EXPR","getVariableSet","SceneControlsSpacer","SceneTimePicker","SceneRefreshPicker","$timeRange","SceneTimeRange","LoadingPlaceholder","AddFilterEvent","BusEventBase","addAdHocFilter","scene","variableType","addToFilters","resolveVariableTypeForField","getAdHocFiltersVariable","validateVariableNameForField","valueObject","parser","getParserForField","fieldValue","getValueFromAdHocVariableFilter","filterExists","valueLabels","publishEvent","replaceFilter","field","variableName","getDetectedLabelsFrame","AddToFiltersButton","getFilter","frame","add_to_filters_in_breakdown_clicked","filterType","action","filtersLength","isSelected","filterInSelectedFilters","filterNameAndValueObj","Object","BreakdownSearchReset","recentFilters","BreakdownSearchScene","filterValues","LabelBreakdownScene","FieldsBreakdownScene","cacheKey","LabelValuesBreakdownScene","FieldValuesBreakdownScene","forEachChild","ByFrameRepeater","isActive","filterByString","logger","warn","typeofBody","onValueFilterChange","event","clearValueFilter","reset","SearchInput","performRepeat","sortedSeries","sortSeries","sortBy","seriesIndex","layoutChild","getLayoutChild","unfilteredChildren","getData","iterateFrames","callback","haystack","frames","getLabelValue","fuzzySearch","filterFrames","filterFn","clearFilter","SceneFlexLayout","SceneFlexItem","SceneReactObject","reactNode","alertContainer","noResultsAlert","clearButton","prevData","minWidth","EmptyLayoutScene","emptyStateStyles","FieldSelector","selected","setSelected","selectableOptions","InlineField","onOpenMenu","onCloseMenu","select","prefix","customOption","setCustomOption","allOptions","selectedOption","selectWrapper","grow","exploreServiceSearch","isClearable","allowCustomValue","__isNew__","actionMeta","onInputChange","meta","prevInputValue","marginBottom","Selector","LayoutSwitcher","groupByVariable","getFieldGroupByVariable","tagKey","detectedFieldsFrame","getDetectedFieldsFrame","queryString","buildFieldsQueryString","query","subscribeToEvent","lastFilterEvent","onValuesDataQueryChange","navigateToFields","setErrorState","errors","err","status","message","traceId","navigateToDrilldownPage","optionValue","getSortByPreference","DEFAULT_SORT_BY","fieldsBreakdownScene","parserForThisField","layouts","FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS","getFilterBreakdownValueScene","expr","Line","FieldsAggregatedBreakdownScene","sortChildren","cardinalityMap","aPanel","bPanel","aCardinality","calculateCardinalityMap","getDetectedFieldsFrameFromQueryRunnerState","i","serviceScene","fieldsCount","updateFieldCount","$detectedFieldsData","onDetectedFieldsChange","buildChildren","childrenClones","clone","limitMaxNumberOfSeriesForPanel","subscribeToPanel","getResultsStream","subscribe","result","isHidden","ALL_VARIABLE_VALUE","isAvgField","queryRunner","dataTransformer","SceneDataTransformer","transformations","limitFramesTransformation","MAX_NUMBER_OF_TIME_SERIES","SelectLabelActionScene","hideValueDrilldown","fieldType","ValueSlugs","viz","gridItem","activeLayout","activeLayoutChildren","activePanels","changeFieldCount","newNamesField","getDetectedFieldsNamesFromQueryRunnerState","prevNamesField","forEach","layoutObj","newFieldsSet","updatedChildren","has","delete","fieldName","limit","source","pipe","averageFields","loading","$detectedLabelsData","SortCriteriaChanged","handleSortByChange","variableChanged","getPrimaryLabelFromUrl","newService","prevService","oldState","updateOptions","checkPrimaryLabel","dataFrame","indexScene","variablesToClear","getVariablesThatCanBeCleared","buildClearFiltersLayout","clearVariables","getFieldOptions","v","getVariables","clearCallback","VAR_FIELD_GROUP_BY","defaultToAll","includeAll","SortByScene","_variableDependency","VariableDependencyConfig","variableNames","value_breakdown_sort_change","criteria","onFieldSelectorChange","select_field_in_breakdown_clicked","previousField","getValueText","view","sortByDirection","navigateToValueBreakdown","blockingMessage","StatusWrapper","textDecoration","paddingTop","LabelsAggregatedBreakdownScene","$detectedLabels","update","updateQueriesOnFieldsVariableChange","getPanelByIndex","detectedLabelsFrame","newLabels","getLabelGroupByVariable","existingLabels","newLabelsSet","detectedLabels","LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS","buildLabelsQuery","getDataTransformer","SceneQueryRunner","error","onDetectedLabelsDataChange","onLabelsVariableChange","onGroupByVariableChange","newPrimaryLabel","prevPrimaryLabel","getLabelOptions","hasAllValue","VAR_LABEL_GROUP_BY","previousLabel","VAR_LABEL_GROUP_BY_EXPR","errorIndex","displayed","showErrorToast","navigateToLabels","activeLayoutContainsNoPanels","getActiveLayout","errorState","getErrorStateAlert","layoutSwitcher","renderError","variableState","labelBreakdownScene","bodyOpts","appEvents","getAppEvents","errorArray","displayError","publish","AppEvents","alertError","payload","RadioButtonGroup","onLayoutChange","layout_type_changed","index","findIndex","o","Input","clearIcon","getExistingFilter","EMPTY_VARIABLE_VALUE","calculateSparsity","newLogsPanelState","logsPanelData","getLogsPanelFrame","showFilterField","getVariable","logLinesWithLabelCount","reduce","acc","VizPanel","percentage","description","onClickViewValues","onClickExcludeEmpty","onClickIncludeEmpty","existingFilter","sortingOptions","ReducerID","stdDev","sum","max","min","fieldReducers","selectOptions","filterReducerOptions","onCriteriaChange","setSortByPreference","onDirectionChange","group","sortByValue","breakdowns","common","htmlFor","sortByFunction","inputId","ENABLED_PERCENTILES","ext","id","getLabelValueFromDataFrame","statusMessage","fontStyle","TimeSeriesLimitSeriesTitleItemScene","currentSeriesCount","titleItems","showAllSeries","toggleShowAllSeries","timeSeriesLimiter","reprocessTransformations","totalLength","timeSeriesDisclaimer","warningMessage","aria-hidden","warning","GoToExploreButton","exploration","openExplore","open_in_explore_clicked","getDataSource","getQueryExpr","trimEnd","exploreState","range","toURLRange","raw","subUrl","appSubUrl","urlUtil","renderUrl","panes","schemaVersion","open","LineFilterIcon","caseSensitive","maxContrast","onCaseSensitiveToggle","viewBox","xmlns","x","y","dominantBaseline","textAnchor","x0_5","LineFilterScene","updateFilter","lineFilter","debounced","updateVariableDebounced","updateVariable","lineFilterValue","getLineFilterVariable","lineFilterString","matches","match","handleChange","handleEnter","escapeRegExp","search_string_in_logs_changed","searchQueryLength","containsLevel","searchLogs","onKeyUp","getField","cache","getFieldByName","DATAPLANE_TIMESTAMP_NAME","DATAPLANE_BODY_NAME","logFrameLabelsToLabels","logFrameLabels","entries","k","getTimeName","logsFrame","timeField","getBodyName","bodyField","tableColumnCustomWidths","LogLineState","TableColumnsContext","createContext","columnWidthMap","setColumnWidthMap","columns","filteredColumns","setColumns","setFilteredColumns","setVisible","visible","bodyState","setBodyState","clearSelectedLine","TableColumnContextProvider","initialColumns","setUrlColumns","removeExtraColumns","initialColumnWidths","existingWidths","msg","getColumnWidthsFromLocalStorage","setColumnWidthMapState","handleSetColumns","useCallback","newColumns","activeColumns","colA","colB","getActiveColumns","handleSetVisible","isVisible","useEffect","pendingLabelState","newColumnsArray","pa","pb","defaultColumns","getDefaultColumns","col","pendingColumns","percentOfLinesWithLabel","Infinity","setDefaultColumns","Provider","labelTypes","columnsToSet","useTableColumnContext","useContext","TableCellContext","cellIndex","numberOfMenuItems","setActiveCellIndex","TableCellContextProvider","cellActive","setCellActive","handleCellActive","useTableCellContext","TableHeaderContext","isHeaderMenuActive","setHeaderMenuActive","TableHeaderContextProvider","handleisHeaderMenuActive","useTableHeaderContext","LogsColumnSearch","setSearchValue","dispatcher","newColumnsWithMeta","numberOfResults","searchResultCount","reportInteraction","resultCount","searchWrap","currentTarget","needle","debouncedFuzzySearch","LogsTableEmptyFields","empty","LogsTableNavField","dragIcon","opacity","labelCount","appearance","pxToRem","contentWrap","customWidthWrap","checkboxLabel","whiteSpace","Checkbox","checked","showCount","omit","draggable","LogsTableActiveFields","reorderColumn","valueFilter","toggleColumn","dragging","columnWrapper","getLogsFieldsStyles","labelKeys","renderTitle","DragDropContext","onDragEnd","destination","Droppable","droppableId","provided","droppableProps","innerRef","la","lb","sortLabels","Draggable","draggableId","snapshot","isDragging","draggableProps","dragHandleProps","collator","Intl","Collator","sensitivity","LogsTableAvailableFields","borderBottom","canvas","Number","compare","LogsTableMultiSelect","sidebarWrap","overflowY","scrollbarWidth","columnHeaderButton","columnHeader","h6","left","clear","filteredColumnsWithMeta","columnsWithMeta","getReorderColumn","sourceIndex","destinationIndex","ColumnSelectionDrawerWrap","ClickOutsideWrapper","useCapture","columnName","logContext","logError","c","priorActiveCount","column","columnAction","columnCount","columnFilterEvent","pendingFilteredLabelState","isDefaultField","DefaultCellWrapComponent","CellWrapInnerComponent","onMouseIn","rowIndex","cellState","bgColor","overflowX","onMouseEnter","initialState","addFilter","selectedLine","QueryContext","QueryContextProvider","useQueryContext","CellContextMenu","pillType","menu","menuItemsWrap","menuItem","showColumn","path","fillRule","clipRule","d","fillOpacity","links","LEVEL_NAME","DefaultPill","levelColor","mappings","getFieldMappings","isPillActive","activePillWrap","pillWrap","pill","menuItemText","FieldType","time","LineActionIcons","clipboardButton","lineHeight","inspectButton","verticalAlign","iconWrapper","z2","inspect","logId","idField","lineValue","isInspecting","setIsInspecting","table","inspectLine","tooltipPlacement","tabIndex","ClipboardButton","getText","searchParams","row","toISOString","origin","Modal","onDismiss","ButtonRow","UrlParameterType","DefaultCellComponent","getCellLinks","displayValue","number","linkWrapper","hasLinks","Boolean","React","formattedValueToString","fieldIndex","showColumns","renderValue","getLinks","DataLinksContextMenu","api","openMenu","LogLinePillValue","activePill","valueWrap","menuActive","onClickAdd","LogLinePill","templateSrv","getTemplateSrv","useMemo","other","originalField","isDerivedField","originalFrame","getLinksSupplier","subFieldName","addFieldToColumns","stopScroll","scrollTo","scrollLeft","Scroller","scrollerRef","scroller","scrollRight","onPointerDown","behavior","onPointerUp","scrollWidth","RawLogLineText","rawLogLine","fontFamilyMonospace","LogLineCellComponent","isHover","setIsHover","untransformedField","rawValue","isDerived","untransformedValue","string","renderLabels","isAuto","auto","hasLabels","ScrollSyncPane","LogsTableHeader","isFirstColumn","isLine","tableHeaderMenu","maxHeight","defaultContentWrapper","defaultContent","LogsTableHeaderWrap","hideColumn","pendingColumnState","columnIndex","cols","isBodyField","headerProps","linkWrap","openColumnManagementDrawer","slideLeft","reverse","slideRight","autoColumnWidths","TableAndContext","GrafanaTable","onColumnResize","onResize","initialSortBy","displayName","desc","initialRowIndex","cellHeight","TableCellHeight","Sm","footerOptions","reducer","countRows","timeZone","section","tableWrap","tableFrame","setTableFrame","localSelectedLine","prepareTableFrame","frameWithOverrides","applyFieldOverrides","replaceVariables","fieldConfig","defaults","custom","overrides","guessLogsFieldTypeForField","filterable","headerComponent","getInitialFieldWidth","cellOptions","getTableCellOptions","prepare","isFieldLokiLabels","typeInfo","DataFrameType","LogLines","isFieldDataplaneLabels","flatMap","format","keepTime","labelFiltersTransform","labelFilters","labelFiltersInclude","indexByName","includeByName","getOrganizeFieldsTransform","buildColumnsWithMeta","specialFields","extraFields","getDefaultStateOrganizeFieldsTransform","transformedDataFrame","lastValueFrom","transformDataFrame","getIdName","lineIndex","cleanLineIndex","Drawer","onClose","ScrollSync","horizontal","vertical","proportional","fieldDisplayName","guessLogsFieldTypeForValue","critical","crit","eror","info","debug","trace","MappingType","ValueToText","cellComponent","TableCellDisplayMode","Custom","tableWidth","numberOfFields","extraPadding","columnMeta","maxLength","iso8601Regex","TableWrap","panelWrapSize","setPanelWrapSize","useResizeObserver","panelWrap","clientWidth","clientHeight","getTimeZone","getColumnsFromProps","fieldNames","previouslySelected","urlColumns","getLogFrameLabelsAsLabels","numberOfLogLines","labelMap","fieldLabels","setObj","valueSet","getCardinalityMapFromLabels","cardinalityCount","fromEntries","normalize","mapLabelsToInitialState","specialFieldArray","addSpecialLabelsState","setSpecialFieldMeta","total","ceil","guessFieldTypeFromValue","test","TableProvider","FieldCache","timestampField","severityField","labelsField","getLogFrameLabels","timeNanosecondField","getLabelFieldName","parseDataplaneLogsFrame","getFirstFieldOfType","getL","lineField","lineLabels","makeLabelsArray","makeLabelsGetter","parseLegacyLogsFrame","LogsPanelHeaderActions","visualisationType","visualisationTypeRadio","vizType","LogsTableScene","parentModel","LogsListScene","visualizationType","timeRangeValue","panelWrapper","PanelChrome","loadingState","actions","setVisualizationType","getVariableForLabel","LogOptionsScene","wrapLines","getLogOption","handleWrapLinesChange","setLogOption","getParentScene","setLogsVizOption","wrapLogMessage","clearDisplayedFields","logs_clear_displayed_fields","displayedFields","transparent","InlineSwitch","horizontalInlineSwitch","LogsPanelScene","getLogsPanel","onOptionsChange","handleLabelFilterClick","handleLabelFilterOutClick","handleIsFilterLabelActive","handleFilterStringClick","onClickShowField","onClickHideField","handleLabelFilter","logs_detail_filter_applied","setDisplayedFields","logs_toggle_displayed_field","displayedField","metadata","hasKeyValueFilter","fieldFilter","getValueFromFieldsFilter","hasKeyValueFilterField","lineFilterScene","getLineFilterScene","logs_popover_line_filter","selectionLength","VISUALIZATION_TYPE_LOCALSTORAGE_KEY","getDisplayedFields","decodedUrlColumns","decodedSelectedTableRow","decodedVisualizationType","setStateFromUrl","updateLogsPanel","selectedLineUrl","urlColumnsUrl","vizTypeUrl","displayedFieldsUrl","getVizPanel","logsPanelScene","xSizing","logs_visualization_toggle","contain","onPatternClick","filteredPatterns","staleIndex","pattern_selected","logsStatsRow","logsStatsRowActive","logsStatsRowLabel","logsStatsRowValue","logsStatsRowCount","logsStatsRowPercent","logsStatsRowBar","logsStatsRowInnerBar","PatternFieldLabelStatsRow","count","proportion","style","percent","barStyle","logsStats","wordBreak","logsStatsHeader","medium","logsStatsTitle","logsStatsClose","logsStatsBody","PatternFieldLabelStats","stats","topRows","activeRow","otherRows","otherCount","combinedRows","stat","PatternNameLabel","patternIndices","indices","currentIndex","extractPatternIndices","setStats","statsError","setStatsError","previousQueryRef","previousTimeRangeRef","handlePatternClick","pattern_field_clicked","patternExtractor","_value","constructQuery","getLokiDatasource","currentTimeRange","requestId","interval","intervalMs","scopedVars","targets","timezone","app","startTime","fieldCount","fieldStatsMap","toArray","fieldStats","convertResultToStats","parts","part","Toggletip","onOpen","Spinner","emphasize","PatternsLogsSampleScene","queryWithFilters","LOG_STREAM_SELECTOR_EXPR","replacePatternsInQuery","queryRunnerWithFilters","onQueryWithFiltersResult","pendingPattern","VAR_PATTERNS_EXPR","removePatternFromFilterExclusion","patternsViewTableScene","PatternsViewTableScene","patternsNotMatchingFilters","setWarningMessage","noticeFlexItem","getNoticeFlexItem","vizFlexItem","getVizFlexItem","getFlexItemChildren","excludeThisPatternFromFiltering","patternsThatDontMatchCurrentFilters","clearFilters","filterVariable","lineFilterVariable","onQueryError","every","traceIds","request","panelFlexItem","queryWithoutFilters","PATTERNS_SAMPLE_SELECTOR_EXPR","queryRunnerWithoutFilters","PatternsTableExpandedRow","tableViz","expandedRows","rowScene","newRowScene","SCALED_UNITS","appliedPatterns","getColumnStyles","cell","panelData","original","dataNode","SceneDataNode","timeSeries","TooltipDisplayMode","None","legend","AxisPlacement","Hidden","setDisplayMode","tableTimeSeriesWrap","tableTimeSeries","sortType","scaledUnits","countTextWrap","toFixed","getTablePatternTextStyles","tablePatternTextDefault","getExplorationFor","disableGrow","existingPattern","appliedPattern","includeLink","excludeLink","undoLink","patternFrames","legendSyncPatterns","logExploration","patternFrame","getTableStyles","patternsFrameScene","PatternsFrameScene","patternFramesRaw","previousValue","tableData","buildTableData","buildColumns","tableWrapper","InteractiveTable","getRowId","r","renderExpandedRow","theme2","overflowWrap","th","navbarFixed","pointerEvents","palette","visualization","newFrame","$patternsData","prevFrame","patternsBreakdownScene","PatternsBreakdownScene","patternFilter","getTimeseriesDataNode","getSingleViewLayout","override","patternsToShow","matcher","names","getTimeSeries","asTable","setLinks","url","targetBlank","fixedColor","overrideToFixedColor","logsByServiceScene","PatternsViewTextSearch","onSearchResult","setFilteredPatterns","patternFramesOverride","filteredPatternFrames","clearSearch","handleSearchChange","setEmptySearch","PatternsNotDetected","PatternsTooOld","PATTERNS_MAX_AGE_HOURS","setBody","dataFrames","updatePatternFrames","onDataChange","ySizing","dataFrameToPatternFrame","newFrames","prevFrames","controlsRight","controlsLeft","justifyItems","patternMissingText","getTimeSeriesExpr","streamSelectorName","excludeEmpty","metadataExpressionToAdd","fieldFilters","getParserFromFieldsFilters","VAR_LABELS_EXPR","VAR_METADATA_EXPR","VAR_LINE_FILTER_EXPR","VAR_FIELDS_EXPR","JSON_FORMAT_EXPR","LOGS_FORMAT_EXPR","timeRangeTooOld","LogsVolumePanel","List","setLogsVolumeFieldConfigs","syncLogsPanelVisibleSeries","SeriesVisibilityChangeMode","AppendToSelection","toggleLevelFromFilter","level_in_logs_volume_clicked","TabNames","breakdownViewsDefinitions","getScene","testId","tabLogs","tabLabels","buildFieldsBreakdownActionScene","changeFieldNumber","tabFields","tabPatterns","valueBreakdownViews","buildLabelValuesBreakdownActionScene","buildFieldValuesBreakdownActionScene","ActionBarScene","currentBreakdownViewSlug","allowNavToParent","drilldownValueSlug","getDrilldownValueSlug","loadingStates","Box","paddingY","getCounter","action_view_changed","newActionView","previousActionView","patternsCount","labelsCount","breakpoints","up","LOGS_PANEL_QUERY_REFID","setSubscribeToLabelsVariable","redirectToStart","prevRouteMatch","replaceSlash","isExact","resetTabCount","getMetadataService","setServiceSceneState","unsubscribe","clearAdHocVariables","navigateToIndex","getServiceSceneState","getMetadata","resetBodyAndData","setBreakdownView","subscribeToPatternsQuery","subscribeToDetectedLabelsQuery","subscribeToDetectedFieldsQuery","subscribeToLogsQuery","subscribeToFieldsVariable","subscribeToMetadataVariable","subscribeToLevelsVariable","subscribeToDataSourceVariable","subscribeToPatternsVariable","subscribeToTimeRange","getMetadataVariable","slug","parentSlug","updateLoadingState","patternsResponse","setPatternsCount","detectedLabelsResponse","detectedLabelsFields","removeSpecialFields","setLabelsCount","detectedFieldsFields","setFieldsCount","getServiceSceneQueryRunner","getPatternsQueryRunner","getDetectedLabelsQueryRunner","getDetectedFieldsQueryRunner","buildGraphScene","breakdownView","breakdownViewDef","valueBreakdownView","valueBreakdownViewDef","getResourceQueryRunner","MultiValueVariable","getValueOptions","args","of","renderSelectForVariable","page","properties","createInteractionName","wasm_not_supported","arr1","arr2","set1","set2","requestSupportsSharding","trim","nodeType","isQueryWithNode","iterate","enter","MetricExpr","isLogsQuery","isLogsRequest","SHARDING_PLACEHOLDER","interpolateShardingSelector","shards","shardValue","RegExp","resolveIdx","destField","sourceField","idx","closestIdx","nanos","compareEntries","destTimeField","destIdField","destIndex","sourceTimeField","sourceIdField","sameTimestamp","compareNsTimestamps","findSourceField","referenceField","sourceFields","candidates","candidate","shallowCompare","TOTAL_BYTES_STAT","getCombinedMetadataStats","destStats","sourceStats","destStat","s","sourceStat","unit","eitherStat","cloneDataFrame","runShardSplitQuery","interpolateVariablesInQueries","splittingTargets","shouldStop","mergedResponse","uuidv4","subquerySubscription","retriesMap","retryTimer","runNextRequest","subscriber","cycle","groupSize","nextGroupSize","retrying","complete","nextRequest","nextCycle","next","retry","errorResponse","floor","sqrt","retries","setTimeout","pow","shardsToQuery","start","groupShardRequests","subRequest","runQuery","partialResponse","constrainGroupSize","response","currentSize","metaExecutionTime","executionTime","updateGroupSizeFromResponse","currentResult","newResult","currentFrame","frame1","frame2","frameType1","TimeSeriesMulti","field1","field2","customType1","frameType","customType2","shouldCombine","dest","sourceTimeValues","totalFields","destIdx","entryExistsInDest","mergeFrames","mergedErrors","mergedError","mergedTraceIds","combineResponses","runNonSplitRequest","Observable","selector","getNodesFromQuery","getSelectorForShardValues","isValidQuery","languageProvider","fetchLabelValues","streamSelector","then","parseInt","getInitialGroupSize","catch","clearTimeout","splitQueriesByStreamShard","DEBUG_ENABLED","WRAPPED_LOKI_DS_UID","DETECTED_FIELDS_NAME_FIELD","DETECTED_FIELDS_CARDINALITY_NAME","DETECTED_FIELDS_PARSER_NAME","DETECTED_FIELDS_TYPE_NAME","WrappedLokiDatasource","RuntimeDataSource","__sceneObject","getDataSourceSrv","valueOf","DataSourceWithBackend","targetsSet","resource","getVolume","getPatterns","getDetectedLabels","getDetectedFields","shardingEnabled","exploreLogsShardSplitting","interpolatedTarget","expression","interpolate","dsResponse","getResource","utc","end","headers","lokiPatterns","maxValue","minValue","timeValues","countValues","samples","createDataFrame","preferredVisualisationType","targetsInterpolated","LABELS_TO_REMOVE","sortLabelsByCardinality","detectedLabelFields","nameField","cardinalityField","parserField","typeField","FIELDS_TO_REMOVE","parsers","volumeResponse","lhs","rhs","lVolumeCount","rVolumeCount","df","metric","labelsResponse","testDatasource","uid","sceneUtils","registerRuntimeDataSource","dataSource","getReducerId","extractParserFromString","parserString","extractParserFromArray","parsersSet","parsersArray","namesField","getTitle","sortByScene","frameIndex","reducerID","selectFrameTransformation","setColor","getColorByIndex","setDisplayName","labelType","labelKey","LabelType","Indexed","StructuredMetadata","Parsed","getLabelTypeFromFrame","getFilterTypeFromLabelType","parserFromFilterValue","fieldExpressionToAdd","structuredMetadataToAdd","getLogsStreamSelector","buildFieldsQuery","optionName","labelExpressionToAdd","visibleLevels","ToggleSelection","existingLevel","getVisibleLevels","levelsFilter","wantedLevels","normalizeLevelName","unwantedLevels","defaultContext","version","ctx","attemptFaroInfo","attemptFaroWarn","attemptFaroErr","logInfo","logWarning","context2","hasData","populateFetchErrorContext","metadataService","initializeMetadataService","MetadataService","serviceSceneState","previousRoute","buildDrilldownPageUrl","extraQueryParams","getUrlSearchParams","DRILLDOWN_URL_KEYS","buildDrilldownPageRoute","newPath","urlLabelName","urlLabelValue","urlPath","prefixRoute","buildValueBreakdownUrl","fullUrl","ROUTES","breakdownUrl","serviceUrl","buildServicesUrl","getSearch","LogsSceneQueryRunner","UNKNOWN_LEVEL_LOGS","matchFieldsWithName","overrideColor","builder","setLevelSeriesOverrides","overrideConfig","FieldMatcherID","byNames","readOnly","overrideCustomFieldConfig","__systemRef","focusedLevels","FieldConfigBuilders","FieldConfigBuilder","onFieldConfigChange","sortLevelTransformation","displayNameFromDS","aName","aVal","bName","queryRunnerOptions","queryParamsOverrides","defaultQueryParams","VAR_DATASOURCE_EXPR","queryType","editorMode","supportingQueryType","positive","negative","positiveGroups","groupBy","positiveFilters","renderMetadata","renderRegexLabelFilter","negativeFilters","fieldFilterToQueryString","excludePatternsLine","includePatternsLine","PLUGIN_BASE_URL","SUB_ROUTES","breakdownLabelName","ROUTE_DEFINITIONS","CHILD_ROUTE_DEFINITIONS","route","SERVICE_URL_KEYS","lastIndexOf","routeParams","startOfUrl","locationArray","buildServicesRoute","extractValuesFromRoute","labelsVariable","sceneObject","visTheme","getColorByName","uf","uFuzzy","intraMode","intraIns","intraSub","intraTrn","intraDel","idxs","order","haystackOrder","matchesSet","mark","matched","infoIdx","highlight","ranges","debounceLodash","memoize","sortSeriesByName","initOutlierDetector","fieldReducer","calculateDataFrameChangepoints","calculateOutlierValue","doStandardCalcs","seriesCalcs","firstTimestamp","lastTimestamp","firstValue","lastValue","allSeriesKey","wasmSupported","dataPoints","samplingStep","sample","Float64Array","ChangepointDetector","defaultArgpcp","detectChangepoints","valueA","valueB","localeCompare","joined","outerJoinDataFrames","joinedSeries","nTimestamps","points","detector","OutlierDetector","dbscan","preprocess","outliers","detect","seriesResults","isOutlier","outlierIntervals","support","WebAssembly","FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY","FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY","DS_LOCALSTORAGE_KEY","dsKey","createPrimaryLabelLocalStorageKey","labelValues","isArray","servicesToStore","unshift","createTabsLocalStorageKey","tabName","tabNames","SORT_BY_LOCALSTORAGE_KEY","defaultSortBy","defaultDirection","LOG_OPTIONS_LOCALSTORAGE_KEY","storedValue","getExplorationPrefix","getDataSourceName","getServiceName","PREFIX","storedFields","appConfig","apiKey","apiUrl","submit","refreshPicker","addNewLabelTab","searchLabelValueInput","logsPanelHeader","radio","capitalizeFirstLetter","charAt","toUpperCase","ellipsis","buttonRef","navigator","clipboard","isSecureContext","writeText","document","execCommand","textarea","createElement","appendChild","focus","remove","VAR_LEVELS_EXPR","lookupVariable","adHocFiltersVariableState","getServiceNameFromVariableState"],"sourceRoot":""}